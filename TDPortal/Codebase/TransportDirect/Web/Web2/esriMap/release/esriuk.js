/**
*   This is a compiled version of ESRI (UK) Custom JavaScript library
*   For use with the ESRI JavaScript API
*   @copyright: ESRI (UK) 2009
*   @author: Sam Larsen, ESRI (UK), slarsen@esriuk.com
*   @date: September 2009
*/
if(!dojo._hasResource["ESRIUK.Util"]){dojo._hasResource["ESRIUK.Util"]=true;if(typeof ESRIUK=="undefined"){ESRIUK={};}ESRIUK.Util=ESRIUK.Util||{};dojo._loadedModules["ESRIUK.Util"]=ESRIUK.Util;dojo.declare("ESRIUK.Util",null,(function(){var _1=function(_2){var s=typeof _2;if(s==="object"){if(_2){if(typeof _2.length==="number"&&!(_2.propertyIsEnumerable("length"))&&typeof _2.splice==="function"){s="array";}}else{s="null";}}return s;};var _4=function(o){var i,v;if(_1(o)==="object"){for(i in o){v=o[i];if(v!==undefined&&_1(v)!=="function"){return false;}}}return true;};String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");};String.prototype.quote=function(){var c,i,l=this.length,o="\"";for(i=0;i<l;i+=1){c=this.charAt(i);if(c>=" "){if(c==="\\"||c==="\""){o+="\\";}o+=c;}else{switch(c){case "\b":o+="\\b";break;case "\f":o+="\\f";break;case "\n":o+="\\n";break;case "\r":o+="\\r";break;case "\t":o+="\\t";break;default:c=c.charCodeAt();o+="\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16);}}}return o+"\"";};String.prototype.supplant=function(o){return this.replace(/{([^{}]*)}/g,function(a,b){var r=o[b];return typeof r==="string"||typeof r==="number"?r:a;});};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};String.prototype.camelCase=function(){var s=trim(this);return (/\S[A-Z]/.test(s))?s.replace(/(.)([A-Z])/g,function(t,a,b){return a+" "+b.toLowerCase();}):s.replace(/( )([a-z])/g,function(t,a,b){return b.toUpperCase();});};return {_logLevel:0,degrees:"<span class='degrees'>&deg;</span>",isValid:false,jsonESRITemplate:{result:{geometryType:"",displayFieldName:"",fieldAliases:null,spatialReference:null,features:[]}},constructor:function(){this.isValid=true;if(this.isNothing(window.console)){this.setupDummyConsole();}this._getURLParams();if(this._logLevel<1){var fcn=function(){return false;};this.logMessage=this.logDebug=this.logInfo=this.logWarning=this.logError=fcn;}else{this.log=this.logMessage;this.debug=this.logDebug;this.info=this.logInfo;this.warn=this.logWarning;this.error=this.logError;}},isNothing:function(){if(arguments.length<1){return true;}var _18=function(obj){return obj===undefined||obj===null;};for(var i=0;i<arguments.length;i++){if(!_18(arguments[0])){return false;}}return true;},isBoolean:function(){if(arguments.length<1){return false;}var _1b=function(obj){return _1(obj)==="boolean";};for(var i=0;i<arguments.length;i++){if(!_1b(arguments[0])){return false;}}return true;},isObject:function(){if(arguments.length<1){return false;}var _1e=function(obj){return _1(obj)==="object";};for(var i=0;i<arguments.length;i++){if(!_1e(arguments[0])){return false;}}return true;},isString:function(){if(arguments.length<1){return false;}var _21=function(obj){return _1(obj)==="string";};for(var i=0;i<arguments.length;i++){if(!_21(arguments[0])){return false;}}return true;},isArray:function(){if(arguments.length<1){return false;}var _24=function(obj){return _1(obj)==="array";};for(var i=0;i<arguments.length;i++){if(!_24(arguments[0])){return false;}}return true;},isNumber:function(){if(arguments.length<1){return false;}var _27=this;var _28=function(obj){if(!_27.isNothing(obj)){if(typeof obj==="string"){if(isNaN(obj)){return false;}else{return true;}}else{if(typeof obj==="number"){return true;}else{return false;}}}else{return false;}};for(var i=0;i<arguments.length;i++){if(!_28(arguments[i])){return false;}}return true;},isStringPopulated:function(obj){return this.isString(obj)&&obj.length>0;},isArrayPopulated:function(obj){return this.isArray(obj)&&obj.length>0;},parseBool:function(obj){if(this.isBoolean(obj)){return obj;}else{if(this.isString(obj)){return (obj.toLowerCase()==="true");}else{return false;}}},parseNumber:function(obj){if(this.isNumber(obj)){return obj*1;}else{this.warn(this.declaredClass,arguments.callee.nom," Could not parse number ",obj);}},isValidXY:function(obj){if(this.isObject(obj)&&this.isNumber(obj.x,obj.y)){return true;}return false;},isValidWH:function(obj){if(this.isObject(obj)&&this.isNumber(obj.w,obj.h)){return true;}return false;},isValidExt:function(obj){if(this.isObject(obj)&&this.isNumber(obj.xmin,obj.ymin,obj.xmax,obj.ymax)){return true;}return false;},validateXY:function(obj){if(this.isString(obj.x)){obj.x=parseFloat(obj.x);}if(this.isString(obj.y)){obj.y=parseFloat(obj.y);}return obj;},validateExt:function(ext){if(typeof ext.xmin==="string"){ext.xmin=parseFloat(ext.xmin);}if(typeof ext.ymin==="string"){ext.ymin=parseFloat(ext.ymin);}if(typeof ext.xmax==="string"){ext.xmax=parseFloat(ext.xmax);}if(typeof ext.ymax==="string"){ext.ymax=parseFloat(ext.ymax);}return ext;},getElmGutterVertical:function(elm){var _35=0;_35+=dojo.style(elm,"paddingLeft");_35+=dojo.style(elm,"paddingRight");return _35;},getElmGutterHorizontal:function(elm){var _37=0;_37+=dojo.style(elm,"paddingTop");_37+=dojo.style(elm,"paddingBottom");return _37;},getST_GeometryExtent:function(ext){var x=ext.toJson();return x.xmin+" "+x.ymin+", "+x.xmin+" "+x.ymax+", "+x.xmax+" "+x.ymax+", "+x.xmax+" "+x.ymin+","+x.xmin+" "+x.ymin;},getESRIJsonExtent:function(ext){var _3b=ext.toJson();_3b.spatialReference="";return _3b;},getValidJSONResponse:function(_3c){var _3d=this.jsonESRITemplate.result;try{var _3e=_3c.result||undefined;if(typeof _3e==="string"){_3e=dojo.fromJson(_3c.result);}else{if(typeof _3e==="object"&&typeof _3e.features==="object"&&typeof _3e.features.length==="number"){_3d=_3e;if(typeof _3e.displayFieldName!=="string"){_3d.displayFieldName="";}if(typeof _3e.geometryType!=="string"){_3d.geometryType="";}if(typeof _3e.fieldAliases!=="object"){_3d.fieldAliases=null;}if(typeof _3e.spatialReference!=="object"){_3d.spatialReference=null;}}else{}}}catch(err){}return _3d;},getValidGraphic:function(obj){var _40=null;var x=obj.x||null;var y=obj.y||null;var _43=obj.paths||null;var _44=obj.rings||null;var _45=obj.spatialReference;if(x&&y){_40=new esri.geometry.Point([x,y],new esri.SpatialReference(_45));}else{if(_43){_40=new esri.geometry.Polyline(obj);}else{if(_44){_40=new esri.geometry.Polygon(obj);}}}return _40;},getPtExtent:function(pt){return new esri.geometry.Extent(pt.x,pt.y,pt.x,pt.y,pt.spatialReference);},formatConnect:function(_47,_48){return {handle:_47,name:_48};},arguments2Array:function(obj){return Array.prototype.slice.call(obj);},setupDummyConsole:function(){window.console={log:function(){return false;},debug:function(){return false;},warn:function(){return false;},info:function(){return false;},error:function(){return false;}};},logMessage:function(){if(this._logLevel>4){}},logDebug:function(){if(this._logLevel>3){}},logInfo:function(){if(this._logLevel>2){}},logWarning:function(){if(this._logLevel>1){}},logError:function(){if(this._logLevel>0){}},log:function(){return false;},debug:function(){return false;},info:function(){return false;},warn:function(){return false;},error:function(){return false;},_getURLParams:function(){try{if(this.isStringPopulated(window.location.search)){var _4a=dojo.queryToObject(window.location.search.slice(1));if(this.isNumber(_4a.debug)){this._setDebugLevel(parseInt(_4a.debug));}}}catch(err){this.log(this.declaredClass,arguments.callee.nom,err,window.location);}},_setDebugLevel:function(obj){if(obj>-1&&obj<6){this._logLevel=obj*1;}}};})());ESRIUK._util=null;ESRIUK.util=function(){if(ESRIUK._util===null){ESRIUK._util=new ESRIUK.Util();}return ESRIUK._util;};}if(!dojo._hasResource["dijit._Contained"]){dojo._hasResource["dijit._Contained"]=true;if(typeof dijit=="undefined"){dijit={};}dijit._Contained=dijit._Contained||{};dojo._loadedModules["dijit._Contained"]=dijit._Contained;dojo.declare("dijit._Contained",null,{getParent:function(){for(var p=this.domNode.parentNode;p;p=p.parentNode){var id=p.getAttribute&&p.getAttribute("widgetId");if(id){var _4e=dijit.byId(id);return _4e.isContainer?_4e:null;}}return null;},_getSibling:function(_4f){var _50=this.domNode;do{_50=_50[_4f+"Sibling"];}while(_50&&_50.nodeType!=1);if(!_50){return null;}var id=_50.getAttribute("widgetId");return dijit.byId(id);},getPreviousSibling:function(){return this._getSibling("previous");},getNextSibling:function(){return this._getSibling("next");},getIndexInParent:function(){var p=this.getParent();if(!p||!p.getIndexOfChild){return -1;}return p.getIndexOfChild(this);}});}if(!dojo._hasResource["dijit.form.TextBox"]){dojo._hasResource["dijit.form.TextBox"]=true;dijit.form=dijit.form||{};dijit.form.TextBox=dijit.form.TextBox||{};dojo._loadedModules["dijit.form.TextBox"]=dijit.form.TextBox;dojo.declare("dijit.form.TextBox",dijit.form._FormValueWidget,{trim:false,uppercase:false,lowercase:false,propercase:false,maxLength:"",templateString:"<input class=\"dijit dijitReset dijitLeft\" dojoAttachPoint='textbox,focusNode'\r\n\tdojoAttachEvent='onmouseenter:_onMouse,onmouseleave:_onMouse'\r\n\tautocomplete=\"off\" type=\"${type}\" ${nameAttrSetting}\r\n\t/>\r\n",baseClass:"dijitTextBox",attributeMap:dojo.delegate(dijit.form._FormValueWidget.prototype.attributeMap,{maxLength:"focusNode"}),_getValueAttr:function(){return this.parse(this.attr("displayedValue"),this.constraints);},_setValueAttr:function(_53,_54,_55){var _56;if(_53!==undefined){_56=this.filter(_53);if(typeof _55!="string"){if(_56!==null&&((typeof _56!="number")||!isNaN(_56))){_55=this.filter(this.format(_56,this.constraints));}else{_55="";}}}if(_55!=null&&_55!=undefined&&((typeof _55)!="number"||!isNaN(_55))&&this.textbox.value!=_55){this.textbox.value=_55;}this.inherited(arguments,[_56,_54]);},displayedValue:"",getDisplayedValue:function(){dojo.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use attr('displayedValue') instead.","","2.0");return this.attr("displayedValue");},_getDisplayedValueAttr:function(){return this.filter(this.textbox.value);},setDisplayedValue:function(_57){dojo.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use attr('displayedValue', ...) instead.","","2.0");this.attr("displayedValue",_57);},_setDisplayedValueAttr:function(_58){if(_58===null||_58===undefined){_58="";}else{if(typeof _58!="string"){_58=String(_58);}}this.textbox.value=_58;this._setValueAttr(this.attr("value"),undefined,_58);},format:function(_59,_5a){return ((_59==null||_59==undefined)?"":(_59.toString?_59.toString():_59));},parse:function(_5b,_5c){return _5b;},_refreshState:function(){},_onInput:function(e){if(e&&e.type&&/key/i.test(e.type)&&e.keyCode){switch(e.keyCode){case dojo.keys.SHIFT:case dojo.keys.ALT:case dojo.keys.CTRL:case dojo.keys.TAB:return;}}if(this.intermediateChanges){var _5e=this;setTimeout(function(){_5e._handleOnChange(_5e.attr("value"),false);},0);}this._refreshState();},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);if(dojo.isMoz||dojo.isOpera){this.connect(this.textbox,"oninput",this._onInput);}else{this.connect(this.textbox,"onkeydown",this._onInput);this.connect(this.textbox,"onkeyup",this._onInput);this.connect(this.textbox,"onpaste",this._onInput);this.connect(this.textbox,"oncut",this._onInput);}this._layoutHack();},_blankValue:"",filter:function(val){if(val===null){return this._blankValue;}if(typeof val!="string"){return val;}if(this.trim){val=dojo.trim(val);}if(this.uppercase){val=val.toUpperCase();}if(this.lowercase){val=val.toLowerCase();}if(this.propercase){val=val.replace(/[^\s]+/g,function(_60){return _60.substring(0,1).toUpperCase()+_60.substring(1);});}return val;},_setBlurValue:function(){this._setValueAttr(this.attr("value"),true);},_onBlur:function(e){if(this.disabled){return;}this._setBlurValue();this.inherited(arguments);},_onFocus:function(e){if(this.disabled){return;}this._refreshState();this.inherited(arguments);},reset:function(){this.textbox.value="";this.inherited(arguments);}});dijit.selectInputText=function(_63,_64,_65){var _66=dojo.global;var _67=dojo.doc;_63=dojo.byId(_63);if(isNaN(_64)){_64=0;}if(isNaN(_65)){_65=_63.value?_63.value.length:0;}_63.focus();if(_67["selection"]&&dojo.body()["createTextRange"]){if(_63.createTextRange){var _68=_63.createTextRange();with(_68){collapse(true);moveStart("character",_64);moveEnd("character",_65);select();}}}else{if(_66["getSelection"]){var _69=_66.getSelection();if(_63.setSelectionRange){_63.setSelectionRange(_64,_65);}}}};}if(!dojo._hasResource["dojo.io.script"]){dojo._hasResource["dojo.io.script"]=true;if(typeof dojo=="undefined"){dojo={};}dojo.io=dojo.io||{};dojo.io.script=dojo.io.script||{};dojo._loadedModules["dojo.io.script"]=dojo.io.script;dojo.io.script={get:function(_6a){var dfd=this._makeScriptDeferred(_6a);var _6c=dfd.ioArgs;dojo._ioAddQueryToUrl(_6c);if(this._canAttach(_6c)){this.attach(_6c.id,_6c.url,_6a.frameDoc);}dojo._ioWatch(dfd,this._validCheck,this._ioCheck,this._resHandle);return dfd;},attach:function(id,url,_6f){var doc=(_6f||dojo.doc);var _71=doc.createElement("script");_71.type="text/javascript";_71.src=url;_71.id=id;_71.charset="utf-8";doc.getElementsByTagName("head")[0].appendChild(_71);},remove:function(id,_73){dojo.destroy(dojo.byId(id,_73));if(this["jsonp_"+id]){delete this["jsonp_"+id];}},_makeScriptDeferred:function(_74){var dfd=dojo._ioSetArgs(_74,this._deferredCancel,this._deferredOk,this._deferredError);var _76=dfd.ioArgs;_76.id=dojo._scopeName+"IoScript"+(this._counter++);_76.canDelete=false;if(_74.callbackParamName){_76.query=_76.query||"";if(_76.query.length>0){_76.query+="&";}_76.query+=_74.callbackParamName+"="+(_74.frameDoc?"parent.":"")+dojo._scopeName+".io.script.jsonp_"+_76.id+"._jsonpCallback";_76.frameDoc=_74.frameDoc;_76.canDelete=true;dfd._jsonpCallback=this._jsonpCallback;this["jsonp_"+_76.id]=dfd;}return dfd;},_deferredCancel:function(dfd){dfd.canceled=true;if(dfd.ioArgs.canDelete){dojo.io.script._addDeadScript(dfd.ioArgs);}},_deferredOk:function(dfd){if(dfd.ioArgs.canDelete){dojo.io.script._addDeadScript(dfd.ioArgs);}if(dfd.ioArgs.json){return dfd.ioArgs.json;}else{return dfd.ioArgs;}},_deferredError:function(_79,dfd){if(dfd.ioArgs.canDelete){if(_79.dojoType=="timeout"){dojo.io.script.remove(dfd.ioArgs.id,dfd.ioArgs.frameDoc);}else{dojo.io.script._addDeadScript(dfd.ioArgs);}}return _79;},_deadScripts:[],_counter:1,_addDeadScript:function(_7b){dojo.io.script._deadScripts.push({id:_7b.id,frameDoc:_7b.frameDoc});_7b.frameDoc=null;},_validCheck:function(dfd){var _7d=dojo.io.script;var _7e=_7d._deadScripts;if(_7e&&_7e.length>0){for(var i=0;i<_7e.length;i++){_7d.remove(_7e[i].id,_7e[i].frameDoc);_7e[i].frameDoc=null;}dojo.io.script._deadScripts=[];}return true;},_ioCheck:function(dfd){if(dfd.ioArgs.json){return true;}var _81=dfd.ioArgs.args.checkString;if(_81&&eval("typeof("+_81+") != 'undefined'")){return true;}return false;},_resHandle:function(dfd){if(dojo.io.script._ioCheck(dfd)){dfd.callback(dfd);}else{dfd.errback(new Error("inconceivable dojo.io.script._resHandle error"));}},_canAttach:function(_83){return true;},_jsonpCallback:function(_84){this.ioArgs.json=_84;}};}if(!dojo._hasResource["ESRIUK.Dijits.Loading"]){dojo._hasResource["ESRIUK.Dijits.Loading"]=true;(function(){ESRIUK.Dijits=ESRIUK.Dijits||{};ESRIUK.Dijits.Loading=ESRIUK.Dijits.Loading||{};dojo._loadedModules["ESRIUK.Dijits.Loading"]=ESRIUK.Dijits.Loading;var _85=ESRIUK.util();dojo.declare("ESRIUK.Dijits.Loading",[dijit._Widget,dijit._Templated],{counter:0,templateString:"<div class='mapOverlay semiTransparent loadingIcon mapPanel noDisplay'><img src='${imagePath}ajax-loader.gif' /><span>&nbsp;&nbsp;Loading&nbsp;...&nbsp;</span></div>",imagePath:dojo.moduleUrl("ESRIUK.Dijits","images/Loading/"),loadingMaxTime:30000,loadingTimer:null,toggle:function(on){var _87=this;on=_85.isBoolean(on)?on:false;if(_85.isNumber(this.loadingTimer)){clearTimeout(this.loadingTimer);}if(on){this.counter++;if(this.counter==1){this.domNode.style.display="block";}}else{this.counter--;if(this.counter<1){this.domNode.style.display="none";}if(this.counter<0){this.counter=0;}}if(this.counter>0){this.loadingTimer=setTimeout(function(){_87.switchOff();},this.loadingMaxTime);}},switchOff:function(){this.counter=0;this.domNode.style.display="none";}});})();}if(!dojo._hasResource["ESRIUK.Dijits.Query"]){dojo._hasResource["ESRIUK.Dijits.Query"]=true;ESRIUK.Dijits.Query=ESRIUK.Dijits.Query||{};dojo._loadedModules["ESRIUK.Dijits.Query"]=ESRIUK.Dijits.Query;dojo.declare("ESRIUK.Dijits.Query",esri.layers.Layer,(function(){var _88=ESRIUK.util(),_89=ESRIUK.config();sConfig=null,jsonHandler=null;return {loaded:false,_extentQueries:0,_loading:function(){return false;},setLoading:function(fcn){this._loading=fcn;},constructor:function(_8b,_8c){sConfig=_8b;this._loading=_8c;this._loading(true);this._checkConfig();this._loadJSONHandler();},onLoad:function(){this.inherited(arguments);this._loading(false);},_cleanUp:function(){this.loaded=false;this._extentQueries=0;},_checkConfig:function(){if(!_88.isObject(sConfig.errorStrings)){sConfig.errorStrings={};}},_load:function(){this._loaded=true;jsonHandler=new TransportDirectQueryWebService();},_loadJSONHandler:function(){var _8d=this,_8e=arguments.callee.nom;var _8f={url:sConfig.url,checkString:sConfig.checkString,timeout:20000,load:function(_90,_91){if(_8d._loaded){}else{try{_8d._load();}catch(err){_89.events.queryError({message:_8d.declaredClass+"."+_8e+" - Failed to load Query Service JavaScript: error processing response ",innerException:err,request:_91},_90);}}},error:function(_92,_93){_89.events.queryError({message:_8d.declaredClass+"."+_8e+" - Failed to load Query Service JavaScript: script not loaded",innerException:_93,request:_93},_92);}};dojo.io.script.get(_8f);},queryPoint:function(_94,_95){this._loading(true);var _96=this,_97=arguments.callee.nom,_98=" jsonHandler.queryPoint ";jsonHandler.queryPoint(_94.x,_94.y,function(obj){try{var _9a=false;if(_88.isObject(obj)){if(_88.isObject(obj.result)){var _9b=obj.result;if(_88.isArray(_9b.results)){_9a=true;_96._queryResults=_9b.results;_95(_9b.results);}}}if(!_9a){_89.events.queryError({message:_96.declaredClass+"."+_97+" - Failed to query point: error processing response ",innerException:{code:_9b.errorStatusCode,message:_9b.errorMessage}},obj);}}catch(err){_89.events.queryError({message:_96.declaredClass+"."+_97+" - Failed to query point: error processing response.  Response message:"+_9b.errorMessage,code:_9b.errorStatusCode,innerException:err},obj);}finally{_96._loading(false);}});},getInitFeatures:function(_9c,map,_9e,_9f,_a0,_a1){var _a2=this,_a3=arguments.callee.nom;try{if(_88.isObject(_a1)){this.getExtentFeatures(_9c,map,_9e,_9f,function(obj){try{_a0.call(_a1,obj);_a2.loaded=true;_a2.onLoad(_a2);}catch(err){_89.events.queryError({message:_a2.declaredClass+"."+_a3+" failure parsing response",innerException:err},obj);}},null);}else{this.getExtentFeatures(_9c,map,_9e,_9f,function(obj){try{_a0(obj);_a2.loaded=true;_a2.onLoad(_a2);}catch(err){_89.events.queryError({message:_a2.declaredClass+"."+_a3+" failure parsing response",innerException:err},obj);}},_a1);}}catch(err){_89.events.queryError({message:this.declaredClass+"."+arguments.callee.nom+" Error querying extent features",data:arguments,innerException:err},null);}},getExtentFeatures:function(_a6,map,_a8,_a9,_aa,_ab){this._loading(true);var _ac=this,lod=esri.version<1.5?map._LOD:map.__LOD,_ae=false,_af=arguments.callee.nom,_b0=" jsonHandler.getExtentFeatures ";this._extentQueries++;_a9=_88.isNothing(_a9)?_89.filter.standard:_a9;jsonHandler.queryExtent(_a6.xmin,_a6.ymin,_a6.xmax,_a6.ymax,lod.resolution,_a8.pointX,_a8.stops,_a8.carparkLayerVisible,_a9,function(obj){try{var _b2=0;if(_88.isObject(obj)&&_88.isObject(obj.result)&&_ac._extentQueries<2){var _b3=obj.result;if(_88.isArray(_b3.results)){_ae=true;_b2=_b3.results.length;if(_88.isObject(_ab)){_aa.call(_ab,_b3.results);}else{_aa(_b3.results);}if(_b3.errorStatusCode===650){_b2=-1;}}}_89.events.mapGraphicsCount(_b2);if(!_ae){_89.events.queryError({message:_ac.declaredClass+"."+_af+" Failed to parse response ",data:[_a6,map,_a8,_a9],innerException:{code:_b3.errorStatusCode,message:_b3.errorMessage}},obj);}}catch(err){_89.events.queryError({message:_ac.declaredClass+"."+_af+" Failed to parse response",data:[_a6,map,_a8,_a9],innerException:err},obj);}finally{_ac._extentQueries--;_ac._loading(false);_ac._loading(false);}});},findJunctionPoint:function(_b4,_b5){var _b6=this,_b7=arguments.callee.nom,_b8=" jsonHandler.findJunctionPoint ",_b9;try{_b9=jsonHandler.findJunctionPoint(_b4,_b5);if(_88.isObject(_b9)&&_88.isValidXY(_b9)&&_b9.errorStatusCode==200){return _88.validateXY(_b9);}else{throw _b9;}}catch(err){_89.events.error({message:_b6.declaredClass+"."+_b7+" failed",innerException:err},_b9);throw err;}},findITNNodePoint:function(_ba){var _bb=this,_bc=arguments.callee.nom,_bd=" jsonHandler.findITNNodePoint ",_be;try{_be=jsonHandler.findITNNodePoint(_ba);if(_88.isObject(_be)&&_88.isValidXY(_be)&&_be.errorStatusCode==200){return _88.validateXY(_be);}else{throw _be;}}catch(err){_89.events.error({message:_bb.declaredClass+"."+_bc+" failed",innerException:err},_be);throw err;}},getTravelNewsInfo:function(id,_c0,_c1){this._loading(true);var _c2=this,_c3=this.declaredClass,_c4=" jsonHandler.getRoadEnvelope ";jsonHandler.getTravelNews(id,function(obj){try{var _c6=false,_c7=_89.statics;if(_88.isObject(obj)&&_88.isObject(obj.result)){if(_88.isArrayPopulated(obj.result.results)){var _c8=obj.result.results[0],_c9="",_ca=null,_cb=null,_cc=null,div=dojo.create("div");elements=[],arr=sConfig.roadIncidentQueryFields;caps=function(s){var _cf=s.slice(0,1),_d0=s.slice(1,s.length);return _cf.toUpperCase()+_d0;};if(_88.isStringPopulated(_c8.type)&&_c8.type==="TravelNews"&&_88.isArrayPopulated(_c8.values)){_cb=_c8.values;_ca=_cb.length;var _d1=dojo.create("tbody",null,dojo.create("table",{cellpadding:0,cellspacing:0},div));for(var i=0;i<_ca-2;i++){_cc=arr[i];elm=dojo.create("tr",null,_d1);dojo.create("td",{innerHTML:_cc+":","class":_c7.cssTravelNewsField},elm);dojo.create("td",{innerHTML:_cb[i].replace("&apos;","&#039;"),"class":_c7.cssTravelNewsBody},elm);}var e=_c7.travelNewsEnum,_d4=_cb[dojo.indexOf(arr,sConfig.roadIncidentTypeField)],_d5=_88.parseBool(_cb[dojo.indexOf(arr,sConfig.roadIncidentPlannedField)]);_c9=_88.parseBool(_d5)?_d4==="Road"?e.pRoad:e.pRail:_d4==="Road"?e.upRoad:e.upRail;if(_88.isObject(_c1)){_c0.call(_c1,_c9,[div]);}else{_c0(_c9,[div]);}_c6=true;}}}if(!_c6){_89.events.queryError({message:_c2.declaredClass+"."+_c3+" Failed to parse Travel News response",innerException:{code:obj.result.errorStatusCode,message:obj.result.errorMessage}},obj);}}catch(err){_89.events.queryError({message:_c2.declaredClass+"."+_c3+" Failed to parse Travel News response",innerException:err},obj);}finally{_c2._loading(false);}});},getPointXInfo:function(id,_d7,_d8){this._loading(true);var _d9=this,_da=this.declaredClass;jsonHandler.getPointX(id,function(obj){try{var _dc=false,_dd=" jsonHandler.getPointXInfo ";if(_88.isObject(obj)&&_88.isObject(obj.result)){if(_88.isArrayPopulated(obj.result.results)){var _de=obj.result.results[0],_df=[],_e0=null;if(_88.isStringPopulated(_de.type)&&_88.isArrayPopulated(_de.values)){var _e1=_de.values;_e0=_e1[0];for(var i=1;i<_e1.length;i++){if(_e1[i]!==""){_df.push(dojo.create("span",{innerHTML:_e1[i].replace("&apos;","&#039;")}));}}_dc=true;if(_88.isObject(_d8)){_d7.call(_d8,_e0,_df);}else{_d7(_e0,_df);}}}}if(!_dc){_89.events.queryError({message:_d9.declaredClass+"."+_da+" Failed to parse PointX response",innerException:{code:obj.result.errorStatusCode,message:obj.result.errorMessage}},obj);}}catch(err){_89.events.queryError({message:_d9.declaredClass+"."+_da+" Failed to parse Point X response",innerException:err},obj);}finally{_d9._loading(false);}});},getRouteEnvelope:function(_e3,id,_e5){var _e6=this,_e7=arguments.callee.nom,_e8=" jsonHandler.getRouteEnvelope ",_e9;try{_e9=jsonHandler.getRouteEnvelope(_e3,id,_e5);if(_88.isObject(_e9)&&_88.isValidExt(_e9)&&_e9.errorStatusCode==200){return _88.validateExt(_e9);}else{throw _e9;}}catch(err){_89.events.error({message:_e6.declaredClass+"."+_e7+" failed",innerException:err},_e9);throw err;}}};})());}if(!dojo._hasResource["ESRIUK.Dijits.MapNavPanel"]){dojo._hasResource["ESRIUK.Dijits.MapNavPanel"]=true;ESRIUK.Dijits.MapNavPanel=ESRIUK.Dijits.MapNavPanel||{};dojo._loadedModules["ESRIUK.Dijits.MapNavPanel"]=ESRIUK.Dijits.MapNavPanel;dojo.declare("ESRIUK.Dijits.MapNavPanel",[dijit._Widget,dijit._Templated],(function(){var _ea=ESRIUK.util(),_eb=ESRIUK.config();return {_statics:{altSuffix:" navigation image",panNorth:"Pan North",panEast:"Pan East",panSouth:"Pan South",panWest:"Pan West",fullExtent:"Full Extent"},widgetsInTemplate:true,templateString:"<div class=\"navPanelContainer\">\r\n    <div class=\"navPanelHolder mapPanel\">\r\n        <div class=\"navPanelItem top centre\" dojoAttachEvent='onclick:_onPanNorth'>\r\n            <img title=\"${_statics.panNorth}\" alt=\"${_statics.panNorth}${_statics.altSuffix}\" src=\"${imagePath}panNorth${navImgType}\" class=\"transparentPNG\" />\r\n        </div>\r\n        <div class=\"navPanelItem middle left\" dojoAttachEvent='onclick:_onPanWest'>\r\n            <img title=\"${_statics.panWest}\" alt=\"${_statics.panWest}${_statics.altSuffix}\" src=\"${imagePath}panWest${navImgType}\" class=\"transparentPNG\" />\r\n        </div>\r\n        <div class=\"navPanelItem middle centrePlus\" dojoAttachEvent='onclick:_onPanFullExtent'>\r\n            <img title=\"${_statics.fullExtent}\" alt=\"${_statics.fullExtent}${_statics.altSuffix}\" src=\"${imagePath}panFullExtent${navImgType}\" class=\"transparentPNG\" />\r\n        </div>\r\n        <div class=\"navPanelItem middle right\" dojoAttachEvent='onclick:_onPanEast'>\r\n            <img title=\"${_statics.panEast}\" alt=\"${_statics.panEast}${_statics.altSuffix}\" src=\"${imagePath}panEast${navImgType}\" class=\"transparentPNG\" />\r\n        </div>\r\n        <div class=\"navPanelItem bottom centre\" dojoAttachEvent='onclick:_onPanSouth' >\r\n            <img title=\"${_statics.panSouth}\" alt=\"${_statics.panSouth}${_statics.altSuffix}\" src=\"${imagePath}panSouth${navImgType}\" class=\"transparentPNG\" />\r\n        </div>\r\n    </div>\r\n</div>\r\n",imagePath:dojo.moduleUrl("ESRIUK.Dijits","images/MapNavPanel/"),navImgType:".png",constructor:function(){try{var obj=_eb.statics.mapNavPanel;if(_ea.isObject(obj)){dojo.mixin(this._statics,obj);}}catch(err){}},bindEvents:function(_ed,_ee,_ef,_f0,_f1){this._onPanNorth=_ed;this._onPanSouth=_ee;this._onPanEast=_ef;this._onPanWest=_f0;this._onPanFullExtent=_f1;},_onPanNorth:function(){},_onPanWest:function(){},_onPanFullExtent:function(){},_onPanEast:function(){},_onPanSouth:function(){}};})());}if(!dojo._hasResource["ESRIUK.Dijits.MapToolBarPanel"]){dojo._hasResource["ESRIUK.Dijits.MapToolBarPanel"]=true;ESRIUK.Dijits.MapToolBarPanel=ESRIUK.Dijits.MapToolBarPanel||{};dojo._loadedModules["ESRIUK.Dijits.MapToolBarPanel"]=ESRIUK.Dijits.MapToolBarPanel;dojo.declare("ESRIUK.Dijits.MapToolBarPanel",[dijit._Widget,dijit._Templated],(function(){var _f2=ESRIUK.util(),_f3=ESRIUK.config();return {_statics:{altSuffix:" tool image",panMap:"Pan Map",userDefined:"Add A User Defined Location",selectNearby:"Select A Nearby Point"},isShowing:false,tools:[],widgetsInTemplate:true,templateString:"<div class=\"toolbarPanelContainer\" style=\"display:none\">\r\n    <div class=\"toolbarPanelHolder mapPanel\">\r\n        <span class=\"toolbarPanelItem selected default\" dojoAttachPoint=\"attachDefault\">\r\n            <img title=\"${_statics.panMap}\" alt=\"${_statics.panMap}${_statics.altSuffix}\" src=\"${imagePath}default-map-actions${navImgType}\" dojoAttachEvent='onclick:_onDefaultMapActions' class=\"transparentPNG\" />\r\n        </span>\r\n        <span class=\"toolbarPanelItem\" dojoAttachPoint=\"attachUserDefined\">\r\n            <img title=\"${_statics.userDefined}\" alt=\"${_statics.userDefined}${_statics.altSuffix}\" src=\"${imagePath}user-defined-location${navImgType}\" dojoAttachEvent='onclick:_onUserDefinedLocation' class=\"transparentPNG\" />\r\n        </span>                \r\n        <span class=\"toolbarPanelItem\" dojoAttachPoint=\"attachSelectNearby\">\r\n            <img title=\"${_statics.selectNearby}\" alt=\"${_statics.selectNearby}${_statics.altSuffix}\" src=\"${imagePath}select-nearby-point${navImgType}\" dojoAttachEvent='onclick:_onSelectNearbyPoint' class=\"transparentPNG\" />\r\n        </span>        \r\n    </div>\r\n</div>\r\n",imagePath:dojo.moduleUrl("ESRIUK.Dijits","images/MapToolBarPanel/"),navImgType:".png",constructor:function(){try{var obj=_f3.statics.mapToolbarPanel;if(_f2.isObject(obj)){dojo.mixin(this._statics,obj);}}catch(err){}},init:function(_f5){_f5=_f2.isArrayPopulated(_f5)?_f5:[];var _f6=false,_f7=false;this.tools=_f5;for(var i=0;i<_f5.length;i++){if(_f5[i]==="selectNearby"){_f7=true;this.isShowing=true;}else{if(_f5[i]==="userDefined"){_f6=true;this.isShowing=true;}}}dojo.style(this.domNode,{display:this.isShowing?"block":"none"});if(!_f6){dojo.style(this.attachUserDefined,{display:"none"});}if(!_f7){dojo.style(this.attachSelectNearby,{display:"none"});}},bindEvents:function(_f9,_fa,_fb){this._onDefaultMapActions=_f9;this._onUserDefinedLocation=_fa;this._onSelectNearbyPoint=_fb;},_onDefaultMapActions:function(){},_onUserDefinedLocation:function(){},_onSelectNearbyPoint:function(){},getCurrentActiveTool:function(){var _fc=_f3.statics.cssSelectedToolClass;var arr=dojo.query("."+_f3.statics.cssToolItemClass,this.domNode);for(var i=0;i<arr.length;i++){if(dojo.hasClass(arr[i],_fc)){return arr[i];}}},getDefaultTool:function(){return dojo.query("."+_f3.statics.cssDefaultToolClass,this.domNode)[0];},toggleActiveTool:function(_ff){if(_f2.isStringPopulated(_ff)){var _100=_f3.toolBar.typeEnum;if(_ff===_100.defaultTool){_ff=this.attachDefault;}else{if(_ff===_100.userDefinedLocation){_ff=this.attachUserDefined;}else{if(_ff===_100.selectNearbyPoint){_ff=this.attachSelectNearby;}else{_ff=dojo.byId(_ff);}}}}else{if(!_f2.isObject(_ff)){return false;}}this._resetAllTools();dojo.addClass(_ff,_f3.statics.cssSelectedToolClass);},_resetAllTools:function(){var _101=_f3.statics.cssSelectedToolClass;var arr=dojo.query("."+_f3.statics.cssToolItemClass,this.domNode);for(var i=0;i<arr.length;i++){dojo.removeClass(arr[i],_101);}}};})());}if(!dojo._hasResource["ESRIUK.Dijits.IMSServerStateLayer"]){dojo._hasResource["ESRIUK.Dijits.IMSServerStateLayer"]=true;ESRIUK.Dijits.IMSServerStateLayer=ESRIUK.Dijits.IMSServerStateLayer||{};dojo._loadedModules["ESRIUK.Dijits.IMSServerStateLayer"]=ESRIUK.Dijits.IMSServerStateLayer;dojo.declare("ESRIUK.Dijits.IMSServerStateLayer",esri.layers.DynamicMapServiceLayer,(function(){var util=ESRIUK.util(),_105=ESRIUK.config(),_106=null;return {_requestId:0,_loaded:false,_initRoutes:false,_lastScale:null,_layers:{},_externalConfig:null,_loading:function(){return false;},setLoading:function(fcn){this._loading=fcn;},ovUrl:"",urlTest:null,constructor:function(_108,_109,_10a){this._loading=_10a;this._loading(true);this._cleanUp(_108,_109);this._checkConfig();this._loadJSONHandler();},onLoad:function(){this.inherited(arguments);this._loading(false);},_cleanUp:function(_10b,_10c){this._requestId=0;this._loaded=false;this._lastScale=null;this._layers={};this.ovUrl="";this._externalConfig={travelNews:null,sumbols:[],routes:[]};if(util.isObject(_10c.travelNews)){_10b.travelNews=_10c.travelNews;}if(util.isArrayPopulated(_10c.symbols)){_10b.symbols=_10c.symbols;}if(util.isArrayPopulated(_10c.routes)){_10b.routes=_10c.routes;}this._externalConfig=_10b;},_checkConfig:function(){if(!util.isObject(this._externalConfig.errorStrings)){this._externalConfig.errorStrings={no_imageUrl:" Result does not contain valid imageUrl. ",no_errorStatusCode:" Result does not contain valid errorStatusCode. ",no_result:" No valid result was returned. ",no_response:" No valid response was returned. ",invalid_status:" Invalid status code returned. ",invalid_url:" Invalid image url returned. "};}this.urlTest=this._externalConfig.imgUrlPattern||/^http:\/\/.+(\.png|\.jpg|\.gif)$/;},_load:function(){var m=esri.config.defaults.map;this._loaded=true;this._loadInitMap(m.width,m.height);},_loadJSONHandler:function(){var that=this,_10f=arguments.callee.nom;var _110={url:this._externalConfig.url,checkString:this._externalConfig.checkString,timeout:50000,load:function(_111,_112){if(that._loaded){}else{try{that._load();}catch(err){_105.events.queryError({message:that.declaredClass+"."+_10f+" - Failed to load Map Service JavaScript: error processing response ",innerException:err,request:_112},_111);}}},error:function(_113,_114){var str=that.declaredClass+"."+_10f+" script not loaded ";_105.events.queryError({message:that.declaredClass+"."+_10f+" - Failed to load Map Service JavaScript: script not loaded",innerException:_114,request:_114},_113);}};dojo.io.script.get(_110);},_overrideInitExtent:function(_116){if(_116 instanceof esri.geometry.Extent){this.initialExtent=_116;}dojo.unsubscribe(this._configExtentHandler);},_loadInitMap:function(_117,_118){var that=this,_11a=arguments.callee.nom,_11b=" jsonHandler.initMap ",_11c=function(obj){try{if(!util.isNothing(obj)){if(!util.isNothing(obj.result)){var _11e=obj.result;if(util.isBoolean(_11e.isValid)&&_11e.isValid===true){that.initialExtent=that.fullExtent=new esri.geometry.Extent({xmin:_11e.xmin,ymin:_11e.ymin,xmax:_11e.xmax,ymax:_11e.ymax,spatialReference:new esri.SpatialReference({wkid:_105.map.wkid})});that.spatialReference=new esri.SpatialReference({wkid:_105.map.wkid});that._readMapLayers(_11e);if(that._initRoutes){dojo.publish("esriukMap/newInitExtent",[that.initialExtent]);that._configExtentHandler=dojo.subscribe("esriukMap/oldInitExtent",that._overrideInitExtent);}that.loaded=true;that.onLoad(that);}}}if(!that.loaded){var str=that.declaredClass+"."+_11a+" "+_11b+"not successful";_105.events.mapError({message:that.declaredClass+"."+_11a+" "+_11b+" Failed parsing response ",innerException:null},obj);}}catch(err){_105.events.mapError({message:that.declaredClass+"."+_11a+" "+_11b+" Failed parsing response ",innerException:err},obj);}};try{_106=new TransportDirectMapWebService();var _120=this._externalConfig,_121=util.isArrayPopulated(_120.symbols),_122=util.isArrayPopulated(_120.routes);this._initRoutes=_122;if(util.isObject(_120.travelNews)){if(_121){if(_122){_106.initMap_Sym_TN_R(_117,_118,_120.travelNews,_120.symbols,_120.routes,_11c);}else{_106.initMap_Symbols_TravelNews(_117,_118,_120.travelNews,_120.symbols,_11c);}}else{if(_122){_106.initMap_TN_R(_117,_118,_120.travelNews,_120.routes,_11c);}else{_106.initMapAndTravelNews(_117,_118,_120.travelNews,_11c);}}}else{if(_121){if(_122){_106.initMap_Sym_R(_117,_118,_120.symbols,_120.routes,_11c);}else{_106.initMapAndSymbols(_117,_118,_120.symbols,_11c);}}else{if(_122){_106.initMap_Routes(_117,_118,_120.routes,_11c);}else{_106.initMap(_117,_118,_11c);}}}}catch(err){_105.events.mapError({message:this.declaredClass+"."+_11a+" Failed calling initial map request ",innerException:err},null);}},getImageUrl:function(_123,_124,_125,_126){var that=this,map=this._map,lod=esri.version<1.5?map._LOD:map.__LOD,_12a=lod.scale,_12b=_105.events,_12c=this._lastScale==_12a?false:true,_12d=arguments.callee.nom,_12e=" jsonHandler.getImage ";this._loading(true);this._loading(true);this._requestId++;if(_12c){this._lastScale=_12a;}_106.getImage(_123.xmin,_123.ymin,_123.xmax,_123.ymax,_12c,function(obj){try{if(util.isNumber(obj.id)){if(obj.id!==that._requestId){return;}}var _130=that._jsonResponseHandler(obj,_126);if(!_130.valid){_105.events.mapError({message:that.declaredClass+"."+_12d+" "+_12e+" Failed parsing response ",innerException:null},obj);}else{_12b.onMapExtentChange(map.extent,_12c,_12a,that.ovUrl);}}catch(err){_105.events.mapError({message:that.declaredClass+"."+_12d+" "+_12e+" Failed parsing response ",innerException:err},obj);}finally{that._loading(false);}});},addStartEndPt:function(pt){var that=this,_133=arguments.callee.nom,_134=" jsonHandler.addPoint ";var _135=function(_136){that._replaceImageUrl(_136);};this._loading(true);this._requestId++;_106.addPoint(pt,function(obj){var _138=that._jsonResponseHandler(obj,_135);if(!_138.valid){_105.events.mapError({message:that.declaredClass+"."+_133+" "+_134+" Failed parsing response ",innerException:null},obj);}that._loading(false);});},clearPoints:function(type){var that=this,_13b=arguments.callee.nom,_13c=" jsonHandler.clearPoints ";type=util.isStringPopulated(type)?type:"";this._loading(true);this._requestId++;var _13d=function(_13e){that._replaceImageUrl(_13e);};_106.clearPoints(type,function(obj){try{var _140=that._jsonResponseHandler(obj,_13d);if(!_140.valid){_105.events.mapError({message:that.declaredClass+"."+_13b+" "+_13c+" Failed parsing response ",innerException:null},obj);}}catch(err){throw err;}finally{that._loading(false);}});},setLayerState:function(_141){var that=this,_143=arguments.callee.nom,_144=" jsonHandler.setLayerStates ";if(util.isObject(_141)){dojo.mixin(this._layers,_141);}else{return;}this._loading(true);this._requestId++;var _145=function(_146){that._replaceImageUrl(_146);};_106.setLayerStates(_141.pointX,_141.stops,_141.carparkLayerVisible,function(obj){try{var _148=that._jsonResponseHandler(obj,_145);if(!_148.valid){_105.events.mapError({message:that.declaredClass+"."+_143+" "+_144+" Failed parsing response ",innerException:null},obj);}}catch(err){throw err;}finally{that._loading(false);}});},setTravelNewsLayers:function(_149){var that=this,_14b=arguments.callee.nom,_14c=" jsonHandler.setTravelNewsLayers ";this._loading(true);this._requestId++;var _14d=function(_14e){that._replaceImageUrl(_14e);};_106.setTravelNewsLayers(_149,function(obj){var _150=that._jsonResponseHandler(obj,_14d);if(!_150.valid){_105.events.mapError({message:that.declaredClass+"."+_14b+" "+_14c+" Failed parsing response ",innerException:null},obj);}that._loading(false);});},getPrintImage:function(_151,_152,dpi){this._loading(true);this._requestId++;var obj=null,url=null,_156=null,_157=" jsonHandler.getPrintImage ";try{obj=_106.getPrintImage(_151,_152,dpi);_156=this._jsonResponseHandler({result:{errorStatusCode:200,imageUrl:obj.imageUrl,ovUrl:obj.ovUrl}},function(){return false;});if(_156.valid){url=obj.imageUrl;}else{_105.events.mapError({message:that.declaredClass+"."+scope+" "+_157+" Failed parsing response ",innerException:null},obj);}}catch(err){throw err;}finally{this._loading(false);}return url;},addRoute:function(_158,id,type,_15b){this._loading(true);this._requestId++;var that=this,_15d=arguments.callee.nom,_15e=" jsonHandler.addRoute ",_15f=_106.addRoute(_158,id,type,_15b);this._loading(false);if(util.isObject(_15f)&&util.isValidExt(_15f)&&_15f.errorStatusCode==200){return util.validateExt(_15f);}else{throw dojo.mixin(_15f,{message:_15f.errorMessage});}},clearRoutes:function(type){this._loading(true);this._requestId++;var that=this,_162={valid:false},_163=arguments.callee.nom,_164=" jsonHandler.clearRoutes ",obj=_106.clearRoutes(util.isStringPopulated(type)?type:""),_166=function(_167){that._replaceImageUrl(_167);};this._loading(false);if(util.isObject(obj)&&obj.errorStatusCode==200){_162=that._jsonResponseHandler({result:obj},_166);}if(!_162.valid){throw dojo.mixin(_162,{message:_162.errorMessage});}},zoomToAllAddedRoutes:function(){this._loading(true);this._requestId++;var that=this,_169={valid:false},_16a=arguments.callee.nom,_16b=" jsonHandler.zoomToAllAddedRoutes ";obj=_106.zoomToAllAddedRoutes();this._loading(false);if(util.isObject(obj)&&util.isValidExt(obj)&&obj.errorStatusCode==200){return util.validateExt(obj);}else{throw dojo.mixin(obj,{message:obj.errorMessage});}},getNumberOfCycleImages:function(_16c){this._loading(true);this._requestId++;var that=this,_16e=arguments.callee.nom,_16f=" jsonHandler.getNumberOfCycleImages ",_170=_106.getNumberOfCycleImages(_16c);this._loading(false);if(util.isObject(_170)&&_170.errorStatusCode==200&&util.isNumber(_170.number)){return util.parseNumber(_170.number);}else{throw dojo.mixin(_170,{message:_170.errorMessage});}},getCyclePrintDetails:function(_171){this._loading(true);this._requestId++;var that=this,_173=arguments.callee.nom,_174=" jsonHandler.getCyclePrintInfo ",_175=_106.getCyclePrintInfo(_171);this._loading(false);if(util.isObject(_175)&&_175.errorStatusCode==200&&util.isArrayPopulated(_175.cyclePrintInfo)){return _175.cyclePrintInfo;}else{throw dojo.mixin(_175,{message:_175.errorMessage});}},toggleLayer:function(_176,on){var _178=this._externalConfig.layers,_179=this._layers;if(_176===_178.carparks){_179.carparkLayerVisible=on;}else{if(_176.indexOf(_178.pointX)>-1){var name=_176.split(_178.pointX)[1],arr=_179.pointX;for(var i=0;i<arr.length;i++){if(arr[i].name===name){arr[i].visible=on;break;}}_179.pointX=arr;}else{if(_176.indexOf(_178.stops)>-1){var name=_176.split(_178.stops)[1],arr=_179.stops;for(var i=0;i<arr.length;i++){if(arr[i].name===name){arr[i].visible=on;break;}}_179.stops=arr;}}}this.setLayerState(_179);},_replaceImageUrl:function(url){if(util.isStringPopulated(url)&&this.urlTest.test(url)){this._img.src=url;}else{}},_jsonResponseHandler:function(obj,_17f){var _180=false,_181="",_182=this._externalConfig.errorStrings;try{if(!util.isNothing(obj)){var _183=obj.result;if(!util.isNothing(_183)){if(util.isNumber(_183.errorStatusCode)&&_183.errorStatusCode==200){if(util.isStringPopulated(_183.imageUrl)&&this.urlTest.test(_183.imageUrl)){_180=true;if(util.isStringPopulated(_183.ovUrl)&&this.urlTest.test(_183.ovUrl)){this.ovUrl=_183.ovUrl;}_17f(_183.imageUrl);}else{_181+=_182.no_imageUrl;}}else{if(util.isNumber(_183.errorStatusCode)){_181+="{str}, Status code:{code}, Error message:{msg} ".supplant({str:_182.invalid_status,code:_183.errorStatusCode,msg:_183.errorMessage});}else{_181+=_182.no_errorStatusCode;}}}else{_181+=_182.no_result;}}else{_181+=_182.no_response;}}catch(err){_181+=" Error determining response status. "+(util.isStringPopulated(err.message)?err.message:"");_105.events.mapError({message:this.declaredClass+"."+arguments.callee.nom+" Failed parsing response ",innerException:err},obj);}return {valid:_180,message:_181};},_readMapLayers:function(_184){try{var ptX=[],_186=[],_187=_184.pointXVisible[0],_188=_184.pointXVisible[1];for(var i=0;i<_187.length;i++){ptX.push({name:_187[i],visible:_188[i]});}_187=_184.stopsVisible[0];_188=_184.stopsVisible[1];for(var i=0;i<_187.length;i++){_186.push({name:_187[i],visible:_188[i]});}dojo.mixin(this._layers,{carparkLayerVisible:_184.carparkLayerVisible,pointX:ptX,stops:_186});}catch(err){}}};})());}if(!dojo._hasResource["ESRIUK.Dijits.MapBase"]){dojo._hasResource["ESRIUK.Dijits.MapBase"]=true;ESRIUK.Dijits.MapBase=ESRIUK.Dijits.MapBase||{};dojo._loadedModules["ESRIUK.Dijits.MapBase"]=ESRIUK.Dijits.MapBase;dojo.declare("ESRIUK.Dijits.MapBase",[dijit._Widget,dijit._Contained],(function(){var util=ESRIUK.util(),_18b=ESRIUK.config(),_18c={graphics:"graphics",drawing:"drawing",extentQuery:"extentQuery",perm:"permanent"};return {loaded:false,_map:null,_navBar:null,_filter:null,_connects:[],_graphics:[],_initGraphics:[],_userGraphics:[],_serverGraphics:[],_toolBar:null,_resizeSet:false,_graphicsLayer:null,_drawToolBar:null,_geomService:null,_queryTimer:null,_sliderHandle:null,_resizeTimer:null,_scrollTimer:null,_queryService:null,_queryResults:null,_loadingHandler:null,_baseMapServiceId:null,_ie6ResizeTrigger:true,_graphcisMapServiceId:null,_disable:{extentChange:true},_externalConfig:{},imagesPath:dojo.moduleUrl("ESRIUK","images/"),setMap:function(map){if(typeof map=="object"){if(typeof map.declaredClass=="string"){if(map.declaredClass=="esri.Map"){this._map=map;}}}},setGeomService:function(_18e){if(util.isNothing(this._geomService)){if(typeof _18e==="object"){if(typeof _18e.declaredClass==="string"){if(_18e.declaredClass===""){}}}}},setDrawingToolBar:function(_18f){if(util.isObject(_18f)){this._drawToolBar=_18f;}},setGraphicsMapService:function(_190){if(util.isStringPopulated(_190)){this._graphcisMapServiceId=_190;}},setBaseMapService:function(_191){if(util.isStringPopulated(_191)){this._baseMapServiceId=_191;}},setQueryService:function(_192){if(util.isObject(_192)&&_192.declaredClass==="ESRIUK.Dijits.Query"){this._queryService=_192;}},getInputText:function(){return this._externalConfig.text;},getMap:function(){return this._map;},getDrawingToolBar:function(){return this._drawToolBar;},getQueryService:function(){if(util.isNothing(this._queryService)){try{this._queryService=new ESRIUK.Dijits.Query();}catch(err){this._queryService=null;}}return this._queryService;},getGeomService:function(){if(util.isNothing(this._geomService)){try{this._geomService=this.getServiceSetting(_18b.webServiceTypeEnum.geom);}catch(err){this._geomService=null;}}return this._geomService;},getBaseMapSetting:function(){var _193=_18b.mapServices;var _194=_193.length;for(var i=0;i<_194;i++){if(_193[i].baseMap){return _193[i];}}return null;},getBaseMapService:function(){var _196=null;if(!util.isNothing(this._graphcisMapServiceId)){_196=this.getMap().getLayer(this._baseMapServiceId);if(_196===null){}}return _196;},getGraphicsMapService:function(){var _197=null;if(!util.isNothing(this._graphcisMapServiceId)){_197=this.getMap().getLayer(this._graphcisMapServiceId);if(_197===null){}}return _197;},getOtherMapSettings:function(){var _198=[];var _199=_18b.mapServices;var _19a=_199.length;for(var i=0;i<_19a;i++){if(!_199[i].baseMap){_198.push(_199[i]);}}return _198;},getServiceSetting:function(_19c){var _19d=_18b.webServices;var _19e=_19d.length;for(var i=0;i<_19e;i++){if(_19d[i].type===_19c){return _19d[i];}}return null;},getOverviewUrl:function(){var _1a0=this.getBaseMapService();return util.isStringPopulated(_1a0.ovUrl)?_1a0.ovUrl:"";},_getAddPointPrefixText:function(){return util.isStringPopulated(this._externalConfig.text)?this._externalConfig.text:_18b.statics.planAJourneyText.addPointPrefix;},removeConnectTypes:function(type){var arr=this._connects,_1a3=arr.length;for(var i=0;i<_1a3;i++){if(arr[i].name===type){dojo.disconnect(arr[i].handle);arr.splice(i,1);_1a3--;i--;}}},toggleEvt:function(_1a5,on){on=(typeof on==="boolean"?on:true);var dis=this._disable;if(_1a5===_18c.extentQuery){dis.extentChange=on;}},checkMapSpatialRef:function(map){if(util.isObject(map.spatialReference)){if(util.isNothing(map.spatialReference.wkid)){if(map.spatialReference.wkt.indexOf("British_National_Grid")>-1){map.spatialReference.wkid=27700;}}}},constructor:function(){this._externalConfig={};},postCreate:function(){this.inherited(arguments);if(util.isNumber(dojo.isIE)&&dojo.isIE<7){esri.config.defaults.map.zoomDuration=1;esri.config.defaults.map.panDuration=1;}esri.config.defaults.map.slider=_18b.map.slider;},init:function(_1a9){try{this._applyPreLoadConfig(_1a9);this._addBaseMap();this._addOtherMaps();this._addGeomService();this._addOtherServices();}catch(err){_18b.events.miscError({message:this.declaredClass+"."+arguments.callee.nom+" - "+err.message,error:err});}},_applyPreLoadConfig:function(_1aa){this._externalConfig={};this._filter=null;if(typeof _1aa==="object"){if(util.isNumber(_1aa.width)){dojo.style(this.domNode,{width:_1aa.width+"px"});esri.config.defaults.map.width=_1aa.width;}if(util.isNumber(_1aa.height)){dojo.style(this.domNode,{height:_1aa.height+"px"});esri.config.defaults.map.height=_1aa.height;}}dojo.mixin(this._externalConfig,_1aa);dojo.subscribe("esriukMap/newInitExtent",this,"_onNewLoadExtent");},_getLoadConfig:function(){var _1ab=null,pt=null,_1ad=null,_1ae=this._externalConfig;if(util.isValidXY(_1ae.location)){var xy=util.validateXY(_1ae.location);pt=new esri.geometry.Point(xy.x,xy.y,new esri.SpatialReference({wkid:_18b.map.wkid}));if(util.isNumber(_1ae.scale)){_1ab=this._generateExtentFromPt(pt,_1ae.scale,false);}else{if(util.isNumber(_1ae.level)){_1ab=this._generateExtentFromPt(pt,_1ae.level,true);}else{_1ab=this._generateExtentFromPt(pt,5,true);}}}else{if(util.isValidExt(_1ae.extent)){var ex=_1ae.extent;_1ab=new esri.geometry.Extent(ex.xmin,ex.ymin,ex.xmax,ex.ymax,new esri.SpatialReference({wkid:_18b.map.wkid}));}}return _1ab;},_addBaseMap:function(){var map=null,_1b2={displayGraphicsOnPan:false},_1b3=null,_1b4=this.getBaseMapSetting(),_1b5=_18b.mapServiceTypeEnum,_1b6=this._externalConfig,_1b7=this._getLoadConfig(),_1b8={};if(_1b4!==null){if(util.isArrayPopulated(_18b.map.lods)){dojo.mixin(_1b2,{lods:_18b.map.lods});}if(util.isObject(_1b7)){dojo.mixin(_1b2,{extent:_1b7});this._externalConfig.extent=_1b7;}if(util.isObject(_1b6.travelNews)){this._filter=_1b6.travelNews;dojo.mixin(_1b8,{travelNews:this._filter});}if(util.isArrayPopulated(_1b6.symbols)){dojo.mixin(_1b8,{symbols:_1b6.symbols});}if(util.isArrayPopulated(_1b6.routes)){dojo.mixin(_1b8,{routes:_1b6.routes});}map=new esri.Map(this.domNode.id,_1b2);dojo.connect(map,"onLoad",function(){this.disableDoubleClickZoom();dojo.connect(this,"onDblClick",function(evt){this.centerAt(evt.mapPoint);dojo.stopEvent(evt);return false;});});switch(_1b4.type){case _1b5.dynamic:_1b3=new esri.layers.ArcGISDynamicMapServiceLayer(_1b4.url);break;case _1b5.tiled:_1b3=new esri.layers.ArcGISTiledMapServiceLayer(_1b4.url);break;case _1b5.imsserver:_1b3=new ESRIUK.Dijits.IMSServerStateLayer(_1b4,_1b8,this._loadingHandler);break;default:break;}this._connects.push(util.formatConnect(dojo.connect(map,"onLoad",this,this._setHandlers),"init"));this.setMap(map);map.addLayer(_1b3);if(!util.isNothing(_1b4.addGraphics)){this.setGraphicsMapService(util.isNothing(_1b3.id)?0:_1b3.id);}this.setBaseMapService(_1b3.id);}else{}},_addOtherMaps:function(){var _1ba=null,map=this.getMap(),_1bc=this.getOtherMapSettings(),_1bd=_1bc.length;for(var i=0;i<_1bd;i++){if(_1bc[i].type=="dynamic"){_1ba=new esri.layers.ArcGISDynamicMapServiceLayer(_1bc[i].url);}else{if(_1bc[i].type=="tiled"){_1ba=new esri.layers.ArcGISTiledMapServiceLayer(_1bc[i].url);}else{continue;}}map.addLayer(_1ba);}},_addGeomService:function(){var _1bf=this.getServiceSetting(_18b.webServiceTypeEnum.geom);if(!util.isNothing(this._geomService)&&!util.isNothing(_1bf)){var _1c0=new esri.tasks.GeometryService(_1bf.url);this.setGeomService(_1c0);}},_addOtherServices:function(){var _1c1=this.getServiceSetting(_18b.webServiceTypeEnum.query);if(util.isObject(_1c1)){this.setQueryService(new ESRIUK.Dijits.Query(_1c1,this._loadingHandler));}},_setHandlers:function(){var map=this.getMap();try{this._graphicsLayer=map.addLayer(new esri.layers.GraphicsLayer({displayOnPan:dojo.isIE?false:true,id:"esriukCustomGraphicsLayer"}));if(_18b.map.useResizeHandler){this._connects.push(util.formatConnect(dojo.connect(window,"onresize",this,this.onMapResize),_18c.perm));}this._connects.push(util.formatConnect(dojo.connect(map.graphics,"onClick",this,this.onGraphicClick),_18c.graphics),util.formatConnect(dojo.connect(this._graphicsLayer,"onClick",this,this.onGraphicClick),_18c.graphics),util.formatConnect(dojo.connect(window,"onscroll",this,this.onScroll),_18c.perm),util.formatConnect(dojo.connect(map,"onExtentChange",this,this.onMapExtentChange),_18c.extentQuery));this._applyPostLoadChanges();this._runPostLoad();this._onLoad();}catch(err){_18b.events.miscError({message:this.declaredClass+"."+arguments.callee.nom+" - "+err.message,error:err});}},_applyPostLoadChanges:function(){var map=this.getMap(),_1c4=_18b.map,_1c5=map._slider,node=_1c5.domNode,arr=dojo.query("div.dijitRuleMarkV",node),_1c8=arr.length,item,elm,_1cb,str,div,lods=_1c4.lods,_1cf=_1c5.sliderHandle,lod=esri.version<1.5?map._LOD:map.__LOD,par=arr[0].parentNode,pad=_1c4.sliderBoxPadding,_1d3=_1c4.sliderBoxStart-1;try{dojo.place(node,this.getParent().attachMapSliderContent);this._sliderHandle=_1cf;_1c5.scrollOnFocus=false;if(util.isObject(_1cf)){_1cf.title="Scale = 1:"+dojo.number.format(lod.scale,"#,##0.###");_1cf.alt=_1cf.title;}str="-"+pad+"px";div=dojo.create("div",{"class":"sliderBottomBox",style:{left:str,right:str,top:str}},par,"first");for(var i=0,j=lods.length-1;i<_1c8;i++,j--){item=arr[i];if(i==_1d3){var _1d6=dojo.coords(item);dojo.style(div,{height:(_1d6.t+(pad*2))+"px"});}str=dojo.number.format(lods[j].scale,"#,##0.###");item._val=lods[j].level;item.title="Scale 1:"+str;item.alt=item.title;dojo.connect(item,"onclick",function(){map.setLevel(this._val);});}dojo.attr((dojo.isFF?_1c5.incrementButton.parentNode:_1c5.incrementButton),{alt:"Zoom Out",title:"Zoom Out"});dojo.attr((dojo.isFF?_1c5.decrementButton.parentNode:_1c5.decrementButton),{alt:"Zoom In",title:"Zoom In"});}catch(err){_18b.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed to set slider tooltips",obj:err});}if(util.isNumber(dojo.isIE)){var _1d7=parseInt(dojo.style(this.getParent().attachMapSliderContent,"height"),10);if(isNaN(_1d7)||_1d7<2){_1d7=parseInt(_1c4.slider.height,10);}dojo.style(this.getParent().attachMapSliderContent,{height:(_1d7+_1c4.sliderIEOverlap)+"px"});}dojo.addClass(map.infoWindow.domNode,_18b.statics.cssInfoWindowClassName);map.reposition();},_runPostLoad:function(){var arr,_1d9,elm,item,_1dc,_1dd,_1de,geom,map=this.getMap(),type=_18b.graphics.typeEnum.serverGraphic,geo=esri.geometry,_1e3=map.graphics,_1e4=this.getParent(),ref=map.spatialReference,pt=_18b.graphics.point,_1e7=this.getQueryService();if(util.isArrayPopulated(this._externalConfig.symbols)){arr=this._externalConfig.symbols;_1dc=arr.length;for(var i=0;i<_1dc;i++){item=arr[i];if(util.parseBool(item.infoWindowRequired)){if(util.isStringPopulated(item.content)){elm=dojo.byId(item.content);_1dd=util.isNothing(elm)?item.content:elm.innerHTML;}else{_1dd="";}_1d9={text:item.label,type:type,content:_1dd};geom=new geo.Point(util.parseNumber(item.x),util.parseNumber(item.y),ref);_1de=_1e3.add(new esri.Graphic(geom,pt,_1d9));this._serverGraphics.push(_1de);if(util.parseBool(item.main)){this.drawCallout({screenPoint:esri.geometry.toScreenGeometry(map.extent,map.width,map.height,geom)},map,_1de,geom);}}}}if(_1e7!==null){_1e7.getInitFeatures(map.extent,map,this.getBaseMapService()._layers,this._filter,this._plotMapFeatures,this);}else{_18b.events.miscEror({message:this.declaredClass+"."+arguments.callee.nom+" - Failed to load Query Service"});}},_onNewLoadExtent:function(ext){if(!this._externalConfig.extent){this._externalConfig.extent=ext;}else{dojo.publish("esriukMap/oldInitExtent",[this._externalConfig.extent]);}},_onLoad:function(){try{var map=this.getMap(),ext=this._externalConfig.extent,mExt=map.extent,_1ed=this.getBaseMapService(),_1ee=this.getQueryService();if(_1ed.loaded&&_1ee.loaded){this.loaded=true;if(typeof ext!=="undefined"&&(mExt.getHeight()<ext.getHeight()||mExt.getWidth()<ext.getWidth())){map.setExtent(ext,true);setTimeout(function(){dojo.publish(_18b.events.mapLoad);},1000);}else{dojo.publish(_18b.events.mapLoad);}}else{if(_1ed.loaded&&(!_1ee.loaded)){dojo.connect(_1ee,"onLoad",this,this._onLoad);}else{if((!_1ed.loaded)&&_1ee.loaded){dojo.connect(_1ed,"onLoad",this,this._onLoad);}else{dojo.connect(_1ee,"onLoad",this,this._onLoad);dojo.connect(_1ed,"onLoad",this,this._onLoad);}}}}catch(err){_18b.events.error({message:"error firing final onMapInitialiseComplete method",obj:err});}},bindNavControls:function(_1ef){var map=this.getMap(),that=this;if(!util.isNothing(_1ef)&&!util.isNothing(map)){var nav=this._navBar=new esri.toolbars.Navigation(map),_1f3;if(util.isValidExt(this._externalConfig.extent)){_1f3=function(){map.setExtent(that._externalConfig.extent,true);};}else{_1f3=function(){nav.zoomToFullExtent();};}_1ef.bindEvents(function(){map.panUp();},function(){map.panDown();},function(){map.panRight();},function(){map.panLeft();},_1f3);}else{this._navBar=null;}},bindToolbar:function(_1f4){if(!util.isNothing(_1f4)){this._toolBar=_1f4;if(_1f4.isShowing){var that=this,_1f6=_18b.toolBar.typeEnum;_1f4.bindEvents(function(evt){that._setMapNavigationState(evt,_1f6.defaultTool);},function(evt){that._setMapNavigationState(evt,_1f6.userDefinedLocation);},function(evt){that._setMapNavigationState(evt,_1f6.selectNearbyPoint);});}}else{this._toolBar=null;}},bindLoading:function(_1fa){this._loadingHandler=function(obj){_1fa.toggle(obj);};},setActiveTool:function(type){if(util.isStringPopulated(type)){var _1fd=_18b.toolBar.typeEnum;if(type===_1fd.defaultTool){this._setMapNavigationState(_1fd.defaultTool);}else{if(type===_1fd.userDefinedLocation){this._setMapNavigationState(_1fd.userDefinedLocation);}else{if(type===_1fd.selectNearbyPoint){this._setMapNavigationState(_1fd.selectNearbyPoint);}else{}}}}else{}},_setMapNavigationState:function(evt,type){if(util.isStringPopulated(evt)&&util.isNothing(type)){type=evt;evt={target:{parentNode:type}};}if(util.isStringPopulated(type)){var map=this.getMap(),that=this,_202=this.getDrawingToolBar(),_203=_18b.toolBar.typeEnum;if(!util.isObject(_202)){_202=new esri.toolbars.Draw(map);this.setDrawingToolBar(_202);}this._toolBar.toggleActiveTool(evt.target.parentNode);this.removeConnectTypes(_18c.drawing);switch(type){case _203.defaultTool:_202.deactivate();map.enableMapNavigation();break;case _203.userDefinedLocation:map.disableMapNavigation();that._connects.push(util.formatConnect(dojo.connect(_202,"onDrawEnd",function(geom){that._toolAddUserDefinedPoint(geom);}),_18c.drawing));_202.activate(esri.toolbars.Draw.POINT);break;case _203.selectNearbyPoint:map.disableMapNavigation();that._connects.push(util.formatConnect(dojo.connect(_202,"onDrawEnd",function(geom){that._toolSelectNearbyPoints(geom);}),_18c.drawing));_202.activate(esri.toolbars.Draw.POINT);break;default:break;}}else{}},_toolAddUserDefinedPoint:function(geom){if(util.isStringPopulated(geom.type)&&geom.type==="point"){var that=this,_208=null,_209=false,_20a=arguments.callee.nom,_20b=_18b.statics,map=this.getMap(),arr=that._userGraphics,win=map.infoWindow,_20f=esri.geometry.toScreenGeometry(map.extent,map.width,map.height,geom),_210=map.graphics.add(new esri.Graphic(geom,_18b.graphics.pointMisc));arr.push(_210);if(win.isShowing){win.hide();}var _211=dojo.create("div");var _212=function(){if(!_209){var map=that.getMap(),_214=map.graphics,_215=arr.length;try{_214.remove(_210);arr.pop();}catch(err){}if(win.isShowing){win.hide();}that._setMapNavigationState({target:that._toolBar.getDefaultTool().getElementsByTagName("img")[0]},"default");}};var _216=function(){var text=_208.attr("value");_210.setAttributes({text:text});_209=true;win.setTitle(text);win.resize(_20b.dims.addPointSize.x,_20b.dims.addPointSize.y+30);win.setContent(that._getGraphicOptionLinks(_210,[],true));that._setMapNavigationState({target:that._toolBar.getDefaultTool().getElementsByTagName("img")[0]},"default");};_208=new dijit.form.TextBox({value:_20b.planAJourneyText.addPointDefaultText,style:"width: 100px;",maxLength:20},dojo.create("div",null,_211));var _218=dojo.connect(_208,"_onFocus",function(){this.attr("value","");dojo.disconnect(_218);});var _219=new dijit.form.Button({onClick:_216,label:_20b.misc.ok},dojo.create("div",null,_211));var _21a=new dijit.form.Button({onClick:_212,label:_20b.misc.cancel},dojo.create("div",null,_211));this._connects.push(util.formatConnect(dojo.connect(win,"onHide",_212),_18c.drawing));win.setContent(_211);win.setTitle(_20b.planAJourneyText.addPointTitle);win.resize(_20b.dims.addPointSize.x,_20b.dims.addPointSize.y);win.show(_20f,map.getInfoWindowAnchor(_20f));this._resizeInfoWindow(win);_219.focus();}else{}},_toolSelectNearbyPoints:function(geom){if(util.isStringPopulated(geom.type)&&geom.type==="point"){this.getQueryService().queryPoint(geom,_18b.events.selectNearbyPointResult);}},_getGraphicOptionLinks:function(_21c,_21d,_21e){var that=this,i=0,geom=util.isObject(_21c)?_21c.geometry:null,_222=_18b.statics,_223=dojo.create("div"),_224=_222.planAJourneyText,_225=function(){return false;},_226=this._getAddPointPrefixText(),arr=util.isArrayPopulated(this._externalConfig.mode)?this._externalConfig.mode:["start","end"];_21e=util.isBoolean(_21e)?_21e:false;_21d=_21d||[];dojo.addClass(_223,_222.cssInfoWindowContentClassName);for(i=0;i<_21d.length;i++){if(util.isString(_21d[i].tagName)){if(i>0){dojo.create("br",null,_223);}_223.appendChild(_21d[i]);}}if(util.isNothing(geom)){return _223;}_225=function(type){_18b.events[type](geom.x,geom.y,util.isStringPopulated(_21c.attributes.text)?_21c.attributes.text:_222.pointInfoNoTitle);var map=that.getMap();map.infoWindow.hide();if(_21e){map.graphics.remove(_21c);}};if(_21d.length>0){dojo.create("br",null,_223);}for(i=0;i<arr.length;i++){if(i>0){dojo.create("br",null,_223);}if(arr[i]==="start"){dojo.connect(dojo.create("a",{innerHTML:_226+_224.addPointSuffixStart},_223),"onclick",function(){_225("useAsStartPoint");});}else{if(arr[i]==="via"){dojo.connect(dojo.create("a",{innerHTML:_226+_224.addPointSuffixVia},_223),"onclick",function(){_225("useAsViaPoint");});}else{if(arr[i]==="end"){dojo.connect(dojo.create("a",{innerHTML:_226+_224.addPointSuffixEnd},_223),"onclick",function(){_225("useAsEndPoint");});}}}}if(_223.firstChild!==null){return _223;}else{return null;}},onGraphicClick:function(_22a){if(util.isObject(_22a.graphic)){var _22b=_22a.graphic;if(!util.isNothing(_22b.attributes)){this.drawCallout(_22a,this.getMap(),_22b,_22b.geometry);}}},onGraphicMouseOver:function(_22c){if(util.isObject(_22c.graphic)){var _22d=_22c.graphic;if(!util.isNothing(_22d.attributes)){this.drawCallout(_22c,this.getMap(),_22d,_22d.geometry);}}},onMapExtentChange:function(_22e,_22f,_230,lod){var t=this._queryTimer,time=_18b.query.wait,that=this;if(util.isNumber(t)){clearTimeout(t);this._loadingHandler(false);}this._queryTimer=setTimeout(function(){that._onMapExtentChange(_22e,_22f,_230,lod);},time);if(util.isObject(this._sliderHandle)){this._sliderHandle.title="Scale = 1:"+dojo.number.format(lod.scale,"#,##0.###");this._sliderHandle.alt=this._sliderHandle.title;}},_onMapExtentChange:function(_235,_236,_237,lod){var map=this.getMap(),t=this._queryTimer;if(util.isNumber(t)){clearTimeout(t);this._queryTimer=null;}this._removeMapFeatures();if(lod.level>_18b.query.maxLOD&&this._disable.extentChange){this.getQueryService().getExtentFeatures(_235,map,this.getBaseMapService()._layers,this._filter,this._plotMapFeatures,this);}else{if(_237){this.toggleEvt(_18c.extentQuery,true);}}},onMapPanStart:function(_23b,_23c){this._removeMapFeatures();},onMapPan:function(){return;},onMapPanEnd:function(_23d,_23e){},onMapResize:function(){if(dojo.coords(this.domNode).w>2&&dojo.coords(this.domNode).h>2){clearTimeout(this._resizeTimer);var that=this;var _240=arguments.callee.nom;if(dojo.isIE<7&&this._ie6ResizeTrigger){this._ie6ResizeTrigger=false;return;}this._resizeTimer=setTimeout(function(){var map=that.getMap();if(that._externalConfig.wholePage){try{var _242=that.getParent()._wholePageResize();dojo.style(that.domNode,{height:_242.height+"px",width:_242.width+"px"});}catch(err){}}if(that._resizeSet){that._resizeSet=false;}dojo.style(that.domNode.parentNode,{width:"auto"});dojo.style(that.domNode,{width:"auto"});var _243=dojo.coords(that.domNode);map.width=parseInt(_243.w,10);map.height=parseInt(_243.h,10);if(dojo.isIE<7){var _244=dojo.coords(that.domNode.parentNode.parentNode);var _245=util.getElmGutterHorizontal(that.domNode.parentNode.parentNode)+util.getElmGutterHorizontal(that.domNode.parentNode);dojo.style(that.domNode,{width:_244.w-_245});map.width=_244.w-_245;}that._onMapResize();},300);}},onScroll:function(){clearTimeout(this._scrollTimer);var that=this;this._scrollTimer=setTimeout(function(){that._onScroll();},300);},_onMapResize:function(){var that=this,_248=arguments.callee.nom,map=this.getMap();map.reposition();map.resize();setTimeout(function(){try{for(var i=0;i<map.layerIds.length;i++){map.getLayer(map.layerIds[i]).refresh();}}catch(err){}},300);},_onScroll:function(){this.getMap().reposition();},_getClosestScale:function(_24b,dims){var _24d,_24e,next,_250,_251,i;lods=_18b.map.lods,dpi=96,counter=0,factor=1.2,inchPerMetre=39.3700787402,smaller=true;while(smaller&&counter<20){counter++;next=null;_24e=null;_250=_24b.getWidth()/dims.w,_251=Math.round(_250*dpi*inchPerMetre);for(i=0;i<lods.length;i++){_24d=lods[i].scale;if(_251<_24d){_24e=_24d;}else{if(_251>_24d){next=_24d;break;}else{if(_251===_24d){return _24b;}}}}if(!util.isNothing(_24e,next)){var _253=_24e-_251,_254=_251-next;if(_253>=_254){_24b=_24b.expand(factor);}else{smaller=false;return _24b;}}else{smaller=false;}}},_getClosestLOD:function(_255){var lods=_18b.map.lods,lod=null;for(var i=0;i<lods.length;i++){if(_255==lods[i].scale){return lods[i].level;}else{if(_255>lods[i].scale){lod=i>0?lods[i-1]:lods[0];return lod.level;}}}lod=lods[lods.length-1];return lod.level;},_getLODInfo:function(_259,type){var i=null,lod=null,arr=_18b.map.lods;_259=util.parseNumber(_259);if(util.isArrayPopulated(arr)){if(type!=="level"){_259=this._getClosestLOD(_259);}for(i=0;i<arr.length;i++){lod=arr[i];if(_259===lod.level){return lod;}}}else{}return lod;},_generateExtentFromPt:function(pt,_25f,_260){try{_260=util.parseBool(_260);var _261=esri.config.defaults.map,_262=this._getLODInfo(_25f,_260?"level":null).resolution,x=(_261.width/2)*_262,y=(_261.height/2)*_262;return new esri.geometry.Extent(pt.x-x,pt.y-y,pt.x+x,pt.y+y,new esri.SpatialReference({wkid:_18b.map.wkid}));}catch(err){return null;}},_plotMapFeatures:function(arr){var item=null,pt=null,_268=arr.length,map=this.getMap(),geo=esri.geometry,_26b=this._graphicsLayer,_26c=this._graphics,ref=map.spatialReference,_26e=_18b.graphics.point;for(var i=0;i<_268;++i){item=arr[i];if(item.points.length==1){pt=item.points[0];_26c.push(_26b.add(new esri.Graphic(new geo.Point(pt.x,pt.y,ref),_26e,{type:item.type,values:item.values})));}}},_removeMapFeatures:function(){var arr=this._graphics,_271=this._graphicsLayer,_272=arr.length;for(var i=0;i<_272;++i){_271.remove(arr[i]);}this._graphics=[];},_removeUserGraphics:function(){var arr=this._userGraphics,_275=this.getMap().graphics,_276=arr.length;for(var i=0;i<_276;++i){_275.remove(arr[i]);}this._userGraphics=[];},_removeServerGraphics:function(){var arr=this._serverGraphics,_279=this.getMap().graphics,_27a=arr.length;for(var i=0;i<_27a;++i){_279.remove(arr[i]);}this._serverGraphics=[];},setExtent:function(_27c){this.getMap().setExtent(_27c);},resize:function(x,y){if(util.isNumber(x)&&util.isNumber(y)){var map=this.getMap();this._resizeSet=true;dojo.style(this.domNode,{height:y+"px",width:x+"px"});map.width=parseInt(x,10);map.height=parseInt(y,10);this._onMapResize();}else{}},zoomToFullExtent:function(){this._navBar.zoomToFullExtent();},zoomToPreviousExtent:function(){this._navBar.zoomToPrevExtent();},zoomToXY:function(x,y){var map=this.getMap();var pt=new esri.geometry.Point(util.parseNumber(x),util.parseNumber(y),map.spatialReference);map.centerAt(pt);},zoomToLevel:function(_284){this.getMap().setLevel(_284);},zoomToScale:function(_285){var lod=this._getClosestLOD(_285);this.getMap().setLevel(lod);},centerAndZoom:function(x,y,_289,text){var map=this.getMap(),that=this,_28d=null,_28e=function(_28f,_290,_291,_292){dojo.disconnect(_28d);this.addIconAndInfoWindow(x,y,text,false);};text=util.isNothing(text)?null:text;if(util.isStringPopulated(text)){_28d=dojo.connect(map,"onExtentChange",that,_28e);}map.centerAndZoom(new esri.geometry.Point(util.parseNumber(x),util.parseNumber(y),map.spatialReference),_289);},centerAndScale:function(x,y,_295,text){var lod=this._getClosestLOD(_295);text=util.isStringPopulated(text)?text:null;this.centerAndZoom(x,y,lod,text);},zoomToExtent:function(ext,_299){_299=util.isBoolean(_299)?_299:false;this.getMap().setExtent(ext,_299);},addStartEndPt:function(pt){var _29b=this.getGraphicsMapService(),map=this._map;if(!util.isNothing(_29b)){_29b.addStartEndPt(pt);try{if(util.parseBool(pt.infoWindowRequired)&&util.isStringPopulated(pt.content)){attributes={text:pt.label,type:_18b.graphics.typeEnum.serverGraphic,content:pt.content};var geom=new esri.geometry.Point(util.parseNumber(pt.x),util.parseNumber(pt.y),map.spatialReference),_29e=map.graphics.add(new esri.Graphic(geom,_18b.graphics.point,attributes));this._serverGraphics.push(_29e);if(pt.main){this.drawCallout({screenPoint:esri.geometry.toScreenGeometry(map.extent,map.width,map.height,geom)},map,_29e,geom);}}}catch(err){throw {source:this.declaredClass+arguments.callee.nom,message:" Could not add invisible client graphic on top of server symbol. "+err.message};}}else{throw {source:this.declaredClass+arguments.callee.nom,message:" No 'addable graphics' map service available.\n Check there is a map service with 'addGraphics:true' defined in config. "};}},addIconAndInfoWindow:function(x,y,text,_2a2){var map=this.getMap(),geom=new esri.geometry.Point(x,y,map.spatialReference),_2a5=map.graphics.add(new esri.Graphic(geom,_18b.graphics.pointMisc,{text:text}));this.drawCallout({screenPoint:esri.geometry.toScreenGeometry(map.extent,map.width,map.height,geom)},map,_2a5,geom);if(!util.parseBool(_2a2)){this.setActiveTool(_18b.toolBar.typeEnum.defaultTool);}},clearPoints:function(type){var _2a7=this.getGraphicsMapService();if(!util.isNothing(_2a7)){if(((!util.isStringPopulated(type))||type==="graphics")&&type!=="server"){this._removeUserGraphics();}_2a7.clearPoints(type);this._removeServerGraphics();}else{throw {source:this.declaredClass+arguments.callee.nom,message:" No 'addable graphics' map service available.\n Check there is a map service with 'addGraphics:true' defined in config. "};}},getLayerList:function(){return this.copyLayerList(this.getBaseMapService()._layers);},copyLayerList:function(_2a8){var i=0,obj={carparkLayerVisible:false,stops:[],pointX:[]},_2ab=_2a8.stops,_2ac=_2a8.pointX,_2ad=_2a8.carparkLayerVisible;obj.carparkLayerVisible=_2ad;for(i=0;i<_2ab.length;++i){obj.stops.push(dojo.mixin({},_2ab[i]));}for(i=0;i<_2ac.length;++i){obj.pointX.push(dojo.mixin({},_2ac[i]));}return obj;},getMapProperties:function(){var map=this.getMap(),lod=esri.version<1.5?map._LOD:map.__LOD,_2b0=map.extent,obj=this._externalConfig,_2b2=new esri.geometry.Point(_2b0.xmin+((_2b0.xmax-_2b0.xmin)/2),_2b0.ymin+((_2b0.ymax-_2b0.ymin)/2),map.spatialReference).toJson();var _2b3={};for(var name in obj){if(obj.hasOwnProperty(name)){if(name==="location"){if(obj[name].x!==null){dojo.mixin(_2b3,{location:obj[name]});}}else{if(name!=="set"&&name!=="wholePage"){if(obj[name]!==null){dojo.mixin(_2b3,dojo.fromJson("{\""+name+"\":"+dojo.toJson(obj[name])+"}"));}}}}}return {scale:lod.scale,level:lod.level,centrePoint:_2b2,layers:this.getLayerList(),inputs:_2b3};},toggleLayer:function(_2b5,on){var _2b7=this.getBaseMapService();_2b7.toggleLayer(_2b5,on);},setLayerState:function(_2b8){var map=this.getMap(),_2ba=this.getBaseMapService(),obj=this.copyLayerList(_2b8);this._removeMapFeatures();_2ba.setLayerState(obj);this.getQueryService().getExtentFeatures(map.extent,map,obj,this._filter,this._plotMapFeatures,this);},setTravelNews:function(_2bc){var map=this.getMap(),_2be=this.getBaseMapService();this._filter=this.validateTravelFilter(_2bc);this._removeMapFeatures();_2be.setTravelNewsLayers(this._filter);this.getQueryService().getExtentFeatures(map.extent,map,_2be._layers,this._filter,this._plotMapFeatures,this);},findJunctionPoint:function(_2bf,_2c0,_2c1,_2c2){var map=this.getMap(),obj=this.getQueryService().findJunctionPoint(_2bf,_2c0),pt=new esri.geometry.Point(obj.x,obj.y,map.spatialReference);if(_2c2){if(util.isNumber(_2c1)){map.centerAndZoom(pt,util.parseNumber(_2c1)-1);}else{map.centerAt(pt);}}return pt.toJson();},findITNNodePoint:function(TOID,_2c7,_2c8){var map=this.getMap(),obj=this.getQueryService().findITNNodePoint(TOID),pt=new esri.geometry.Point(obj.x,obj.y,map.spatialReference);if(_2c8){if(util.isNumber(_2c7)){map.centerAndZoom(pt,util.parseNumber(_2c7)-1);}else{map.centerAt(pt);}}return pt.toJson();},addRoute:function(_2cc,_2cd,type,_2cf){var map=this.getMap(),_2d1=this.getBaseMapService(),obj=_2d1.addRoute(_2cc,_2cd,type,_2cf),ext=new esri.geometry.Extent({xmin:obj.xmin,ymin:obj.ymin,xmax:obj.xmax,ymax:obj.ymax,spatialReference:map.spatialReference});if(_2cf==="all"||_2cf==="this"){map.setExtent(ext,true);}else{_2d1.refresh();this._loadingHandler(false);}return ext.toJson();},clearRoutes:function(type){this.getBaseMapService().clearRoutes(type);},zoomToRoute:function(_2d5,_2d6,type){var map=this.getMap(),obj=this.getQueryService().getRouteEnvelope(_2d5,_2d6,type),ext=new esri.geometry.Extent({xmin:obj.xmin,ymin:obj.ymin,xmax:obj.xmax,ymax:obj.ymax,spatialReference:map.spatialReference});map.setExtent(ext,true);return ext.toJson();},zoomToAllAddedRoues:function(){var map=this.getMap(),obj=this.getBaseMapService().zoomToAllAddedRoutes(),ext=new esri.geometry.Extent({xmin:obj.xmin,ymin:obj.ymin,xmax:obj.xmax,ymax:obj.ymax,spatialReference:map.spatialReference});map.setExtent(ext,true);return ext.toJson();},getPrintImage:function(_2de,_2df,dpi){return this.getBaseMapService().getPrintImage(_2de,_2df,dpi);},getNumberOfCycleImages:function(_2e1){return this.getBaseMapService().getNumberOfCycleImages(_2e1);},getCyclePrintDetails:function(_2e2){return this.getBaseMapService().getCyclePrintDetails(_2e2);},validateTravelFilter:function(_2e3){var str=null,_2e5=false,obj={};if(util.isStringPopulated(_2e3.transportType)){str=_2e3.transportType;if(str==="all"){_2e5=true;dojo.mixin(obj,{roadIncidentsVisible:true,publicIncidentsVisible:true});}else{if(str==="road"){_2e5=true;dojo.mixin(obj,{roadIncidentsVisible:true,publicIncidentsVisible:false});}else{if(str==="public"){_2e5=true;dojo.mixin(obj,{roadIncidentsVisible:false,publicIncidentsVisible:true});}else{if(str==="none"){_2e5=true;dojo.mixin(obj,{roadIncidentsVisible:false,publicIncidentsVisible:false});}}}}}if(util.isStringPopulated(_2e3.incidentType)){str=_2e3.incidentType;if(str==="all"||str==="planned"||str==="unplanned"){_2e5=true;dojo.mixin(obj,{incidentType:_2e3.incidentType});}else{}}if(util.isStringPopulated(_2e3.severity)){str=_2e3.severity;if(str==="all"||str==="major"){_2e5=true;dojo.mixin(obj,{severity:_2e3.severity});}else{}}if(util.isStringPopulated(_2e3.timePeriod)){str=_2e3.timePeriod;if(str==="current"||str==="recent"){_2e5=true;dojo.mixin(obj,{timePeriod:_2e3.timePeriod});}else{if(str==="date"||str==="datetime"){if(util.isStringPopulated(_2e3.datetime)){str=_2e3.datetime;if(/^\d{1,2}\/\d{1,2}\/\d{2,4} \d{1,2}[\:\/]\d{1,2}$/.test(str)){_2e5=true;dojo.mixin(obj,{datetime:str.replace(/\:/g,"/"),timePeriod:_2e3.timePeriod});}else{_2e5=false;}}}else{}}}if(_2e5){return obj;}else{throw {message:this.declaredClass+"."+arguments.callee.nom+" failed to parse travel news ",obj:_2e3};}},drawCallout:function(_2e7,map,_2e9,geom){var id=null,link=null,_2ed=[],attr=_2e9.attributes,arr=attr.values,_2f0=_18b.statics,dims=_2f0.dims,win=map.infoWindow,_2f3=true,_2f4=_18b.graphics.typeEnum,type=util.isStringPopulated(attr.type)?attr.type:"Generic",text=util.isStringPopulated(attr.text)?attr.text:_2f0.pointInfoNoTitle;switch(type){case _2f4.carParks:var isPR=arr[0]==="Y",_2f8=arr[1],name=arr[2],ref=arr[3];_2f3=false;str=_2f0.misc;link=dojo.create("a",{innerHTML:str.infoPageCarParks});text="{a}, {b} {c}{d}".supplant({a:_2f8,b:name,c:(isPR?str.parkandride:""),d:str.carpark});dojo.connect(link,"onclick",function(){_18b.events.showCarParkInformation(ref);});_2ed=[link];win.resize(dims.calloutCarParks.x,dims.calloutCarParks.y);break;case _2f4.stops:var str=_2f0.misc;id=arr[0];text=arr[1];_2f3=false;link=dojo.create("a",{innerHTML:str.infoPageStops});dojo.connect(link,"onclick",function(){_18b.events.showStopsInformation(id);});_2ed=[link];win.resize(dims.calloutStops.x,dims.calloutStops.y);break;case _2f4.travelNews:case _2f4.pointX:var that=this,elm=null,_2fe=type===_2f4.travelNews,_2ff=arguments.callee.nom,_300=_2fe?"getTravelNewsInfo":"getPointXInfo";dims=_2fe?dims.calloutTravelNews:dims.calloutPointX;id=arr[0];win.setTitle(_2f0.misc.loading);win.setContent("<img src=\""+this.imagesPath+"ajax-loader.gif\" alt=\"Loading...\" />");win.resize(dims.x,dims.y);win.show(_2e7.screenPoint,map.getInfoWindowAnchor(_2e7.screenPoint));this.getQueryService()[_300](id,function(text,_302){_2e9.attributes.text=text;win.setTitle(text.replace("&apos;","&#039;"));var elm=that._getGraphicOptionLinks((_2fe?null:_2e9),_302);if(elm!==null){win.setContent(elm);that._resizeInfoWindow(win);}else{win.setContent("");dojo.style(win.containerNode,{height:"0px"});that._resizeInfoWindow(win,true);}});return;case _2f4.serverGraphic:text=util.isStringPopulated(attr.text)?attr.text:_18b.statics.misc.pt;_2ed=attr.content.length>0?[dojo.create("span",{innerHTML:attr.content})]:[];break;default:win.resize(dims.calloutGeneric.x,dims.calloutGeneric.y);break;}_2e9.attributes.text=text;win.setTitle(text.replace("&apos;","&#039;"));win.setContent(this._getGraphicOptionLinks(_2e9,_2ed,_2f3));win.show(_2e7.screenPoint,map.getInfoWindowAnchor(_2e7.screenPoint));this._resizeInfoWindow(win);},_resizeInfoWindow:function(win,_305){var dims=dojo.coords(win._titlebar);var _307=dojo.coords(util.parseBool(_305)?win.containerNode:win.containerNode.firstChild);if(util.isNumber(dojo.isIE)){dims.h+=_18b.statics.dims.ieBuffer;}win.resize(win.width,dims.h+dims.t+_307.h+_307.t);},fuzzyPan:function(pt,panx,pany){var map=this.getMap();var ex=map.extent;if(map.extent.contains(pt)){return;}else{this.toggleEvt(eventToggleEnum.ext,false);var ox=0;var oy=0;if(pt.x<ex.xmin){ox=pt.x-ex.xmin-(panx*ex.getWidth());}else{if(pt.x>ex.xmax){ox=pt.x-ex.xmax+(panx*ex.getWidth());}}if(pt.y<ex.ymin){oy=pt.y-ex.ymin-(pany*ex.getHeight());}else{if(pt.y>ex.ymax){oy=pt.y-ex.ymax+(pany*ex.getHeight());}}map.setExtent(ex.offset(ox,oy));}}};})());}if(!dojo._hasResource["ESRIUK.Dijits.Map"]){dojo._hasResource["ESRIUK.Dijits.Map"]=true;ESRIUK.Dijits.Map=ESRIUK.Dijits.Map||{};dojo._loadedModules["ESRIUK.Dijits.Map"]=ESRIUK.Dijits.Map;dojo.declare("ESRIUK.Dijits.Map",[dijit._Widget,dijit._Templated,dijit._Container],(function(){var util=ESRIUK.util(),_310=null;return {loaded:false,_tmpConnect:null,_tmpWidth:null,_tmpHeight:null,settings:{},param_XMin:null,param_YMin:null,param_XMax:null,param_YMax:null,param_Scale:null,param_Level:null,param_Width:null,param_Height:null,param_LocationX:null,param_LocationY:null,param_Text:"",param_Mode:"",param_Tools:"",param_Symbols:"",param_Routes:"",param_TravelNews:"",param_WholePage:false,widgetsInTemplate:true,templateString:"<div class='esriuk-custom-mapbase'>\r\n  <div dojoAttachPoint='attachNavPanel' dojoType='ESRIUK.Dijits.MapNavPanel' class='mapOverlay semiTransparent' style=\"display:none\"></div>\r\n  <div dojoAttachPoint='attachToolBarPanel' dojoType='ESRIUK.Dijits.MapToolBarPanel' class='mapOverlay'></div>\r\n  <div class='sliderPanelContainer mapOverlay semiTransparent' style=\"display:none\"><div dojoAttachPoint='attachMapSliderContent' class='sliderPanelHolder mapPanel'></div></div>\r\n  <div dojoAttachPoint='attachLoading' dojoType='ESRIUK.Dijits.Loading'></div>\r\n  <div dojoAttachPoint='attachMap' dojoType='ESRIUK.Dijits.MapBase' class=\"esriuk-custom-map\"></div>\r\n</div>\r\n",imagesPath:dojo.moduleUrl("ESRIUK.Dijits","images/Map/"),constructor:function(){dojo.mixin(this,arguments[0]);this.settings={set:false,scale:null,level:null,location:{x:null,y:null},extent:{xmin:null,ymin:null,xmax:null,ymax:null},height:null,width:null,text:null,tools:[],travelNews:null,symbols:null,mode:null};ESRIUK._config=null;_310=ESRIUK.config();dojo.subscribe(_310.events.mapLoad,this,"onLoad");},postCreate:function(){this.inherited(arguments);this.attachLoading.toggle(true);this._readURLSettings();this._readInlineSettings();this._addRequiredCSSFiles();this._applyStyleParams(true);if(!util.isNothing(this.attachMap)){try{this.attachMap.bindLoading(this.attachLoading);this.attachMap.init(this.getMapParams());this.showPanels(this.getToolsInput());this.attachToolBarPanel.init(this.getToolsInput());}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" error initiating map widget ",innerException:err});}}else{}},startup:function(){this.inherited(arguments);var map=this.attachMap,nav=this.attachNavPanel,_313=this.attachToolBarPanel;try{map.bindNavControls(nav);map.bindToolbar(_313);this._addBugFixes();}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" error binding nav & toolbar controls ",innerException:err});}finally{this.attachLoading.toggle(false);}},onLoad:function(){this.loaded=true;_310.events.onMapInitialiseComplete(this);},destroy:function(){this.inherited(arguments);},destroyRecursive:function(){this.inherited(arguments);},resize:function(x,y){if(util.isNumber(x,y)){try{this.setWidthInput(x);this.setHeightInput(y);this._applyStyleParams();this.attachMap.resize(x,y);}catch(err){}}else{if(util.isValidWH(x)){if(_310.map.useResizeHandler){}else{try{this.attachMap.onScroll();}catch(err){}}}else{}}},zoomToXY:function(x,y){if(util.isNumber(x,y)){try{this.attachMap.zoomToXY(x,y);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},zoomToLevel:function(_318){if(util.isNumber(_318)){try{this.attachMap.zoomToLevel(_318);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},zoomToScale:function(_319){if(util.isNumber(_319)){try{this.attachMap.zoomToScale(_319);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},zoomToLevelAndPoint:function(x,y,_31c,text){if(util.isNumber(x,y,_31c)){try{this.attachMap.centerAndZoom(x,y,_31c,text);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},zoomToScaleAndPoint:function(x,y,_320,text){if(util.isNumber(x,y,_320)){try{this.attachMap.centerAndScale(x,y,_320,text);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},zoomToExtent:function(xmin,ymin,xmax,ymax,fit){if(util.isNumber(xmin,ymin,xmax,ymax)){try{fit=util.isBoolean(fit)?fit:true;this.attachMap.zoomToExtent(new esri.geometry.Extent(util.parseNumber(xmin),util.parseNumber(ymin),util.parseNumber(xmax),util.parseNumber(ymax),this.attachMap.getMap().spatialReference),fit);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},setActiveTool:function(type){if(util.isStringPopulated(type)){try{this.attachMap.setActiveTool(type);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},addIconAndInfoWindow:function(x,y,text){if(util.isNumber(x,y)&&util.isStringPopulated(text)){try{this.attachMap.addIconAndInfoWindow(util.parseNumber(x),util.parseNumber(y),text);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},zoomToFullExtent:function(){try{this.attachMap.zoomToFullExtent();}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}},zoomPrevious:function(){try{this.attachMap.zoomToPreviousExtent();}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}},toggleLayer:function(_32b,on){return;if(util.isString(_32b)&&util.isBoolean(on)){try{this.attachMap.toggleLayer(_32b,util.parseBool(on));}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},setLayerState:function(_32d){if(util.isObject(_32d)){try{this.attachMap.setLayerState(_32d);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},addStartEndPt:function(pt){if(util.isValidXY(pt)){pt=util.validateXY(pt);try{this.attachMap.addStartEndPt(pt);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},clearPoints:function(type){try{this.attachMap.clearPoints(type);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}},getLayerList:function(){var _330=null;try{_330=this.attachMap.getLayerList();}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}return _330;},getMapProperties:function(){var _331=null;try{_331=this.attachMap.getMapProperties();}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}return _331;},setTravelNews:function(_332){if(util.isObject(_332)){try{this.attachMap.setTravelNews(_332);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},findJunctionPoint:function(_333,_334,_335,_336){var _337=null;_335=_335||null;_336=_336||false;if(util.isStringPopulated(_333)&&util.isStringPopulated(_334)){try{_337=this.attachMap.findJunctionPoint(_333,_334,_335,_336);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _337;},findITNNodePoint:function(TOID,_339,_33a){var _33b=null;_339=_339||null;_33a=_33a||false;if(util.isStringPopulated(TOID)){try{_33b=this.attachMap.findITNNodePoint(TOID,_339,_33a);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _33b;},getPrintImage:function(_33c,_33d,dpi){var _33f=null;if(util.isNumber(_33c,_33d,dpi)){try{_33f=this.attachMap.getPrintImage(util.parseNumber(_33c),util.parseNumber(_33d),util.parseNumber(dpi));}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _33f;},addRoute:function(_340,_341,type,_343){var _344=null;_343=util.isStringPopulated(_343)?_343:"";if(util.isStringPopulated(_340)&&util.isNumber(_341)&&util.isStringPopulated(type)){try{_344=this.attachMap.addRoute(_340,util.parseNumber(_341),type,_343);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _344;},clearRoutes:function(type){var _346=false;type=util.isStringPopulated(type)?type:"";try{this.attachMap.clearRoutes(type);_346=true;}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}return _346;},zoomToRoute:function(_347,_348,type){var _34a=null;if(util.isStringPopulated(_347)&&util.isNumber(_348)&&util.isStringPopulated(type)){try{_34a=this.attachMap.zoomToRoute(_347,util.parseNumber(_348),type);}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _34a;},zoomtoAllAddedRoutes:function(){var _34b=null;try{_34b=this.attachMap.zoomToAllAddedRoues();}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}return _34b;},getNumberOfCycleImages:function(_34c){var _34d=-1;if(util.isNumber(_34c)){try{_34d=this.attachMap.getNumberOfCycleImages(util.parseNumber(_34c));}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _34d;},getCyclePrintDetails:function(_34e){var _34f=null;if(util.isNumber(_34e)){try{_34f=this.attachMap.getCyclePrintDetails(util.parseNumber(_34e));}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _34f;},setScaleInput:function(_350){if(util.isNumber(_350)){if(typeof _350==="string"){_350=util.parseNumber(_350);}this.settings.scale=_350;if(!this.settings.set){this.settings.set=true;}}},setLevelInput:function(_351){if(util.isNumber(_351)){if(typeof _351==="string"){_351=util.parseNumber(_351);}if(_351>0){_351--;}this.settings.level=_351;if(!this.settings.set){this.settings.set=true;}}},setLocationInput:function(_352){if(util.isObject(_352)){if(util.isNumber(_352.x,_352.y)){if(typeof _352.x==="string"){_352.x=util.parseNumber(_352.x);}if(typeof _352.y==="string"){_352.y=util.parseNumber(_352.y);}this.settings.location=_352;if(!this.settings.set){this.settings.set=true;}}}},setExtentInput:function(ext){if(util.isValidExt(ext)){if(util.isString(ext.xmin)){ext.xmin=util.parseNumber(ext.xmin);}if(util.isString(ext.ymin)){ext.ymin=util.parseNumber(ext.ymin);}if(util.isString(ext.xmax)){ext.xmax=util.parseNumber(ext.xmax);}if(util.isString(ext.ymax)){ext.ymax=util.parseNumber(ext.ymax);}this.settings.extent=ext;if(!this.settings.set){this.settings.set=true;}}},setTextInput:function(text){if(util.isStringPopulated(text)){this.settings.text=text;if(!this.settings.set){this.settings.set=true;}}},setToolsInput:function(text){if(util.isStringPopulated(text)){var arr=text.split(",");this.settings.tools=[];for(var i=0;i<arr.length;i++){if(util.isStringPopulated(arr[i])){this.settings.tools.push(arr[i]);}}if(!this.settings.set){this.settings.set=true;}}},setTravelNewsInput:function(text){if(util.isStringPopulated(text)){var arr=text.split(","),obj={};try{for(var i=0;i<arr.length;i++){var pair=arr[i].split(":");obj[pair[0]]=pair[1];}this.settings.travelNews=this.attachMap.validateTravelFilter(obj);if(!this.settings.set){this.settings.set=true;}}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}},setSymbolsInput:function(text){if(util.isStringPopulated(text)||util.isArrayPopulated(text)){try{if(typeof text==="string"){var obj=dojo.fromJson(text),arr=[];for(var i=0;i<obj.length;i++){if(util.isValidXY(obj[i])){arr.push(obj[i]);}}this.settings.symbols=arr;if(!this.settings.set){this.settings.set=true;}}else{this.settings.symbols=text;if(!this.settings.set){this.settings.set=true;}}}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}},setRouteInput:function(text){if(util.isStringPopulated(text)){var obj=dojo.fromJson(text),arr=[];try{for(var i=0;i<obj.length;i++){var o=obj[i],s=o.type;if(s==="PT"||s==="Road"||s==="Cycle"){arr.push(o);}}this.settings.routes=arr;if(!this.settings.set){this.settings.set=true;}}catch(err){_310.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}},setModeInput:function(text){if(util.isStringPopulated(text)){var arr=text.split(",");this.settings.mode=[];for(var i=0;i<arr.length;i++){if(util.isStringPopulated(arr[i])){this.settings.mode.push(arr[i]);}}if(!this.settings.set){this.settings.set=true;}}},setHeightInput:function(_36a){if(util.isNumber(_36a)){if(typeof _36a==="string"){_36a=util.parseNumber(_36a);}this.settings.height=_36a;if(!this.settings.set){this.settings.set=true;}}},setWidthInput:function(_36b){if(util.isNumber(_36b)){if(typeof _36b==="string"){_36b=util.parseNumber(_36b);}this.settings.width=_36b;if(!this.settings.set){this.settings.set=true;}}},getScaleInput:function(){return this.settings.scale;},getLevelInput:function(){return this.settings.level;},getLocationInput:function(){return this.settings.location;},getExtentInput:function(){return this.settings.extent;},getTextInput:function(){return this.settings.text;},getToolsInput:function(){return this.settings.tools;},getHeightInput:function(){return this.settings.height;},getWidthInput:function(){return this.settings.width;},getTravelNewsInput:function(){return this.settings.travelNews;},getSymbolsInput:function(){return this.settings.symbols;},getRoutesInput:function(){return this.settings.routes;},getModeInput:function(){return this.settings.mode;},getMapParams:function(){var _36c={wholePage:this.param_WholePage},pt=this.getLocationInput(),ext=this.getExtentInput();if(this.settings.set){if(util.isValidXY(pt)){dojo.mixin(_36c,{location:pt});}else{if(util.isValidExt(ext)){dojo.mixin(_36c,{extent:ext});}}if(util.isNumber(this.getScaleInput())){dojo.mixin(_36c,{scale:this.getScaleInput()});}else{if(util.isNumber(this.getLevelInput())){dojo.mixin(_36c,{level:this.getLevelInput()});}}if(util.isStringPopulated(this.getTextInput())){dojo.mixin(_36c,{text:this.getTextInput()});}if(util.isNumber(this.getHeightInput())){dojo.mixin(_36c,{height:this.getHeightInput()});}if(util.isNumber(this.getWidthInput())){dojo.mixin(_36c,{width:this.getWidthInput()});}if(util.isObject(this.getTravelNewsInput())){dojo.mixin(_36c,{travelNews:this.getTravelNewsInput()});}if(util.isArrayPopulated(this.getSymbolsInput())){dojo.mixin(_36c,{symbols:this.getSymbolsInput()});}if(util.isArrayPopulated(this.getRoutesInput())){dojo.mixin(_36c,{routes:this.getRoutesInput()});}if(util.isArrayPopulated(this.getModeInput())){dojo.mixin(_36c,{mode:this.getModeInput()});}}return _36c;},_addRequiredCSSFiles:function(){if(util.isArrayPopulated(_310.requiredCSSFiles)){var head=document.getElementsByTagName("head")[0],_370=_310.live?"":"?r="+Math.random()*1000;for(var i=0;i<_310.requiredCSSFiles.length;i++){dojo.create("link",{type:"text/css",rel:"stylesheet",href:_310.requiredCSSFiles[i]+_370},head);}}},_applyStyleParams:function(_372){_372=util.isBoolean(_372)?_372:false;var _373=null;if(!this.param_WholePage){if(_372){var _374=_310.map.defaultDimensions;if(util.isNothing(this.getHeightInput())){if(util.isNothing(_374)&&!util.isNumber(_374.height)){this.setHeight(esri.config.defaults.map.height);}else{this.setHeightInput(_374.height);}}if(util.isNothing(this.getWidthInput())){if(util.isNothing(_374)&&!util.isNumber(_374.width)){this.setWidthInput(esri.config.defaults.map.width);}else{this.setWidthInput(_374.width);}}}var _375=this.getHeightInput(),_376=this.getWidthInput();if(util.isNumber(_375)){_373={height:_375+"px"};}if(util.isNumber(_376)){if(util.isNothing(_373)){_373={width:_376+"px"};}else{_373.width=_376+"px";}}dojo.style(this.domNode,_373);}else{this._wholePageResize();}},_wholePageResize:function(){var _377=dojo.coords(this.domNode.parentNode);var _378=util.getElmGutterVertical(this.domNode.parentNode)+util.getElmGutterVertical(this.domNode);var _379=util.getElmGutterHorizontal(this.domNode.parentNode)+util.getElmGutterHorizontal(this.domNode);var h=(_377.h-_378-2);var w=(_377.w-_379-2);this.setHeightInput(h);this.setWidthInput(w);dojo.style(this.domNode,{height:h+"px",width:w+"px"});return {height:h,width:w};},_readURLSettings:function(){if(!this.settings.set){if(window.location.search){var _37c=dojo.queryToObject(window.location.search.slice(1));if(!util.isNothing(_37c.scale)){this.setScaleInput(_37c.scale);}if(!util.isNothing(_37c.level)){this.setLevelInput(_37c.level);}if(!util.isNothing(_37c.mapWidth)){this.setWidthInput(_37c.mapWidth);}if(!util.isNothing(_37c.mapHeight)){this.setHeightInput(_37c.mapHeight);}if(util.isNumber(_37c.x)&&util.isNumber(_37c.y)){this.setLocationInput({x:_37c.x,y:_37c.y});}}}},_readInlineSettings:function(){if(!this.settings.set){if(!util.isNothing(this.param_Scale)){this.setScaleInput(this.param_Scale);}if(!util.isNothing(this.param_Level)){this.setLevelInput(this.param_Level);}if(!util.isNothing(this.param_Height)){this.setHeightInput(this.param_Height);}if(!util.isNothing(this.param_Width)){this.setWidthInput(this.param_Width);}if(!util.isNothing(this.param_LocationX,this.param_LocationY)){this.setLocationInput({x:util.parseNumber(this.param_LocationX),y:util.parseNumber(this.param_LocationY)});}else{if(!util.isNothing(this.param_XMin,this.param_YMin,this.param_XMax,this.param_YMax)){this.setExtentInput({xmin:util.parseNumber(this.param_XMin),ymin:util.parseNumber(this.param_YMin),xmax:util.parseNumber(this.param_XMax),ymax:util.parseNumber(this.param_YMax)});}}if(util.isStringPopulated(this.param_Text)){this.setTextInput(this.param_Text);}if(util.isStringPopulated(this.param_Tools)){this.setToolsInput(this.param_Tools);}if(util.isStringPopulated(this.param_TravelNews)){this.setTravelNewsInput(this.param_TravelNews);}if(util.isStringPopulated(this.param_Symbols)||util.isArrayPopulated(this.param_Symbols)){this.setSymbolsInput(this.param_Symbols);}if(util.isStringPopulated(this.param_Routes)){this.setRouteInput(this.param_Routes);}if(util.isStringPopulated(this.param_Mode)){this.setModeInput(this.param_Mode);}this.param_WholePage=util.parseBool(this.param_WholePage);}},showPanels:function(arr){var _37e=arr.length,_37f=false,item;for(var i=0;i<_37e;i++){item=arr[i];if(item==="pan"){_37f=true;dojo.style(this.attachNavPanel.domNode,{display:"block"});}else{if(item==="zoom"){_37f=true;dojo.style(this.attachMapSliderContent.parentNode,{display:"block"});}}}if(!_37f){dojo.addClass(this.attachToolBarPanel.domNode,"toolbarPanelContainerFlush");}},_addBugFixes:function(){var map=this.attachMap.getMap();dojo.global.esri.Map.prototype.reposition=function(){var pos=dojo.coords(this.container,true),brdr=dojo._getBorderExtents(this.container);this.position.setX(pos.x+brdr.l);this.position.setY(pos.y+brdr.t);this.onReposition(this.position.x,this.position.y);};}};})());}