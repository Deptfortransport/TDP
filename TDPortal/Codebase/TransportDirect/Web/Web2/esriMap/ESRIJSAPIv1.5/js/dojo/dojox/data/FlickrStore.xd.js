/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.FlickrStore"],["require","dojo.data.util.simpleFetch"],["require","dojo.io.script"],["require","dojo.date.stamp"],["require","dojo.AdapterRegistry"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.FlickrStore"]){_4._hasResource["dojox.data.FlickrStore"]=true;_4.provide("dojox.data.FlickrStore");_4.require("dojo.data.util.simpleFetch");_4.require("dojo.io.script");_4.require("dojo.date.stamp");_4.require("dojo.AdapterRegistry");(function(){var d=_4;_4.declare("dojox.data.FlickrStore",null,{constructor:function(_8){if(_8&&_8.label){this.label=_8.label;}},_storeRef:"_S",label:"title",_assertIsItem:function(_9){if(!this.isItem(_9)){throw new Error("dojox.data.FlickrStore: a function was passed an item argument that was not an item");}},_assertIsAttribute:function(_a){if(typeof _a!=="string"){throw new Error("dojox.data.FlickrStore: a function was passed an attribute argument that was not an attribute name string");}},getFeatures:function(){return {"dojo.data.api.Read":true};},getValue:function(_b,_c,_d){var _e=this.getValues(_b,_c);if(_e&&_e.length>0){return _e[0];}return _d;},getAttributes:function(_f){return ["title","description","author","datePublished","dateTaken","imageUrl","imageUrlSmall","imageUrlMedium","tags","link"];},hasAttribute:function(_10,_11){if(this.getValue(_10,_11)){return true;}return false;},isItemLoaded:function(_12){return this.isItem(_12);},loadItem:function(_13){},getLabel:function(_14){return this.getValue(_14,this.label);},getLabelAttributes:function(_15){return [this.label];},containsValue:function(_16,_17,_18){var _19=this.getValues(_16,_17);for(var i=0;i<_19.length;i++){if(_19[i]===_18){return true;}}return false;},getValues:function(_1b,_1c){this._assertIsItem(_1b);this._assertIsAttribute(_1c);var u=d.hitch(this,"_unescapeHtml");var s=d.hitch(d.date.stamp,"fromISOString");switch(_1c){case "title":return [u(_1b.title)];case "author":return [u(_1b.author)];case "datePublished":return [s(_1b.published)];case "dateTaken":return [s(_1b.date_taken)];case "imageUrlSmall":return [_1b.media.m.replace(/_m\./,"_s.")];case "imageUrl":return [_1b.media.m.replace(/_m\./,".")];case "imageUrlMedium":return [_1b.media.m];case "link":return [_1b.link];case "tags":return _1b.tags.split(" ");case "description":return [u(_1b.description)];default:return [];}},isItem:function(_1f){if(_1f&&_1f[this._storeRef]===this){return true;}return false;},close:function(_20){},_fetchItems:function(_21,_22,_23){var rq=_21.query=_21.query||{};var _25={format:"json",tagmode:"any"};d.forEach(["tags","tagmode","lang","id","ids"],function(i){if(rq[i]){_25[i]=rq[i];}});_25.id=rq.id||rq.userid||rq.groupid;if(rq.userids){_25.ids=rq.userids;}var _27=null;var _28={url:_6.data.FlickrStore.urlRegistry.match(_21),preventCache:true,content:_25};var _29=d.hitch(this,function(_2a){if(!!_27){d.disconnect(_27);}_22(this._processFlickrData(_2a),_21);});_27=d.connect("jsonFlickrFeed",_29);var _2b=d.io.script.get(_28);_2b.addErrback(function(_2c){d.disconnect(_27);_23(_2c,_21);});},_processFlickrData:function(_2d){var _2e=[];if(_2d.items){_2e=_2d.items;for(var i=0;i<_2d.items.length;i++){var _30=_2d.items[i];_30[this._storeRef]=this;}}return _2e;},_unescapeHtml:function(str){return str.replace(/&amp;/gm,"&").replace(/&lt;/gm,"<").replace(/&gt;/gm,">").replace(/&quot;/gm,"\"").replace(/&#39;/gm,"'");}});_4.extend(_6.data.FlickrStore,_4.data.util.simpleFetch);var _32="http://api.flickr.com/services/feeds/";var reg=_6.data.FlickrStore.urlRegistry=new d.AdapterRegistry(true);reg.register("group pool",function(_34){return !!_34.query["groupid"];},_32+"groups_pool.gne");reg.register("default",function(_35){return true;},_32+"photos_public.gne");})();if(!_36){var _36=function(_37){};}}}};});