/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojo.dnd.Source"],["require","dojo.dnd.Selector"],["require","dojo.dnd.Manager"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojo.dnd.Source"]){_4._hasResource["dojo.dnd.Source"]=true;_4.provide("dojo.dnd.Source");_4.require("dojo.dnd.Selector");_4.require("dojo.dnd.Manager");_4.declare("dojo.dnd.Source",_4.dnd.Selector,{isSource:true,horizontal:false,copyOnly:false,selfCopy:false,selfAccept:true,skipForm:false,withHandles:false,autoSync:false,delay:0,accept:["text"],constructor:function(_7,_8){_4.mixin(this,_4.mixin({},_8));var _9=this.accept;if(_9.length){this.accept={};for(var i=0;i<_9.length;++i){this.accept[_9[i]]=1;}}this.isDragging=false;this.mouseDown=false;this.targetAnchor=null;this.targetBox=null;this.before=true;this._lastX=0;this._lastY=0;this.sourceState="";if(this.isSource){_4.addClass(this.node,"dojoDndSource");}this.targetState="";if(this.accept){_4.addClass(this.node,"dojoDndTarget");}if(this.horizontal){_4.addClass(this.node,"dojoDndHorizontal");}this.topics=[_4.subscribe("/dnd/source/over",this,"onDndSourceOver"),_4.subscribe("/dnd/start",this,"onDndStart"),_4.subscribe("/dnd/drop",this,"onDndDrop"),_4.subscribe("/dnd/cancel",this,"onDndCancel")];},checkAcceptance:function(_b,_c){if(this==_b){return !this.copyOnly||this.selfAccept;}for(var i=0;i<_c.length;++i){var _e=_b.getItem(_c[i].id).type;var _f=false;for(var j=0;j<_e.length;++j){if(_e[j] in this.accept){_f=true;break;}}if(!_f){return false;}}return true;},copyState:function(_11,_12){if(_11){return true;}if(arguments.length<2){_12=this==_4.dnd.manager().target;}if(_12){if(this.copyOnly){return this.selfCopy;}}else{return this.copyOnly;}return false;},destroy:function(){_4.dnd.Source.superclass.destroy.call(this);_4.forEach(this.topics,_4.unsubscribe);this.targetAnchor=null;},markupFactory:function(_13,_14){_13._skipStartup=true;return new _4.dnd.Source(_14,_13);},onMouseMove:function(e){if(this.isDragging&&this.targetState=="Disabled"){return;}_4.dnd.Source.superclass.onMouseMove.call(this,e);var m=_4.dnd.manager();if(this.isDragging){var _17=false;if(this.current){if(!this.targetBox||this.targetAnchor!=this.current){this.targetBox={xy:_4.coords(this.current,true),w:this.current.offsetWidth,h:this.current.offsetHeight};}if(this.horizontal){_17=(e.pageX-this.targetBox.xy.x)<(this.targetBox.w/2);}else{_17=(e.pageY-this.targetBox.xy.y)<(this.targetBox.h/2);}}if(this.current!=this.targetAnchor||_17!=this.before){this._markTargetAnchor(_17);m.canDrop(!this.current||m.source!=this||!(this.current.id in this.selection));}}else{if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay)){var _18=this.getSelectedNodes();if(_18.length){m.startDrag(this,_18,this.copyState(_4.dnd.getCopyKeyState(e),true));}}}},onMouseDown:function(e){if(!this.mouseDown&&this._legalMouseDown(e)&&(!this.skipForm||!_4.dnd.isFormElement(e))){this.mouseDown=true;this._lastX=e.pageX;this._lastY=e.pageY;_4.dnd.Source.superclass.onMouseDown.call(this,e);}},onMouseUp:function(e){if(this.mouseDown){this.mouseDown=false;_4.dnd.Source.superclass.onMouseUp.call(this,e);}},onDndSourceOver:function(_1b){if(this!=_1b){this.mouseDown=false;if(this.targetAnchor){this._unmarkTargetAnchor();}}else{if(this.isDragging){var m=_4.dnd.manager();m.canDrop(this.targetState!="Disabled"&&(!this.current||m.source!=this||!(this.current.id in this.selection)));}}},onDndStart:function(_1d,_1e,_1f){if(this.autoSync){this.sync();}if(this.isSource){this._changeState("Source",this==_1d?(_1f?"Copied":"Moved"):"");}var _20=this.accept&&this.checkAcceptance(_1d,_1e);this._changeState("Target",_20?"":"Disabled");if(this==_1d){_4.dnd.manager().overSource(this);}this.isDragging=true;},onDndDrop:function(_21,_22,_23,_24){if(this==_24){this.onDrop(_21,_22,_23);}this.onDndCancel();},onDndCancel:function(){if(this.targetAnchor){this._unmarkTargetAnchor();this.targetAnchor=null;}this.before=true;this.isDragging=false;this.mouseDown=false;this._changeState("Source","");this._changeState("Target","");},onDrop:function(_25,_26,_27){if(this!=_25){this.onDropExternal(_25,_26,_27);}else{this.onDropInternal(_26,_27);}},onDropExternal:function(_28,_29,_2a){var _2b=this._normalizedCreator;if(this.creator){this._normalizedCreator=function(_2c,_2d){return _2b.call(this,_28.getItem(_2c.id).data,_2d);};}else{if(_2a){this._normalizedCreator=function(_2e,_2f){var t=_28.getItem(_2e.id);var n=_2e.cloneNode(true);n.id=_4.dnd.getUniqueId();return {node:n,data:t.data,type:t.type};};}else{this._normalizedCreator=function(_32,_33){var t=_28.getItem(_32.id);_28.delItem(_32.id);return {node:_32,data:t.data,type:t.type};};}}this.selectNone();if(!_2a&&!this.creator){_28.selectNone();}this.insertNodes(true,_29,this.before,this.current);if(!_2a&&this.creator){_28.deleteSelectedNodes();}this._normalizedCreator=_2b;},onDropInternal:function(_35,_36){var _37=this._normalizedCreator;if(this.current&&this.current.id in this.selection){return;}if(_36){if(this.creator){this._normalizedCreator=function(_38,_39){return _37.call(this,this.getItem(_38.id).data,_39);};}else{this._normalizedCreator=function(_3a,_3b){var t=this.getItem(_3a.id);var n=_3a.cloneNode(true);n.id=_4.dnd.getUniqueId();return {node:n,data:t.data,type:t.type};};}}else{if(!this.current){return;}this._normalizedCreator=function(_3e,_3f){var t=this.getItem(_3e.id);return {node:_3e,data:t.data,type:t.type};};}this._removeSelection();this.insertNodes(true,_35,this.before,this.current);this._normalizedCreator=_37;},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){_4.dnd.Source.superclass.onOverEvent.call(this);_4.dnd.manager().overSource(this);if(this.isDragging&&this.targetState!="Disabled"){this.onDraggingOver();}},onOutEvent:function(){_4.dnd.Source.superclass.onOutEvent.call(this);_4.dnd.manager().outSource(this);if(this.isDragging&&this.targetState!="Disabled"){this.onDraggingOut();}},_markTargetAnchor:function(_41){if(this.current==this.targetAnchor&&this.before==_41){return;}if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}this.targetAnchor=this.current;this.targetBox=null;this.before=_41;if(this.targetAnchor){this._addItemClass(this.targetAnchor,this.before?"Before":"After");}},_unmarkTargetAnchor:function(){if(!this.targetAnchor){return;}this._removeItemClass(this.targetAnchor,this.before?"Before":"After");this.targetAnchor=null;this.targetBox=null;this.before=true;},_markDndStatus:function(_42){this._changeState("Source",_42?"Copied":"Moved");},_legalMouseDown:function(e){if(!_4.dnd._isLmbPressed(e)){return false;}if(!this.withHandles){return true;}for(var _44=e.target;_44&&_44!==this.node;_44=_44.parentNode){if(_4.hasClass(_44,"dojoDndHandle")){return true;}if(_4.hasClass(_44,"dojoDndItem")){break;}}return false;}});_4.declare("dojo.dnd.Target",_4.dnd.Source,{constructor:function(_45,_46){this.isSource=false;_4.removeClass(this.node,"dojoDndSource");},markupFactory:function(_47,_48){_47._skipStartup=true;return new _4.dnd.Target(_48,_47);}});_4.declare("dojo.dnd.AutoSource",_4.dnd.Source,{constructor:function(_49,_4a){this.autoSync=true;},markupFactory:function(_4b,_4c){_4b._skipStartup=true;return new _4.dnd.AutoSource(_4c,_4b);}});}}};});