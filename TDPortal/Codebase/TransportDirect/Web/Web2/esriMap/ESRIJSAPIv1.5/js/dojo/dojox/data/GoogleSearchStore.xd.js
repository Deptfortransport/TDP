/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.GoogleSearchStore"],["provide","dojox.data.GoogleWebSearchStore"],["provide","dojox.data.GoogleBlogSearchStore"],["provide","dojox.data.GoogleLocalSearchStore"],["provide","dojox.data.GoogleVideoSearchStore"],["provide","dojox.data.GoogleNewsSearchStore"],["provide","dojox.data.GoogleBookSearchStore"],["provide","dojox.data.GoogleImageSearchStore"],["require","dojo.io.script"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.GoogleSearchStore"]){_4._hasResource["dojox.data.GoogleSearchStore"]=true;_4.provide("dojox.data.GoogleSearchStore");_4.provide("dojox.data.GoogleWebSearchStore");_4.provide("dojox.data.GoogleBlogSearchStore");_4.provide("dojox.data.GoogleLocalSearchStore");_4.provide("dojox.data.GoogleVideoSearchStore");_4.provide("dojox.data.GoogleNewsSearchStore");_4.provide("dojox.data.GoogleBookSearchStore");_4.provide("dojox.data.GoogleImageSearchStore");_4.require("dojo.io.script");_4.experimental("dojox.data.GoogleSearchStore");_4.declare("dojox.data.GoogleSearchStore",null,{constructor:function(_7){if(_7){if(_7.label){this.label=_7.label;}if(_7.key){this._key=_7.key;}if(_7.lang){this._lang=_7.lang;}}this._id=_6.data.GoogleSearchStore.prototype._id++;},_id:0,_requestCount:0,_googleUrl:"http://ajax.googleapis.com/ajax/services/search/",_storeRef:"_S",_attributes:["unescapedUrl","url","visibleUrl","cacheUrl","title","titleNoFormatting","content"],label:"titleNoFormatting",_type:"web",_queryAttr:"text",_assertIsItem:function(_8){if(!this.isItem(_8)){throw new Error("dojox.data.GoogleSearchStore: a function was passed an item argument that was not an item");}},_assertIsAttribute:function(_9){if(typeof _9!=="string"){throw new Error("dojox.data.GoogleSearchStore: a function was passed an attribute argument that was not an attribute name string");}},getFeatures:function(){return {"dojo.data.api.Read":true};},getValue:function(_a,_b,_c){var _d=this.getValues(_a,_b);if(_d&&_d.length>0){return _d[0];}return _c;},getAttributes:function(_e){return this._attributes;},hasAttribute:function(_f,_10){if(this.getValue(_f,_10)){return true;}return false;},isItemLoaded:function(_11){return this.isItem(_11);},loadItem:function(_12){},getLabel:function(_13){return this.getValue(_13,this.label);},getLabelAttributes:function(_14){return [this.label];},containsValue:function(_15,_16,_17){var _18=this.getValues(_15,_16);for(var i=0;i<_18.length;i++){if(_18[i]===_17){return true;}}return false;},getValues:function(_1a,_1b){this._assertIsItem(_1a);this._assertIsAttribute(_1b);var val=_1a[_1b];if(_4.isArray(val)){return val;}else{if(val!==undefined){return [val];}else{return [];}}},isItem:function(_1d){if(_1d&&_1d[this._storeRef]===this){return true;}return false;},close:function(_1e){},_format:function(_1f,_20){return _1f;},fetch:function(_21){_21=_21||{};var _22=_21.scope||_4.global;if(!_21.query||!_21.query[this._queryAttr]){if(_21.onError){_21.onError.call(_22,new Error(this.declaredClass+": A query must be specified, with a '"+[this._queryAttr]+"' parameter."));return;}}var _23=_21.query[this._queryAttr];_21={query:{},onComplete:_21.onComplete,onError:_21.onError,onItem:_21.onItem,onBegin:_21.onBegin,start:_21.start,count:_21.count};_21.query[this._queryAttr]=_23;var _24=8;var _25="GoogleSearchStoreCallback_"+this._id+"_"+(++this._requestCount);var _26=this._createContent(_23,_25,_21);var _27;if(typeof (_21.start)==="undefined"||_21.start===null){_21.start=0;}if(!_21.count){_21.count=_24;}_27={start:_21.start-_21.start%_24};var _28=this;var _29=null;var _2a=this._googleUrl+this._type;var _2b={url:_2a,preventCache:true,content:_26};var _2c=[];var _2d=0;var _2e=false;var _2f=_21.start-1;var _30=0;function _31(req){_30++;_2b.content.context=_2b.content.start=req.start;var _33=_4.io.script.get(_2b);_33.addErrback(function(_34){if(_21.onError){_21.onError.call(_22,_34,_21);}});};var _35=function(_36,_37){if(_2e){return;}var _38=_28._getItems(_37);var _39=_37?_37["cursor"]:null;if(_38){for(var i=0;i<_38.length&&i+_36<_21.count+_21.start;i++){_28._processItem(_38[i],_37);_2c[i+_36]=_38[i];}_2d++;if(_2d==1){var _3b=_39?_39.pages:null;var _3c=_3b?Number(_3b[_3b.length-1].start):0;if(_21.onBegin){var est=_39?_39.estimatedResultCount:_38.length;var _3e=est?Math.min(est,_3c+_38.length):_3c+_38.length;_21.onBegin.call(_22,_3e,_21);}var _3f=(_21.start-_21.start%_24)+_24;var _40=1;while(_3b){if(!_3b[_40]||Number(_3b[_40].start)>=_21.start+_21.count){break;}if(Number(_3b[_40].start)>=_3f){_31({start:_3b[_40].start});}_40++;}}if(_21.onItem&&_2c[_2f+1]){do{_2f++;_21.onItem.call(_22,_2c[_2f],_21);}while(_2c[_2f+1]&&_2f<_21.start+_21.count);}if(_2d==_30){_2e=true;_4.global[_25]=null;if(_21.onItem){_21.onComplete.call(_22,null,_21);}else{_2c=_2c.slice(_21.start,_21.start+_21.count);_21.onComplete.call(_22,_2c,_21);}}}};var _41=[];var _42=_27.start-1;var _43=function(a,b){if(a.start<b.start){return -1;}if(b.start<a.start){return 1;}return 0;};_4.global[_25]=function(_46,_47,_48,_49){try{if(_48!=200){if(_21.onError){_21.onError.call(_22,new Error("Response from Google was: "+_48),_21);}_4.global[_25]=function(){};return;}if(_46==_42+1){_35(Number(_46),_47);_42+=_24;if(_41.length>0){_41.sort(_43);while(_41.length>0&&_41[0].start==_42+1){_35(Number(_41[0].start),_41[0].data);_41.splice(0,1);_42+=_24;}}}else{_41.push({start:_46,data:_47});}}catch(e){_21.onError.call(_22,e,_21);}};_31(_27);},_processItem:function(_4a,_4b){_4a[this._storeRef]=this;},_getItems:function(_4c){return _4c["results"]||_4c;},_createContent:function(_4d,_4e,_4f){return {q:_4d,v:"1.0",rsz:"large",callback:_4e,key:this._key,hl:this._lang};}});_4.declare("dojox.data.GoogleWebSearchStore",_6.data.GoogleSearchStore,{});_4.declare("dojox.data.GoogleBlogSearchStore",_6.data.GoogleSearchStore,{_type:"blogs",_attributes:["blogUrl","postUrl","title","titleNoFormatting","content","author","publishedDate"]});_4.declare("dojox.data.GoogleLocalSearchStore",_6.data.GoogleSearchStore,{_type:"local",_attributes:["title","titleNoFormatting","url","lat","lng","streetAddress","city","region","country","phoneNumbers","ddUrl","ddUrlToHere","ddUrlFromHere","staticMapUrl"]});_4.declare("dojox.data.GoogleVideoSearchStore",_6.data.GoogleSearchStore,{_type:"video",_attributes:["title","titleNoFormatting","content","url","published","publisher","duration","tbWidth","tbHeight","tbUrl","playUrl"]});_4.declare("dojox.data.GoogleNewsSearchStore",_6.data.GoogleSearchStore,{_type:"news",_attributes:["title","titleNoFormatting","content","url","unescapedUrl","publisher","clusterUrl","location","publishedDate","relatedStories"]});_4.declare("dojox.data.GoogleBookSearchStore",_6.data.GoogleSearchStore,{_type:"books",_attributes:["title","titleNoFormatting","authors","url","unescapedUrl","bookId","pageCount","publishedYear"]});_4.declare("dojox.data.GoogleImageSearchStore",_6.data.GoogleSearchStore,{_type:"images",_attributes:["title","titleNoFormatting","visibleUrl","url","unescapedUrl","originalContextUrl","width","height","tbWidth","tbHeight","tbUrl","content","contentNoFormatting"]});}}};});