/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid._Builder"],["require","dojox.grid.util"],["require","dojo.dnd.Moveable"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid._Builder"]){_4._hasResource["dojox.grid._Builder"]=true;_4.provide("dojox.grid._Builder");_4.require("dojox.grid.util");_4.require("dojo.dnd.Moveable");(function(){var dg=_6.grid;var _8=function(td){return td.cellIndex>=0?td.cellIndex:_4.indexOf(td.parentNode.cells,td);};var _a=function(tr){return tr.rowIndex>=0?tr.rowIndex:_4.indexOf(tr.parentNode.childNodes,tr);};var _c=function(_d,_e){return _d&&((_d.rows||0)[_e]||_d.childNodes[_e]);};var _f=function(_10){for(var n=_10;n&&n.tagName!="TABLE";n=n.parentNode){}return n;};var _12=function(_13,_14){for(var n=_13;n&&_14(n);n=n.parentNode){}return n;};var _16=function(_17){var _18=_17.toUpperCase();return function(_19){return _19.tagName!=_18;};};var _1a=_6.grid.util.rowIndexTag;var _1b=_6.grid.util.gridViewTag;dg._Builder=_4.extend(function(_1c){if(_1c){this.view=_1c;this.grid=_1c.grid;}},{view:null,_table:"<table class=\"dojoxGridRowTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" role=\""+(_4.isFF<3?"wairole:":"")+"presentation\"",getTableArray:function(){var _1d=[this._table];if(this.view.viewWidth){_1d.push([" style=\"width:",this.view.viewWidth,";\""].join(""));}_1d.push(">");return _1d;},generateCellMarkup:function(_1e,_1f,_20,_21){var _22=[],_23;var _24=_4.isFF<3?"wairole:":"";if(_21){var _25=_1e.index!=_1e.grid.getSortIndex()?"":_1e.grid.sortInfo>0?"aria-sort=\"ascending\"":"aria-sort=\"descending\"";_23=["<th tabIndex=\"-1\" role=\"",_24,"columnheader\"",_25];}else{_23=["<td tabIndex=\"-1\" role=\"",_24,"gridcell\""];}_1e.colSpan&&_23.push(" colspan=\"",_1e.colSpan,"\"");_1e.rowSpan&&_23.push(" rowspan=\"",_1e.rowSpan,"\"");_23.push(" class=\"dojoxGridCell ");_1e.classes&&_23.push(_1e.classes," ");_20&&_23.push(_20," ");_22.push(_23.join(""));_22.push("");_23=["\" idx=\"",_1e.index,"\" style=\""];if(_1f&&_1f[_1f.length-1]!=";"){_1f+=";";}_23.push(_1e.styles,_1f||"",_1e.hidden?"display:none;":"");_1e.unitWidth&&_23.push("width:",_1e.unitWidth,";");_22.push(_23.join(""));_22.push("");_23=["\""];_1e.attrs&&_23.push(" ",_1e.attrs);_23.push(">");_22.push(_23.join(""));_22.push("");_22.push(_21?"</th>":"</td>");return _22;},isCellNode:function(_26){return Boolean(_26&&_26!=_4.doc&&_4.attr(_26,"idx"));},getCellNodeIndex:function(_27){return _27?Number(_4.attr(_27,"idx")):-1;},getCellNode:function(_28,_29){for(var i=0,row;row=_c(_28.firstChild,i);i++){for(var j=0,_2d;_2d=row.cells[j];j++){if(this.getCellNodeIndex(_2d)==_29){return _2d;}}}},findCellTarget:function(_2e,_2f){var n=_2e;while(n&&(!this.isCellNode(n)||(n.offsetParent&&_1b in n.offsetParent.parentNode&&n.offsetParent.parentNode[_1b]!=this.view.id))&&(n!=_2f)){n=n.parentNode;}return n!=_2f?n:null;},baseDecorateEvent:function(e){e.dispatch="do"+e.type;e.grid=this.grid;e.sourceView=this.view;e.cellNode=this.findCellTarget(e.target,e.rowNode);e.cellIndex=this.getCellNodeIndex(e.cellNode);e.cell=(e.cellIndex>=0?this.grid.getCell(e.cellIndex):null);},findTarget:function(_32,_33){var n=_32;while(n&&(n!=this.domNode)&&(!(_33 in n)||(_1b in n&&n[_1b]!=this.view.id))){n=n.parentNode;}return (n!=this.domNode)?n:null;},findRowTarget:function(_35){return this.findTarget(_35,_1a);},isIntraNodeEvent:function(e){try{return (e.cellNode&&e.relatedTarget&&_4.isDescendant(e.relatedTarget,e.cellNode));}catch(x){return false;}},isIntraRowEvent:function(e){try{var row=e.relatedTarget&&this.findRowTarget(e.relatedTarget);return !row&&(e.rowIndex==-1)||row&&(e.rowIndex==row.gridRowIndex);}catch(x){return false;}},dispatchEvent:function(e){if(e.dispatch in this){return this[e.dispatch](e);}},domouseover:function(e){if(e.cellNode&&(e.cellNode!=this.lastOverCellNode)){this.lastOverCellNode=e.cellNode;this.grid.onMouseOver(e);}this.grid.onMouseOverRow(e);},domouseout:function(e){if(e.cellNode&&(e.cellNode==this.lastOverCellNode)&&!this.isIntraNodeEvent(e,this.lastOverCellNode)){this.lastOverCellNode=null;this.grid.onMouseOut(e);if(!this.isIntraRowEvent(e)){this.grid.onMouseOutRow(e);}}},domousedown:function(e){if(e.cellNode){this.grid.onMouseDown(e);}this.grid.onMouseDownRow(e);}});dg._ContentBuilder=_4.extend(function(_3d){dg._Builder.call(this,_3d);},dg._Builder.prototype,{update:function(){this.prepareHtml();},prepareHtml:function(){var _3e=this.grid.get,_3f=this.view.structure.cells;for(var j=0,row;(row=_3f[j]);j++){for(var i=0,_43;(_43=row[i]);i++){_43.get=_43.get||(_43.value==undefined)&&_3e;_43.markup=this.generateCellMarkup(_43,_43.cellStyles,_43.cellClasses,false);}}},generateHtml:function(_44,_45){var _46=this.getTableArray(),v=this.view,_48=v.structure.cells,_49=this.grid.getItem(_45);_6.grid.util.fire(this.view,"onBeforeRow",[_45,_48]);for(var j=0,row;(row=_48[j]);j++){if(row.hidden||row.header){continue;}_46.push(!row.invisible?"<tr>":"<tr class=\"dojoxGridInvisible\">");for(var i=0,_4d,m,cc,cs;(_4d=row[i]);i++){m=_4d.markup,cc=_4d.customClasses=[],cs=_4d.customStyles=[];m[5]=_4d.format(_45,_49);m[1]=cc.join(" ");m[3]=cs.join(";");_46.push.apply(_46,m);}_46.push("</tr>");}_46.push("</table>");return _46.join("");},decorateEvent:function(e){e.rowNode=this.findRowTarget(e.target);if(!e.rowNode){return false;}e.rowIndex=e.rowNode[_1a];this.baseDecorateEvent(e);e.cell=this.grid.getCell(e.cellIndex);return true;}});dg._HeaderBuilder=_4.extend(function(_52){this.moveable=null;dg._Builder.call(this,_52);},dg._Builder.prototype,{_skipBogusClicks:false,overResizeWidth:4,minColWidth:1,update:function(){if(this.tableMap){this.tableMap.mapRows(this.view.structure.cells);}else{this.tableMap=new dg._TableMap(this.view.structure.cells);}},generateHtml:function(_53,_54){var _55=this.getTableArray(),_56=this.view.structure.cells;_6.grid.util.fire(this.view,"onBeforeRow",[-1,_56]);for(var j=0,row;(row=_56[j]);j++){if(row.hidden){continue;}_55.push(!row.invisible?"<tr>":"<tr class=\"dojoxGridInvisible\">");for(var i=0,_5a,_5b;(_5a=row[i]);i++){_5a.customClasses=[];_5a.customStyles=[];if(this.view.simpleStructure){if(_5a.headerClasses){if(_5a.headerClasses.indexOf("dojoDndItem")==-1){_5a.headerClasses+=" dojoDndItem";}}else{_5a.headerClasses="dojoDndItem";}if(_5a.attrs){if(_5a.attrs.indexOf("dndType='gridColumn_")==-1){_5a.attrs+=" dndType='gridColumn_"+this.grid.id+"'";}}else{_5a.attrs="dndType='gridColumn_"+this.grid.id+"'";}}_5b=this.generateCellMarkup(_5a,_5a.headerStyles,_5a.headerClasses,true);_5b[5]=(_54!=undefined?_54:_53(_5a));_5b[3]=_5a.customStyles.join(";");_5b[1]=_5a.customClasses.join(" ");_55.push(_5b.join(""));}_55.push("</tr>");}_55.push("</table>");return _55.join("");},getCellX:function(e){var x=e.layerX;if(_4.isMoz){var n=_12(e.target,_16("th"));x-=(n&&n.offsetLeft)||0;var t=e.sourceView.getScrollbarWidth();if(!_4._isBodyLtr()&&e.sourceView.headerNode.scrollLeft<t){x-=t;}}var n=_12(e.target,function(){if(!n||n==e.cellNode){return false;}x+=(n.offsetLeft<0?0:n.offsetLeft);return true;});return x;},decorateEvent:function(e){this.baseDecorateEvent(e);e.rowIndex=-1;e.cellX=this.getCellX(e);return true;},prepareResize:function(e,mod){do{var i=_8(e.cellNode);e.cellNode=(i?e.cellNode.parentNode.cells[i+mod]:null);e.cellIndex=(e.cellNode?this.getCellNodeIndex(e.cellNode):-1);}while(e.cellNode&&e.cellNode.style.display=="none");return Boolean(e.cellNode);},canResize:function(e){if(!e.cellNode||e.cellNode.colSpan>1){return false;}var _65=this.grid.getCell(e.cellIndex);return !_65.noresize&&_65.canResize();},overLeftResizeArea:function(e){if(_4.isIE){var tN=e.target;if(_4.hasClass(tN,"dojoxGridArrowButtonNode")||_4.hasClass(tN,"dojoxGridArrowButtonChar")){return false;}}if(_4._isBodyLtr()){return (e.cellIndex>0)&&(e.cellX<this.overResizeWidth)&&this.prepareResize(e,-1);}var t=e.cellNode&&(e.cellX<this.overResizeWidth);return t;},overRightResizeArea:function(e){if(_4.isIE){var tN=e.target;if(_4.hasClass(tN,"dojoxGridArrowButtonNode")||_4.hasClass(tN,"dojoxGridArrowButtonChar")){return false;}}if(_4._isBodyLtr()){return e.cellNode&&(e.cellX>=e.cellNode.offsetWidth-this.overResizeWidth);}return (e.cellIndex>0)&&(e.cellX>=e.cellNode.offsetWidth-this.overResizeWidth)&&this.prepareResize(e,-1);},domousemove:function(e){if(!this.moveable){var c=(this.overRightResizeArea(e)?"e-resize":(this.overLeftResizeArea(e)?"w-resize":""));if(c&&!this.canResize(e)){c="not-allowed";}if(_4.isIE){var t=e.sourceView.headerNode.scrollLeft;e.sourceView.headerNode.style.cursor=c||"";e.sourceView.headerNode.scrollLeft=t;}else{e.sourceView.headerNode.style.cursor=c||"";}if(c){_4.stopEvent(e);}}},domousedown:function(e){if(!this.moveable){if((this.overRightResizeArea(e)||this.overLeftResizeArea(e))&&this.canResize(e)){this.beginColumnResize(e);}else{this.grid.onMouseDown(e);this.grid.onMouseOverRow(e);}}},doclick:function(e){if(this._skipBogusClicks){_4.stopEvent(e);return true;}},beginColumnResize:function(e){this.moverDiv=document.createElement("div");_4.style(this.moverDiv,{position:"absolute",left:0});_4.body().appendChild(this.moverDiv);var m=this.moveable=new _4.dnd.Moveable(this.moverDiv);var _72=[],_73=this.tableMap.findOverlappingNodes(e.cellNode);for(var i=0,_75;(_75=_73[i]);i++){_72.push({node:_75,index:this.getCellNodeIndex(_75),width:_75.offsetWidth});}var _76=e.sourceView;var adj=_4._isBodyLtr()?1:-1;var _78=e.grid.views.views;var _79=[];for(var i=_76.idx+adj,_7a;(_7a=_78[i]);i=i+adj){_79.push({node:_7a.headerNode,left:window.parseInt(_7a.headerNode.style.left)});}var _7b=_76.headerContentNode.firstChild;var _7c={scrollLeft:e.sourceView.headerNode.scrollLeft,view:_76,node:e.cellNode,index:e.cellIndex,w:_4.contentBox(e.cellNode).w,vw:_4.contentBox(_76.headerNode).w,table:_7b,tw:_4.contentBox(_7b).w,spanners:_72,followers:_79};m.onMove=_4.hitch(this,"doResizeColumn",_7c);_4.connect(m,"onMoveStop",_4.hitch(this,function(){this.endResizeColumn(_7c);if(_7c.node.releaseCapture){_7c.node.releaseCapture();}this.moveable.destroy();delete this.moveable;this.moveable=null;}));_76.convertColPctToFixed();if(e.cellNode.setCapture){e.cellNode.setCapture();}m.onMouseDown(e);},doResizeColumn:function(_7d,_7e,_7f){var _80=_4._isBodyLtr();var _81=_80?_7f.l:-_7f.l;var w=_7d.w+_81;var vw=_7d.vw+_81;var tw=_7d.tw+_81;if(w>=this.minColWidth){for(var i=0,s,sw;(s=_7d.spanners[i]);i++){sw=s.width+_81;s.node.style.width=sw+"px";_7d.view.setColWidth(s.index,sw);}for(var i=0,f,fl;(f=_7d.followers[i]);i++){fl=f.left+_81;f.node.style.left=fl+"px";}_7d.node.style.width=w+"px";_7d.view.setColWidth(_7d.index,w);_7d.view.headerNode.style.width=vw+"px";_7d.view.setColumnsWidth(tw);if(!_80){_7d.view.headerNode.scrollLeft=_7d.scrollLeft+_81;}}if(_7d.view.flexCells&&!_7d.view.testFlexCells()){var t=_f(_7d.node);t&&(t.style.width="");}},endResizeColumn:function(_8b){_4.destroy(this.moverDiv);delete this.moverDiv;this._skipBogusClicks=true;var _8c=_4.connect(_8b.view,"update",this,function(){_4.disconnect(_8c);this._skipBogusClicks=false;});setTimeout(_4.hitch(_8b.view,"update"),50);}});dg._TableMap=_4.extend(function(_8d){this.mapRows(_8d);},{map:null,mapRows:function(_8e){var _8f=_8e.length;if(!_8f){return;}this.map=[];for(var j=0,row;(row=_8e[j]);j++){this.map[j]=[];}for(var j=0,row;(row=_8e[j]);j++){for(var i=0,x=0,_94,_95,_96;(_94=row[i]);i++){while(this.map[j][x]){x++;}this.map[j][x]={c:i,r:j};_96=_94.rowSpan||1;_95=_94.colSpan||1;for(var y=0;y<_96;y++){for(var s=0;s<_95;s++){this.map[j+y][x+s]=this.map[j][x];}}x+=_95;}}},dumpMap:function(){for(var j=0,row,h="";(row=this.map[j]);j++,h=""){for(var i=0,_9d;(_9d=row[i]);i++){h+=_9d.r+","+_9d.c+"   ";}}},getMapCoords:function(_9e,_9f){for(var j=0,row;(row=this.map[j]);j++){for(var i=0,_a3;(_a3=row[i]);i++){if(_a3.c==_9f&&_a3.r==_9e){return {j:j,i:i};}}}return {j:-1,i:-1};},getNode:function(_a4,_a5,_a6){var row=_a4&&_a4.rows[_a5];return row&&row.cells[_a6];},_findOverlappingNodes:function(_a8,_a9,_aa){var _ab=[];var m=this.getMapCoords(_a9,_aa);var row=this.map[m.j];for(var j=0,row;(row=this.map[j]);j++){if(j==m.j){continue;}var rw=row[m.i];var n=(rw?this.getNode(_a8,rw.r,rw.c):null);if(n){_ab.push(n);}}return _ab;},findOverlappingNodes:function(_b1){return this._findOverlappingNodes(_f(_b1),_a(_b1.parentNode),_8(_b1));}});})();}}};});