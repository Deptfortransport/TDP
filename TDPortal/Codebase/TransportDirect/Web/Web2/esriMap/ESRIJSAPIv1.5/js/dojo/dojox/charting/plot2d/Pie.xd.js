/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.charting.plot2d.Pie"],["require","dojox.charting.Element"],["require","dojox.charting.axis2d.common"],["require","dojox.charting.plot2d.common"],["require","dojox.lang.functional"],["require","dojox.gfx"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.charting.plot2d.Pie"]){_4._hasResource["dojox.charting.plot2d.Pie"]=true;_4.provide("dojox.charting.plot2d.Pie");_4.require("dojox.charting.Element");_4.require("dojox.charting.axis2d.common");_4.require("dojox.charting.plot2d.common");_4.require("dojox.lang.functional");_4.require("dojox.gfx");(function(){var df=_6.lang.functional,du=_6.lang.utils,dc=_6.charting.plot2d.common,da=_6.charting.axis2d.common,g=_6.gfx;_4.declare("dojox.charting.plot2d.Pie",_6.charting.Element,{defaultParams:{labels:true,ticks:false,fixed:true,precision:1,labelOffset:20,labelStyle:"default",htmlLabels:true},optionalParams:{font:"",fontColor:"",radius:0},constructor:function(_c,_d){this.opt=_4.clone(this.defaultParams);du.updateWithObject(this.opt,_d);du.updateWithPattern(this.opt,_d,this.optionalParams);this.run=null;this.dyn=[];},destroy:function(){this.resetEvents();this.inherited(arguments);},clear:function(){this.dirty=true;this.dyn=[];this.run=null;return this;},setAxis:function(_e){return this;},addSeries:function(_f){this.run=_f;return this;},calculateAxes:function(dim){return this;},getRequiredColors:function(){return this.run?this.run.data.length:0;},plotEvent:function(o){},connect:function(_12,_13){this.dirty=true;return _4.connect(this,"plotEvent",_12,_13);},events:function(){var ls=this.plotEvent._listeners;if(!ls||!ls.length){return false;}for(var i in ls){if(!(i in Array.prototype)){return true;}}return false;},resetEvents:function(){this.plotEvent({type:"onplotreset",plot:this});},_connectEvents:function(_16,o){_16.connect("onmouseover",this,function(e){o.type="onmouseover";o.event=e;this.plotEvent(o);});_16.connect("onmouseout",this,function(e){o.type="onmouseout";o.event=e;this.plotEvent(o);});_16.connect("onclick",this,function(e){o.type="onclick";o.event=e;this.plotEvent(o);});},render:function(dim,_1c){if(!this.dirty){return this;}this.dirty=false;this.cleanGroup();var s=this.group,_1e,t=this.chart.theme;this.resetEvents();if(!this.run||!this.run.data.length){return this;}var rx=(dim.width-_1c.l-_1c.r)/2,ry=(dim.height-_1c.t-_1c.b)/2,r=Math.min(rx,ry),_23="font" in this.opt?this.opt.font:t.axis.font,_24=_23?g.normalizedLength(g.splitFontString(_23).size):0,_25="fontColor" in this.opt?this.opt.fontColor:t.axis.fontColor,_26=0,_27,_28,_29,_2a,_2b,_2c,run=this.run.data,_2e=this.events();if(typeof run[0]=="number"){_28=df.map(run,"Math.max(x, 0)");if(df.every(_28,"<= 0")){return this;}_29=df.map(_28,"/this",df.foldl(_28,"+",0));if(this.opt.labels){_2a=_4.map(_29,function(x){return x>0?this._getLabel(x*100)+"%":"";},this);}}else{_28=df.map(run,"Math.max(x.y, 0)");if(df.every(_28,"<= 0")){return this;}_29=df.map(_28,"/this",df.foldl(_28,"+",0));if(this.opt.labels){_2a=_4.map(_29,function(x,i){if(x<=0){return "";}var v=run[i];return "text" in v?v.text:this._getLabel(x*100)+"%";},this);}}if(this.opt.labels){_2b=df.foldl1(df.map(_2a,function(_33){return _6.gfx._base._getTextBox(_33,{font:_23}).w;},this),"Math.max(a, b)")/2;if(this.opt.labelOffset<0){r=Math.min(rx-2*_2b,ry-_24)+this.opt.labelOffset;}_2c=r-this.opt.labelOffset;}if("radius" in this.opt){r=this.opt.radius;_2c=r-this.opt.labelOffset;}var _34={cx:_1c.l+rx,cy:_1c.t+ry,r:r};this.dyn=[];_4.some(_29,function(_35,i){if(_35<=0){return false;}var v=run[i];if(_35>=1){var _38,_39,_3a;if(typeof v=="object"){_38="color" in v?v.color:new _4.Color(t.next("color"));_39="fill" in v?v.fill:dc.augmentFill(t.series.fill,_38);_3a="stroke" in v?v.stroke:dc.augmentStroke(t.series.stroke,_38);}else{_38=new _4.Color(t.next("color"));_39=dc.augmentFill(t.series.fill,_38);_3a=dc.augmentStroke(t.series.stroke,_38);}var _3b=s.createCircle(_34).setFill(_39).setStroke(_3a);this.dyn.push({color:_38,fill:_39,stroke:_3a});if(_2e){var o={element:"slice",index:i,run:this.run,plot:this,shape:_3b,x:i,y:typeof v=="number"?v:v.y,cx:_34.cx,cy:_34.cy,cr:r};this._connectEvents(_3b,o);}return true;}var end=_26+_35*2*Math.PI;if(i+1==_29.length){end=2*Math.PI;}var _3e=end-_26,x1=_34.cx+r*Math.cos(_26),y1=_34.cy+r*Math.sin(_26),x2=_34.cx+r*Math.cos(end),y2=_34.cy+r*Math.sin(end);var _38,_39,_3a;if(typeof v=="object"){_38="color" in v?v.color:new _4.Color(t.next("color"));_39="fill" in v?v.fill:dc.augmentFill(t.series.fill,_38);_3a="stroke" in v?v.stroke:dc.augmentStroke(t.series.stroke,_38);}else{_38=new _4.Color(t.next("color"));_39=dc.augmentFill(t.series.fill,_38);_3a=dc.augmentStroke(t.series.stroke,_38);}var _3b=s.createPath({}).moveTo(_34.cx,_34.cy).lineTo(x1,y1).arcTo(r,r,0,_3e>Math.PI,true,x2,y2).lineTo(_34.cx,_34.cy).closePath().setFill(_39).setStroke(_3a);this.dyn.push({color:_38,fill:_39,stroke:_3a});if(_2e){var o={element:"slice",index:i,run:this.run,plot:this,shape:_3b,x:i,y:typeof v=="number"?v:v.y,cx:_34.cx,cy:_34.cy,cr:r};this._connectEvents(_3b,o);}_26=end;return false;},this);if(this.opt.labels){_26=0;_4.some(_29,function(_43,i){if(_43<=0){return false;}if(_43>=1){var v=run[i],_46=da.createText[this.opt.htmlLabels&&_6.gfx.renderer!="vml"?"html":"gfx"](this.chart,s,_34.cx,_34.cy+_24/2,"middle",_2a[i],_23,(typeof v=="object"&&"fontColor" in v)?v.fontColor:_25);if(this.opt.htmlLabels){this.htmlElements.push(_46);}return true;}var end=_26+_43*2*Math.PI,v=run[i];if(i+1==_29.length){end=2*Math.PI;}var _48=(_26+end)/2,x=_34.cx+_2c*Math.cos(_48),y=_34.cy+_2c*Math.sin(_48)+_24/2;var _46=da.createText[this.opt.htmlLabels&&_6.gfx.renderer!="vml"?"html":"gfx"](this.chart,s,x,y,"middle",_2a[i],_23,(typeof v=="object"&&"fontColor" in v)?v.fontColor:_25);if(this.opt.htmlLabels){this.htmlElements.push(_46);}_26=end;return false;},this);}return this;},_getLabel:function(_4b){return this.opt.fixed?_4b.toFixed(this.opt.precision):_4b.toString();}});})();}}};});