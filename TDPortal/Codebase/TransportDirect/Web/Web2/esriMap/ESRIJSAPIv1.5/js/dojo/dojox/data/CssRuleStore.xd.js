/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.CssRuleStore"],["require","dojo.data.util.filter"],["require","dojo.data.util.sorter"],["require","dojox.data.css"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.CssRuleStore"]){_4._hasResource["dojox.data.CssRuleStore"]=true;_4.provide("dojox.data.CssRuleStore");_4.require("dojo.data.util.filter");_4.require("dojo.data.util.sorter");_4.require("dojox.data.css");_4.declare("dojox.data.CssRuleStore",null,{_storeRef:"_S",_labelAttribute:"selector",_cache:null,_browserMap:null,_cName:"dojox.data.CssRuleStore",constructor:function(_7){if(_7){_4.mixin(this,_7);}this._cache={};this._allItems=null;this._waiting=[];this.gatherHandle=null;var _8=this;function _9(){try{_8.context=_6.data.css.determineContext(_8.context);if(_8.gatherHandle){clearInterval(_8.gatherHandle);_8.gatherHandle=null;}while(_8._waiting.length){var _a=_8._waiting.pop();_6.data.css.rules.forEach(_a.forFunc,null,_8.context);_a.finishFunc();}}catch(e){}};this.gatherHandle=setInterval(_9,250);},setContext:function(_b){if(_b){this.close();this.context=_6.data.css.determineContext(_b);}},getFeatures:function(){return {"dojo.data.api.Read":true};},isItem:function(_c){if(_c&&_c[this._storeRef]==this){return true;}return false;},hasAttribute:function(_d,_e){this._assertIsItem(_d);this._assertIsAttribute(_e);var _f=this.getAttributes(_d);if(_4.indexOf(_f,_e)!=-1){return true;}return false;},getAttributes:function(_10){this._assertIsItem(_10);var _11=["selector","classes","rule","style","cssText","styleSheet","parentStyleSheet","parentStyleSheetHref"];var _12=_10.rule.style;if(_12){var key;for(key in _12){_11.push("style."+key);}}return _11;},getValue:function(_14,_15,_16){var _17=this.getValues(_14,_15);var _18=_16;if(_17&&_17.length>0){return _17[0];}return _16;},getValues:function(_19,_1a){this._assertIsItem(_19);this._assertIsAttribute(_1a);var _1b=null;if(_1a==="selector"){_1b=_19.rule["selectorText"];if(_1b&&_4.isString(_1b)){_1b=_1b.split(",");}}else{if(_1a==="classes"){_1b=_19.classes;}else{if(_1a==="rule"){_1b=_19.rule.rule;}else{if(_1a==="style"){_1b=_19.rule.style;}else{if(_1a==="cssText"){if(_4.isIE){if(_19.rule.style){_1b=_19.rule.style.cssText;if(_1b){_1b="{ "+_1b.toLowerCase()+" }";}}}else{_1b=_19.rule.cssText;if(_1b){_1b=_1b.substring(_1b.indexOf("{"),_1b.length);}}}else{if(_1a==="styleSheet"){_1b=_19.rule.styleSheet;}else{if(_1a==="parentStyleSheet"){_1b=_19.rule.parentStyleSheet;}else{if(_1a==="parentStyleSheetHref"){if(_19.href){_1b=_19.href;}}else{if(_1a.indexOf("style.")===0){var _1c=_1a.substring(_1a.indexOf("."),_1a.length);_1b=_19.rule.style[_1c];}else{_1b=[];}}}}}}}}}if(_1b!==undefined){if(!_4.isArray(_1b)){_1b=[_1b];}}return _1b;},getLabel:function(_1d){this._assertIsItem(_1d);return this.getValue(_1d,this._labelAttribute);},getLabelAttributes:function(_1e){return [this._labelAttribute];},containsValue:function(_1f,_20,_21){var _22=undefined;if(typeof _21==="string"){_22=_4.data.util.filter.patternToRegExp(_21,false);}return this._containsValue(_1f,_20,_21,_22);},isItemLoaded:function(_23){return this.isItem(_23);},loadItem:function(_24){this._assertIsItem(_24.item);},fetch:function(_25){_25=_25||{};if(!_25.store){_25.store=this;}var _26=_25.scope||_4.global;if(this._pending&&this._pending.length>0){this._pending.push({request:_25,fetch:true});}else{this._pending=[{request:_25,fetch:true}];this._fetch(_25);}return _25;},_fetch:function(_27){var _28=_27.scope||_4.global;if(this._allItems===null){this._allItems={};try{if(this.gatherHandle){this._waiting.push({"forFunc":_4.hitch(this,this._handleRule),"finishFunc":_4.hitch(this,this._handleReturn)});}else{_6.data.css.rules.forEach(_4.hitch(this,this._handleRule),null,this.context);this._handleReturn();}}catch(e){if(_27.onError){_27.onError.call(_28,e,_27);}}}else{this._handleReturn();}},_handleRule:function(_29,_2a,_2b){var _2c=_29["selectorText"];var s=_2c.split(" ");var _2e=[];for(var j=0;j<s.length;j++){var tmp=s[j];var _31=tmp.indexOf(".");if(tmp&&tmp.length>0&&_31!==-1){var _32=tmp.indexOf(",")||tmp.indexOf("[");tmp=tmp.substring(_31,((_32!==-1&&_32>_31)?_32:tmp.length));_2e.push(tmp);}}var _33={};_33.rule=_29;_33.styleSheet=_2a;_33.href=_2b;_33.classes=_2e;_33[this._storeRef]=this;if(!this._allItems[_2c]){this._allItems[_2c]=[];}this._allItems[_2c].push(_33);},_handleReturn:function(){var _34=[];var _35=[];var _36=null;for(var i in this._allItems){_36=this._allItems[i];for(var j in _36){_35.push(_36[j]);}}var _39;while(this._pending.length){_39=this._pending.pop();_39.request._items=_35;_34.push(_39);}while(_34.length){_39=_34.pop();this._handleFetchReturn(_39.request);}},_handleFetchReturn:function(_3a){var _3b=_3a.scope||_4.global;var _3c=[];var _3d="all";var i;if(_3a.query){_3d=_4.toJson(_3a.query);}if(this._cache[_3d]){_3c=this._cache[_3d];}else{if(_3a.query){for(i in _3a._items){var _3f=_3a._items[i];var _40=_4.isWebKit?true:(_3a.queryOptions?_3a.queryOptions.ignoreCase:false);var _41={};var key;var _43;for(key in _3a.query){_43=_3a.query[key];if(typeof _43==="string"){_41[key]=_4.data.util.filter.patternToRegExp(_43,_40);}}var _44=true;for(key in _3a.query){_43=_3a.query[key];if(!this._containsValue(_3f,key,_43,_41[key])){_44=false;}}if(_44){_3c.push(_3f);}}this._cache[_3d]=_3c;}else{for(i in _3a._items){_3c.push(_3a._items[i]);}}}var _45=_3c.length;if(_3a.sort){_3c.sort(_4.data.util.sorter.createSortFunction(_3a.sort,this));}var _46=0;var _47=_3c.length;if(_3a.start>0&&_3a.start<_3c.length){_46=_3a.start;}if(_3a.count&&_3a.count){_47=_3a.count;}var _48=_46+_47;if(_48>_3c.length){_48=_3c.length;}_3c=_3c.slice(_46,_48);if(_3a.onBegin){_3a.onBegin.call(_3b,_45,_3a);}if(_3a.onItem){if(_4.isArray(_3c)){for(i=0;i<_3c.length;i++){_3a.onItem.call(_3b,_3c[i],_3a);}if(_3a.onComplete){_3a.onComplete.call(_3b,null,_3a);}}}else{if(_3a.onComplete){_3a.onComplete.call(_3b,_3c,_3a);}}return _3a;},close:function(){this._cache={};this._allItems=null;},_assertIsItem:function(_49){if(!this.isItem(_49)){throw new Error(this._cName+": Invalid item argument.");}},_assertIsAttribute:function(_4a){if(typeof _4a!=="string"){throw new Error(this._cName+": Invalid attribute argument.");}},_containsValue:function(_4b,_4c,_4d,_4e){return _4.some(this.getValues(_4b,_4c),function(_4f){if(_4f!==null&&!_4.isObject(_4f)&&_4e){if(_4f.toString().match(_4e)){return true;}}else{if(_4d===_4f){return true;}}return false;});}});}}};});