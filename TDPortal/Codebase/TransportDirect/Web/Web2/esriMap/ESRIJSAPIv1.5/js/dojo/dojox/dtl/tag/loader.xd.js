/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.dtl.tag.loader"],["require","dojox.dtl._base"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.dtl.tag.loader"]){_4._hasResource["dojox.dtl.tag.loader"]=true;_4.provide("dojox.dtl.tag.loader");_4.require("dojox.dtl._base");(function(){var dd=_6.dtl;var _8=dd.tag.loader;_8.BlockNode=_4.extend(function(_9,_a){this.name=_9;this.nodelist=_a;},{"super":function(){if(this.parent){var _b=this.parent.nodelist.dummyRender(this.context,null,true);if(typeof _b=="string"){_b=new String(_b);}_b.safe=true;return _b;}return "";},render:function(_c,_d){var _e=this.name;var _f=this.nodelist;var _10;if(_d.blocks){var _11=_d.blocks[_e];if(_11){_10=_11.parent;_f=_11.nodelist;_11.used=true;}}this.rendered=_f;_c=_c.push();this.context=_c;this.parent=null;if(_f!=this.nodelist){this.parent=this;}_c.block=this;if(_d.getParent){var _12=_d.getParent();var _13=_4.connect(_d,"onSetParent",function(_14,up,_16){if(up&&_16){_d.setParent(_12);}});}_d=_f.render(_c,_d,this);_13&&_4.disconnect(_13);_c=_c.pop();return _d;},unrender:function(_17,_18){return this.rendered.unrender(_17,_18);},clone:function(_19){return new this.constructor(this.name,this.nodelist.clone(_19));},toString:function(){return "dojox.dtl.tag.loader.BlockNode";}});_8.ExtendsNode=_4.extend(function(_1a,_1b,_1c,_1d,key){this.getTemplate=_1a;this.nodelist=_1b;this.shared=_1c;this.parent=_1d;this.key=key;},{parents:{},getParent:function(_1f){var _20=this.parent;if(!_20){var _21;_20=this.parent=_1f.get(this.key,false);if(!_20){throw new Error("extends tag used a variable that did not resolve");}if(typeof _20=="object"){var url=_20.url||_20.templatePath;if(_20.shared){this.shared=true;}if(url){_20=this.parent=url.toString();}else{if(_20.templateString){_21=_20.templateString;_20=this.parent=" ";}else{_20=this.parent=this.parent.toString();}}}if(_20&&_20.indexOf("shared:")===0){this.shared=true;_20=this.parent=_20.substring(7,_20.length);}}if(!_20){throw new Error("Invalid template name in 'extends' tag.");}if(_20.render){return _20;}if(this.parents[_20]){return this.parents[_20];}this.parent=this.getTemplate(_21||_6.dtl.text.getTemplateString(_20));if(this.shared){this.parents[_20]=this.parent;}return this.parent;},render:function(_23,_24){var _25=this.getParent(_23);_25.blocks=_25.blocks||{};_24.blocks=_24.blocks||{};for(var i=0,_27;_27=this.nodelist.contents[i];i++){if(_27 instanceof _6.dtl.tag.loader.BlockNode){var old=_25.blocks[_27.name];if(old&&old.nodelist!=_27.nodelist){_24=old.nodelist.unrender(_23,_24);}_25.blocks[_27.name]=_24.blocks[_27.name]={shared:this.shared,nodelist:_27.nodelist,used:false};}}this.rendered=_25;return _25.nodelist.render(_23,_24,this);},unrender:function(_29,_2a){return this.rendered.unrender(_29,_2a,this);},toString:function(){return "dojox.dtl.block.ExtendsNode";}});_8.IncludeNode=_4.extend(function(_2b,_2c,_2d,_2e,_2f){this._path=_2b;this.constant=_2c;this.path=(_2c)?_2b:new dd._Filter(_2b);this.getTemplate=_2d;this.text=_2e;this.parsed=(arguments.length==5)?_2f:true;},{_cache:[{},{}],render:function(_30,_31){var _32=((this.constant)?this.path:this.path.resolve(_30)).toString();var _33=Number(this.parsed);var _34=false;if(_32!=this.last){_34=true;if(this.last){_31=this.unrender(_30,_31);}this.last=_32;}var _35=this._cache[_33];if(_33){if(!_35[_32]){_35[_32]=dd.text._resolveTemplateArg(_32,true);}if(_34){var _36=this.getTemplate(_35[_32]);this.rendered=_36.nodelist;}return this.rendered.render(_30,_31,this);}else{if(this.text instanceof dd._TextNode){if(_34){this.rendered=this.text;this.rendered.set(dd.text._resolveTemplateArg(_32,true));}return this.rendered.render(_30,_31);}else{if(!_35[_32]){var _37=[];var div=document.createElement("div");div.innerHTML=dd.text._resolveTemplateArg(_32,true);var _39=div.childNodes;while(_39.length){var _3a=div.removeChild(_39[0]);_37.push(_3a);}_35[_32]=_37;}if(_34){this.nodelist=[];var _3b=true;for(var i=0,_3d;_3d=_35[_32][i];i++){this.nodelist.push(_3d.cloneNode(true));}}for(var i=0,_3e;_3e=this.nodelist[i];i++){_31=_31.concat(_3e);}}}return _31;},unrender:function(_3f,_40){if(this.rendered){_40=this.rendered.unrender(_3f,_40);}if(this.nodelist){for(var i=0,_42;_42=this.nodelist[i];i++){_40=_40.remove(_42);}}return _40;},clone:function(_43){return new this.constructor(this._path,this.constant,this.getTemplate,this.text.clone(_43),this.parsed);}});_4.mixin(_8,{block:function(_44,_45){var _46=_45.contents.split();var _47=_46[1];_44._blocks=_44._blocks||{};_44._blocks[_47]=_44._blocks[_47]||[];_44._blocks[_47].push(_47);var _48=_44.parse(["endblock","endblock "+_47]).rtrim();_44.next_token();return new _6.dtl.tag.loader.BlockNode(_47,_48);},extends_:function(_49,_4a){var _4b=_4a.contents.split();var _4c=false;var _4d=null;var key=null;if(_4b[1].charAt(0)=="\""||_4b[1].charAt(0)=="'"){_4d=_4b[1].substring(1,_4b[1].length-1);}else{key=_4b[1];}if(_4d&&_4d.indexOf("shared:")==0){_4c=true;_4d=_4d.substring(7,_4d.length);}var _4f=_49.parse();return new _6.dtl.tag.loader.ExtendsNode(_49.getTemplate,_4f,_4c,_4d,key);},include:function(_50,_51){var _52=_51.contents.split();if(_52.length!=2){throw new Error(_52[0]+" tag takes one argument: the name of the template to be included");}var _53=_52[1];var _54=false;if((_53.charAt(0)=="\""||_53.slice(-1)=="'")&&_53.charAt(0)==_53.slice(-1)){_53=_53.slice(1,-1);_54=true;}return new _8.IncludeNode(_53,_54,_50.getTemplate,_50.create_text_node());},ssi:function(_55,_56){var _57=_56.contents.split();var _58=false;if(_57.length==3){_58=(_57.pop()=="parsed");if(!_58){throw new Error("Second (optional) argument to ssi tag must be 'parsed'");}}var _59=_8.include(_55,new dd.Token(_56.token_type,_57.join(" ")));_59.parsed=_58;return _59;}});})();}}};});