/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid._View"],["require","dijit._Widget"],["require","dijit._Templated"],["require","dojox.grid._Builder"],["require","dojox.html.metrics"],["require","dojox.grid.util"],["require","dojo.dnd.Source"],["require","dojo.dnd.Manager"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid._View"]){_4._hasResource["dojox.grid._View"]=true;_4.provide("dojox.grid._View");_4.require("dijit._Widget");_4.require("dijit._Templated");_4.require("dojox.grid._Builder");_4.require("dojox.html.metrics");_4.require("dojox.grid.util");_4.require("dojo.dnd.Source");_4.require("dojo.dnd.Manager");(function(){var _7=function(_8,_9){return _8.style.cssText==undefined?_8.getAttribute("style"):_8.style.cssText;};_4.declare("dojox.grid._View",[_5._Widget,_5._Templated],{defaultWidth:"18em",viewWidth:"",templateString:"<div class=\"dojoxGridView\" wairole=\"presentation\">\r\n\t<div class=\"dojoxGridHeader\" dojoAttachPoint=\"headerNode\" wairole=\"presentation\">\r\n\t\t<div dojoAttachPoint=\"headerNodeContainer\" style=\"width:9000em\" wairole=\"presentation\">\r\n\t\t\t<div dojoAttachPoint=\"headerContentNode\" wairole=\"row\"></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<input type=\"checkbox\" class=\"dojoxGridHiddenFocus\" dojoAttachPoint=\"hiddenFocusNode\" wairole=\"presentation\" />\r\n\t<input type=\"checkbox\" class=\"dojoxGridHiddenFocus\" wairole=\"presentation\" />\r\n\t<div class=\"dojoxGridScrollbox\" dojoAttachPoint=\"scrollboxNode\" wairole=\"presentation\">\r\n\t\t<div class=\"dojoxGridContent\" dojoAttachPoint=\"contentNode\" hidefocus=\"hidefocus\" wairole=\"presentation\"></div>\r\n\t</div>\r\n</div>\r\n",themeable:false,classTag:"dojoxGrid",marginBottom:0,rowPad:2,_togglingColumn:-1,postMixInProperties:function(){this.rowNodes=[];},postCreate:function(){this.connect(this.scrollboxNode,"onscroll","doscroll");_6.grid.util.funnelEvents(this.contentNode,this,"doContentEvent",["mouseover","mouseout","click","dblclick","contextmenu","mousedown"]);_6.grid.util.funnelEvents(this.headerNode,this,"doHeaderEvent",["dblclick","mouseover","mouseout","mousemove","mousedown","click","contextmenu"]);this.content=new _6.grid._ContentBuilder(this);this.header=new _6.grid._HeaderBuilder(this);if(!_4._isBodyLtr()){this.headerNodeContainer.style.width="";}},destroy:function(){_4.destroy(this.headerNode);delete this.headerNode;_4.forEach(this.rowNodes,_4.destroy);this.rowNodes=[];if(this.source){this.source.destroy();}this.inherited(arguments);},focus:function(){if(_4.isWebKit||_4.isOpera){this.hiddenFocusNode.focus();}else{this.scrollboxNode.focus();}},setStructure:function(_a){var vs=(this.structure=_a);if(vs.width&&!isNaN(vs.width)){this.viewWidth=vs.width+"em";}else{this.viewWidth=vs.width||(vs.noscroll?"auto":this.viewWidth);}this.onBeforeRow=vs.onBeforeRow;this.onAfterRow=vs.onAfterRow;this.noscroll=vs.noscroll;if(this.noscroll){this.scrollboxNode.style.overflow="hidden";}this.simpleStructure=Boolean(vs.cells.length==1);this.testFlexCells();this.updateStructure();},testFlexCells:function(){this.flexCells=false;for(var j=0,_d;(_d=this.structure.cells[j]);j++){for(var i=0,_f;(_f=_d[i]);i++){_f.view=this;this.flexCells=this.flexCells||_f.isFlex();}}return this.flexCells;},updateStructure:function(){this.header.update();this.content.update();},getScrollbarWidth:function(){var _10=this.hasVScrollbar();var _11=_4.style(this.scrollboxNode,"overflow");if(this.noscroll||!_11||_11=="hidden"){_10=false;}else{if(_11=="scroll"){_10=true;}}return (_10?_6.html.metrics.getScrollbar().w:0);},getColumnsWidth:function(){return this.headerContentNode.firstChild.offsetWidth;},setColumnsWidth:function(_12){this.headerContentNode.firstChild.style.width=_12+"px";if(this.viewWidth){this.viewWidth=_12+"px";}},getWidth:function(){return this.viewWidth||(this.getColumnsWidth()+this.getScrollbarWidth())+"px";},getContentWidth:function(){return Math.max(0,_4._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px";},render:function(){this.scrollboxNode.style.height="";this.renderHeader();if(this._togglingColumn>=0){this.setColumnsWidth(this.getColumnsWidth()-this._togglingColumn);this._togglingColumn=-1;}var _13=this.grid.layout.cells;var _14=_4.hitch(this,function(_15,_16){var inc=_16?-1:1;var idx=this.header.getCellNodeIndex(_15)+inc;var _19=_13[idx];while(_19&&_19.getHeaderNode()&&_19.getHeaderNode().style.display=="none"){idx+=inc;_19=_13[idx];}if(_19){return _19.getHeaderNode();}return null;});if(this.grid.columnReordering&&this.simpleStructure){if(this.source){this.source.destroy();}this.source=new _4.dnd.Source(this.headerContentNode.firstChild.rows[0],{horizontal:true,accept:["gridColumn_"+this.grid.id],viewIndex:this.index,onMouseDown:_4.hitch(this,function(e){this.header.decorateEvent(e);if((this.header.overRightResizeArea(e)||this.header.overLeftResizeArea(e))&&this.header.canResize(e)&&!this.header.moveable){this.header.beginColumnResize(e);}else{if(this.grid.headerMenu){this.grid.headerMenu.onCancel(true);}if(e.button===(_4.isIE?1:0)){_4.dnd.Source.prototype.onMouseDown.call(this.source,e);}}}),_markTargetAnchor:_4.hitch(this,function(_1b){var src=this.source;if(src.current==src.targetAnchor&&src.before==_1b){return;}if(src.targetAnchor&&_14(src.targetAnchor,src.before)){src._removeItemClass(_14(src.targetAnchor,src.before),src.before?"After":"Before");}_4.dnd.Source.prototype._markTargetAnchor.call(src,_1b);if(src.targetAnchor&&_14(src.targetAnchor,src.before)){src._addItemClass(_14(src.targetAnchor,src.before),src.before?"After":"Before");}}),_unmarkTargetAnchor:_4.hitch(this,function(){var src=this.source;if(!src.targetAnchor){return;}if(src.targetAnchor&&_14(src.targetAnchor,src.before)){src._removeItemClass(_14(src.targetAnchor,src.before),src.before?"After":"Before");}_4.dnd.Source.prototype._unmarkTargetAnchor.call(src);}),destroy:_4.hitch(this,function(){_4.disconnect(this._source_conn);_4.unsubscribe(this._source_sub);_4.dnd.Source.prototype.destroy.call(this.source);})});this._source_conn=_4.connect(this.source,"onDndDrop",this,"_onDndDrop");this._source_sub=_4.subscribe("/dnd/drop/before",this,"_onDndDropBefore");this.source.startup();}},_onDndDropBefore:function(_1e,_1f,_20){if(_4.dnd.manager().target!==this.source){return;}this.source._targetNode=this.source.targetAnchor;this.source._beforeTarget=this.source.before;var _21=this.grid.views.views;var _22=_21[_1e.viewIndex];var _23=_21[this.index];if(_23!=_22){var s=_22.convertColPctToFixed();var t=_23.convertColPctToFixed();if(s||t){setTimeout(function(){_22.update();_23.update();},50);}}},_onDndDrop:function(_26,_27,_28){if(_4.dnd.manager().target!==this.source){if(_4.dnd.manager().source===this.source){this._removingColumn=true;}return;}var _29=function(n){return n?_4.attr(n,"idx"):null;};var w=_4.marginBox(_27[0]).w;if(_26.viewIndex!==this.index){var _2c=this.grid.views.views;var _2d=_2c[_26.viewIndex];var _2e=_2c[this.index];if(_2d.viewWidth&&_2d.viewWidth!="auto"){_2d.setColumnsWidth(_2d.getColumnsWidth()-w);}if(_2e.viewWidth&&_2e.viewWidth!="auto"){_2e.setColumnsWidth(_2e.getColumnsWidth());}}var stn=this.source._targetNode;var stb=this.source._beforeTarget;var _31=this.grid.layout;var idx=this.index;delete this.source._targetNode;delete this.source._beforeTarget;window.setTimeout(function(){_31.moveColumn(_26.viewIndex,idx,_29(_27[0]),_29(stn),stb);},1);},renderHeader:function(){this.headerContentNode.innerHTML=this.header.generateHtml(this._getHeaderContent);if(this.flexCells){this.contentWidth=this.getContentWidth();this.headerContentNode.firstChild.style.width=this.contentWidth;}_6.grid.util.fire(this,"onAfterRow",[-1,this.structure.cells,this.headerContentNode]);},_getHeaderContent:function(_33){var n=_33.name||_33.grid.getCellName(_33);var ret=["<div class=\"dojoxGridSortNode"];if(_33.index!=_33.grid.getSortIndex()){ret.push("\">");}else{ret=ret.concat([" ",_33.grid.sortInfo>0?"dojoxGridSortUp":"dojoxGridSortDown","\"><div class=\"dojoxGridArrowButtonChar\">",_33.grid.sortInfo>0?"&#9650;":"&#9660;","</div><div class=\"dojoxGridArrowButtonNode\" role=\""+(_4.isFF<3?"wairole:":"")+"presentation\"></div>"]);}ret=ret.concat([n,"</div>"]);return ret.join("");},resize:function(){this.adaptHeight();this.adaptWidth();},hasHScrollbar:function(_36){if(this._hasHScroll==undefined||_36){if(this.noscroll){this._hasHScroll=false;}else{var _37=_4.style(this.scrollboxNode,"overflow");if(_37=="hidden"){this._hasHScroll=false;}else{if(_37=="scroll"){this._hasHScroll=true;}else{this._hasHScroll=(this.scrollboxNode.offsetWidth<this.contentNode.offsetWidth);}}}}return this._hasHScroll;},hasVScrollbar:function(_38){if(this._hasVScroll==undefined||_38){if(this.noscroll){this._hasVScroll=false;}else{var _39=_4.style(this.scrollboxNode,"overflow");if(_39=="hidden"){this._hasVScroll=false;}else{if(_39=="scroll"){this._hasVScroll=true;}else{this._hasVScroll=(this.scrollboxNode.offsetHeight<this.contentNode.offsetHeight);}}}}return this._hasVScroll;},convertColPctToFixed:function(){var _3a=false;var _3b=_4.query("th",this.headerContentNode);var _3c=_4.map(_3b,function(c,_3e){var w=c.style.width;_4.attr(c,"vIdx",_3e);if(w&&w.slice(-1)=="%"){_3a=true;}else{if(w&&w.slice(-2)=="px"){return window.parseInt(w,10);}}return _4.contentBox(c).w;});if(_3a){_4.forEach(this.grid.layout.cells,function(_40,idx){if(_40.view==this){var _42=_40.view.getHeaderCellNode(_40.index);if(_42&&_4.hasAttr(_42,"vIdx")){var _43=window.parseInt(_4.attr(_42,"vIdx"));this.setColWidth(idx,_3c[_43]);_3b[_43].style.width=_40.unitWidth;_4.removeAttr(_42,"vIdx");}}},this);return true;}return false;},adaptHeight:function(_44){if(!this.grid._autoHeight){var h=this.domNode.clientHeight;if(_44){h-=_6.html.metrics.getScrollbar().h;}_6.grid.util.setStyleHeightPx(this.scrollboxNode,h);}this.hasVScrollbar(true);},adaptWidth:function(){if(this.flexCells){this.contentWidth=this.getContentWidth();this.headerContentNode.firstChild.style.width=this.contentWidth;}var w=this.scrollboxNode.offsetWidth-this.getScrollbarWidth();if(!this._removingColumn){w=Math.max(w,this.getColumnsWidth())+"px";}else{w=Math.min(w,this.getColumnsWidth())+"px";this._removingColumn=false;}var cn=this.contentNode;cn.style.width=w;this.hasHScrollbar(true);},setSize:function(w,h){var ds=this.domNode.style;var hs=this.headerNode.style;if(w){ds.width=w;hs.width=w;}ds.height=(h>=0?h+"px":"");},renderRow:function(_4c){var _4d=this.createRowNode(_4c);this.buildRow(_4c,_4d);this.grid.edit.restore(this,_4c);if(this._pendingUpdate){window.clearTimeout(this._pendingUpdate);}this._pendingUpdate=window.setTimeout(_4.hitch(this,function(){window.clearTimeout(this._pendingUpdate);delete this._pendingUpdate;this.grid._resize();}),50);return _4d;},createRowNode:function(_4e){var _4f=document.createElement("div");_4f.className=this.classTag+"Row";_4.attr(_4f,"role","row");_4f[_6.grid.util.gridViewTag]=this.id;_4f[_6.grid.util.rowIndexTag]=_4e;this.rowNodes[_4e]=_4f;return _4f;},buildRow:function(_50,_51){this.buildRowContent(_50,_51);this.styleRow(_50,_51);},buildRowContent:function(_52,_53){_53.innerHTML=this.content.generateHtml(_52,_52);if(this.flexCells&&this.contentWidth){_53.firstChild.style.width=this.contentWidth;}_6.grid.util.fire(this,"onAfterRow",[_52,this.structure.cells,_53]);},rowRemoved:function(_54){this.grid.edit.save(this,_54);delete this.rowNodes[_54];},getRowNode:function(_55){return this.rowNodes[_55];},getCellNode:function(_56,_57){var row=this.getRowNode(_56);if(row){return this.content.getCellNode(row,_57);}},getHeaderCellNode:function(_59){if(this.headerContentNode){return this.header.getCellNode(this.headerContentNode,_59);}},styleRow:function(_5a,_5b){_5b._style=_7(_5b);this.styleRowNode(_5a,_5b);},styleRowNode:function(_5c,_5d){if(_5d){this.doStyleRowNode(_5c,_5d);}},doStyleRowNode:function(_5e,_5f){this.grid.styleRowNode(_5e,_5f);},updateRow:function(_60){var _61=this.getRowNode(_60);if(_61){_61.style.height="";this.buildRow(_60,_61);}return _61;},updateRowStyles:function(_62){this.styleRowNode(_62,this.getRowNode(_62));},lastTop:0,firstScroll:0,doscroll:function(_63){var _64=_4._isBodyLtr();if(this.firstScroll<2){if((!_64&&this.firstScroll==1)||(_64&&this.firstScroll==0)){var s=_4.marginBox(this.headerNodeContainer);if(_4.isIE){this.headerNodeContainer.style.width=s.w+this.getScrollbarWidth()+"px";}else{if(_4.isMoz){this.headerNodeContainer.style.width=s.w-this.getScrollbarWidth()+"px";this.scrollboxNode.scrollLeft=_64?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth;}}}this.firstScroll++;}this.headerNode.scrollLeft=this.scrollboxNode.scrollLeft;var top=this.scrollboxNode.scrollTop;if(top!=this.lastTop){this.grid.scrollTo(top);}},setScrollTop:function(_67){this.lastTop=_67;this.scrollboxNode.scrollTop=_67;return this.scrollboxNode.scrollTop;},doContentEvent:function(e){if(this.content.decorateEvent(e)){this.grid.onContentEvent(e);}},doHeaderEvent:function(e){if(this.header.decorateEvent(e)){this.grid.onHeaderEvent(e);}},dispatchContentEvent:function(e){return this.content.dispatchEvent(e);},dispatchHeaderEvent:function(e){return this.header.dispatchEvent(e);},setColWidth:function(_6c,_6d){this.grid.setCellWidth(_6c,_6d+"px");},update:function(){this.content.update();this.grid.update();var _6e=this.scrollboxNode.scrollLeft;this.scrollboxNode.scrollLeft=_6e;this.headerNode.scrollLeft=_6e;}});_4.declare("dojox.grid._GridAvatar",_4.dnd.Avatar,{construct:function(){var dd=_4.doc;var a=dd.createElement("table");a.cellPadding=a.cellSpacing="0";a.className="dojoxGridDndAvatar";a.style.position="absolute";a.style.zIndex=1999;a.style.margin="0px";var b=dd.createElement("tbody");var tr=dd.createElement("tr");var td=dd.createElement("td");var img=dd.createElement("td");tr.className="dojoxGridDndAvatarItem";img.className="dojoxGridDndAvatarItemImage";img.style.width="16px";var _75=this.manager.source,_76;if(_75.creator){_76=_75._normailzedCreator(_75.getItem(this.manager.nodes[0].id).data,"avatar").node;}else{_76=this.manager.nodes[0].cloneNode(true);if(_76.tagName.toLowerCase()=="tr"){var _77=dd.createElement("table"),_78=dd.createElement("tbody");_78.appendChild(_76);_77.appendChild(_78);_76=_77;}else{if(_76.tagName.toLowerCase()=="th"){var _77=dd.createElement("table"),_78=dd.createElement("tbody"),r=dd.createElement("tr");_77.cellPadding=_77.cellSpacing="0";r.appendChild(_76);_78.appendChild(r);_77.appendChild(_78);_76=_77;}}}_76.id="";td.appendChild(_76);tr.appendChild(img);tr.appendChild(td);_4.style(tr,"opacity",0.9);b.appendChild(tr);a.appendChild(b);this.node=a;var m=_4.dnd.manager();this.oldOffsetY=m.OFFSET_Y;m.OFFSET_Y=1;},destroy:function(){_4.dnd.manager().OFFSET_Y=this.oldOffsetY;this.inherited(arguments);}});var _7b=_4.dnd.manager().makeAvatar;_4.dnd.manager().makeAvatar=function(){var src=this.source;if(src.viewIndex!==undefined){return new _6.grid._GridAvatar(this);}return _7b.call(_4.dnd.manager());};})();}}};});