/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.CouchDBRestStore"],["require","dojox.data.JsonRestStore"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.CouchDBRestStore"]){_4._hasResource["dojox.data.CouchDBRestStore"]=true;_4.provide("dojox.data.CouchDBRestStore");_4.require("dojox.data.JsonRestStore");_4.declare("dojox.data.CouchDBRestStore",_6.data.JsonRestStore,{save:function(_7){var _8=this.inherited(arguments);var _9=this.service.servicePath;for(var i=0;i<_8.length;i++){(function(_b,_c){_c.addCallback(function(_d){if(_d){_b.__id=_9+_d.id;_b._rev=_d.rev;}return _d;});})(_8[i].content,_8[i].deferred);}},fetch:function(_e){_e.query=_e.query||"_all_docs?";if(_e.start){_e.query=(_e.query?(_e.query+"&"):"")+"startkey="+_e.start;delete _e.start;}if(_e.count){_e.query=(_e.query?(_e.query+"&"):"")+"count="+_e.count;delete _e.count;}return this.inherited(arguments);},_processResults:function(_f){var _10=_f.rows;if(_10){var _11=this.service.servicePath;var _12=this;for(var i=0;i<_10.length;i++){_10[i]={__id:_11+_10[i].id,_id:_10[i].id,_loadObject:function(_14){_12.fetchItemByIdentity({identity:this._id,onItem:_14});delete this._loadObject;}};}return {totalCount:_f.total_rows,items:_f.rows};}else{return {items:_f};}}});_6.data.CouchDBRestStore.getStores=function(_15){var dfd=_4.xhrGet({url:_15+"_all_dbs",handleAs:"json",sync:true});var _17={};dfd.addBoth(function(dbs){for(var i=0;i<dbs.length;i++){_17[dbs[i]]=new _6.data.CouchDBRestStore({target:_15+dbs[i],idAttribute:"_id"});}return _17;});return _17;};}}};});