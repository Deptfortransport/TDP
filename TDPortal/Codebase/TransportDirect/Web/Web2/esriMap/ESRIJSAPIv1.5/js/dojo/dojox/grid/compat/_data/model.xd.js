/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid.compat._data.model"],["require","dojox.grid.compat._data.fields"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid.compat._data.model"]){_4._hasResource["dojox.grid.compat._data.model"]=true;_4.provide("dojox.grid.compat._data.model");_4.require("dojox.grid.compat._data.fields");_4.declare("dojox.grid.data.Model",null,{constructor:function(_7,_8){this.observers=[];this.fields=new _6.grid.data.Fields();if(_7){this.fields.set(_7);}this.setData(_8);},count:0,updating:0,observer:function(_9,_a){this.observers.push({o:_9,p:_a||"model"});},notObserver:function(_b){for(var i=0,m,o;(o=this.observers[i]);i++){if(o.o==_b){this.observers.splice(i,1);return;}}},notify:function(_f,_10){var a=_10||[];for(var i=0,m,o;(o=this.observers[i]);i++){m=o.p+_f;o=o.o;(m in o)&&(o[m].apply(o,a));}},clear:function(){this.fields.clear();this.clearData();},beginUpdate:function(){this.notify("BeginUpdate",arguments);},endUpdate:function(){this.notify("EndUpdate",arguments);},clearData:function(){this.setData(null);},change:function(){this.notify("Change",arguments);},insertion:function(){this.notify("Insertion",arguments);this.notify("Change",arguments);},removal:function(){this.notify("Removal",arguments);this.notify("Change",arguments);},insert:function(_15){if(!this._insert.apply(this,arguments)){return false;}this.insertion.apply(this,_4._toArray(arguments,1));return true;},remove:function(_16){if(!this._remove.apply(this,arguments)){return false;}this.removal.apply(this,arguments);return true;},canSort:function(){return this.sort!=null;},generateComparator:function(_17,_18,_19,_1a){return function(a,b){var _1d=_17(a[_18],b[_18]);return _1d?(_19?_1d:-_1d):_1a&&_1a(a,b);};},makeComparator:function(_1e){var idx,col,_21,_22=null;for(var i=_1e.length-1;i>=0;i--){idx=_1e[i];col=Math.abs(idx)-1;if(col>=0){_21=this.fields.get(col);_22=this.generateComparator(_21.compare,_21.key,idx>0,_22);}}return _22;},sort:null,dummy:0});_4.declare("dojox.grid.data.Rows",_6.grid.data.Model,{allChange:function(){this.notify("AllChange",arguments);this.notify("Change",arguments);},rowChange:function(){this.notify("RowChange",arguments);},datumChange:function(){this.notify("DatumChange",arguments);},beginModifyRow:function(_24){if(!this.cache[_24]){this.cache[_24]=this.copyRow(_24);}},endModifyRow:function(_25){var _26=this.cache[_25];if(_26){var _27=this.getRow(_25);if(!_6.grid.arrayCompare(_26,_27)){this.update(_26,_27,_25);}delete this.cache[_25];}},cancelModifyRow:function(_28){var _29=this.cache[_28];if(_29){this.setRow(_29,_28);delete this.cache[_28];}}});_4.declare("dojox.grid.data.Table",_6.grid.data.Rows,{constructor:function(){this.cache=[];},colCount:0,data:null,cache:null,measure:function(){this.count=this.getRowCount();this.colCount=this.getColCount();this.allChange();},getRowCount:function(){return (this.data?this.data.length:0);},getColCount:function(){return (this.data&&this.data.length?this.data[0].length:this.fields.count());},badIndex:function(_2a,_2b){console.error("dojox.grid.data.Table: badIndex");},isGoodIndex:function(_2c,_2d){return (_2c>=0&&_2c<this.count&&(arguments.length<2||(_2d>=0&&_2d<this.colCount)));},getRow:function(_2e){return this.data[_2e];},copyRow:function(_2f){return this.getRow(_2f).slice(0);},getDatum:function(_30,_31){return this.data[_30][_31];},get:function(){throw ("Plain \"get\" no longer supported. Use \"getRow\" or \"getDatum\".");},setData:function(_32){this.data=(_32||[]);this.allChange();},setRow:function(_33,_34){this.data[_34]=_33;this.rowChange(_33,_34);this.change();},setDatum:function(_35,_36,_37){this.data[_36][_37]=_35;this.datumChange(_35,_36,_37);},set:function(){throw ("Plain \"set\" no longer supported. Use \"setData\", \"setRow\", or \"setDatum\".");},setRows:function(_38,_39){for(var i=0,l=_38.length,r=_39;i<l;i++,r++){this.setRow(_38[i],r);}},update:function(_3d,_3e,_3f){return true;},_insert:function(_40,_41){_6.grid.arrayInsert(this.data,_41,_40);this.count++;return true;},_remove:function(_42){for(var i=_42.length-1;i>=0;i--){_6.grid.arrayRemove(this.data,_42[i]);}this.count-=_42.length;return true;},sort:function(){this.data.sort(this.makeComparator(arguments));},swap:function(_44,_45){_6.grid.arraySwap(this.data,_44,_45);this.rowChange(this.getRow(_44),_44);this.rowChange(this.getRow(_45),_45);this.change();},dummy:0});_4.declare("dojox.grid.data.Objects",_6.grid.data.Table,{constructor:function(_46,_47,_48){if(!_46){this.autoAssignFields();}},allChange:function(){this.notify("FieldsChange");this.inherited(arguments);},autoAssignFields:function(){var d=this.data[0],i=0,_4b;for(var f in d){_4b=this.fields.get(i++);if(!_4.isString(_4b.key)){_4b.key=f;}}},setData:function(_4d){this.data=(_4d||[]);this.autoAssignFields();this.allChange();},getDatum:function(_4e,_4f){return this.data[_4e][this.fields.get(_4f).key];}});_4.declare("dojox.grid.data.Dynamic",_6.grid.data.Table,{constructor:function(){this.page=[];this.pages=[];},page:null,pages:null,rowsPerPage:100,requests:0,bop:-1,eop:-1,clearData:function(){this.pages=[];this.bop=this.eop=-1;this.setData([]);},getRowCount:function(){return this.count;},getColCount:function(){return this.fields.count();},setRowCount:function(_50){this.count=_50;this.change();},requestsPending:function(_51){},rowToPage:function(_52){return (this.rowsPerPage?Math.floor(_52/this.rowsPerPage):_52);},pageToRow:function(_53){return (this.rowsPerPage?this.rowsPerPage*_53:_53);},requestRows:function(_54,_55){},rowsProvided:function(_56,_57){this.requests--;if(this.requests==0){this.requestsPending(false);}},requestPage:function(_58){var row=this.pageToRow(_58);var _5a=Math.min(this.rowsPerPage,this.count-row);if(_5a>0){this.requests++;this.requestsPending(true);setTimeout(_4.hitch(this,"requestRows",row,_5a),1);}},needPage:function(_5b){if(!this.pages[_5b]){this.pages[_5b]=true;this.requestPage(_5b);}},preparePage:function(_5c,_5d){if(_5c<this.bop||_5c>=this.eop){var _5e=this.rowToPage(_5c);this.needPage(_5e);this.bop=_5e*this.rowsPerPage;this.eop=this.bop+(this.rowsPerPage||this.count);}},isRowLoaded:function(_5f){return Boolean(this.data[_5f]);},removePages:function(_60){for(var i=0,r;((r=_60[i])!=undefined);i++){this.pages[this.rowToPage(r)]=false;}this.bop=this.eop=-1;},remove:function(_63){this.removePages(_63);_6.grid.data.Table.prototype.remove.apply(this,arguments);},getRow:function(_64){var row=this.data[_64];if(!row){this.preparePage(_64);}return row;},getDatum:function(_66,_67){var row=this.getRow(_66);return (row?row[_67]:this.fields.get(_67).na);},setDatum:function(_69,_6a,_6b){var row=this.getRow(_6a);if(row){row[_6b]=_69;this.datumChange(_69,_6a,_6b);}else{console.error("["+this.declaredClass+"] dojox.grid.data.dynamic.set: cannot set data on a non-loaded row");}},canSort:function(){return false;}});_6.grid.data.table=_6.grid.data.Table;_6.grid.data.dynamic=_6.grid.data.Dynamic;_4.declare("dojox.grid.data.DojoData",_6.grid.data.Dynamic,{constructor:function(_6d,_6e,_6f){this.count=1;this._rowIdentities={};this._currentlyProcessing=[];if(_6f){_4.mixin(this,_6f);}if(this.store){var f=this.store.getFeatures();this._canNotify=f["dojo.data.api.Notification"];this._canWrite=f["dojo.data.api.Write"];this._canIdentify=f["dojo.data.api.Identity"];if(this._canNotify){_4.connect(this.store,"onSet",this,"_storeDatumChange");_4.connect(this.store,"onDelete",this,"_storeDatumDelete");_4.connect(this.store,"onNew",this,"_storeDatumNew");}if(this._canWrite){_4.connect(this.store,"revert",this,"refresh");}}},markupFactory:function(_71,_72){return new _6.grid.data.DojoData(null,null,_71);},query:{name:"*"},store:null,_currentlyProcessing:null,_canNotify:false,_canWrite:false,_canIdentify:false,_rowIdentities:{},clientSort:false,sortFields:null,queryOptions:null,setData:function(_73){this.store=_73;this.data=[];this.allChange();},setRowCount:function(_74){this.count=_74;this.allChange();},beginReturn:function(_75){if(this.count!=_75){this.setRowCount(_75);}},_setupFields:function(_76){if(this.fields._nameMaps){return;}var m={};var _78=_4.map(this.store.getAttributes(_76),function(_79,idx){m[_79]=idx;m[idx+".idx"]=_79;return {name:_79,key:_79};},this);this.fields._nameMaps=m;this.fields.set(_78);this.notify("FieldsChange");},_getRowFromItem:function(_7b){},_createRow:function(_7c){var row={};row.__dojo_data_item=_7c;_4.forEach(this.fields.values,function(a){var _7f=this.store.getValue(_7c,a.name);row[a.name]=(_7f===undefined||_7f===null)?"":_7f;},this);return row;},processRows:function(_80,_81){if(!_80||_80.length==0){return;}this._setupFields(_80[0]);_4.forEach(_80,function(_82,idx){var row=this._createRow(_82);this._setRowId(_82,_81.start,idx);this.setRow(row,_81.start+idx);},this);this.endUpdate();},requestRows:function(_85,_86){this.beginUpdate();var row=_85||0;var _88={start:row,count:this.rowsPerPage,query:this.query,sort:this.sortFields,queryOptions:this.queryOptions,onBegin:_4.hitch(this,"beginReturn"),onComplete:_4.hitch(this,"processRows"),onError:_4.hitch(this,"processError")};this.store.fetch(_88);},getDatum:function(_89,_8a){var row=this.getRow(_89);var _8c=this.fields.values[_8a];return row&&_8c?row[_8c.name]:_8c?_8c.na:"?";},setDatum:function(_8d,_8e,_8f){var n=this.fields._nameMaps[_8f+".idx"];if(n){this.data[_8e][n]=_8d;this.datumChange(_8d,_8e,_8f);}},copyRow:function(_91){var row={};var _93={};var src=this.getRow(_91);for(var x in src){if(src[x]!=_93[x]){row[x]=src[x];}}return row;},_attrCompare:function(_96,_97){_4.forEach(this.fields.values,function(a){if(_96[a.name]!=_97[a.name]){return false;}},this);return true;},endModifyRow:function(_99){var _9a=this.cache[_99];if(_9a){var _9b=this.getRow(_99);if(!this._attrCompare(_9a,_9b)){this.update(_9a,_9b,_99);}delete this.cache[_99];}},cancelModifyRow:function(_9c){var _9d=this.cache[_9c];if(_9d){this.setRow(_9d,_9c);delete this.cache[_9c];}},_setRowId:function(_9e,_9f,idx){if(this._canIdentify){this._rowIdentities[this.store.getIdentity(_9e)]={rowId:_9f+idx,item:_9e};}else{var _a1=_4.toJson(this.query)+":start:"+_9f+":idx:"+idx+":sort:"+_4.toJson(this.sortFields);this._rowIdentities[_a1]={rowId:_9f+idx,item:_9e};}},_getRowId:function(_a2,_a3){var _a4=null;if(this._canIdentify&&!_a3){var _a5=this._rowIdentities[this.store.getIdentity(_a2)];if(_a5){_a4=_a5.rowId;}}else{var id;for(id in this._rowIdentities){if(this._rowIdentities[id].item===_a2){_a4=this._rowIdentities[id].rowId;break;}}}return _a4;},_storeDatumChange:function(_a7,_a8,_a9,_aa){var _ab=this._getRowId(_a7);var row=this.getRow(_ab);if(row){row[_a8]=_aa;var _ad=this.fields._nameMaps[_a8];this.notify("DatumChange",[_aa,_ab,_ad]);}},_storeDatumDelete:function(_ae){if(_4.indexOf(this._currentlyProcessing,_ae)!=-1){return;}var _af=this._getRowId(_ae,true);if(_af!=null){this._removeItems([_af]);}},_storeDatumNew:function(_b0){if(this._disableNew){return;}this._insertItem(_b0,this.data.length);},insert:function(_b1,_b2){this._disableNew=true;var i=this.store.newItem(_b1);this._disableNew=false;this._insertItem(i,_b2);},_insertItem:function(_b4,_b5){if(!this.fields._nameMaps){this._setupFields(_b4);}var row=this._createRow(_b4);for(var i in this._rowIdentities){var _b8=this._rowIdentities[i];if(_b8.rowId>=_b5){_b8.rowId++;}}this._setRowId(_b4,0,_b5);_6.grid.data.Dynamic.prototype.insert.apply(this,[row,_b5]);},datumChange:function(_b9,_ba,_bb){if(this._canWrite){var row=this.getRow(_ba);var _bd=this.fields._nameMaps[_bb+".idx"];this.store.setValue(row.__dojo_data_item,_bd,_b9);}else{this.notify("DatumChange",arguments);}},insertion:function(){this.notify("Insertion",arguments);this.notify("Change",arguments);},removal:function(){this.notify("Removal",arguments);this.notify("Change",arguments);},remove:function(_be){for(var i=_be.length-1;i>=0;i--){var _c0=this.data[_be[i]].__dojo_data_item;this._currentlyProcessing.push(_c0);this.store.deleteItem(_c0);}this._removeItems(_be);this._currentlyProcessing=[];},_removeItems:function(_c1){_6.grid.data.Dynamic.prototype.remove.apply(this,arguments);this._rowIdentities={};for(var i=0;i<this.data.length;i++){this._setRowId(this.data[i].__dojo_data_item,0,i);}},canSort:function(){return true;},sort:function(_c3){var col=Math.abs(_c3)-1;this.sortFields=[{"attribute":this.fields.values[col].name,"descending":(_c3>0)}];this.refresh();},refresh:function(){this.clearData(true);this.requestRows();},clearData:function(_c5){this._rowIdentities={};this.pages=[];this.bop=this.eop=-1;this.count=0;this.setData((_c5?this.store:[]));},processError:function(_c6,_c7){console.log(_c6);}});}}};});