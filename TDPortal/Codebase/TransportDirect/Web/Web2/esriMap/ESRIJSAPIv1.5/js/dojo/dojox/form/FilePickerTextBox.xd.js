/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.form.FilePickerTextBox"],["require","dojox.widget.FilePicker"],["require","dijit.form.ValidationTextBox"],["require","dojox.form._HasDropDown"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.form.FilePickerTextBox"]){_4._hasResource["dojox.form.FilePickerTextBox"]=true;_4.provide("dojox.form.FilePickerTextBox");_4.require("dojox.widget.FilePicker");_4.require("dijit.form.ValidationTextBox");_4.require("dojox.form._HasDropDown");_4.declare("dojox.form.FilePickerTextBox",[_5.form.ValidationTextBox,_6.form._HasDropDown],{baseClass:"dojoxFilePickerTextBox",templateString:"<div class=\"dijit dijitReset dijitInlineTable dijitLeft\"\r\n\tid=\"widget_${id}\"\r\n\tdojoAttachEvent=\"onmouseenter:_onMouse,onmouseleave:_onMouse,onmousedown:_onMouse\" waiRole=\"combobox\" tabIndex=\"-1\"\r\n\t><div style=\"overflow:hidden;\"\r\n\t\t><div class='dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton'\r\n\t\t\tdojoAttachPoint=\"downArrowNode,dropDownNode,popupStateNode\" waiRole=\"presentation\"\r\n\t\t\t><div class=\"dijitArrowButtonInner\">&thinsp;</div\r\n\t\t\t><div class=\"dijitArrowButtonChar\">&#9660;</div\r\n\t\t></div\r\n\t\t><div class=\"dijitReset dijitValidationIcon\"><br></div\r\n\t\t><div class=\"dijitReset dijitValidationIconText\">&Chi;</div\r\n\t\t><div class=\"dijitReset dijitInputField\"\r\n\t\t\t><input type=\"text\" autocomplete=\"off\" ${nameAttrSetting} class='dijitReset'\r\n\t\t\t\tdojoAttachEvent='onkeypress:_onKey' \r\n\t\t\t\tdojoAttachPoint='textbox,focusNode' waiRole=\"textbox\" waiState=\"haspopup-true,autocomplete-list\"\r\n\t\t/></div\r\n\t></div\r\n></div>\r\n",searchDelay:500,_stopClickEvents:false,valueItem:null,numPanes:2.25,postMixInProperties:function(){this.inherited(arguments);this.dropDown=new _6.widget.FilePicker(this.constraints);},postCreate:function(){this.inherited(arguments);this.connect(this.dropDown,"onChange",this._onWidgetChange);this.connect(this.focusNode,"onblur","_focusBlur");this.connect(this.focusNode,"onfocus","_focusFocus");this.connect(this.focusNode,"ondblclick",function(){_5.selectInputText(this.focusNode);});},_setValueAttr:function(_7,_8,_9){if(!this._searchInProgress){this.inherited(arguments);_7=_7||"";var _a=this.dropDown.attr("pathValue")||"";if(_7!==_a){this._skip=true;var fx=_4.hitch(this,"_setBlurValue");this.dropDown._setPathValueAttr(_7,!_9,this._settingBlurValue?fx:null);}}},_onWidgetChange:function(_c){if(!_c&&this.focusNode.value){this._hasValidPath=false;this.focusNode.value="";}else{this.valueItem=_c;var _d=this.dropDown._getPathValueAttr(_c);if(_d){this._hasValidPath=true;}if(!this._skip){this._setValueAttr(_d,undefined,true);}delete this._skip;}this.validate();},startup:function(){if(!this.dropDown._started){this.dropDown.startup();}this.inherited(arguments);},openDropDown:function(){this.dropDown.domNode.style.width="0px";if(!("minPaneWidth" in (this.constraints||{}))){this.dropDown.attr("minPaneWidth",(this.domNode.offsetWidth/this.numPanes));}this.inherited(arguments);},toggleDropDown:function(){this.inherited(arguments);if(this._opened){this.dropDown.attr("pathValue",this.attr("value"));}},_focusBlur:function(e){if(e.explicitOriginalTarget==this.focusNode&&!this._allowBlur){window.setTimeout(_4.hitch(this,function(){if(!this._allowBlur){this.focus();}}),1);}else{if(this._menuFocus){this.dropDown._updateClass(this._menuFocus,"Item",{"Hover":false});delete this._menuFocus;}}},_focusFocus:function(e){if(this._menuFocus){this.dropDown._updateClass(this._menuFocus,"Item",{"Hover":false});}delete this._menuFocus;var _10=_5.getFocus(this);if(_10&&_10.node){_10=_5.byNode(_10.node);if(_10){this._menuFocus=_10.domNode;}}if(this._menuFocus){this.dropDown._updateClass(this._menuFocus,"Item",{"Hover":true});}delete this._allowBlur;},_onBlur:function(){this._allowBlur=true;delete this.dropDown._savedFocus;this.inherited(arguments);},_setBlurValue:function(){if(this.dropDown&&!this._settingBlurValue){this._settingBlurValue=true;this.attr("value",this.focusNode.value);}else{delete this._settingBlurValue;this.inherited(arguments);}},parse:function(_11,_12){if(this._hasValidPath||this._hasSelection){return _11;}var dd=this.dropDown,_14=dd.topDir,sep=dd.pathSeparator;var _16=dd.attr("pathValue");var _17=function(v){if(_14.length&&v.indexOf(_14)===0){v=v.substring(_14.length);}if(sep&&v[v.length-1]==sep){v=v.substring(0,v.length-1);}return v;};_16=_17(_16);var val=_17(_11);if(val==_16){return _11;}return undefined;},_startSearchFromInput:function(){var dd=this.dropDown,fn=this.focusNode;var val=fn.value,_1d=val,_1e=dd.topDir;if(this._hasSelection){_5.selectInputText(fn,_1d.length);}this._hasSelection=false;if(_1e.length&&val.indexOf(_1e)===0){val=val.substring(_1e.length);}var _1f=val.split(dd.pathSeparator);var _20=_4.hitch(this,function(idx){var dir=_1f[idx];var _23=dd.getChildren()[idx];var _24;this._searchInProgress=true;var _25=_4.hitch(this,function(){delete this._searchInProgress;});if((dir||_23)&&!this._opened){this.toggleDropDown();}if(dir&&_23){var fx=_4.hitch(this,function(){if(_24){this.disconnect(_24);}delete _24;var _27=_23._menu.getChildren();var _28=_4.filter(_27,function(i){return i.label==dir;})[0];var _2a=_4.filter(_27,function(i){return (i.label.indexOf(dir)===0);})[0];if(_28&&((_1f.length>idx+1&&_28.children)||(!_28.children))){idx++;_23._menu.onItemClick(_28,{type:"internal",stopPropagation:function(){},preventDefault:function(){}});if(_1f[idx]){_20(idx);}else{_25();}}else{_23._setSelected(null);if(_2a&&_1f.length===idx+1){dd._setInProgress=true;dd._removeAfter(_23);delete dd._setInProgress;var _2c=_2a.label;if(_2a.children){_2c+=dd.pathSeparator;}_2c=_2c.substring(dir.length);window.setTimeout(function(){_5.scrollIntoView(_2a.domNode);},1);fn.value=_1d+_2c;_5.selectInputText(fn,_1d.length);this._hasSelection=true;try{_2a.focusNode.focus();}catch(e){}}else{if(this._menuFocus){this.dropDown._updateClass(this._menuFocus,"Item",{"Hover":false,"Focus":false});}delete this._menuFocus;}_25();}});if(!_23.isLoaded){_24=this.connect(_23,"onLoad",fx);}else{fx();}}else{if(_23){_23._setSelected(null);dd._setInProgress=true;dd._removeAfter(_23);delete dd._setInProgress;}_25();}});_20(0);},_onKey:function(e){if(this.disabled||this.readOnly){return;}var dk=_4.keys;var c=e.charOrCode;if(c==dk.DOWN_ARROW){this._allowBlur=true;}if(c==dk.ENTER&&this._opened){this.dropDown.onExecute();_5.selectInputText(this.focusNode,this.focusNode.value.length);this._hasSelection=false;_4.stopEvent(e);return;}if((c==dk.RIGHT_ARROW||c==dk.LEFT_ARROW||c==dk.TAB)&&this._hasSelection){this._startSearchFromInput();_4.stopEvent(e);return;}this.inherited(arguments);var _30=false;if((c==dk.BACKSPACE||c==dk.DELETE)&&this._hasSelection){this._hasSelection=false;}else{if(c==dk.BACKSPACE||c==dk.DELETE||c==" "){_30=true;}else{_30=e.keyChar!=="";}}if(this._searchTimer){window.clearTimeout(this._searchTimer);}delete this._searchTimer;if(_30){this._hasValidPath=false;this._hasSelection=false;this._searchTimer=window.setTimeout(_4.hitch(this,"_startSearchFromInput"),this.searchDelay+1);}}});}}};});