/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.AndOrReadStore"],["require","dojo.data.util.filter"],["require","dojo.data.util.simpleFetch"],["require","dojo.date.stamp"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.AndOrReadStore"]){_4._hasResource["dojox.data.AndOrReadStore"]=true;_4.provide("dojox.data.AndOrReadStore");_4.require("dojo.data.util.filter");_4.require("dojo.data.util.simpleFetch");_4.require("dojo.date.stamp");_4.declare("dojox.data.AndOrReadStore",null,{constructor:function(_7){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=false;this._jsonFileUrl=_7.url;this._jsonData=_7.data;this._datatypeMap=_7.typeMap||{};if(!this._datatypeMap["Date"]){this._datatypeMap["Date"]={type:Date,deserialize:function(_8){return _4.date.stamp.fromISOString(_8);}};}this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=false;this._queuedFetches=[];if(_7.urlPreventCache!==undefined){this.urlPreventCache=_7.urlPreventCache?true:false;}if(_7.clearOnClose){this.clearOnClose=true;}},url:"",data:null,typeMap:null,clearOnClose:false,urlPreventCache:false,_assertIsItem:function(_9){if(!this.isItem(_9)){throw new Error("dojox.data.AndOrReadStore: Invalid item argument.");}},_assertIsAttribute:function(_a){if(typeof _a!=="string"){throw new Error("dojox.data.AndOrReadStore: Invalid attribute argument.");}},getValue:function(_b,_c,_d){var _e=this.getValues(_b,_c);return (_e.length>0)?_e[0]:_d;},getValues:function(_f,_10){this._assertIsItem(_f);this._assertIsAttribute(_10);return _f[_10]||[];},getAttributes:function(_11){this._assertIsItem(_11);var _12=[];for(var key in _11){if((key!==this._storeRefPropName)&&(key!==this._itemNumPropName)&&(key!==this._rootItemPropName)&&(key!==this._reverseRefMap)){_12.push(key);}}return _12;},hasAttribute:function(_14,_15){return this.getValues(_14,_15).length>0;},containsValue:function(_16,_17,_18){var _19=undefined;if(typeof _18==="string"){_19=_4.data.util.filter.patternToRegExp(_18,false);}return this._containsValue(_16,_17,_18,_19);},_containsValue:function(_1a,_1b,_1c,_1d){return _4.some(this.getValues(_1a,_1b),function(_1e){if(_1e!==null&&!_4.isObject(_1e)&&_1d){if(_1e.toString().match(_1d)){return true;}}else{if(_1c===_1e){return true;}}});},isItem:function(_1f){if(_1f&&_1f[this._storeRefPropName]===this){if(this._arrayOfAllItems[_1f[this._itemNumPropName]]===_1f){return true;}}return false;},isItemLoaded:function(_20){return this.isItem(_20);},loadItem:function(_21){this._assertIsItem(_21.item);},getFeatures:function(){return this._features;},getLabel:function(_22){if(this._labelAttr&&this.isItem(_22)){return this.getValue(_22,this._labelAttr);}return undefined;},getLabelAttributes:function(_23){if(this._labelAttr){return [this._labelAttr];}return null;},_fetchItems:function(_24,_25,_26){var _27=this;var _28=function(_29,_2a){var _2b=[];if(_29.query){var _2c=_4.fromJson(_4.toJson(_29.query));if(typeof _2c=="object"){var _2d=0;var p;for(p in _2c){_2d++;}if(_2d>1&&_2c.complexQuery){var cq=_2c.complexQuery;var _30=false;for(p in _2c){if(p!=="complexQuery"){if(!_30){cq="( "+cq+" )";_30=true;}cq+=" AND "+p+":"+_29.query[p];delete _2c[p];}}_2c.complexQuery=cq;}}var _31=_29.queryOptions?_29.queryOptions.ignoreCase:false;if(typeof _2c!="string"){_2c=_4.toJson(_2c);_2c=_2c.replace(/\\\\/g,"\\");}_2c=_2c.replace(/\\"/g,"\"");var _32=_4.trim(_2c.replace(/{|}/g,""));var _33,i;if(_32.match(/"? *complexQuery *"?:/)){_32=_4.trim(_32.replace(/"?\s*complexQuery\s*"?:/,""));var _35=["'","\""];var _36,_37;var _38=false;for(i=0;i<_35.length;i++){_36=_32.indexOf(_35[i]);_33=_32.indexOf(_35[i],1);_37=_32.indexOf(":",1);if(_36===0&&_33!=-1&&_37<_33){_38=true;break;}}if(_38){_32=_32.replace(/^\"|^\'|\"$|\'$/g,"");}}var _39=_32;var _3a=/^,|^NOT |^AND |^OR |^\(|^\)|^!|^&&|^\|\|/i;var _3b="";var op="";var val="";var pos=-1;var err=false;var key="";var _41="";var tok="";_33=-1;for(i=0;i<_2a.length;++i){var _43=true;var _44=_2a[i];if(_44===null){_43=false;}else{_32=_39;_3b="";while(_32.length>0&&!err){op=_32.match(_3a);while(op&&!err){_32=_4.trim(_32.replace(op[0],""));op=_4.trim(op[0]).toUpperCase();op=op=="NOT"?"!":op=="AND"||op==","?"&&":op=="OR"?"||":op;op=" "+op+" ";_3b+=op;op=_32.match(_3a);}if(_32.length>0){pos=_32.indexOf(":");if(pos==-1){err=true;break;}else{key=_4.trim(_32.substring(0,pos).replace(/\"|\'/g,""));_32=_4.trim(_32.substring(pos+1));tok=_32.match(/^\'|^\"/);if(tok){tok=tok[0];pos=_32.indexOf(tok);_33=_32.indexOf(tok,pos+1);if(_33==-1){err=true;break;}_41=_32.substring(pos+1,_33);if(_33==_32.length-1){_32="";}else{_32=_4.trim(_32.substring(_33+1));}_3b+=_27._containsValue(_44,key,_41,_4.data.util.filter.patternToRegExp(_41,_31));}else{tok=_32.match(/\s|\)|,/);if(tok){var _45=new Array(tok.length);for(var j=0;j<tok.length;j++){_45[j]=_32.indexOf(tok[j]);}pos=_45[0];if(_45.length>1){for(var j=1;j<_45.length;j++){pos=Math.min(pos,_45[j]);}}_41=_4.trim(_32.substring(0,pos));_32=_4.trim(_32.substring(pos));}else{_41=_4.trim(_32);_32="";}_3b+=_27._containsValue(_44,key,_41,_4.data.util.filter.patternToRegExp(_41,_31));}}}}_43=eval(_3b);}if(_43){_2b.push(_44);}}if(err){_2b=[];console.log("The store's _fetchItems failed, probably due to a syntax error in query.");}_25(_2b,_29);}else{for(var i=0;i<_2a.length;++i){var _47=_2a[i];if(_47!==null){_2b.push(_47);}}_25(_2b,_29);}};if(this._loadFinished){_28(_24,this._getItemsArray(_24.queryOptions));}else{if(this._jsonFileUrl){if(this._loadInProgress){this._queuedFetches.push({args:_24,filter:_28});}else{this._loadInProgress=true;var _48={url:_27._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache};var _49=_4.xhrGet(_48);_49.addCallback(function(_4a){try{_27._getItemsFromLoadedData(_4a);_27._loadFinished=true;_27._loadInProgress=false;_28(_24,_27._getItemsArray(_24.queryOptions));_27._handleQueuedFetches();}catch(e){_27._loadFinished=true;_27._loadInProgress=false;_26(e,_24);}});_49.addErrback(function(_4b){_27._loadInProgress=false;_26(_4b,_24);});var _4c=null;if(_24.abort){_4c=_24.abort;}_24.abort=function(){var df=_49;if(df&&df.fired===-1){df.cancel();df=null;}if(_4c){_4c.call(_24);}};}}else{if(this._jsonData){try{this._loadFinished=true;this._getItemsFromLoadedData(this._jsonData);this._jsonData=null;_28(_24,this._getItemsArray(_24.queryOptions));}catch(e){_26(e,_24);}}else{_26(new Error("dojox.data.AndOrReadStore: No JSON source data was provided as either URL or a nested Javascript object."),_24);}}}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _4f=this._queuedFetches[i];var _50=_4f.args;var _51=_4f.filter;if(_51){_51(_50,this._getItemsArray(_50.queryOptions));}else{this.fetchItemByIdentity(_50);}}this._queuedFetches=[];}},_getItemsArray:function(_52){if(_52&&_52.deep){return this._arrayOfAllItems;}return this._arrayOfTopLevelItems;},close:function(_53){if(this.clearOnClose&&(this._jsonFileUrl!=="")){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=false;this._itemsByIdentity=null;this._loadInProgress=false;this._queuedFetches=[];}},_getItemsFromLoadedData:function(_54){function _55(_56){var _57=((_56!==null)&&(typeof _56==="object")&&(!_4.isArray(_56))&&(!_4.isFunction(_56))&&(_56.constructor==Object)&&(typeof _56._reference==="undefined")&&(typeof _56._type==="undefined")&&(typeof _56._value==="undefined"));return _57;};var _58=this;function _59(_5a){_58._arrayOfAllItems.push(_5a);for(var _5b in _5a){var _5c=_5a[_5b];if(_5c){if(_4.isArray(_5c)){var _5d=_5c;for(var k=0;k<_5d.length;++k){var _5f=_5d[k];if(_55(_5f)){_59(_5f);}}}else{if(_55(_5c)){_59(_5c);}}}}};this._labelAttr=_54.label;var i;var _61;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=_54.items;for(i=0;i<this._arrayOfTopLevelItems.length;++i){_61=this._arrayOfTopLevelItems[i];_59(_61);_61[this._rootItemPropName]=true;}var _62={};var key;for(i=0;i<this._arrayOfAllItems.length;++i){_61=this._arrayOfAllItems[i];for(key in _61){if(key!==this._rootItemPropName){var _64=_61[key];if(_64!==null){if(!_4.isArray(_64)){_61[key]=[_64];}}else{_61[key]=[null];}}_62[key]=key;}}while(_62[this._storeRefPropName]){this._storeRefPropName+="_";}while(_62[this._itemNumPropName]){this._itemNumPropName+="_";}while(_62[this._reverseRefMap]){this._reverseRefMap+="_";}var _65;var _66=_54.identifier;if(_66){this._itemsByIdentity={};this._features["dojo.data.api.Identity"]=_66;for(i=0;i<this._arrayOfAllItems.length;++i){_61=this._arrayOfAllItems[i];_65=_61[_66];var _67=_65[0];if(!this._itemsByIdentity[_67]){this._itemsByIdentity[_67]=_61;}else{if(this._jsonFileUrl){throw new Error("dojox.data.AndOrReadStore:  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+_66+"].  Value collided: ["+_67+"]");}else{if(this._jsonData){throw new Error("dojox.data.AndOrReadStore:  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+_66+"].  Value collided: ["+_67+"]");}}}}}else{this._features["dojo.data.api.Identity"]=Number;}for(i=0;i<this._arrayOfAllItems.length;++i){_61=this._arrayOfAllItems[i];_61[this._storeRefPropName]=this;_61[this._itemNumPropName]=i;}for(i=0;i<this._arrayOfAllItems.length;++i){_61=this._arrayOfAllItems[i];for(key in _61){_65=_61[key];for(var j=0;j<_65.length;++j){_64=_65[j];if(_64!==null&&typeof _64=="object"){if(_64._type&&_64._value){var _69=_64._type;var _6a=this._datatypeMap[_69];if(!_6a){throw new Error("dojox.data.AndOrReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+_69+"'");}else{if(_4.isFunction(_6a)){_65[j]=new _6a(_64._value);}else{if(_4.isFunction(_6a.deserialize)){_65[j]=_6a.deserialize(_64._value);}else{throw new Error("dojox.data.AndOrReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");}}}}if(_64._reference){var _6b=_64._reference;if(!_4.isObject(_6b)){_65[j]=this._itemsByIdentity[_6b];}else{for(var k=0;k<this._arrayOfAllItems.length;++k){var _6d=this._arrayOfAllItems[k];var _6e=true;for(var _6f in _6b){if(_6d[_6f]!=_6b[_6f]){_6e=false;}}if(_6e){_65[j]=_6d;}}}if(this.referenceIntegrity){var _70=_65[j];if(this.isItem(_70)){this._addReferenceToMap(_70,_61,key);}}}else{if(this.isItem(_64)){if(this.referenceIntegrity){this._addReferenceToMap(_64,_61,key);}}}}}}}},_addReferenceToMap:function(_71,_72,_73){},getIdentity:function(_74){var _75=this._features["dojo.data.api.Identity"];if(_75===Number){return _74[this._itemNumPropName];}else{var _76=_74[_75];if(_76){return _76[0];}}return null;},fetchItemByIdentity:function(_77){if(!this._loadFinished){var _78=this;if(this._jsonFileUrl){if(this._loadInProgress){this._queuedFetches.push({args:_77});}else{this._loadInProgress=true;var _79={url:_78._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache};var _7a=_4.xhrGet(_79);_7a.addCallback(function(_7b){var _7c=_77.scope?_77.scope:_4.global;try{_78._getItemsFromLoadedData(_7b);_78._loadFinished=true;_78._loadInProgress=false;var _7d=_78._getItemByIdentity(_77.identity);if(_77.onItem){_77.onItem.call(_7c,_7d);}_78._handleQueuedFetches();}catch(error){_78._loadInProgress=false;if(_77.onError){_77.onError.call(_7c,error);}}});_7a.addErrback(function(_7e){_78._loadInProgress=false;if(_77.onError){var _7f=_77.scope?_77.scope:_4.global;_77.onError.call(_7f,_7e);}});}}else{if(this._jsonData){_78._getItemsFromLoadedData(_78._jsonData);_78._jsonData=null;_78._loadFinished=true;var _80=_78._getItemByIdentity(_77.identity);if(_77.onItem){var _81=_77.scope?_77.scope:_4.global;_77.onItem.call(_81,_80);}}}}else{var _80=this._getItemByIdentity(_77.identity);if(_77.onItem){var _81=_77.scope?_77.scope:_4.global;_77.onItem.call(_81,_80);}}},_getItemByIdentity:function(_82){var _83=null;if(this._itemsByIdentity){_83=this._itemsByIdentity[_82];}else{_83=this._arrayOfAllItems[_82];}if(_83===undefined){_83=null;}return _83;},getIdentityAttributes:function(_84){var _85=this._features["dojo.data.api.Identity"];if(_85===Number){return null;}else{return [_85];}},_forceLoad:function(){var _86=this;if(this._jsonFileUrl){var _87={url:_86._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,sync:true};var _88=_4.xhrGet(_87);_88.addCallback(function(_89){try{if(_86._loadInProgress!==true&&!_86._loadFinished){_86._getItemsFromLoadedData(_89);_86._loadFinished=true;}else{if(_86._loadInProgress){throw new Error("dojox.data.AndOrReadStore:  Unable to perform a synchronous load, an async load is in progress.");}}}catch(e){console.log(e);throw e;}});_88.addErrback(function(_8a){throw _8a;});}else{if(this._jsonData){_86._getItemsFromLoadedData(_86._jsonData);_86._jsonData=null;_86._loadFinished=true;}}}});_4.extend(_6.data.AndOrReadStore,_4.data.util.simpleFetch);}}};});