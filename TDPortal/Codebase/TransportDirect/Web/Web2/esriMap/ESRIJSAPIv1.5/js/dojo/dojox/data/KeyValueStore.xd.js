/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.KeyValueStore"],["require","dojo.data.util.filter"],["require","dojo.data.util.simpleFetch"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.KeyValueStore"]){_4._hasResource["dojox.data.KeyValueStore"]=true;_4.provide("dojox.data.KeyValueStore");_4.require("dojo.data.util.filter");_4.require("dojo.data.util.simpleFetch");_4.declare("dojox.data.KeyValueStore",null,{constructor:function(_7){if(_7.url){this.url=_7.url;}this._keyValueString=_7.data;this._keyValueVar=_7.dataVar;this._keyAttribute="key";this._valueAttribute="value";this._storeProp="_keyValueStore";this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._loadInProgress=false;this._queuedFetches=[];},url:"",data:"",_assertIsItem:function(_8){if(!this.isItem(_8)){throw new Error("dojox.data.KeyValueStore: a function was passed an item argument that was not an item");}},_assertIsAttribute:function(_9,_a){if(!_4.isString(_a)){throw new Error("dojox.data.KeyValueStore: a function was passed an attribute argument that was not an attribute object nor an attribute name string");}},getValue:function(_b,_c,_d){this._assertIsItem(_b);this._assertIsAttribute(_b,_c);var _e;if(_c==this._keyAttribute){_e=_b[this._keyAttribute];}else{_e=_b[this._valueAttribute];}if(_e===undefined){_e=_d;}return _e;},getValues:function(_f,_10){var _11=this.getValue(_f,_10);return (_11?[_11]:[]);},getAttributes:function(_12){return [this._keyAttribute,this._valueAttribute,_12[this._keyAttribute]];},hasAttribute:function(_13,_14){this._assertIsItem(_13);this._assertIsAttribute(_13,_14);return (_14==this._keyAttribute||_14==this._valueAttribute||_14==_13[this._keyAttribute]);},containsValue:function(_15,_16,_17){var _18=undefined;if(typeof _17==="string"){_18=_4.data.util.filter.patternToRegExp(_17,false);}return this._containsValue(_15,_16,_17,_18);},_containsValue:function(_19,_1a,_1b,_1c){var _1d=this.getValues(_19,_1a);for(var i=0;i<_1d.length;++i){var _1f=_1d[i];if(typeof _1f==="string"&&_1c){return (_1f.match(_1c)!==null);}else{if(_1b===_1f){return true;}}}return false;},isItem:function(_20){if(_20&&_20[this._storeProp]===this){return true;}return false;},isItemLoaded:function(_21){return this.isItem(_21);},loadItem:function(_22){},getFeatures:function(){return this._features;},close:function(_23){},getLabel:function(_24){return _24[this._keyAttribute];},getLabelAttributes:function(_25){return [this._keyAttribute];},_fetchItems:function(_26,_27,_28){var _29=this;var _2a=function(_2b,_2c){var _2d=null;if(_2b.query){_2d=[];var _2e=_2b.queryOptions?_2b.queryOptions.ignoreCase:false;var _2f={};for(var key in _2b.query){var _31=_2b.query[key];if(typeof _31==="string"){_2f[key]=_4.data.util.filter.patternToRegExp(_31,_2e);}}for(var i=0;i<_2c.length;++i){var _33=true;var _34=_2c[i];for(var key in _2b.query){var _31=_2b.query[key];if(!_29._containsValue(_34,key,_31,_2f[key])){_33=false;}}if(_33){_2d.push(_34);}}}else{if(_2b.identity){_2d=[];var _35;for(var key in _2c){_35=_2c[key];if(_35[_29._keyAttribute]==_2b.identity){_2d.push(_35);break;}}}else{if(_2c.length>0){_2d=_2c.slice(0,_2c.length);}}}_27(_2d,_2b);};if(this._loadFinished){_2a(_26,this._arrayOfAllItems);}else{if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_26,filter:_2a});}else{this._loadInProgress=true;var _36={url:_29.url,handleAs:"json-comment-filtered"};var _37=_4.xhrGet(_36);_37.addCallback(function(_38){_29._processData(_38);_2a(_26,_29._arrayOfAllItems);_29._handleQueuedFetches();});_37.addErrback(function(_39){_29._loadInProgress=false;throw _39;});}}else{if(this._keyValueString){this._processData(eval(this._keyValueString));this._keyValueString=null;_2a(_26,this._arrayOfAllItems);}else{if(this._keyValueVar){this._processData(this._keyValueVar);this._keyValueVar=null;_2a(_26,this._arrayOfAllItems);}else{throw new Error("dojox.data.KeyValueStore: No source data was provided as either URL, String, or Javascript variable data input.");}}}}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _3b=this._queuedFetches[i];var _3c=_3b.filter;var _3d=_3b.args;if(_3c){_3c(_3d,this._arrayOfAllItems);}else{this.fetchItemByIdentity(_3b.args);}}this._queuedFetches=[];}},_processData:function(_3e){this._arrayOfAllItems=[];for(var i=0;i<_3e.length;i++){this._arrayOfAllItems.push(this._createItem(_3e[i]));}this._loadFinished=true;this._loadInProgress=false;},_createItem:function(_40){var _41={};_41[this._storeProp]=this;for(var i in _40){_41[this._keyAttribute]=i;_41[this._valueAttribute]=_40[i];break;}return _41;},getIdentity:function(_43){if(this.isItem(_43)){return _43[this._keyAttribute];}return null;},getIdentityAttributes:function(_44){return [this._keyAttribute];},fetchItemByIdentity:function(_45){_45.oldOnItem=_45.onItem;_45.onItem=null;_45.onComplete=this._finishFetchItemByIdentity;this.fetch(_45);},_finishFetchItemByIdentity:function(_46,_47){var _48=_47.scope||_4.global;if(_46.length){_47.oldOnItem.call(_48,_46[0]);}else{_47.oldOnItem.call(_48,null);}}});_4.extend(_6.data.KeyValueStore,_4.data.util.simpleFetch);}}};});