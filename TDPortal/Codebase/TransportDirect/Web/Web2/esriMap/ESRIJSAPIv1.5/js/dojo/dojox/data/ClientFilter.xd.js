/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.ClientFilter"],["require","dojo.data.util.filter"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.ClientFilter"]){_4._hasResource["dojox.data.ClientFilter"]=true;_4.provide("dojox.data.ClientFilter");_4.require("dojo.data.util.filter");(function(){var cf;var _8=function(_9,_a,_b){return function(_c){_9._updates.push({create:_a&&_c,remove:_b&&_c});cf.onUpdate();};};cf=_4.declare("dojox.data.ClientFilter",null,{constructor:function(){this.onSet=_8(this,true,true);this.onNew=_8(this,true,false);this.onDelete=_8(this,false,true);this._updates=[];this._fetchCache=[];},updateResultSet:function(_d,_e){if(this.isUpdateable(_e)){for(var i=_e._version||0;i<this._updates.length;i++){var _10=this._updates[i].create;var _11=this._updates[i].remove;if(_11){for(var j=0;j<_d.length;j++){if(_d[j]==_11){_d.splice(j--,1);var _13=true;}}}if(_10&&this.matchesQuery(_10,_e)&&_4.indexOf(_d,_10)==-1){_d.push(_10);_13=true;}}if(_e.sort&&_13){_d.sort(this.makeComparator(_e.sort.concat()));}if(_e.count&&_13){_d.splice(_e.count,_d.length);}_e._version=this._updates.length;return _13?2:1;}return 0;},querySuperSet:function(_14,_15){if(_14.query==_15.query){return {};}if(!(_15.query instanceof Object&&(!_14.query||typeof _14.query=="object"))){return false;}var _16=_4.mixin({},_15.query);for(var i in _14.query){if(_16[i]==_14.query[i]){delete _16[i];}else{if(!(typeof _14.query[i]=="string"&&_4.data.util.filter.patternToRegExp(_14.query[i]).test(_16[i]))){return false;}}}return _16;},serverVersion:0,cachingFetch:function(_18){var _19=this;for(var i=0;i<this._fetchCache.length;i++){var _1b=this._fetchCache[i];var _1c=this.querySuperSet(_1b,_18);if(_1c!==false){var _1d=_1b._loading;if(!_1d){_1d=new _4.Deferred();_1d.callback(_1b.cacheResults);}_1d.addCallback(function(_1e){_1e=_19.clientSideFetch({query:_1c,sort:_18.sort,start:_18.start,count:_18.count},_1e);_1d.fullLength=_1e._fullLength;return _1e;});}}if(!_1d){var _1f=_4.mixin({},_18);var _20=(_18.queryOptions||0).cache;if(_20===undefined?this.cacheByDefault:_20){if(_18.start||_18.count){delete _1f.start;delete _1f.count;_18.clientQuery=_4.mixin(_18.clientQuery||{},{start:_18.start,count:_18.count});}_18=_1f;this._fetchCache.push(_18);}_1d=_18._loading=this._doQuery(_18);}var _21=this.serverVersion;_1d.addCallback(function(_22){delete _18._loading;if(_22){_18._version=_21;_19.updateResultSet(_22,_18);_18.cacheResults=_22;}return _22;});return _1d;},isUpdateable:function(_23){return typeof _23.query=="object";},clientSideFetch:function(_24,_25){if(_24.query){var _26=[];for(var i=0;i<_25.length;i++){var _28=_25[i];if(_28&&this.matchesQuery(_28,_24)){_26.push(_25[i]);}}}else{_26=_24.sort?_25.concat():_25;}if(_24.sort){_26.sort(this.makeComparator(_24.sort.concat()));}return this.clientSidePaging(_24,_26);},clientSidePaging:function(_29,_2a){var _2b=_29.start||0;var _2c=(_2b||_29.count)?_2a.slice(_2b,_2b+(_29.count||_2a.length)):_2a;_2c._fullLength=_2a.length;return _2c;},matchesQuery:function(_2d,_2e){var _2f=_2e.query;var _30=_2e.queryOptions&&_2e.queryOptions.ignoreCase;for(var i in _2f){var _32=_2f[i];var _33=this.getValue(_2d,i);if((typeof _32=="string"&&(_32.match(/[\*\.]/)||_30))?!_4.data.util.filter.patternToRegExp(_32,_30).test(_33):_33!=_32){return false;}}return true;},makeComparator:function(_34){var _35=_34.shift();if(!_35){return function(){};}var _36=_35.attribute;var _37=!!_35.descending;var _38=this.makeComparator(_34);var _39=this;return function(a,b){var av=_39.getValue(a,_36);var bv=_39.getValue(b,_36);if(av!=bv){return av<bv==_37?1:-1;}return _38(a,b);};}});cf.onUpdate=function(){};})();}}};});