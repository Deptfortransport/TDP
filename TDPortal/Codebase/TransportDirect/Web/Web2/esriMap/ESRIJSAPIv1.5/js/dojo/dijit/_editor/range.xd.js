/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit._editor.range"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit._editor.range"]){_4._hasResource["dijit._editor.range"]=true;_4.provide("dijit._editor.range");_5.range={};_5.range.getIndex=function(_7,_8){var _9=[],_a=[];var _b=_8;var _c=_7;var _d,n;while(_7!=_b){var i=0;_d=_7.parentNode;while((n=_d.childNodes[i++])){if(n===_7){--i;break;}}if(i>=_d.childNodes.length){_4.debug("Error finding index of a node in dijit.range.getIndex");}_9.unshift(i);_a.unshift(i-_d.childNodes.length);_7=_d;}if(_9.length>0&&_c.nodeType==3){n=_c.previousSibling;while(n&&n.nodeType==3){_9[_9.length-1]--;n=n.previousSibling;}n=_c.nextSibling;while(n&&n.nodeType==3){_a[_a.length-1]++;n=n.nextSibling;}}return {o:_9,r:_a};};_5.range.getNode=function(_10,_11){if(!_4.isArray(_10)||_10.length==0){return _11;}var _12=_11;_4.every(_10,function(i){if(i>=0&&i<_12.childNodes.length){_12=_12.childNodes[i];}else{_12=null;console.debug("Error: can not find node with index",_10,"under parent node",_11);return false;}return true;});return _12;};_5.range.getCommonAncestor=function(n1,n2){var _16=function(n){var as=[];while(n){as.unshift(n);if(n.nodeName!="BODY"){n=n.parentNode;}else{break;}}return as;};var _19=_16(n1);var _1a=_16(n2);var m=Math.min(_19.length,_1a.length);var com=_19[0];for(var i=1;i<m;i++){if(_19[i]===_1a[i]){com=_19[i];}else{break;}}return com;};_5.range.getAncestor=function(_1e,_1f,_20){_20=_20||_1e.ownerDocument.body;while(_1e&&_1e!==_20){var _21=_1e.nodeName.toUpperCase();if(_1f.test(_21)){return _1e;}_1e=_1e.parentNode;}return null;};_5.range.BlockTagNames=/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/;_5.range.getBlockAncestor=function(_22,_23,_24){_24=_24||_22.ownerDocument.body;_23=_23||_5.range.BlockTagNames;var _25=null,_26;while(_22&&_22!==_24){var _27=_22.nodeName.toUpperCase();if(!_25&&_23.test(_27)){_25=_22;}if(!_26&&(/^(?:BODY|TD|TH|CAPTION)$/).test(_27)){_26=_22;}_22=_22.parentNode;}return {blockNode:_25,blockContainer:_26||_22.ownerDocument.body};};_5.range.atBeginningOfContainer=function(_28,_29,_2a){var _2b=false;var _2c=(_2a==0);if(!_2c&&_29.nodeType==3){if(_4.trim(_29.nodeValue.substr(0,_2a))==0){_2c=true;}}if(_2c){var _2d=_29;_2b=true;while(_2d&&_2d!==_28){if(_2d.previousSibling){_2b=false;break;}_2d=_2d.parentNode;}}return _2b;};_5.range.atEndOfContainer=function(_2e,_2f,_30){var _31=false;var _32=(_30==(_2f.length||_2f.childNodes.length));if(!_32&&_2f.nodeType==3){if(_4.trim(_2f.nodeValue.substr(_30))==0){_32=true;}}if(_32){var _33=_2f;_31=true;while(_33&&_33!==_2e){if(_33.nextSibling){_31=false;break;}_33=_33.parentNode;}}return _31;};_5.range.adjacentNoneTextNode=function(_34,_35){var _36=_34;var len=(0-_34.length)||0;var _38=_35?"nextSibling":"previousSibling";while(_36){if(_36.nodeType!=3){break;}len+=_36.length;_36=_36[_38];}return [_36,len];};_5.range._w3c=Boolean(window["getSelection"]);_5.range.create=function(){if(_5.range._w3c){return _4.doc.createRange();}else{return new _5.range.W3CRange;}};_5.range.getSelection=function(win,_3a){if(_5.range._w3c){return win.getSelection();}else{var s=new _5.range.ie.selection(win);if(!_3a){s._getCurrentSelection();}return s;}};if(!_5.range._w3c){_5.range.ie={cachedSelection:{},selection:function(win){this._ranges=[];this.addRange=function(r,_3e){this._ranges.push(r);if(!_3e){r._select();}this.rangeCount=this._ranges.length;};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0;};var _3f=function(){var r=win.document.selection.createRange();var _41=win.document.selection.type.toUpperCase();if(_41=="CONTROL"){return new _5.range.W3CRange(_5.range.ie.decomposeControlRange(r));}else{return new _5.range.W3CRange(_5.range.ie.decomposeTextRange(r));}};this.getRangeAt=function(i){return this._ranges[i];};this._getCurrentSelection=function(){this.removeAllRanges();var r=_3f();if(r){this.addRange(r,true);}};},decomposeControlRange:function(_44){var _45=_44.item(0),_46=_44.item(_44.length-1);var _47=_45.parentNode,_48=_46.parentNode;var _49=_5.range.getIndex(_45,_47).o;var _4a=_5.range.getIndex(_46,_48).o+1;return [_47,_49,_48,_4a];},getEndPoint:function(_4b,end){var _4d=_4b.duplicate();_4d.collapse(!end);var _4e="EndTo"+(end?"End":"Start");var _4f=_4d.parentElement();var _50,_51,_52;if(_4f.childNodes.length>0){_4.every(_4f.childNodes,function(_53,i){var _55;if(_53.nodeType!=3){_4d.moveToElementText(_53);if(_4d.compareEndPoints(_4e,_4b)>0){_50=_53.previousSibling;if(_52&&_52.nodeType==3){_50=_52;_55=true;}else{_50=_4f;_51=i;return false;}}else{if(i==_4f.childNodes.length-1){_50=_4f;_51=_4f.childNodes.length;return false;}}}else{if(i==_4f.childNodes.length-1){_50=_53;_55=true;}}if(_55&&_50){var _56=_5.range.adjacentNoneTextNode(_50)[0];if(_56){_50=_56.nextSibling;}else{_50=_4f.firstChild;}var _57=_5.range.adjacentNoneTextNode(_50);_56=_57[0];var _58=_57[1];if(_56){_4d.moveToElementText(_56);_4d.collapse(false);}else{_4d.moveToElementText(_4f);}_4d.setEndPoint(_4e,_4b);_51=_4d.text.length-_58;return false;}_52=_53;return true;});}else{_50=_4f;_51=0;}if(!end&&_50.nodeType!=3&&_51==_50.childNodes.length){if(_50.nextSibling&&_50.nextSibling.nodeType==3){_50=_50.nextSibling;_51=0;}}return [_50,_51];},setEndPoint:function(_59,_5a,_5b){var _5c=_59.duplicate(),_5d,len;if(_5a.nodeType!=3){if(_5b>0){_5d=_5a.childNodes[_5b-1];if(_5d.nodeType==3){_5a=_5d;_5b=_5d.length;}else{if(_5d.nextSibling&&_5d.nextSibling.nodeType==3){_5a=_5d.nextSibling;_5b=0;}else{_5c.moveToElementText(_5d.nextSibling?_5d:_5a);var _5f=_5d.parentNode.insertBefore(document.createTextNode(" "),_5d.nextSibling);_5c.collapse(false);_5f.parentNode.removeChild(_5f);}}}else{_5c.moveToElementText(_5a);_5c.collapse(true);}}if(_5a.nodeType==3){var _60=_5.range.adjacentNoneTextNode(_5a);var _61=_60[0];len=_60[1];if(_61){_5c.moveToElementText(_61);_5c.collapse(false);if(_61.contentEditable!="inherit"){len++;}}else{_5c.moveToElementText(_5a.parentNode);_5c.collapse(true);}_5b+=len;if(_5b>0){if(_5c.move("character",_5b)!=_5b){console.error("Error when moving!");}}}return _5c;},decomposeTextRange:function(_62){var _63=_5.range.ie.getEndPoint(_62);var _64=_63[0],_65=_63[1];var _66=_63[0],_67=_63[1];if(_62.htmlText.length){if(_62.htmlText==_62.text){_67=_65+_62.text.length;}else{_63=_5.range.ie.getEndPoint(_62,true);_66=_63[0],_67=_63[1];}}return [_64,_65,_66,_67];},setRange:function(_68,_69,_6a,_6b,_6c,_6d){var _6e=_5.range.ie.setEndPoint(_68,_69,_6a);_68.setEndPoint("StartToStart",_6e);if(!_6d){var end=_5.range.ie.setEndPoint(_68,_6b,_6c);}_68.setEndPoint("EndToEnd",end||_6e);return _68;}};_4.declare("dijit.range.W3CRange",null,{constructor:function(){if(arguments.length>0){this.setStart(arguments[0][0],arguments[0][1]);this.setEnd(arguments[0][2],arguments[0][3]);}else{this.commonAncestorContainer=null;this.startContainer=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=true;}},_updateInternal:function(){if(this.startContainer!==this.endContainer){this.commonAncestorContainer=_5.range.getCommonAncestor(this.startContainer,this.endContainer);}else{this.commonAncestorContainer=this.startContainer;}this.collapsed=(this.startContainer===this.endContainer)&&(this.startOffset==this.endOffset);},setStart:function(_70,_71){_71=parseInt(_71);if(this.startContainer===_70&&this.startOffset==_71){return;}delete this._cachedBookmark;this.startContainer=_70;this.startOffset=_71;if(!this.endContainer){this.setEnd(_70,_71);}else{this._updateInternal();}},setEnd:function(_72,_73){_73=parseInt(_73);if(this.endContainer===_72&&this.endOffset==_73){return;}delete this._cachedBookmark;this.endContainer=_72;this.endOffset=_73;if(!this.startContainer){this.setStart(_72,_73);}else{this._updateInternal();}},setStartAfter:function(_74,_75){this._setPoint("setStart",_74,_75,1);},setStartBefore:function(_76,_77){this._setPoint("setStart",_76,_77,0);},setEndAfter:function(_78,_79){this._setPoint("setEnd",_78,_79,1);},setEndBefore:function(_7a,_7b){this._setPoint("setEnd",_7a,_7b,0);},_setPoint:function(_7c,_7d,_7e,ext){var _80=_5.range.getIndex(_7d,_7d.parentNode).o;this[_7c](_7d.parentNode,_80.pop()+ext);},_getIERange:function(){var r=(this._body||this.endContainer.ownerDocument.body).createTextRange();_5.range.ie.setRange(r,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return r;},getBookmark:function(_82){this._getIERange();return this._cachedBookmark;},_select:function(){var r=this._getIERange();r.select();},deleteContents:function(){var r=this._getIERange();r.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=true;},cloneRange:function(){var r=new _5.range.W3CRange([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);r._body=this._body;return r;},detach:function(){this._body=null;this.commonAncestorContainer=null;this.startContainer=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=true;}});}}}};});