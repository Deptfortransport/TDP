/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojo._base.xhr"],["require","dojo._base.Deferred"],["require","dojo._base.json"],["require","dojo._base.lang"],["require","dojo._base.query"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojo._base.xhr"]){_4._hasResource["dojo._base.xhr"]=true;_4.provide("dojo._base.xhr");_4.require("dojo._base.Deferred");_4.require("dojo._base.json");_4.require("dojo._base.lang");_4.require("dojo._base.query");(function(){var _d=_4;function _8(_9,_a,_b){var _c=_9[_a];if(_d.isString(_c)){_9[_a]=[_c,_b];}else{if(_d.isArray(_c)){_c.push(_b);}else{_9[_a]=_b;}}};_4.formToObject=function(_d){var _e={};var _f="file|submit|image|reset|button|";_d.forEach(_4.byId(_d).elements,function(_10){var _in=_10.name;var _12=(_10.type||"").toLowerCase();if(_in&&_12&&_f.indexOf(_12)==-1&&!_10.disabled){if(_12=="radio"||_12=="checkbox"){if(_10.checked){_8(_e,_in,_10.value);}}else{if(_10.multiple){_e[_in]=[];_d.query("option",_10).forEach(function(opt){if(opt.selected){_8(_e,_in,opt.value);}});}else{_8(_e,_in,_10.value);if(_12=="image"){_e[_in+".x"]=_e[_in+".y"]=_e[_in].x=_e[_in].y=0;}}}}});return _e;};_4.objectToQuery=function(map){var enc=encodeURIComponent;var _16=[];var _17={};for(var _18 in map){var _19=map[_18];if(_19!=_17[_18]){var _1a=enc(_18)+"=";if(_d.isArray(_19)){for(var i=0;i<_19.length;i++){_16.push(_1a+enc(_19[i]));}}else{_16.push(_1a+enc(_19));}}}return _16.join("&");};_4.formToQuery=function(_1c){return _d.objectToQuery(_d.formToObject(_1c));};_4.formToJson=function(_1d,_1e){return _d.toJson(_d.formToObject(_1d),_1e);};_4.queryToObject=function(str){var ret={};var qp=str.split("&");var dec=decodeURIComponent;_d.forEach(qp,function(_23){if(_23.length){var _24=_23.split("=");var _25=dec(_24.shift());var val=dec(_24.join("="));if(_d.isString(ret[_25])){ret[_25]=[ret[_25]];}if(_d.isArray(ret[_25])){ret[_25].push(val);}else{ret[_25]=val;}}});return ret;};_4._blockAsync=false;_4._contentHandlers={text:function(xhr){return xhr.responseText;},json:function(xhr){return _d.fromJson(xhr.responseText||null);},"json-comment-filtered":function(xhr){if(!_4.config.useCommentedJson){console.warn("Consider using the standard mimetype:application/json."+" json-commenting can introduce security issues. To"+" decrease the chances of hijacking, use the standard the 'json' handler and"+" prefix your json with: {}&&\n"+"Use djConfig.useCommentedJson=true to turn off this message.");}var _2a=xhr.responseText;var _2b=_2a.indexOf("/*");var _2c=_2a.lastIndexOf("*/");if(_2b==-1||_2c==-1){throw new Error("JSON was not comment filtered");}return _d.fromJson(_2a.substring(_2b+2,_2c));},javascript:function(xhr){return _d.eval(xhr.responseText);},xml:function(xhr){var _2f=xhr.responseXML;if(_d.isIE&&(!_2f||!_2f.documentElement)){var ms=function(n){return "MSXML"+n+".DOMDocument";};var dp=["Microsoft.XMLDOM",ms(6),ms(4),ms(3),ms(2)];_d.some(dp,function(p){try{var dom=new ActiveXObject(p);dom.async=false;dom.loadXML(xhr.responseText);_2f=dom;}catch(e){return false;}return true;});}return _2f;}};_4._contentHandlers["json-comment-optional"]=function(xhr){var _36=_d._contentHandlers;if(xhr.responseText&&xhr.responseText.indexOf("/*")!=-1){return _36["json-comment-filtered"](xhr);}else{return _36["json"](xhr);}};_4._ioSetArgs=function(_37,_38,_39,_3a){var _3b={args:_37,url:_37.url};var _3c=null;if(_37.form){var _3d=_d.byId(_37.form);var _3e=_3d.getAttributeNode("action");_3b.url=_3b.url||(_3e?_3e.value:null);_3c=_d.formToObject(_3d);}var _3f=[{}];if(_3c){_3f.push(_3c);}if(_37.content){_3f.push(_37.content);}if(_37.preventCache){_3f.push({"dojo.preventCache":new Date().valueOf()});}_3b.query=_d.objectToQuery(_d.mixin.apply(null,_3f));_3b.handleAs=_37.handleAs||"text";var d=new _d.Deferred(_38);d.addCallbacks(_39,function(_41){return _3a(_41,d);});var ld=_37.load;if(ld&&_d.isFunction(ld)){d.addCallback(function(_43){return ld.call(_37,_43,_3b);});}var err=_37.error;if(err&&_d.isFunction(err)){d.addErrback(function(_45){return err.call(_37,_45,_3b);});}var _46=_37.handle;if(_46&&_d.isFunction(_46)){d.addBoth(function(_47){return _46.call(_37,_47,_3b);});}d.ioArgs=_3b;return d;};var _48=function(dfd){dfd.canceled=true;var xhr=dfd.ioArgs.xhr;var _at=typeof xhr.abort;if(_at=="function"||_at=="object"||_at=="unknown"){xhr.abort();}var err=dfd.ioArgs.error;if(!err){err=new Error("xhr cancelled");err.dojoType="cancel";}return err;};var _4d=function(dfd){var ret=_d._contentHandlers[dfd.ioArgs.handleAs](dfd.ioArgs.xhr);return ret===undefined?null:ret;};var _50=function(_51,dfd){console.error(_51);return _51;};var _53=null;var _54=[];var _55=function(){var now=(new Date()).getTime();if(!_d._blockAsync){for(var i=0,tif;i<_54.length&&(tif=_54[i]);i++){var dfd=tif.dfd;var _5a=function(){if(!dfd||dfd.canceled||!tif.validCheck(dfd)){_54.splice(i--,1);}else{if(tif.ioCheck(dfd)){_54.splice(i--,1);tif.resHandle(dfd);}else{if(dfd.startTime){if(dfd.startTime+(dfd.ioArgs.args.timeout||0)<now){_54.splice(i--,1);var err=new Error("timeout exceeded");err.dojoType="timeout";dfd.errback(err);dfd.cancel();}}}}};if(_4.config.debugAtAllCosts){_5a.call(this);}else{try{_5a.call(this);}catch(e){dfd.errback(e);}}}}if(!_54.length){clearInterval(_53);_53=null;return;}};_4._ioCancelAll=function(){try{_d.forEach(_54,function(i){try{i.dfd.cancel();}catch(e){}});}catch(e){}};if(_d.isIE){_d.addOnWindowUnload(_d._ioCancelAll);}_d._ioWatch=function(dfd,_5e,_5f,_60){var _61=dfd.ioArgs.args;if(_61.timeout){dfd.startTime=(new Date()).getTime();}_54.push({dfd:dfd,validCheck:_5e,ioCheck:_5f,resHandle:_60});if(!_53){_53=setInterval(_55,50);}if(_61.sync){_55();}};var _62="application/x-www-form-urlencoded";var _63=function(dfd){return dfd.ioArgs.xhr.readyState;};var _65=function(dfd){return 4==dfd.ioArgs.xhr.readyState;};var _67=function(dfd){var xhr=dfd.ioArgs.xhr;if(_d._isDocumentOk(xhr)){dfd.callback(dfd);}else{var err=new Error("Unable to load "+dfd.ioArgs.url+" status:"+xhr.status);err.status=xhr.status;err.responseText=xhr.responseText;dfd.errback(err);}};_4._ioAddQueryToUrl=function(_6b){if(_6b.query.length){_6b.url+=(_6b.url.indexOf("?")==-1?"?":"&")+_6b.query;_6b.query=null;}};_4.xhr=function(_6c,_6d,_6e){var dfd=_d._ioSetArgs(_6d,_48,_4d,_50);dfd.ioArgs.xhr=_d._xhrObj(dfd.ioArgs.args);if(_6e){if("postData" in _6d){dfd.ioArgs.query=_6d.postData;}else{if("putData" in _6d){dfd.ioArgs.query=_6d.putData;}}}else{_d._ioAddQueryToUrl(dfd.ioArgs);}var _70=dfd.ioArgs;var xhr=_70.xhr;xhr.open(_6c,_70.url,_6d.sync!==true,_6d.user||undefined,_6d.password||undefined);if(_6d.headers){for(var hdr in _6d.headers){if(hdr.toLowerCase()==="content-type"&&!_6d.contentType){_6d.contentType=_6d.headers[hdr];}else{xhr.setRequestHeader(hdr,_6d.headers[hdr]);}}}xhr.setRequestHeader("Content-Type",_6d.contentType||_62);if(!_6d.headers||!_6d.headers["X-Requested-With"]){xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");}if(_4.config.debugAtAllCosts){xhr.send(_70.query);}else{try{xhr.send(_70.query);}catch(e){dfd.ioArgs.error=e;dfd.cancel();}}_d._ioWatch(dfd,_63,_65,_67);xhr=null;return dfd;};_4.xhrGet=function(_73){return _d.xhr("GET",_73);};_4.rawXhrPost=_4.xhrPost=function(_74){return _d.xhr("POST",_74,true);};_4.rawXhrPut=_4.xhrPut=function(_75){return _d.xhr("PUT",_75,true);};_4.xhrDelete=function(_76){return _d.xhr("DELETE",_76);};})();}}};});