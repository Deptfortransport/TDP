/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.dtl.dom"],["require","dojox.dtl._base"],["require","dojox.dtl.Context"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.dtl.dom"]){_4._hasResource["dojox.dtl.dom"]=true;_4.provide("dojox.dtl.dom");_4.require("dojox.dtl._base");_4.require("dojox.dtl.Context");(function(){var dd=_6.dtl;dd.BOOLS={checked:1,disabled:1,readonly:1};dd.TOKEN_CHANGE=-11;dd.TOKEN_ATTR=-12;dd.TOKEN_CUSTOM=-13;dd.TOKEN_NODE=1;var _8=dd.text;var _9=dd.dom={_attributes:{},_uppers:{},_re4:/^function anonymous\(\)\s*{\s*(.*)\s*}$/,_reTrim:/(?:^[\n\s]*(\{%)?\s*|\s*(%\})?[\n\s]*$)/g,_reSplit:/\s*%\}[\n\s]*\{%\s*/g,getTemplate:function(_a){if(typeof this._commentable=="undefined"){this._commentable=false;var _b=document.createElement("div");_b.innerHTML="<!--Test comment handling, and long comments, using comments whenever possible.-->";if(_b.childNodes.length&&_b.childNodes[0].nodeType==8&&_b.childNodes[0].data=="comment"){this._commentable=true;}}if(!this._commentable){_a=_a.replace(/<!--({({|%).*?(%|})})-->/g,"$1");}if(_4.isIE){_a=_a.replace(/\b(checked|disabled|readonly|style)="/g,"t$1=\"");}_a=_a.replace(/\bstyle="/g,"tstyle=\"");var _c;var _d=_4.isWebKit;var _e=[[true,"select","option"],[_d,"tr","td|th"],[_d,"thead","tr","th"],[_d,"tbody","tr","td"],[_d,"table","tbody|thead|tr","tr","td"]];var _f=[];for(var i=0,_11;_11=_e[i];i++){if(!_11[0]){continue;}if(_a.indexOf("<"+_11[1])!=-1){var _12=new RegExp("<"+_11[1]+"(?:.|\n)*?>((?:.|\n)+?)</"+_11[1]+">","ig");tagLoop:while(_c=_12.exec(_a)){var _13=_11[2].split("|");var _14=[];for(var j=0,_16;_16=_13[j];j++){_14.push("<"+_16+"(?:.|\n)*?>(?:.|\n)*?</"+_16+">");}var _17=[];var _18=_6.string.tokenize(_c[1],new RegExp("("+_14.join("|")+")","ig"),function(_19){var tag=/<(\w+)/.exec(_19)[1];if(!_17[tag]){_17[tag]=true;_17.push(tag);}return {data:_19};});if(_17.length){var tag=(_17.length==1)?_17[0]:_11[2].split("|")[0];var _1c=[];for(var j=0,jl=_18.length;j<jl;j++){var _1e=_18[j];if(_4.isObject(_1e)){_1c.push(_1e.data);}else{var _1f=_1e.replace(this._reTrim,"");if(!_1f){continue;}_1e=_1f.split(this._reSplit);for(var k=0,kl=_1e.length;k<kl;k++){var _22="";for(var p=2,pl=_11.length;p<pl;p++){if(p==2){_22+="<"+tag+" dtlinstruction=\"{% "+_1e[k].replace("\"","\\\"")+" %}\">";}else{if(tag==_11[p]){continue;}else{_22+="<"+_11[p]+">";}}}_22+="DTL";for(var p=_11.length-1;p>1;p--){if(p==2){_22+="</"+tag+">";}else{if(tag==_11[p]){continue;}else{_22+="</"+_11[p]+">";}}}_1c.push("ÿ"+_f.length);_f.push(_22);}}}_a=_a.replace(_c[1],_1c.join(""));}}}}for(var i=_f.length;i--;){_a=_a.replace("ÿ"+i,_f[i]);}var re=/\b([a-zA-Z_:][a-zA-Z0-9_\-\.:]*)=['"]/g;while(_c=re.exec(_a)){var _26=_c[1].toLowerCase();if(_26=="dtlinstruction"){continue;}if(_26!=_c[1]){this._uppers[_26]=_c[1];}this._attributes[_26]=true;}var _b=document.createElement("div");_b.innerHTML=_a;var _27={nodes:[]};while(_b.childNodes.length){_27.nodes.push(_b.removeChild(_b.childNodes[0]));}return _27;},tokenize:function(_28){var _29=[];for(var i=0,_2b;_2b=_28[i++];){if(_2b.nodeType!=1){this.__tokenize(_2b,_29);}else{this._tokenize(_2b,_29);}}return _29;},_swallowed:[],_tokenize:function(_2c,_2d){var _2e=false;var _2f=this._swallowed;var i,j,tag,_33;if(!_2d.first){_2e=_2d.first=true;var _34=dd.register.getAttributeTags();for(i=0;tag=_34[i];i++){try{(tag[2])({swallowNode:function(){throw 1;}},new dd.Token(dd.TOKEN_ATTR,""));}catch(e){_2f.push(tag);}}}for(i=0;tag=_2f[i];i++){var _35=_2c.getAttribute(tag[0]);if(_35){var _2f=false;var _36=(tag[2])({swallowNode:function(){_2f=true;return _2c;}},new dd.Token(dd.TOKEN_ATTR,tag[0]+" "+_35));if(_2f){if(_2c.parentNode&&_2c.parentNode.removeChild){_2c.parentNode.removeChild(_2c);}_2d.push([dd.TOKEN_CUSTOM,_36]);return;}}}var _37=[];if(_4.isIE&&_2c.tagName=="SCRIPT"){_37.push({nodeType:3,data:_2c.text});_2c.text="";}else{for(i=0;_33=_2c.childNodes[i];i++){_37.push(_33);}}_2d.push([dd.TOKEN_NODE,_2c]);var _38=false;if(_37.length){_2d.push([dd.TOKEN_CHANGE,_2c]);_38=true;}for(var key in this._attributes){var _3a=false;var _3b="";if(key=="class"){_3b=_2c.className||_3b;}else{if(key=="for"){_3b=_2c.htmlFor||_3b;}else{if(key=="value"&&_2c.value==_2c.innerHTML){continue;}else{if(_2c.getAttribute){_3b=_2c.getAttribute(key,2)||_3b;if(key=="href"||key=="src"){if(_4.isIE){var _3c=location.href.lastIndexOf(location.hash);var _3d=location.href.substring(0,_3c).split("/");_3d.pop();_3d=_3d.join("/")+"/";if(_3b.indexOf(_3d)==0){_3b=_3b.replace(_3d,"");}_3b=decodeURIComponent(_3b);}}else{if(key=="tstyle"){_3a=key;key="style";}else{if(dd.BOOLS[key.slice(1)]&&_4.trim(_3b)){key=key.slice(1);}else{if(this._uppers[key]&&_4.trim(_3b)){_3a=this._uppers[key];}}}}}}}}if(_3a){_2c.setAttribute(_3a,"");_2c.removeAttribute(_3a);}if(typeof _3b=="function"){_3b=_3b.toString().replace(this._re4,"$1");}if(!_38){_2d.push([dd.TOKEN_CHANGE,_2c]);_38=true;}_2d.push([dd.TOKEN_ATTR,_2c,key,_3b]);}for(i=0,_33;_33=_37[i];i++){if(_33.nodeType==1){var _3e=_33.getAttribute("dtlinstruction");if(_3e){_33.parentNode.removeChild(_33);_33={nodeType:8,data:_3e};}}this.__tokenize(_33,_2d);}if(!_2e&&_2c.parentNode&&_2c.parentNode.tagName){if(_38){_2d.push([dd.TOKEN_CHANGE,_2c,true]);}_2d.push([dd.TOKEN_CHANGE,_2c.parentNode]);_2c.parentNode.removeChild(_2c);}else{_2d.push([dd.TOKEN_CHANGE,_2c,true,true]);}},__tokenize:function(_3f,_40){var _41=_3f.data;switch(_3f.nodeType){case 1:this._tokenize(_3f,_40);return;case 3:if(_41.match(/[^\s\n]/)&&(_41.indexOf("{{")!=-1||_41.indexOf("{%")!=-1)){var _42=_8.tokenize(_41);for(var j=0,_44;_44=_42[j];j++){if(typeof _44=="string"){_40.push([dd.TOKEN_TEXT,_44]);}else{_40.push(_44);}}}else{_40.push([_3f.nodeType,_3f]);}if(_3f.parentNode){_3f.parentNode.removeChild(_3f);}return;case 8:if(_41.indexOf("{%")==0){var _44=_4.trim(_41.slice(2,-2));if(_44.substr(0,5)=="load "){var _45=_4.trim(_44).split(/\s+/g);for(var i=1,_47;_47=_45[i];i++){_4["require"](_47);}}_40.push([dd.TOKEN_BLOCK,_44]);}if(_41.indexOf("{{")==0){_40.push([dd.TOKEN_VAR,_4.trim(_41.slice(2,-2))]);}if(_3f.parentNode){_3f.parentNode.removeChild(_3f);}return;}}};dd.DomTemplate=_4.extend(function(obj){if(!obj.nodes){var _49=_4.byId(obj);if(_49&&_49.nodeType==1){_4.forEach(["class","src","href","name","value"],function(_4a){_9._attributes[_4a]=true;});obj={nodes:[_49]};}else{if(typeof obj=="object"){obj=_8.getTemplateString(obj);}obj=_9.getTemplate(obj);}}var _4b=_9.tokenize(obj.nodes);if(dd.tests){this.tokens=_4b.slice(0);}var _4c=new dd._DomParser(_4b);this.nodelist=_4c.parse();},{_count:0,_re:/\bdojo:([a-zA-Z0-9_]+)\b/g,setClass:function(str){this.getRootNode().className=str;},getRootNode:function(){return this.buffer.rootNode;},getBuffer:function(){return new dd.DomBuffer();},render:function(_4e,_4f){_4f=this.buffer=_4f||this.getBuffer();this.rootNode=null;var _50=this.nodelist.render(_4e||new dd.Context({}),_4f);for(var i=0,_52;_52=_4f._cache[i];i++){if(_52._cache){_52._cache.length=0;}}return _50;},unrender:function(_53,_54){return this.nodelist.unrender(_53,_54);}});dd.DomBuffer=_4.extend(function(_55){this._parent=_55;this._cache=[];},{concat:function(_56){var _57=this._parent;if(_57&&_56.parentNode&&_56.parentNode===_57&&!_57._dirty){return this;}if(_56.nodeType==1&&!this.rootNode){this.rootNode=_56||true;return this;}if(!_57){if(_56.nodeType==3&&_4.trim(_56.data)){throw new Error("Text should not exist outside of the root node in template");}return this;}if(this._closed){if(_56.nodeType==3&&!_4.trim(_56.data)){return this;}else{throw new Error("Content should not exist outside of the root node in template");}}if(_57._dirty){if(_56._drawn&&_56.parentNode==_57){var _58=_57._cache;if(_58){for(var i=0,_5a;_5a=_58[i];i++){this.onAddNode&&this.onAddNode(_5a);_57.insertBefore(_5a,_56);this.onAddNodeComplete&&this.onAddNodeComplete(_5a);}_58.length=0;}}_57._dirty=false;}if(!_57._cache){_57._cache=[];this._cache.push(_57);}_57._dirty=true;_57._cache.push(_56);return this;},remove:function(obj){if(typeof obj=="string"){if(this._parent){this._parent.removeAttribute(obj);}}else{if(obj.nodeType==1&&!this.getRootNode()&&!this._removed){this._removed=true;return this;}if(obj.parentNode){this.onRemoveNode&&this.onRemoveNode(obj);if(obj.parentNode){obj.parentNode.removeChild(obj);}}}return this;},setAttribute:function(key,_5d){var old=_4.attr(this._parent,key);if(this.onChangeAttribute&&old!=_5d){this.onChangeAttribute(this._parent,key,old,_5d);}if(key=="style"){this._parent.style.cssText=_5d;}else{_4.attr(this._parent,key,_5d);}return this;},addEvent:function(_5f,_60,fn,_62){if(!_5f.getThis()){throw new Error("You must use Context.setObject(instance)");}this.onAddEvent&&this.onAddEvent(this.getParent(),_60,fn);var _63=fn;if(_4.isArray(_62)){_63=function(e){this[fn].apply(this,[e].concat(_62));};}return _4.connect(this.getParent(),_60,_5f.getThis(),_63);},setParent:function(_65,up,_67){if(!this._parent){this._parent=this._first=_65;}if(up&&_67&&_65===this._first){this._closed=true;}if(up){var _68=this._parent;var _69="";var ie=_4.isIE&&_68.tagName=="SCRIPT";if(ie){_68.text="";}if(_68._dirty){var _6b=_68._cache;var _6c=(_68.tagName=="SELECT"&&!_68.options.length);for(var i=0,_6e;_6e=_6b[i];i++){if(_6e!==_68){this.onAddNode&&this.onAddNode(_6e);if(ie){_69+=_6e.data;}else{_68.appendChild(_6e);if(_6c&&_6e.defaultSelected&&i){_6c=i;}}this.onAddNodeComplete&&this.onAddNodeComplete(_6e);}}if(_6c){_68.options.selectedIndex=(typeof _6c=="number")?_6c:0;}_6b.length=0;_68._dirty=false;}if(ie){_68.text=_69;}}this._parent=_65;this.onSetParent&&this.onSetParent(_65,up,_67);return this;},getParent:function(){return this._parent;},getRootNode:function(){return this.rootNode;}});dd._DomNode=_4.extend(function(_6f){this.contents=_6f;},{render:function(_70,_71){this._rendered=true;return _71.concat(this.contents);},unrender:function(_72,_73){if(!this._rendered){return _73;}this._rendered=false;return _73.remove(this.contents);},clone:function(_74){return new this.constructor(this.contents);}});dd._DomNodeList=_4.extend(function(_75){this.contents=_75||[];},{push:function(_76){this.contents.push(_76);},unshift:function(_77){this.contents.unshift(_77);},render:function(_78,_79,_7a){_79=_79||dd.DomTemplate.prototype.getBuffer();if(_7a){var _7b=_79.getParent();}for(var i=0;i<this.contents.length;i++){_79=this.contents[i].render(_78,_79);if(!_79){throw new Error("Template node render functions must return their buffer");}}if(_7b){_79.setParent(_7b);}return _79;},dummyRender:function(_7d,_7e,_7f){var div=document.createElement("div");var _81=_7e.getParent();var old=_81._clone;_81._clone=div;var _83=this.clone(_7e,div);if(old){_81._clone=old;}else{_81._clone=null;}_7e=dd.DomTemplate.prototype.getBuffer();_83.unshift(new dd.ChangeNode(div));_83.unshift(new dd._DomNode(div));_83.push(new dd.ChangeNode(div,true));_83.render(_7d,_7e);if(_7f){return _7e.getRootNode();}var _84=div.innerHTML;return (_4.isIE)?_84.replace(/\s*_(dirty|clone)="[^"]*"/g,""):_84;},unrender:function(_85,_86,_87){if(_87){var _88=_86.getParent();}for(var i=0;i<this.contents.length;i++){_86=this.contents[i].unrender(_85,_86);if(!_86){throw new Error("Template node render functions must return their buffer");}}if(_88){_86.setParent(_88);}return _86;},clone:function(_8a){var _8b=_8a.getParent();var _8c=this.contents;var _8d=new dd._DomNodeList();var _8e=[];for(var i=0;i<_8c.length;i++){var _90=_8c[i].clone(_8a);if(_90 instanceof dd.ChangeNode||_90 instanceof dd._DomNode){var _91=_90.contents._clone;if(_91){_90.contents=_91;}else{if(_8b!=_90.contents&&_90 instanceof dd._DomNode){var _92=_90.contents;_90.contents=_90.contents.cloneNode(false);_8a.onClone&&_8a.onClone(_92,_90.contents);_8e.push(_92);_92._clone=_90.contents;}}}_8d.push(_90);}for(var i=0,_90;_90=_8e[i];i++){_90._clone=null;}return _8d;},rtrim:function(){while(1){var i=this.contents.length-1;if(this.contents[i] instanceof dd._DomTextNode&&this.contents[i].isEmpty()){this.contents.pop();}else{break;}}return this;}});dd._DomVarNode=_4.extend(function(str){this.contents=new dd._Filter(str);},{render:function(_95,_96){var str=this.contents.resolve(_95);var _98="text";if(str){if(str.render&&str.getRootNode){_98="injection";}else{if(str.safe){if(str.nodeType){_98="node";}else{if(str.toString){str=str.toString();_98="html";}}}}}if(this._type&&_98!=this._type){this.unrender(_95,_96);}this._type=_98;switch(_98){case "text":this._rendered=true;this._txt=this._txt||document.createTextNode(str);if(this._txt.data!=str){var old=this._txt.data;this._txt.data=str;_96.onChangeData&&_96.onChangeData(this._txt,old,this._txt.data);}return _96.concat(this._txt);case "injection":var _9a=str.getRootNode();if(this._rendered&&_9a!=this._root){_96=this.unrender(_95,_96);}this._root=_9a;var _9b=this._injected=new dd._DomNodeList();_9b.push(new dd.ChangeNode(_96.getParent()));_9b.push(new dd._DomNode(_9a));_9b.push(str);_9b.push(new dd.ChangeNode(_96.getParent()));this._rendered=true;return _9b.render(_95,_96);case "node":this._rendered=true;if(this._node&&this._node!=str&&this._node.parentNode&&this._node.parentNode===_96.getParent()){this._node.parentNode.removeChild(this._node);}this._node=str;return _96.concat(str);case "html":if(this._rendered&&this._src!=str){_96=this.unrender(_95,_96);}this._src=str;if(!this._rendered){this._rendered=true;this._html=this._html||[];var div=(this._div=this._div||document.createElement("div"));div.innerHTML=str;var _9d=div.childNodes;while(_9d.length){var _9e=div.removeChild(_9d[0]);this._html.push(_9e);_96=_96.concat(_9e);}}return _96;default:return _96;}},unrender:function(_9f,_a0){if(!this._rendered){return _a0;}this._rendered=false;switch(this._type){case "text":return _a0.remove(this._txt);case "injection":return this._injection.unrender(_9f,_a0);case "node":if(this._node.parentNode===_a0.getParent()){return _a0.remove(this._node);}return _a0;case "html":for(var i=0,l=this._html.length;i<l;i++){_a0=_a0.remove(this._html[i]);}return _a0;default:return _a0;}},clone:function(){return new this.constructor(this.contents.getExpression());}});dd.ChangeNode=_4.extend(function(_a3,up,_a5){this.contents=_a3;this.up=up;this.root=_a5;},{render:function(_a6,_a7){return _a7.setParent(this.contents,this.up,this.root);},unrender:function(_a8,_a9){if(!_a9.getParent()){return _a9;}return _a9.setParent(this.contents);},clone:function(){return new this.constructor(this.contents,this.up,this.root);}});dd.AttributeNode=_4.extend(function(key,_ab){this.key=key;this.value=_ab;this.contents=_ab;if(this._pool[_ab]){this.nodelist=this._pool[_ab];}else{if(!(this.nodelist=dd.quickFilter(_ab))){this.nodelist=(new dd.Template(_ab,true)).nodelist;}this._pool[_ab]=this.nodelist;}this.contents="";},{_pool:{},render:function(_ac,_ad){var key=this.key;var _af=this.nodelist.dummyRender(_ac);if(dd.BOOLS[key]){_af=!(_af=="false"||_af=="undefined"||!_af);}if(_af!==this.contents){this.contents=_af;return _ad.setAttribute(key,_af);}return _ad;},unrender:function(_b0,_b1){this.contents="";return _b1.remove(this.key);},clone:function(_b2){return new this.constructor(this.key,this.value);}});dd._DomTextNode=_4.extend(function(str){this.contents=document.createTextNode(str);this.upcoming=str;},{set:function(_b4){this.upcoming=_b4;return this;},render:function(_b5,_b6){if(this.contents.data!=this.upcoming){var old=this.contents.data;this.contents.data=this.upcoming;_b6.onChangeData&&_b6.onChangeData(this.contents,old,this.upcoming);}return _b6.concat(this.contents);},unrender:function(_b8,_b9){return _b9.remove(this.contents);},isEmpty:function(){return !_4.trim(this.contents.data);},clone:function(){return new this.constructor(this.contents.data);}});dd._DomParser=_4.extend(function(_ba){this.contents=_ba;},{i:0,parse:function(_bb){var _bc={};var _bd=this.contents;if(!_bb){_bb=[];}for(var i=0;i<_bb.length;i++){_bc[_bb[i]]=true;}var _bf=new dd._DomNodeList();while(this.i<_bd.length){var _c0=_bd[this.i++];var _c1=_c0[0];var _c2=_c0[1];if(_c1==dd.TOKEN_CUSTOM){_bf.push(_c2);}else{if(_c1==dd.TOKEN_CHANGE){var _c3=new dd.ChangeNode(_c2,_c0[2],_c0[3]);_c2[_c3.attr]=_c3;_bf.push(_c3);}else{if(_c1==dd.TOKEN_ATTR){var fn=_8.getTag("attr:"+_c0[2],true);if(fn&&_c0[3]){if(_c0[3].indexOf("{%")!=-1||_c0[3].indexOf("{{")!=-1){_c2.setAttribute(_c0[2],"");}_bf.push(fn(null,new dd.Token(_c1,_c0[2]+" "+_c0[3])));}else{if(_4.isString(_c0[3])){if(_c0[2]=="style"||_c0[3].indexOf("{%")!=-1||_c0[3].indexOf("{{")!=-1){_bf.push(new dd.AttributeNode(_c0[2],_c0[3]));}else{if(_4.trim(_c0[3])){try{_4.attr(_c2,_c0[2],_c0[3]);}catch(e){}}}}}}else{if(_c1==dd.TOKEN_NODE){var fn=_8.getTag("node:"+_c2.tagName.toLowerCase(),true);if(fn){_bf.push(fn(null,new dd.Token(_c1,_c2),_c2.tagName.toLowerCase()));}_bf.push(new dd._DomNode(_c2));}else{if(_c1==dd.TOKEN_VAR){_bf.push(new dd._DomVarNode(_c2));}else{if(_c1==dd.TOKEN_TEXT){_bf.push(new dd._DomTextNode(_c2.data||_c2));}else{if(_c1==dd.TOKEN_BLOCK){if(_bc[_c2]){--this.i;return _bf;}var cmd=_c2.split(/\s+/g);if(cmd.length){cmd=cmd[0];var fn=_8.getTag(cmd);if(typeof fn!="function"){throw new Error("Function not found for "+cmd);}var tpl=fn(this,new dd.Token(_c1,_c2));if(tpl){_bf.push(tpl);}}}}}}}}}}if(_bb.length){throw new Error("Could not find closing tag(s): "+_bb.toString());}return _bf;},next_token:function(){var _c7=this.contents[this.i++];return new dd.Token(_c7[0],_c7[1]);},delete_first_token:function(){this.i++;},skip_past:function(_c8){return dd._Parser.prototype.skip_past.call(this,_c8);},create_variable_node:function(_c9){return new dd._DomVarNode(_c9);},create_text_node:function(_ca){return new dd._DomTextNode(_ca||"");},getTemplate:function(loc){return new dd.DomTemplate(_9.getTemplate(loc));}});})();}}};});