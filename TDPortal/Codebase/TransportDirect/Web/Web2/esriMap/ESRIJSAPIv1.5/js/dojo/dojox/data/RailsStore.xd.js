/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.RailsStore"],["require","dojox.data.JsonRestStore"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.RailsStore"]){_4._hasResource["dojox.data.RailsStore"]=true;_4.provide("dojox.data.RailsStore");_4.require("dojox.data.JsonRestStore");_4.declare("dojox.data.RailsStore",_6.data.JsonRestStore,{constructor:function(){},preamble:function(_7){if(typeof _7.target=="string"&&!_7.service){var _8=_7.target.replace(/\/$/g,"");var _9=function(id,_b){_b=_b||{};var _c=_8;var _d;var _e;if(_4.isObject(id)){_e="";_d="?"+_4.objectToQuery(id);}else{if(_b.queryStr&&_b.queryStr.indexOf("?")!=-1){_e=_b.queryStr.replace(/\?.*/,"");_d=_b.queryStr.replace(/[^?]*\?/g,"?");}else{if(_4.isString(_b.query)&&_b.query.indexOf("?")!=-1){_e=_b.query.replace(/\?.*/,"");_d=_b.query.replace(/[^?]*\?/g,"?");}else{_e=id?id.toString():"";_d="";}}}if(_e.indexOf("=")!=-1){_d=_e;_e="";}if(_e){_c=_c+"/"+_e+".json"+_d;}else{_c=_c+".json"+_d;}var _f=_6.rpc._sync;_6.rpc._sync=false;return {url:_c,handleAs:"json",contentType:"application/json",sync:_f,headers:{Accept:"application/json,application/javascript",Range:_b&&(_b.start>=0||_b.count>=0)?"items="+(_b.start||"0")+"-"+((_b.count&&(_b.count+(_b.start||0)-1))||""):undefined}};};_7.service=_6.rpc.Rest(this.target,true,null,_9);}},fetch:function(_10){_10=_10||{};function _11(obj){function _13(){if(_10.queryStr==null){_10.queryStr="";}if(_4.isObject(_10.query)){_10.queryStr="?"+_4.objectToQuery(_10.query);}else{if(_4.isString(_10.query)){_10.queryStr=_10.query;}}};function _14(){if(_10.queryStr.indexOf("?")==-1){return "?";}else{return "&";}};if(_10.queryStr==null){_13();}_10.queryStr=_10.queryStr+_14()+_4.objectToQuery(obj);};if(_10.start||_10.count){if((_10.start||0)%_10.count){throw new Error("The start parameter must be a multiple of the count parameter");}_11({page:((_10.start||0)/_10.count)+1,per_page:_10.count});}if(_10.sort){var _15={sortBy:[],sortDir:[]};_4.forEach(_10.sort,function(_16){_15.sortBy.push(_16.attribute);_15.sortDir.push(!!_16.descending?"DESC":"ASC");});_11(_15);delete _10.sort;}return this.inherited(arguments);},_processResults:function(_17,_18){var _19;if((typeof this.rootAttribute=="undefined")&&_17[0]){if(_17[0][this.idAttribute]){this.rootAttribute=false;console.debug("RailsStore: without root_in_json");}else{for(var _1a in _17[0]){if(_17[0][_1a][this.idAttribute]){this.rootAttribute=_1a;console.debug("RailsStore: with root_in_json, attribute: "+_1a);}}}}if(this.rootAttribute){_19=_4.map(_17,function(_1b){return _1b[this.rootAttribute];},this);}else{_19=_17;}var _1c=_17.length;return {totalCount:_18.fullLength||(_18.request.count==_1c?(_18.request.start||0)+_1c*2:_1c),items:_19};}});}}};});