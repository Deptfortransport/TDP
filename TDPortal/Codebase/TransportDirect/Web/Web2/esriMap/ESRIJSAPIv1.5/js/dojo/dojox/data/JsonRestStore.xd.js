/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.JsonRestStore"],["require","dojox.data.ServiceStore"],["require","dojox.rpc.JsonRest"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.JsonRestStore"]){_4._hasResource["dojox.data.JsonRestStore"]=true;_4.provide("dojox.data.JsonRestStore");_4.require("dojox.data.ServiceStore");_4.require("dojox.rpc.JsonRest");_4.declare("dojox.data.JsonRestStore",_6.data.ServiceStore,{constructor:function(_7){_4.connect(_6.rpc.Rest._index,"onUpdate",this,function(_8,_9,_a,_b){var _c=this.service.servicePath;if(!_8.__id){console.log("no id on updated object ",_8);}else{if(_8.__id.substring(0,_c.length)==_c){this.onSet(_8,_9,_a,_b);}}});this.idAttribute=this.idAttribute||"id";if(typeof _7.target=="string"&&!this.service){this.service=_6.rpc.Rest(this.target,true);}_6.rpc.JsonRest.registerService(this.service,_7.target,this.schema);this.schema=this.service._schema=this.schema||this.service._schema||{};this.service._store=this;this.schema._idAttr=this.idAttribute;var _d=_6.rpc.JsonRest.getConstructor(this.service);var _e=this;this._constructor=function(_f){_d.call(this,_f);_e.onNew(this);};this._constructor.prototype=_d.prototype;this._index=_6.rpc.Rest._index;},referenceIntegrity:true,target:"",newItem:function(_10,_11){_10=new this._constructor(_10);if(_11){var _12=this.getValue(_11.parent,_11.attribute,[]);this.setValue(_11.parent,_11.attribute,_12.concat([_10]));}return _10;},deleteItem:function(_13){var _14=[];var _15=_6.data._getStoreForItem(_13)||this;if(this.referenceIntegrity){_6.rpc.JsonRest._saveNotNeeded=true;var _16=_6.rpc.Rest._index;var _17=function(_18){var _19;_14.push(_18);_18.__checked=1;for(var i in _18){var _1b=_18[i];if(_1b==_13){if(_18!=_16){if(_18 instanceof Array){(_19=_19||[]).push(i);}else{(_6.data._getStoreForItem(_18)||_15).unsetAttribute(_18,i);}}}else{if((typeof _1b=="object")&&_1b){if(!_1b.__checked){_17(_1b);}if(typeof _1b.__checked=="object"&&_18!=_16){(_6.data._getStoreForItem(_18)||_15).setValue(_18,i,_1b.__checked);}}}}if(_19){i=_19.length;_18=_18.__checked=_18.concat();while(i--){_18.splice(_19[i],1);}return _18;}return null;};_17(_16);_6.rpc.JsonRest._saveNotNeeded=false;var i=0;while(_14[i]){delete _14[i++].__checked;}}_6.rpc.JsonRest.deleteObject(_13);_15.onDelete(_13);},changing:function(_1d,_1e){_6.rpc.JsonRest.changing(_1d,_1e);},setValue:function(_1f,_20,_21){var old=_1f[_20];var _23=_1f.__id?_6.data._getStoreForItem(_1f):this;if(_6.json.schema&&_23.schema&&_23.schema.properties){_6.json.schema.mustBeValid(_6.json.schema.checkPropertyChange(_21,_23.schema.properties[_20]));}if(_20==_23.idAttribute){throw new Error("Can not change the identity attribute for an item");}_23.changing(_1f);_1f[_20]=_21;_23.onSet(_1f,_20,old,_21);},setValues:function(_24,_25,_26){if(!_4.isArray(_26)){throw new Error("setValues expects to be passed an Array object as its value");}this.setValue(_24,_25,_26);},unsetAttribute:function(_27,_28){this.changing(_27);var old=_27[_28];delete _27[_28];this.onSet(_27,_28,old,undefined);},save:function(_2a){if(!(_2a&&_2a.global)){(_2a=_2a||{}).service=this.service;}var _2b=_6.rpc.JsonRest.commit(_2a);this.serverVersion=this._updates&&this._updates.length;return _2b;},revert:function(_2c){var _2d=_6.rpc.JsonRest.getDirtyObjects().concat([]);while(_2d.length>0){var d=_2d.pop();var _2f=_6.data._getStoreForItem(d.object||d.old);if(!d.object){_2f.onNew(d.old);}else{if(!d.old){_2f.onDelete(d.object);}else{for(var i in d.object){if(d.object[i]!=d.old[i]){_2f.onSet(d.object,i,d.object[i],d.old[i]);}}}}}_6.rpc.JsonRest.revert(_2c&&_2c.global&&this.service);},isDirty:function(_31){return _6.rpc.JsonRest.isDirty(_31);},isItem:function(_32,_33){return _32&&_32.__id&&(_33||this.service==_6.rpc.JsonRest.getServiceAndId(_32.__id).service);},_doQuery:function(_34){var _35=typeof _34.queryStr=="string"?_34.queryStr:_34.query;return _6.rpc.JsonRest.query(this.service,_35,_34);},_processResults:function(_36,_37){var _38=_36.length;return {totalCount:_37.fullLength||(_37.request.count==_38?(_37.request.start||0)+_38*2:_38),items:_36};},getConstructor:function(){return this._constructor;},getIdentity:function(_39){var id=_39.__clientId||_39.__id;if(!id){return id;}var _3b=this.service.servicePath;return id.substring(0,_3b.length)!=_3b?id:id.substring(_3b.length);},fetchItemByIdentity:function(_3c){var id=_3c.identity;var _3e=this;if(id.toString().match(/^(\w*:)?\//)){var _3f=_6.rpc.JsonRest.getServiceAndId(id);_3e=_3f.service._store;_3c.identity=_3f.id;}_3c._prefix=_3e.service.servicePath;return _3e.inherited(arguments);},onSet:function(){},onNew:function(){},onDelete:function(){},getFeatures:function(){var _40=this.inherited(arguments);_40["dojo.data.api.Write"]=true;_40["dojo.data.api.Notification"]=true;return _40;}});_6.data._getStoreForItem=function(_41){if(_41.__id){var _42=_41.__id.toString().match(/.*\//)[0];var _43=_6.rpc.JsonRest.services[_42];return _43?_43._store:new _6.data.JsonRestStore({target:_42});}return null;};_6.json.ref._useRefs=true;}}};});