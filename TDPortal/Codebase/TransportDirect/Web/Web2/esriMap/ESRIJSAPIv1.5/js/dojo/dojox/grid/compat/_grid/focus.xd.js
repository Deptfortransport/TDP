/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid.compat._grid.focus"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid.compat._grid.focus"]){_4._hasResource["dojox.grid.compat._grid.focus"]=true;_4.provide("dojox.grid.compat._grid.focus");_4.declare("dojox.grid.focus",null,{constructor:function(_7){this.grid=_7;this.cell=null;this.rowIndex=-1;_4.connect(this.grid.domNode,"onfocus",this,"doFocus");},tabbingOut:false,focusClass:"dojoxGrid-cell-focus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView();},isFocusCell:function(_8,_9){return (this.cell==_8)&&(this.rowIndex==_9);},isLastFocusCell:function(){return (this.rowIndex==this.grid.rowCount-1)&&(this.cell.index==this.grid.layout.cellCount-1);},isFirstFocusCell:function(){return (this.rowIndex==0)&&(this.cell.index==0);},isNoFocusCell:function(){return (this.rowIndex<0)||!this.cell;},_focusifyCellNode:function(_a){var n=this.cell&&this.cell.getNode(this.rowIndex);if(n){_4.toggleClass(n,this.focusClass,_a);if(_a){this.scrollIntoView();try{if(!this.grid.edit.isEditing()){_6.grid.fire(n,"focus");}}catch(e){}}}},scrollIntoView:function(){if(!this.cell){return;}var c=this.cell,s=c.view.scrollboxNode,sr={w:s.clientWidth,l:s.scrollLeft,t:s.scrollTop,h:s.clientHeight},n=c.getNode(this.rowIndex),r=c.view.getRowNode(this.rowIndex),rt=this.grid.scroller.findScrollTop(this.rowIndex);if(n.offsetLeft+n.offsetWidth>sr.l+sr.w){s.scrollLeft=n.offsetLeft+n.offsetWidth-sr.w;}else{if(n.offsetLeft<sr.l){s.scrollLeft=n.offsetLeft;}}if(rt+r.offsetHeight>sr.t+sr.h){this.grid.setScrollTop(rt+r.offsetHeight-sr.h);}else{if(rt<sr.t){this.grid.setScrollTop(rt);}}},styleRow:function(_12){return;},setFocusIndex:function(_13,_14){this.setFocusCell(this.grid.getCell(_14),_13);},setFocusCell:function(_15,_16){if(_15&&!this.isFocusCell(_15,_16)){this.tabbingOut=false;this.focusGridView();this._focusifyCellNode(false);this.cell=_15;this.rowIndex=_16;this._focusifyCellNode(true);}if(_4.isOpera){setTimeout(_4.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);}else{this.grid.onCellFocus(this.cell,this.rowIndex);}},next:function(){var row=this.rowIndex,col=this.cell.index+1,cc=this.grid.layout.cellCount-1,rc=this.grid.rowCount-1;if(col>cc){col=0;row++;}if(row>rc){col=cc;row=rc;}this.setFocusIndex(row,col);},previous:function(){var row=(this.rowIndex||0),col=(this.cell.index||0)-1;if(col<0){col=this.grid.layout.cellCount-1;row--;}if(row<0){row=0;col=0;}this.setFocusIndex(row,col);},move:function(_1d,_1e){var rc=this.grid.rowCount-1,cc=this.grid.layout.cellCount-1,r=this.rowIndex,i=this.cell.index,row=Math.min(rc,Math.max(0,r+_1d)),col=Math.min(cc,Math.max(0,i+_1e));this.setFocusIndex(row,col);if(_1d){this.grid.updateRow(r);}},previousKey:function(e){if(this.isFirstFocusCell()){this.tabOut(this.grid.domNode);}else{_4.stopEvent(e);this.previous();}},nextKey:function(e){if(this.isLastFocusCell()){this.tabOut(this.grid.lastFocusNode);}else{_4.stopEvent(e);this.next();}},tabOut:function(_27){this.tabbingOut=true;_27.focus();},focusGridView:function(){_6.grid.fire(this.focusView,"focus");},focusGrid:function(_28){this.focusGridView();this._focusifyCellNode(true);},doFocus:function(e){if(e&&e.target!=e.currentTarget){return;}if(!this.tabbingOut&&this.isNoFocusCell()){this.setFocusIndex(0,0);}this.tabbingOut=false;}});}}};});