/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.storage.WhatWGStorageProvider"],["require","dojox.storage.Provider"],["require","dojox.storage.manager"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.storage.WhatWGStorageProvider"]){_4._hasResource["dojox.storage.WhatWGStorageProvider"]=true;_4.provide("dojox.storage.WhatWGStorageProvider");_4.require("dojox.storage.Provider");_4.require("dojox.storage.manager");_4.declare("dojox.storage.WhatWGStorageProvider",[_6.storage.Provider],{initialized:false,_domain:null,_available:null,_statusHandler:null,_allNamespaces:null,_storageEventListener:null,initialize:function(){if(_4.config["disableWhatWGStorage"]==true){return;}this._domain=this._getDomain();this.initialized=true;_6.storage.manager.loaded();},isAvailable:function(){try{var _7=globalStorage[this._getDomain()];}catch(e){this._available=false;return this._available;}this._available=true;return this._available;},put:function(_8,_9,_a,_b){if(this.isValidKey(_8)==false){throw new Error("Invalid key given: "+_8);}_b=_b||this.DEFAULT_NAMESPACE;_8=this.getFullKey(_8,_b);this._statusHandler=_a;if(_4.isString(_9)){_9="string:"+_9;}else{_9=_4.toJson(_9);}var _c=_4.hitch(this,function(_d){window.removeEventListener("storage",_c,false);if(_a){_a.call(null,this.SUCCESS,_8,null,_b);}});window.addEventListener("storage",_c,false);try{var _e=globalStorage[this._domain];_e.setItem(_8,_9);}catch(e){this._statusHandler.call(null,this.FAILED,_8,e.toString(),_b);}},get:function(_f,_10){if(this.isValidKey(_f)==false){throw new Error("Invalid key given: "+_f);}_10=_10||this.DEFAULT_NAMESPACE;_f=this.getFullKey(_f,_10);var _11=globalStorage[this._domain];var _12=_11.getItem(_f);if(_12==null||_12==""){return null;}_12=_12.value;if(_4.isString(_12)&&(/^string:/.test(_12))){_12=_12.substring("string:".length);}else{_12=_4.fromJson(_12);}return _12;},getNamespaces:function(){var _13=[this.DEFAULT_NAMESPACE];var _14={};var _15=globalStorage[this._domain];var _16=/^__([^_]*)_/;for(var i=0;i<_15.length;i++){var _18=_15.key(i);if(_16.test(_18)==true){var _19=_18.match(_16)[1];if(typeof _14[_19]=="undefined"){_14[_19]=true;_13.push(_19);}}}return _13;},getKeys:function(_1a){_1a=_1a||this.DEFAULT_NAMESPACE;if(this.isValidKey(_1a)==false){throw new Error("Invalid namespace given: "+_1a);}var _1b;if(_1a==this.DEFAULT_NAMESPACE){_1b=new RegExp("^([^_]{2}.*)$");}else{_1b=new RegExp("^__"+_1a+"_(.*)$");}var _1c=globalStorage[this._domain];var _1d=[];for(var i=0;i<_1c.length;i++){var _1f=_1c.key(i);if(_1b.test(_1f)==true){_1f=_1f.match(_1b)[1];_1d.push(_1f);}}return _1d;},clear:function(_20){_20=_20||this.DEFAULT_NAMESPACE;if(this.isValidKey(_20)==false){throw new Error("Invalid namespace given: "+_20);}var _21;if(_20==this.DEFAULT_NAMESPACE){_21=new RegExp("^[^_]{2}");}else{_21=new RegExp("^__"+_20+"_");}var _22=globalStorage[this._domain];var _23=[];for(var i=0;i<_22.length;i++){if(_21.test(_22.key(i))==true){_23[_23.length]=_22.key(i);}}_4.forEach(_23,_4.hitch(_22,"removeItem"));},remove:function(key,_26){key=this.getFullKey(key,_26);var _27=globalStorage[this._domain];_27.removeItem(key);},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},getFullKey:function(key,_29){_29=_29||this.DEFAULT_NAMESPACE;if(this.isValidKey(_29)==false){throw new Error("Invalid namespace given: "+_29);}if(_29==this.DEFAULT_NAMESPACE){return key;}else{return "__"+_29+"_"+key;}},_getDomain:function(){return ((location.hostname=="localhost"&&_4.isFF&&_4.isFF<3)?"localhost.localdomain":location.hostname);}});_6.storage.manager.register("dojox.storage.WhatWGStorageProvider",new _6.storage.WhatWGStorageProvider());}}};});