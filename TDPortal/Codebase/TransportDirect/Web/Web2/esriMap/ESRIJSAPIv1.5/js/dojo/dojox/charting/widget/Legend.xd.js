/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.charting.widget.Legend"],["require","dijit._Widget"],["require","dijit._Templated"],["require","dojox.lang.functional.array"],["require","dojox.lang.functional.fold"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.charting.widget.Legend"]){_4._hasResource["dojox.charting.widget.Legend"]=true;_4.provide("dojox.charting.widget.Legend");_4.require("dijit._Widget");_4.require("dijit._Templated");_4.require("dojox.lang.functional.array");_4.require("dojox.lang.functional.fold");_4.declare("dojox.charting.widget.Legend",[_5._Widget,_5._Templated],{chartRef:"",horizontal:true,templateString:"<table dojoAttachPoint='legendNode' class='dojoxLegendNode'><tbody dojoAttachPoint='legendBody'></tbody></table>",legendNode:null,legendBody:null,postCreate:function(){if(!this.chart){if(!this.chartRef){return;}this.chart=_5.byId(this.chartRef);if(!this.chart){var _7=_4.byId(this.chartRef);if(_7){this.chart=_5.byNode(_7);}else{console.log("Could not find chart instance with id: "+this.chartRef);return;}}this.series=this.chart.chart.series;}else{this.series=this.chart.series;}this.refresh();},refresh:function(){var df=_6.lang.functional;if(this._surfaces){_4.forEach(this._surfaces,function(_9){_9.destroy();});}this._surfaces=[];while(this.legendBody.lastChild){_4.destroy(this.legendBody.lastChild);}if(this.horizontal){_4.addClass(this.legendNode,"dojoxLegendHorizontal");this._tr=_4.doc.createElement("tr");this.legendBody.appendChild(this._tr);}var s=this.series;if(s.length==0){return;}if(s[0].chart.stack[0].declaredClass=="dojox.charting.plot2d.Pie"){var t=s[0].chart.stack[0];if(typeof t.run.data[0]=="number"){var _c=df.map(t.run.data,"Math.max(x, 0)");if(df.every(_c,"<= 0")){return;}var _d=df.map(_c,"/this",df.foldl(_c,"+",0));_4.forEach(_d,function(x,i){this._addLabel(t.dyn[i],t._getLabel(x*100)+"%");},this);}else{_4.forEach(t.run.data,function(x,i){this._addLabel(t.dyn[i],x.legend||x.text||x.y);},this);}}else{_4.forEach(s,function(x){this._addLabel(x.dyn,x.legend||x.name);},this);}},_addLabel:function(dyn,_14){var _15=_4.doc.createElement("td"),_16=_4.doc.createElement("td"),div=_4.doc.createElement("div");_4.addClass(_15,"dojoxLegendIcon");_4.addClass(_16,"dojoxLegendText");div.style.width="20px";div.style.height="20px";_15.appendChild(div);if(this._tr){this._tr.appendChild(_15);this._tr.appendChild(_16);}else{var tr=_4.doc.createElement("tr");this.legendBody.appendChild(tr);tr.appendChild(_15);tr.appendChild(_16);}this._makeIcon(div,dyn);_16.innerHTML=String(_14);},_makeIcon:function(div,dyn){var mb={h:14,w:14};var _1c=_6.gfx.createSurface(div,mb.w,mb.h);this._surfaces.push(_1c);if(dyn.fill){_1c.createRect({x:2,y:2,width:mb.w-4,height:mb.h-4}).setFill(dyn.fill).setStroke(dyn.stroke);}else{if(dyn.stroke||dyn.marker){var _1d={x1:0,y1:mb.h/2,x2:mb.w,y2:mb.h/2};if(dyn.stroke){_1c.createLine(_1d).setStroke(dyn.stroke);}if(dyn.marker){var c={x:mb.w/2,y:mb.h/2};if(dyn.stroke){_1c.createPath({path:"M"+c.x+" "+c.y+" "+dyn.marker}).setFill(dyn.stroke.color).setStroke(dyn.stroke);}else{_1c.createPath({path:"M"+c.x+" "+c.y+" "+dyn.marker}).setFill(dyn.color).setStroke(dyn.color);}}}else{_1c.createRect({x:2,y:2,width:mb.w-4,height:mb.h-4}).setStroke("black");_1c.createLine({x1:2,y1:2,x2:mb.w-2,y2:mb.h-2}).setStroke("black");_1c.createLine({x1:2,y1:mb.h-2,x2:mb.w-2,y2:2}).setStroke("black");}}}});}}};});