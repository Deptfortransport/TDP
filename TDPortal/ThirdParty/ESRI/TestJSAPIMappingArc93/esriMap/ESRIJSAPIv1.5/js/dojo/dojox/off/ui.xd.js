/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.off.ui"],["require","dojox.storage.Provider"],["require","dojox.storage.manager"],["require","dojox.storage.GearsStorageProvider"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.off.ui"]){_4._hasResource["dojox.off.ui"]=true;_4.provide("dojox.off.ui");_4.require("dojox.storage.Provider");_4.require("dojox.storage.manager");_4.require("dojox.storage.GearsStorageProvider");_4.mixin(_6.off.ui,{appName:"setme",autoEmbed:true,autoEmbedID:"dot-widget",runLink:window.location.href,runLinkTitle:"Run Application",learnHowPath:_4.moduleUrl("dojox","off/resources/learnhow.html"),customLearnHowPath:false,htmlTemplatePath:_4.moduleUrl("dojox","off/resources/offline-widget.html").uri,cssTemplatePath:_4.moduleUrl("dojox","off/resources/offline-widget.css").uri,onlineImagePath:_4.moduleUrl("dojox","off/resources/greenball.png").uri,offlineImagePath:_4.moduleUrl("dojox","off/resources/redball.png").uri,rollerImagePath:_4.moduleUrl("dojox","off/resources/roller.gif").uri,checkmarkImagePath:_4.moduleUrl("dojox","off/resources/checkmark.png").uri,learnHowJSPath:_4.moduleUrl("dojox","off/resources/learnhow.js").uri,_initialized:false,onLoad:function(){},_initialize:function(){if(this._validateAppName(this.appName)==false){alert("You must set dojox.off.ui.appName; it can only contain "+"letters, numbers, and spaces; right now it "+"is incorrectly set to '"+_6.off.ui.appName+"'");_6.off.enabled=false;return;}this.runLinkText="Run "+this.appName;_4.connect(_6.off,"onNetwork",this,"_onNetwork");_4.connect(_6.off.sync,"onSync",this,"_onSync");_6.off.files.cache([this.htmlTemplatePath,this.cssTemplatePath,this.onlineImagePath,this.offlineImagePath,this.rollerImagePath,this.checkmarkImagePath]);if(this.autoEmbed){this._doAutoEmbed();}},_doAutoEmbed:function(){_4.xhrGet({url:this.htmlTemplatePath,handleAs:"text",error:function(_7){_6.off.enabled=false;_7=_7.message||_7;alert("Error loading the Dojo Offline Widget from "+this.htmlTemplatePath+": "+_7);},load:_4.hitch(this,this._templateLoaded)});},_templateLoaded:function(_8){var _9=_4.byId(this.autoEmbedID);if(_9){_9.innerHTML=_8;}this._initImages();this._updateNetIndicator();this._initLearnHow();this._initialized=true;if(!_6.off.hasOfflineCache){this._showNeedsOfflineCache();return;}if(_6.off.hasOfflineCache&&_6.off.browserRestart){this._needsBrowserRestart();return;}else{var _a=_4.byId("dot-widget-browser-restart");if(_a){_a.style.display="none";}}this._updateSyncUI();this._initMainEvtHandlers();this._setOfflineEnabled(_6.off.enabled);this._onNetwork(_6.off.isOnline?"online":"offline");this._testNet();},_testNet:function(){_6.off.goOnline(_4.hitch(this,function(_b){this._onNetwork(_b?"online":"offline");this.onLoad();}));},_updateNetIndicator:function(){var _c=_4.byId("dot-widget-network-indicator-online");var _d=_4.byId("dot-widget-network-indicator-offline");var _e=_4.byId("dot-widget-title-text");if(_c&&_d){if(_6.off.isOnline==true){_c.style.display="inline";_d.style.display="none";}else{_c.style.display="none";_d.style.display="inline";}}if(_e){if(_6.off.isOnline){_e.innerHTML="Online";}else{_e.innerHTML="Offline";}}},_initLearnHow:function(){var _f=_4.byId("dot-widget-learn-how-link");if(!_f){return;}if(!this.customLearnHowPath){var _10=_4.config.baseRelativePath;this.learnHowPath+="?appName="+encodeURIComponent(this.appName)+"&hasOfflineCache="+_6.off.hasOfflineCache+"&runLink="+encodeURIComponent(this.runLink)+"&runLinkText="+encodeURIComponent(this.runLinkText)+"&baseRelativePath="+encodeURIComponent(_10);_6.off.files.cache(this.learnHowJSPath);_6.off.files.cache(this.learnHowPath);}_f.setAttribute("href",this.learnHowPath);var _11=_4.byId("dot-widget-learn-how-app-name");if(!_11){return;}_11.innerHTML="";_11.appendChild(document.createTextNode(this.appName));},_validateAppName:function(_12){if(!_12){return false;}return (/^[a-z0-9 ]*$/i.test(_12));},_updateSyncUI:function(){var _13=_4.byId("dot-roller");var _14=_4.byId("dot-success-checkmark");var _15=_4.byId("dot-sync-messages");var _16=_4.byId("dot-sync-details");var _17=_4.byId("dot-sync-cancel");if(_6.off.sync.isSyncing){this._clearSyncMessage();if(_13){_13.style.display="inline";}if(_14){_14.style.display="none";}if(_15){_4.removeClass(_15,"dot-sync-error");}if(_16){_16.style.display="none";}if(_17){_17.style.display="inline";}}else{if(_13){_13.style.display="none";}if(_17){_17.style.display="none";}if(_15){_4.removeClass(_15,"dot-sync-error");}}},_setSyncMessage:function(_18){var _19=_4.byId("dot-sync-messages");if(_19){while(_19.firstChild){_19.removeChild(_19.firstChild);}_19.appendChild(document.createTextNode(_18));}},_clearSyncMessage:function(){this._setSyncMessage("");},_initImages:function(){var _1a=_4.byId("dot-widget-network-indicator-online");if(_1a){_1a.setAttribute("src",this.onlineImagePath);}var _1b=_4.byId("dot-widget-network-indicator-offline");if(_1b){_1b.setAttribute("src",this.offlineImagePath);}var _1c=_4.byId("dot-roller");if(_1c){_1c.setAttribute("src",this.rollerImagePath);}var _1d=_4.byId("dot-success-checkmark");if(_1d){_1d.setAttribute("src",this.checkmarkImagePath);}},_showDetails:function(evt){evt.preventDefault();evt.stopPropagation();if(!_6.off.sync.details.length){return;}var _1f="";_1f+="<html><head><title>Sync Details</title><head><body>";_1f+="<h1>Sync Details</h1>\n";_1f+="<ul>\n";for(var i=0;i<_6.off.sync.details.length;i++){_1f+="<li>";_1f+=_6.off.sync.details[i];_1f+="</li>";}_1f+="</ul>\n";_1f+="<a href='javascript:window.close()' "+"style='text-align: right; padding-right: 2em;'>"+"Close Window"+"</a>\n";_1f+="</body></html>";var _21="height=400,width=600,resizable=true,"+"scrollbars=true,toolbar=no,menubar=no,"+"location=no,directories=no,dependent=yes";var _22=window.open("","SyncDetails",_21);if(!_22){alert("Please allow popup windows for this domain; can't display sync details window");return;}_22.document.open();_22.document.write(_1f);_22.document.close();if(_22.focus){_22.focus();}},_cancel:function(evt){evt.preventDefault();evt.stopPropagation();_6.off.sync.cancel();},_needsBrowserRestart:function(){var _24=_4.byId("dot-widget-browser-restart");if(_24){_4.addClass(_24,"dot-needs-browser-restart");}var _25=_4.byId("dot-widget-browser-restart-app-name");if(_25){_25.innerHTML="";_25.appendChild(document.createTextNode(this.appName));}var _26=_4.byId("dot-sync-status");if(_26){_26.style.display="none";}},_showNeedsOfflineCache:function(){var _27=_4.byId("dot-widget-container");if(_27){_4.addClass(_27,"dot-needs-offline-cache");}},_hideNeedsOfflineCache:function(){var _28=_4.byId("dot-widget-container");if(_28){_4.removeClass(_28,"dot-needs-offline-cache");}},_initMainEvtHandlers:function(){var _29=_4.byId("dot-sync-details-button");if(_29){_4.connect(_29,"onclick",this,this._showDetails);}var _2a=_4.byId("dot-sync-cancel-button");if(_2a){_4.connect(_2a,"onclick",this,this._cancel);}},_setOfflineEnabled:function(_2b){var _2c=[];_2c.push(_4.byId("dot-sync-status"));for(var i=0;i<_2c.length;i++){if(_2c[i]){_2c[i].style.visibility=(_2b?"visible":"hidden");}}},_syncFinished:function(){this._updateSyncUI();var _2e=_4.byId("dot-success-checkmark");var _2f=_4.byId("dot-sync-details");if(_6.off.sync.successful==true){this._setSyncMessage("Sync Successful");if(_2e){_2e.style.display="inline";}}else{if(_6.off.sync.cancelled==true){this._setSyncMessage("Sync Cancelled");if(_2e){_2e.style.display="none";}}else{this._setSyncMessage("Sync Error");var _30=_4.byId("dot-sync-messages");if(_30){_4.addClass(_30,"dot-sync-error");}if(_2e){_2e.style.display="none";}}}if(_6.off.sync.details.length&&_2f){_2f.style.display="inline";}},_onFrameworkEvent:function(_31,_32){if(_31=="save"){if(_32.status==_6.storage.FAILED&&!_32.isCoreSave){alert("Please increase the amount of local storage available "+"to this application");if(_6.storage.hasSettingsUI()){_6.storage.showSettingsUI();}}}else{if(_31=="coreOperationFailed"){console.log("Application does not have permission to use Dojo Offline");if(!this._userInformed){alert("This application will not work if Google Gears is not allowed to run");this._userInformed=true;}}else{if(_31=="offlineCacheInstalled"){this._hideNeedsOfflineCache();if(_6.off.hasOfflineCache==true&&_6.off.browserRestart==true){this._needsBrowserRestart();return;}else{var _33=_4.byId("dot-widget-browser-restart");if(_33){_33.style.display="none";}}this._updateSyncUI();this._initMainEvtHandlers();this._setOfflineEnabled(_6.off.enabled);this._testNet();}}}},_onSync:function(_34){switch(_34){case "start":this._updateSyncUI();break;case "refreshFiles":this._setSyncMessage("Downloading UI...");break;case "upload":this._setSyncMessage("Uploading new data...");break;case "download":this._setSyncMessage("Downloading new data...");break;case "finished":this._syncFinished();break;case "cancel":this._setSyncMessage("Canceling Sync...");break;default:_4.warn("Programming error: "+"Unknown sync type in dojox.off.ui: "+_34);break;}},_onNetwork:function(_35){if(!this._initialized){return;}this._updateNetIndicator();if(_35=="offline"){this._setSyncMessage("You are working offline");var _36=_4.byId("dot-sync-details");if(_36){_36.style.display="none";}this._updateSyncUI();}else{if(_6.off.sync.autoSync){if(_4.isAIR){window.setTimeout(function(){_6.off.sync.synchronize();},1000);}else{window.setTimeout(_6._scopeName+".off.sync.synchronize()",1000);}}}}});_4.connect(_6.off,"onFrameworkEvent",_6.off.ui,"_onFrameworkEvent");_4.connect(_6.off,"onLoad",_6.off.ui,_6.off.ui._initialize);}}};});