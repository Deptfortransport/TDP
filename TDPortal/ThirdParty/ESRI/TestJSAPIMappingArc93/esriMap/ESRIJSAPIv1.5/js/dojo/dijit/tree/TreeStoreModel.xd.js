/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit.tree.TreeStoreModel"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit.tree.TreeStoreModel"]){_4._hasResource["dijit.tree.TreeStoreModel"]=true;_4.provide("dijit.tree.TreeStoreModel");_4.declare("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],labelAttr:"",root:null,query:null,constructor:function(_7){_4.mixin(this,_7);this.connects=[];var _8=this.store;if(!_8.getFeatures()["dojo.data.api.Identity"]){throw new Error("dijit.Tree: store must support dojo.data.Identity");}if(_8.getFeatures()["dojo.data.api.Notification"]){this.connects=this.connects.concat([_4.connect(_8,"onNew",this,"_onNewItem"),_4.connect(_8,"onDelete",this,"_onDeleteItem"),_4.connect(_8,"onSet",this,"_onSetItem")]);}},destroy:function(){_4.forEach(this.connects,_4.disconnect);},getRoot:function(_9,_a){if(this.root){_9(this.root);}else{this.store.fetch({query:this.query,onComplete:_4.hitch(this,function(_b){if(_b.length!=1){throw new Error(this.declaredClass+": query "+_4.toJson(this.query)+" returned "+_b.length+" items, but must return exactly one item");}this.root=_b[0];_9(this.root);}),onError:_a});}},mayHaveChildren:function(_c){return _4.some(this.childrenAttrs,function(_d){return this.store.hasAttribute(_c,_d);},this);},getChildren:function(_e,_f,_10){var _11=this.store;var _12=[];for(var i=0;i<this.childrenAttrs.length;i++){var _14=_11.getValues(_e,this.childrenAttrs[i]);_12=_12.concat(_14);}var _15=0;_4.forEach(_12,function(_16){if(!_11.isItemLoaded(_16)){_15++;}});if(_15==0){_f(_12);}else{var _17=function _17(_18){if(--_15==0){_f(_12);}};_4.forEach(_12,function(_19){if(!_11.isItemLoaded(_19)){_11.loadItem({item:_19,onItem:_17,onError:_10});}});}},getIdentity:function(_1a){return this.store.getIdentity(_1a);},getLabel:function(_1b){if(this.labelAttr){return this.store.getValue(_1b,this.labelAttr);}else{return this.store.getLabel(_1b);}},newItem:function(_1c,_1d){var _1e={parent:_1d,attribute:this.childrenAttrs[0]};return this.store.newItem(_1c,_1e);},pasteItem:function(_1f,_20,_21,_22,_23){var _24=this.store,_25=this.childrenAttrs[0];if(_20){_4.forEach(this.childrenAttrs,function(_26){if(_24.containsValue(_20,_26,_1f)){if(!_22){var _27=_4.filter(_24.getValues(_20,_26),function(x){return x!=_1f;});_24.setValues(_20,_26,_27);}_25=_26;}});}if(_21){if(typeof _23=="number"){var _29=_24.getValues(_21,_25);_29.splice(_23,0,_1f);_24.setValues(_21,_25,_29);}else{_24.setValues(_21,_25,_24.getValues(_21,_25).concat(_1f));}}},onChange:function(_2a){},onChildrenChange:function(_2b,_2c){},onDelete:function(_2d,_2e){},_onNewItem:function(_2f,_30){if(!_30){return;}this.getChildren(_30.item,_4.hitch(this,function(_31){this.onChildrenChange(_30.item,_31);}));},_onDeleteItem:function(_32){this.onDelete(_32);},_onSetItem:function(_33,_34,_35,_36){if(_4.indexOf(this.childrenAttrs,_34)!=-1){this.getChildren(_33,_4.hitch(this,function(_37){this.onChildrenChange(_33,_37);}));}else{this.onChange(_33);}}});}}};});