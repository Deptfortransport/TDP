/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.atom.io.Connection"],["require","dojox.atom.io.model"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.atom.io.Connection"]){_4._hasResource["dojox.atom.io.Connection"]=true;_4.provide("dojox.atom.io.Connection");_4.require("dojox.atom.io.model");_4.declare("dojox.atom.io.Connection",null,{constructor:function(_7,_8){this.sync=_7;this.preventCache=_8;},preventCache:false,alertsEnabled:false,getFeed:function(_9,_a,_b,_c){this._getXmlDoc(_9,"feed",new _6.atom.io.model.Feed(),_6.atom.io.model._Constants.ATOM_NS,_a,_b,_c);},getService:function(_d,_e,_f,_10){this._getXmlDoc(_d,"service",new _6.atom.io.model.Service(_d),_6.atom.io.model._Constants.APP_NS,_e,_f,_10);},getEntry:function(url,_12,_13,_14){this._getXmlDoc(url,"entry",new _6.atom.io.model.Entry(),_6.atom.io.model._Constants.ATOM_NS,_12,_13,_14);},_getXmlDoc:function(url,_16,_17,_18,_19,_1a,_1b){if(!_1b){_1b=_4.global;}var ae=this.alertsEnabled;var _1d={url:url,handleAs:"xml",sync:this.sync,preventCache:this.preventCache,load:function(_1e,_1f){var _20=null;var _21=_1e;var _22;if(_21){if(typeof (_21.getElementsByTagNameNS)!="undefined"){_22=_21.getElementsByTagNameNS(_18,_16);if(_22&&_22.length>0){_20=_22.item(0);}else{if(_21.lastChild){_20=_21.lastChild;}}}else{if(typeof (_21.getElementsByTagName)!="undefined"){_22=_21.getElementsByTagName(_16);if(_22&&_22.length>0){for(var i=0;i<_22.length;i++){if(_22[i].namespaceURI==_18){_20=_22[i];break;}}}else{if(_21.lastChild){_20=_21.lastChild;}}}else{if(_21.lastChild){_20=_21.lastChild;}else{_19.call(_1b,null,null,_1f);return;}}}_17.buildFromDom(_20);if(_19){_19.call(_1b,_17,_21,_1f);}else{if(ae){var _24=_4.i18n.getLocalization("dojox.atom.io","messages");throw new Error(_24.noCallback);}}}else{_19.call(_1b,null,null,_1f);}}};if(this.user&&this.user!==null){_1d.user=this.user;}if(this.password&&this.password!==null){_1d.password=this.password;}if(_1a){_1d.error=function(_25,_26){_1a.call(_1b,_25,_26);};}else{_1d.error=function(){var _27=_4.i18n.getLocalization("dojox.atom.io","messages");throw new Error(_27.failedXhr);};}_4.xhrGet(_1d);},updateEntry:function(_28,_29,_2a,_2b,_2c,_2d){if(!_2d){_2d=_4.global;}_28.updated=new Date();var url=_28.getEditHref();if(!url){var _2f=_4.i18n.getLocalization("dojox.atom.io","messages");throw new Error(_2f.missingEditUrl);}var _30=this;var ae=this.alertsEnabled;var _32={url:url,handleAs:"text",contentType:"text/xml",sync:this.sync,preventCache:this.preventCache,load:function(_33,_34){var _35=null;if(_2b){_35=_34.xhr.getResponseHeader("Location");if(!_35){_35=url;}var _36=function(_37,dom,_39){if(_29){_29.call(_2d,_37,_35,_39);}else{if(ae){var _3a=_4.i18n.getLocalization("dojox.atom.io","messages");throw new Error(_3a.noCallback);}}};_30.getEntry(_35,_36);}else{if(_29){_29.call(_2d,_28,_34.xhr.getResponseHeader("Location"),_34);}else{if(ae){var _3b=_4.i18n.getLocalization("dojox.atom.io","messages");throw new Error(_3b.noCallback);}}}return _33;}};if(this.user&&this.user!==null){_32.user=this.user;}if(this.password&&this.password!==null){_32.password=this.password;}if(_2a){_32.error=function(_3c,_3d){_2a.call(_2d,_3c,_3d);};}else{_32.error=function(){var _3e=_4.i18n.getLocalization("dojox.atom.io","messages");throw new Error(_3e.failedXhr);};}if(_2c){_32.postData=_28.toString(true);_32.headers={"X-Method-Override":"PUT"};_4.rawXhrPost(_32);}else{_32.putData=_28.toString(true);var xhr=_4.rawXhrPut(_32);}},addEntry:function(_40,url,_42,_43,_44,_45){if(!_45){_45=_4.global;}_40.published=new Date();_40.updated=new Date();var _46=_40.feedUrl;var ae=this.alertsEnabled;if(!url&&_46){url=_46;}if(!url){if(ae){var _48=_4.i18n.getLocalization("dojox.atom.io","messages");throw new Error(_48.missingUrl);}return;}var _49=this;var _4a={url:url,handleAs:"text",contentType:"text/xml",sync:this.sync,preventCache:this.preventCache,postData:_40.toString(true),load:function(_4b,_4c){var _4d=_4c.xhr.getResponseHeader("Location");if(!_4d){_4d=url;}if(!_4c.retrieveEntry){if(_42){_42.call(_45,_40,_4d,_4c);}else{if(ae){var _4e=_4.i18n.getLocalization("dojox.atom.io","messages");throw new Error(_4e.noCallback);}}}else{var _4f=function(_50,dom,_52){if(_42){_42.call(_45,_50,_4d,_52);}else{if(ae){var _53=_4.i18n.getLocalization("dojox.atom.io","messages");throw new Error(_53.noCallback);}}};_49.getEntry(_4d,_4f);}return _4b;}};if(this.user&&this.user!==null){_4a.user=this.user;}if(this.password&&this.password!==null){_4a.password=this.password;}if(_43){_4a.error=function(_54,_55){_43.call(_45,_54,_55);};}else{_4a.error=function(){var _56=_4.i18n.getLocalization("dojox.atom.io","messages");throw new Error(_56.failedXhr);};}_4.rawXhrPost(_4a);},deleteEntry:function(_57,_58,_59,_5a,_5b){if(!_5b){_5b=_4.global;}var url=null;if(typeof (_57)=="string"){url=_57;}else{url=_57.getEditHref();}if(!url){var _5d=_4.i18n.getLocalization("dojox.atom.io","messages");_58.call(_5b,false,null);throw new Error(_5d.missingUrl);}var _5e={url:url,handleAs:"text",sync:this.sync,preventCache:this.preventCache,load:function(_5f,_60){_58.call(_5b,_60);return _5f;}};if(this.user&&this.user!==null){_5e.user=this.user;}if(this.password&&this.password!==null){_5e.password=this.password;}if(_59){_5e.error=function(_61,_62){_59.call(_5b,_61,_62);};}else{_5e.error=function(){var _63=_4.i18n.getLocalization("dojox.atom.io","messages");throw new Error(_63.failedXhr);};}if(_5a){_5e.headers={"X-Method-Override":"DELETE"};_4.xhrPost(_5e);}else{_4.xhrDelete(_5e);}}});}}};});