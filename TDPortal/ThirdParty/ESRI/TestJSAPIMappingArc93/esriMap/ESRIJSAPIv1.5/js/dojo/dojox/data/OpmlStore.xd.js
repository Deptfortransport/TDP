/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.OpmlStore"],["require","dojo.data.util.filter"],["require","dojo.data.util.simpleFetch"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.OpmlStore"]){_4._hasResource["dojox.data.OpmlStore"]=true;_4.provide("dojox.data.OpmlStore");_4.require("dojo.data.util.filter");_4.require("dojo.data.util.simpleFetch");_4.declare("dojox.data.OpmlStore",null,{constructor:function(_7){this._xmlData=null;this._arrayOfTopLevelItems=[];this._arrayOfAllItems=[];this._metadataNodes=null;this._loadFinished=false;this.url=_7.url;this._opmlData=_7.data;if(_7.label){this.label=_7.label;}this._loadInProgress=false;this._queuedFetches=[];this._identityMap={};this._identCount=0;this._idProp="_I";},label:"text",url:"",_assertIsItem:function(_8){if(!this.isItem(_8)){throw new Error("dojo.data.OpmlStore: a function was passed an item argument that was not an item");}},_assertIsAttribute:function(_9){if(!_4.isString(_9)){throw new Error("dojox.data.OpmlStore: a function was passed an attribute argument that was not an attribute object nor an attribute name string");}},_removeChildNodesThatAreNotElementNodes:function(_a,_b){var _c=_a.childNodes;if(_c.length===0){return;}var _d=[];var i,_f;for(i=0;i<_c.length;++i){_f=_c[i];if(_f.nodeType!=1){_d.push(_f);}}for(i=0;i<_d.length;++i){_f=_d[i];_a.removeChild(_f);}if(_b){for(i=0;i<_c.length;++i){_f=_c[i];this._removeChildNodesThatAreNotElementNodes(_f,_b);}}},_processRawXmlTree:function(_10){this._loadFinished=true;this._xmlData=_10;var _11=_10.getElementsByTagName("head");var _12=_11[0];if(_12){this._removeChildNodesThatAreNotElementNodes(_12);this._metadataNodes=_12.childNodes;}var _13=_10.getElementsByTagName("body");var _14=_13[0];if(_14){this._removeChildNodesThatAreNotElementNodes(_14,true);var _15=_13[0].childNodes;for(var i=0;i<_15.length;++i){var _17=_15[i];if(_17.tagName=="outline"){this._identityMap[this._identCount]=_17;this._identCount++;this._arrayOfTopLevelItems.push(_17);this._arrayOfAllItems.push(_17);this._checkChildNodes(_17);}}}},_checkChildNodes:function(_18){if(_18.firstChild){for(var i=0;i<_18.childNodes.length;i++){var _1a=_18.childNodes[i];if(_1a.tagName=="outline"){this._identityMap[this._identCount]=_1a;this._identCount++;this._arrayOfAllItems.push(_1a);this._checkChildNodes(_1a);}}}},_getItemsArray:function(_1b){if(_1b&&_1b.deep){return this._arrayOfAllItems;}return this._arrayOfTopLevelItems;},getValue:function(_1c,_1d,_1e){this._assertIsItem(_1c);this._assertIsAttribute(_1d);if(_1d=="children"){return (_1c.firstChild||_1e);}else{var _1f=_1c.getAttribute(_1d);return (_1f!==undefined)?_1f:_1e;}},getValues:function(_20,_21){this._assertIsItem(_20);this._assertIsAttribute(_21);var _22=[];if(_21=="children"){for(var i=0;i<_20.childNodes.length;++i){_22.push(_20.childNodes[i]);}}else{if(_20.getAttribute(_21)!==null){_22.push(_20.getAttribute(_21));}}return _22;},getAttributes:function(_24){this._assertIsItem(_24);var _25=[];var _26=_24;var _27=_26.attributes;for(var i=0;i<_27.length;++i){var _29=_27.item(i);_25.push(_29.nodeName);}if(_26.childNodes.length>0){_25.push("children");}return _25;},hasAttribute:function(_2a,_2b){return (this.getValues(_2a,_2b).length>0);},containsValue:function(_2c,_2d,_2e){var _2f=undefined;if(typeof _2e==="string"){_2f=_4.data.util.filter.patternToRegExp(_2e,false);}return this._containsValue(_2c,_2d,_2e,_2f);},_containsValue:function(_30,_31,_32,_33){var _34=this.getValues(_30,_31);for(var i=0;i<_34.length;++i){var _36=_34[i];if(typeof _36==="string"&&_33){return (_36.match(_33)!==null);}else{if(_32===_36){return true;}}}return false;},isItem:function(_37){return (_37&&_37.nodeType==1&&_37.tagName=="outline"&&_37.ownerDocument===this._xmlData);},isItemLoaded:function(_38){return this.isItem(_38);},loadItem:function(_39){},getLabel:function(_3a){if(this.isItem(_3a)){return this.getValue(_3a,this.label);}return undefined;},getLabelAttributes:function(_3b){return [this.label];},_fetchItems:function(_3c,_3d,_3e){var _3f=this;var _40=function(_41,_42){var _43=null;if(_41.query){_43=[];var _44=_41.queryOptions?_41.queryOptions.ignoreCase:false;var _45={};for(var key in _41.query){var _47=_41.query[key];if(typeof _47==="string"){_45[key]=_4.data.util.filter.patternToRegExp(_47,_44);}}for(var i=0;i<_42.length;++i){var _49=true;var _4a=_42[i];for(var key in _41.query){var _47=_41.query[key];if(!_3f._containsValue(_4a,key,_47,_45[key])){_49=false;}}if(_49){_43.push(_4a);}}}else{if(_42.length>0){_43=_42.slice(0,_42.length);}}_3d(_43,_41);};if(this._loadFinished){_40(_3c,this._getItemsArray(_3c.queryOptions));}else{if(this._loadInProgress){this._queuedFetches.push({args:_3c,filter:_40});}else{if(this.url!==""){this._loadInProgress=true;var _4b={url:_3f.url,handleAs:"xml"};var _4c=_4.xhrGet(_4b);_4c.addCallback(function(_4d){_3f._processRawXmlTree(_4d);_40(_3c,_3f._getItemsArray(_3c.queryOptions));_3f._handleQueuedFetches();});_4c.addErrback(function(_4e){throw _4e;});}else{if(this._opmlData){this._processRawXmlTree(this._opmlData);this._opmlData=null;_40(_3c,this._getItemsArray(_3c.queryOptions));}else{throw new Error("dojox.data.OpmlStore: No OPML source data was provided as either URL or XML data input.");}}}}},getFeatures:function(){var _4f={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};return _4f;},getIdentity:function(_50){if(this.isItem(_50)){for(var i in this._identityMap){if(this._identityMap[i]===_50){return i;}}}return null;},fetchItemByIdentity:function(_52){if(!this._loadFinished){var _53=this;if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_52});}else{this._loadInProgress=true;var _54={url:_53.url,handleAs:"xml"};var _55=_4.xhrGet(_54);_55.addCallback(function(_56){var _57=_52.scope?_52.scope:_4.global;try{_53._processRawXmlTree(_56);var _58=_53._identityMap[_52.identity];if(!_53.isItem(_58)){_58=null;}if(_52.onItem){_52.onItem.call(_57,_58);}_53._handleQueuedFetches();}catch(error){if(_52.onError){_52.onError.call(_57,error);}}});_55.addErrback(function(_59){this._loadInProgress=false;if(_52.onError){var _5a=_52.scope?_52.scope:_4.global;_52.onError.call(_5a,_59);}});}}else{if(this._opmlData){this._processRawXmlTree(this._opmlData);this._opmlData=null;var _5b=this._identityMap[_52.identity];if(!_53.isItem(_5b)){_5b=null;}if(_52.onItem){var _5c=_52.scope?_52.scope:_4.global;_52.onItem.call(_5c,_5b);}}}}else{var _5b=this._identityMap[_52.identity];if(!this.isItem(_5b)){_5b=null;}if(_52.onItem){var _5c=_52.scope?_52.scope:_4.global;_52.onItem.call(_5c,_5b);}}},getIdentityAttributes:function(_5d){return null;},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _5f=this._queuedFetches[i];var _60=_5f.args;var _61=_5f.filter;if(_61){_61(_60,this._getItemsArray(_60.queryOptions));}else{this.fetchItemByIdentity(_60);}}this._queuedFetches=[];}},close:function(_62){}});_4.extend(_6.data.OpmlStore,_4.data.util.simpleFetch);}}};});