/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.sketch.UndoStack"],["require","dojox.xml.DomParser"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.sketch.UndoStack"]){_4._hasResource["dojox.sketch.UndoStack"]=true;_4.provide("dojox.sketch.UndoStack");_4.require("dojox.xml.DomParser");(function(){var ta=_6.sketch;ta.CommandTypes={Create:"Create",Move:"Move",Modify:"Modify",Delete:"Delete",Convert:"Convert"};_4.declare("dojox.sketch.UndoStack",null,{constructor:function(_8){this.figure=_8;this._steps=[];this._undoedSteps=[];},apply:function(_9,_a,to){if(!_a&&!to&&_9.fullText){this.figure.setValue(_9.fullText);return;}var _c=_a.shapeText;var _d=to.shapeText;if(_c.length==0&&_d.length==0){return;}if(_c.length==0){var o=_6.xml.DomParser.parse(_d).documentElement;var a=this.figure._loadAnnotation(o);if(a){this.figure._add(a);}return;}if(_d.length==0){var ann=this.figure.get(_a.shapeId);this.figure._delete([ann],true);return;}var _11=this.figure.get(to.shapeId);var no=_6.xml.DomParser.parse(_d).documentElement;_11.draw(no);this.figure.select(_11);return;},add:function(cmd,ann,_15){var id=ann?ann.id:"";var _17=ann?ann.serialize():"";if(cmd==ta.CommandTypes.Delete){_17="";}var _18={cmdname:cmd,before:{shapeId:id,shapeText:_15||""},after:{shapeId:id,shapeText:_17}};this._steps.push(_18);this._undoedSteps=[];},destroy:function(){},undo:function(){var _19=this._steps.pop();if(_19){this._undoedSteps.push(_19);this.apply(_19,_19.after,_19.before);}},redo:function(){var _1a=this._undoedSteps.pop();if(_1a){this._steps.push(_1a);this.apply(_1a,_1a.before,_1a.after);}}});})();}}};});