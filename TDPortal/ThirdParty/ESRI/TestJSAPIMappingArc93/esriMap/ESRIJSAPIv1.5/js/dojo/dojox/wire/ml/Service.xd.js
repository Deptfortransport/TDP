/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.wire.ml.Service"],["provide","dojox.wire.ml.RestHandler"],["provide","dojox.wire.ml.XmlHandler"],["provide","dojox.wire.ml.JsonHandler"],["require","dijit._Widget"],["require","dojox.xml.parser"],["require","dojox.wire._base"],["require","dojox.wire.ml.util"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.wire.ml.Service"]){_4._hasResource["dojox.wire.ml.Service"]=true;_4.provide("dojox.wire.ml.Service");_4.provide("dojox.wire.ml.RestHandler");_4.provide("dojox.wire.ml.XmlHandler");_4.provide("dojox.wire.ml.JsonHandler");_4.require("dijit._Widget");_4.require("dojox.xml.parser");_4.require("dojox.wire._base");_4.require("dojox.wire.ml.util");_4.declare("dojox.wire.ml.Service",_5._Widget,{url:"",serviceUrl:"",serviceType:"",handlerClass:"",preventCache:true,postCreate:function(){this.handler=this._createHandler();},_handlerClasses:{"TEXT":"dojox.wire.ml.RestHandler","XML":"dojox.wire.ml.XmlHandler","JSON":"dojox.wire.ml.JsonHandler","JSON-RPC":"dojo.rpc.JsonService"},_createHandler:function(){if(this.url){var _7=this;var d=_4.xhrGet({url:this.url,handleAs:"json",sync:true});d.addCallback(function(_9){_7.smd=_9;});if(this.smd&&!this.serviceUrl){this.serviceUrl=(this.smd.serviceUrl||this.smd.serviceURL);}}var _a=undefined;if(this.handlerClass){_a=_6.wire._getClass(this.handlerClass);}else{if(this.serviceType){_a=this._handlerClasses[this.serviceType];if(_a&&_4.isString(_a)){_a=_6.wire._getClass(_a);this._handlerClasses[this.serviceType]=_a;}}else{if(this.smd&&this.smd.serviceType){_a=this._handlerClasses[this.smd.serviceType];if(_a&&_4.isString(_a)){_a=_6.wire._getClass(_a);this._handlerClasses[this.smd.serviceType]=_a;}}}}if(!_a){return null;}return new _a();},callMethod:function(_b,_c){var _d=new _4.Deferred();this.handler.bind(_b,_c,_d,this.serviceUrl);return _d;}});_4.declare("dojox.wire.ml.RestHandler",null,{contentType:"text/plain",handleAs:"text",bind:function(_e,_f,_10,url){_e=_e.toUpperCase();var _12=this;var _13={url:this._getUrl(_e,_f,url),contentType:this.contentType,handleAs:this.handleAs,headers:this.headers,preventCache:this.preventCache};var d=null;if(_e=="POST"){_13.postData=this._getContent(_e,_f);d=_4.rawXhrPost(_13);}else{if(_e=="PUT"){_13.putData=this._getContent(_e,_f);d=_4.rawXhrPut(_13);}else{if(_e=="DELETE"){d=_4.xhrDelete(_13);}else{d=_4.xhrGet(_13);}}}d.addCallbacks(function(_15){_10.callback(_12._getResult(_15));},function(_16){_10.errback(_16);});},_getUrl:function(_17,_18,url){var _1a;if(_17=="GET"||_17=="DELETE"){if(_18.length>0){_1a=_18[0];}}else{if(_18.length>1){_1a=_18[1];}}if(_1a){var _1b="";for(var _1c in _1a){var _1d=_1a[_1c];if(_1d){_1d=encodeURIComponent(_1d);var _1e="{"+_1c+"}";var _1f=url.indexOf(_1e);if(_1f>=0){url=url.substring(0,_1f)+_1d+url.substring(_1f+_1e.length);}else{if(_1b){_1b+="&";}_1b+=(_1c+"="+_1d);}}}if(_1b){url+="?"+_1b;}}return url;},_getContent:function(_20,_21){if(_20=="POST"||_20=="PUT"){return (_21?_21[0]:null);}else{return null;}},_getResult:function(_22){return _22;}});_4.declare("dojox.wire.ml.XmlHandler",_6.wire.ml.RestHandler,{contentType:"text/xml",handleAs:"xml",_getContent:function(_23,_24){var _25=null;if(_23=="POST"||_23=="PUT"){var p=_24[0];if(p){if(_4.isString(p)){_25=p;}else{var _27=p;if(_27 instanceof _6.wire.ml.XmlElement){_27=_27.element;}else{if(_27.nodeType===9){_27=_27.documentElement;}}var _28="<?xml version=\"1.0\"?>";_25=_28+_6.xml.parser.innerXML(_27);}}}return _25;},_getResult:function(_29){if(_29){_29=new _6.wire.ml.XmlElement(_29);}return _29;}});_4.declare("dojox.wire.ml.JsonHandler",_6.wire.ml.RestHandler,{contentType:"text/json",handleAs:"json",headers:{"Accept":"*/json"},_getContent:function(_2a,_2b){var _2c=null;if(_2a=="POST"||_2a=="PUT"){var p=(_2b?_2b[0]:undefined);if(p){if(_4.isString(p)){_2c=p;}else{_2c=_4.toJson(p);}}}return _2c;}});}}};});