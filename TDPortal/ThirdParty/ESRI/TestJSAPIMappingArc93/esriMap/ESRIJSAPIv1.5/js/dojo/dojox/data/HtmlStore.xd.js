/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.HtmlStore"],["require","dojox.xml.parser"],["require","dojo.data.util.simpleFetch"],["require","dojo.data.util.filter"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.HtmlStore"]){_4._hasResource["dojox.data.HtmlStore"]=true;_4.provide("dojox.data.HtmlStore");_4.require("dojox.xml.parser");_4.require("dojo.data.util.simpleFetch");_4.require("dojo.data.util.filter");_4.declare("dojox.data.HtmlStore",null,{constructor:function(_7){if(_7.url){if(!_7.dataId){throw new Error("dojo.data.HtmlStore: Cannot instantiate using url without an id!");}this.url=_7.url;this.dataId=_7.dataId;}else{if(_7.dataId){this._rootNode=_4.byId(_7.dataId);this.dataId=this._rootNode.id;}else{this._rootNode=_4.byId(this.dataId);}this._indexItems();}},url:"",dataId:"",_indexItems:function(){this._getHeadings();if(this._rootNode.rows){if(this._rootNode.tBodies&&this._rootNode.tBodies.length>0){this._rootNode=this._rootNode.tBodies[0];}var i;for(i=0;i<this._rootNode.rows.length;i++){this._rootNode.rows[i].store=this;this._rootNode.rows[i]._ident=i+1;}}else{var c=1;for(i=0;i<this._rootNode.childNodes.length;i++){if(this._rootNode.childNodes[i].nodeType===1){this._rootNode.childNodes[i].store=this;this._rootNode.childNodes[i]._ident=c;c++;}}}},_getHeadings:function(){this._headings=[];if(this._rootNode.tHead){_4.forEach(this._rootNode.tHead.rows[0].cells,_4.hitch(this,function(th){this._headings.push(_6.xml.parser.textContent(th));}));}else{this._headings=["name"];}},_getAllItems:function(){var _b=[];var i;if(this._rootNode.rows){for(i=0;i<this._rootNode.rows.length;i++){_b.push(this._rootNode.rows[i]);}}else{for(i=0;i<this._rootNode.childNodes.length;i++){if(this._rootNode.childNodes[i].nodeType===1){_b.push(this._rootNode.childNodes[i]);}}}return _b;},_assertIsItem:function(_d){if(!this.isItem(_d)){throw new Error("dojo.data.HtmlStore: a function was passed an item argument that was not an item");}},_assertIsAttribute:function(_e){if(typeof _e!=="string"){throw new Error("dojo.data.HtmlStore: a function was passed an attribute argument that was not an attribute name string");return -1;}return _4.indexOf(this._headings,_e);},getValue:function(_f,_10,_11){var _12=this.getValues(_f,_10);return (_12.length>0)?_12[0]:_11;},getValues:function(_13,_14){this._assertIsItem(_13);var _15=this._assertIsAttribute(_14);if(_15>-1){if(_13.cells){return [_6.xml.parser.textContent(_13.cells[_15])];}else{return [_6.xml.parser.textContent(_13)];}}return [];},getAttributes:function(_16){this._assertIsItem(_16);var _17=[];for(var i=0;i<this._headings.length;i++){if(this.hasAttribute(_16,this._headings[i])){_17.push(this._headings[i]);}}return _17;},hasAttribute:function(_19,_1a){return this.getValues(_19,_1a).length>0;},containsValue:function(_1b,_1c,_1d){var _1e=undefined;if(typeof _1d==="string"){_1e=_4.data.util.filter.patternToRegExp(_1d,false);}return this._containsValue(_1b,_1c,_1d,_1e);},_containsValue:function(_1f,_20,_21,_22){var _23=this.getValues(_1f,_20);for(var i=0;i<_23.length;++i){var _25=_23[i];if(typeof _25==="string"&&_22){return (_25.match(_22)!==null);}else{if(_21===_25){return true;}}}return false;},isItem:function(_26){if(_26&&_26.store&&_26.store===this){return true;}return false;},isItemLoaded:function(_27){return this.isItem(_27);},loadItem:function(_28){this._assertIsItem(_28.item);},_fetchItems:function(_29,_2a,_2b){if(this._rootNode){this._finishFetchItems(_29,_2a,_2b);}else{if(!this.url){this._rootNode=_4.byId(this.dataId);}else{var _2c={url:this.url,handleAs:"text"};var _2d=this;var _2e=_4.xhrGet(_2c);_2e.addCallback(function(_2f){var _30=function(_31,id){if(_31.id==id){return _31;}if(_31.childNodes){for(var i=0;i<_31.childNodes.length;i++){var _34=_30(_31.childNodes[i],id);if(_34){return _34;}}}return null;};var d=document.createElement("div");d.innerHTML=_2f;_2d._rootNode=_30(d,_2d.dataId);_2d._indexItems();_2d._finishFetchItems(_29,_2a,_2b);});_2e.addErrback(function(_36){_2b(_36,_29);});}}},_finishFetchItems:function(_37,_38,_39){var _3a=null;var _3b=this._getAllItems();if(_37.query){var _3c=_37.queryOptions?_37.queryOptions.ignoreCase:false;_3a=[];var _3d={};var key;var _3f;for(key in _37.query){_3f=_37.query[key]+"";if(typeof _3f==="string"){_3d[key]=_4.data.util.filter.patternToRegExp(_3f,_3c);}}for(var i=0;i<_3b.length;++i){var _41=true;var _42=_3b[i];for(key in _37.query){_3f=_37.query[key]+"";if(!this._containsValue(_42,key,_3f,_3d[key])){_41=false;}}if(_41){_3a.push(_42);}}_38(_3a,_37);}else{if(_3b.length>0){_3a=_3b.slice(0,_3b.length);}_38(_3a,_37);}},getFeatures:function(){return {"dojo.data.api.Read":true,"dojo.data.api.Identity":true};},close:function(_43){},getLabel:function(_44){if(this.isItem(_44)){if(_44.cells){return "Item #"+this.getIdentity(_44);}else{return this.getValue(_44,"name");}}return undefined;},getLabelAttributes:function(_45){if(_45.cells){return null;}else{return ["name"];}},getIdentity:function(_46){this._assertIsItem(_46);if(this.hasAttribute(_46,"name")){return this.getValue(_46,"name");}else{return _46._ident;}},getIdentityAttributes:function(_47){return null;},fetchItemByIdentity:function(_48){var _49=_48.identity;var _4a=this;var _4b=null;var _4c=null;if(!this._rootNode){if(!this.url){this._rootNode=_4.byId(this.dataId);this._indexItems();if(_4a._rootNode.rows){_4b=this._rootNode.rows[_49+1];}else{for(var i=0;i<_4a._rootNode.childNodes.length;i++){if(_4a._rootNode.childNodes[i].nodeType===1&&_49===_6.xml.parser.textContent(_4a._rootNode.childNodes[i])){_4b=_4a._rootNode.childNodes[i];}}}if(_48.onItem){_4c=_48.scope?_48.scope:_4.global;_48.onItem.call(_4c,_4b);}}else{var _4e={url:this.url,handleAs:"text"};var _4f=_4.xhrGet(_4e);_4f.addCallback(function(_50){var _51=function(_52,id){if(_52.id==id){return _52;}if(_52.childNodes){for(var i=0;i<_52.childNodes.length;i++){var _55=_51(_52.childNodes[i],id);if(_55){return _55;}}}return null;};var d=document.createElement("div");d.innerHTML=_50;_4a._rootNode=_51(d,_4a.dataId);_4a._indexItems();if(_4a._rootNode.rows&&_49<=_4a._rootNode.rows.length){_4b=_4a._rootNode.rows[_49-1];}else{for(var i=0;i<_4a._rootNode.childNodes.length;i++){if(_4a._rootNode.childNodes[i].nodeType===1&&_49===_6.xml.parser.textContent(_4a._rootNode.childNodes[i])){_4b=_4a._rootNode.childNodes[i];break;}}}if(_48.onItem){_4c=_48.scope?_48.scope:_4.global;_48.onItem.call(_4c,_4b);}});_4f.addErrback(function(_58){if(_48.onError){_4c=_48.scope?_48.scope:_4.global;_48.onError.call(_4c,_58);}});}}else{if(this._rootNode.rows[_49+1]){_4b=this._rootNode.rows[_49+1];if(_48.onItem){_4c=_48.scope?_48.scope:_4.global;_48.onItem.call(_4c,_4b);}}}}});_4.extend(_6.data.HtmlStore,_4.data.util.simpleFetch);}}};});