/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.QueryReadStore"],["require","dojo.string"],["require","dojo.data.util.sorter"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.QueryReadStore"]){_4._hasResource["dojox.data.QueryReadStore"]=true;_4.provide("dojox.data.QueryReadStore");_4.require("dojo.string");_4.require("dojo.data.util.sorter");_4.declare("dojox.data.QueryReadStore",null,{url:"",requestMethod:"get",_className:"dojox.data.QueryReadStore",_items:[],_lastServerQuery:null,_numRows:-1,lastRequestHash:null,doClientPaging:false,doClientSorting:false,_itemsByIdentity:null,_identifier:null,_features:{"dojo.data.api.Read":true,"dojo.data.api.Identity":true},_labelAttr:"label",constructor:function(_7){_4.mixin(this,_7);},getValue:function(_8,_9,_a){this._assertIsItem(_8);if(!_4.isString(_9)){throw new Error(this._className+".getValue(): Invalid attribute, string expected!");}if(!this.hasAttribute(_8,_9)){if(_a){return _a;}console.log(this._className+".getValue(): Item does not have the attribute '"+_9+"'.");}return _8.i[_9];},getValues:function(_b,_c){this._assertIsItem(_b);var _d=[];if(this.hasAttribute(_b,_c)){_d.push(_b.i[_c]);}return _d;},getAttributes:function(_e){this._assertIsItem(_e);var _f=[];for(var i in _e.i){_f.push(i);}return _f;},hasAttribute:function(_11,_12){return this.isItem(_11)&&typeof _11.i[_12]!="undefined";},containsValue:function(_13,_14,_15){var _16=this.getValues(_13,_14);var len=_16.length;for(var i=0;i<len;i++){if(_16[i]==_15){return true;}}return false;},isItem:function(_19){if(_19){return typeof _19.r!="undefined"&&_19.r==this;}return false;},isItemLoaded:function(_1a){return this.isItem(_1a);},loadItem:function(_1b){if(this.isItemLoaded(_1b.item)){return;}},fetch:function(_1c){_1c=_1c||{};if(!_1c.store){_1c.store=this;}var _1d=this;var _1e=function(_1f,_20){if(_20.onError){var _21=_20.scope||_4.global;_20.onError.call(_21,_1f,_20);}};var _22=function(_23,_24,_25){var _26=_24.abort||null;var _27=false;var _28=_24.start?_24.start:0;if(_1d.doClientPaging==false){_28=0;}var _29=_24.count?(_28+_24.count):_23.length;_24.abort=function(){_27=true;if(_26){_26.call(_24);}};var _2a=_24.scope||_4.global;if(!_24.store){_24.store=_1d;}if(_24.onBegin){_24.onBegin.call(_2a,_25,_24);}if(_24.sort&&_1d.doClientSorting){_23.sort(_4.data.util.sorter.createSortFunction(_24.sort,_1d));}if(_24.onItem){for(var i=_28;(i<_23.length)&&(i<_29);++i){var _2c=_23[i];if(!_27){_24.onItem.call(_2a,_2c,_24);}}}if(_24.onComplete&&!_27){var _2d=null;if(!_24.onItem){_2d=_23.slice(_28,_29);}_24.onComplete.call(_2a,_2d,_24);}};this._fetchItems(_1c,_22,_1e);return _1c;},getFeatures:function(){return this._features;},close:function(_2e){},getLabel:function(_2f){if(this._labelAttr&&this.isItem(_2f)){return this.getValue(_2f,this._labelAttr);}return undefined;},getLabelAttributes:function(_30){if(this._labelAttr){return [this._labelAttr];}return null;},_xhrFetchHandler:function(_31,_32,_33,_34){_31=this._filterResponse(_31);if(_31.label){this._labelAttr=_31.label;}var _35=_31.numRows||-1;this._items=[];_4.forEach(_31.items,function(e){this._items.push({i:e,r:this});},this);var _37=_31.identifier;this._itemsByIdentity={};if(_37){this._identifier=_37;var i;for(i=0;i<this._items.length;++i){var _39=this._items[i].i;var _3a=_39[_37];if(!this._itemsByIdentity[_3a]){this._itemsByIdentity[_3a]=_39;}else{throw new Error(this._className+":  The json data as specified by: ["+this.url+"] is malformed.  Items within the list have identifier: ["+_37+"].  Value collided: ["+_3a+"]");}}}else{this._identifier=Number;for(i=0;i<this._items.length;++i){this._items[i].n=i;}}_35=this._numRows=(_35===-1)?this._items.length:_35;_33(this._items,_32,_35);this._numRows=_35;},_fetchItems:function(_3b,_3c,_3d){var _3e=_3b.serverQuery||_3b.query||{};if(!this.doClientPaging){_3e.start=_3b.start||0;if(_3b.count){_3e.count=_3b.count;}}if(!this.doClientSorting){if(_3b.sort){var _3f=_3b.sort[0];if(_3f&&_3f.attribute){var _40=_3f.attribute;if(_3f.descending){_40="-"+_40;}_3e.sort=_40;}}}if(this.doClientPaging&&this._lastServerQuery!==null&&_4.toJson(_3e)==_4.toJson(this._lastServerQuery)){this._numRows=(this._numRows===-1)?this._items.length:this._numRows;_3c(this._items,_3b,this._numRows);}else{var _41=this.requestMethod.toLowerCase()=="post"?_4.xhrPost:_4.xhrGet;var _42=_41({url:this.url,handleAs:"json-comment-optional",content:_3e});_42.addCallback(_4.hitch(this,function(_43){this._xhrFetchHandler(_43,_3b,_3c,_3d);}));_42.addErrback(function(_44){_3d(_44,_3b);});this.lastRequestHash=new Date().getTime()+"-"+String(Math.random()).substring(2);this._lastServerQuery=_4.mixin({},_3e);}},_filterResponse:function(_45){return _45;},_assertIsItem:function(_46){if(!this.isItem(_46)){throw new Error(this._className+": Invalid item argument.");}},_assertIsAttribute:function(_47){if(typeof _47!=="string"){throw new Error(this._className+": Invalid attribute argument ('"+_47+"').");}},fetchItemByIdentity:function(_48){if(this._itemsByIdentity){var _49=this._itemsByIdentity[_48.identity];if(!(_49===undefined)){if(_48.onItem){var _4a=_48.scope?_48.scope:_4.global;_48.onItem.call(_4a,{i:_49,r:this});}return;}}var _4b=function(_4c,_4d){var _4e=_48.scope?_48.scope:_4.global;if(_48.onError){_48.onError.call(_4e,_4c);}};var _4f=function(_50,_51){var _52=_48.scope?_48.scope:_4.global;try{var _53=null;if(_50&&_50.length==1){_53=_50[0];}if(_48.onItem){_48.onItem.call(_52,_53);}}catch(error){if(_48.onError){_48.onError.call(_52,error);}}};var _54={serverQuery:{id:_48.identity}};this._fetchItems(_54,_4f,_4b);},getIdentity:function(_55){var _56=null;if(this._identifier===Number){_56=_55.n;}else{_56=_55.i[this._identifier];}return _56;},getIdentityAttributes:function(_57){return [this._identifier];}});}}};});