/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.ServiceStore"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.ServiceStore"]){_4._hasResource["dojox.data.ServiceStore"]=true;_4.provide("dojox.data.ServiceStore");_4.declare("dojox.data.ServiceStore",_6.data.ClientFilter,{constructor:function(_7){this.byId=this.fetchItemByIdentity;this._index={};if(_7){_4.mixin(this,_7);}this.idAttribute=(_7&&_7.idAttribute)||(this.schema&&this.schema._idAttr);this.labelAttribute=this.labelAttribute||"label";},schema:null,idAttribute:"id",syncMode:false,estimateCountFactor:1,getSchema:function(){return this.schema;},loadLazyValues:true,getValue:function(_8,_9,_a){var _b=_8[_9];return _b||(_9 in _8?_b:_8._loadObject?(_6.rpc._sync=true)&&arguments.callee.call(this,_6.data.ServiceStore.prototype.loadItem({item:_8})||{},_9,_a):_a);},getValues:function(_c,_d){var _e=this.getValue(_c,_d);return _e instanceof Array?_e:_e===undefined?[]:[_e];},getAttributes:function(_f){var res=[];for(var i in _f){if(_f.hasOwnProperty(i)&&!(i.charAt(0)=="_"&&i.charAt(1)=="_")){res.push(i);}}return res;},hasAttribute:function(_12,_13){return _13 in _12;},containsValue:function(_14,_15,_16){return _4.indexOf(this.getValues(_14,_15),_16)>-1;},isItem:function(_17){return (typeof _17=="object")&&_17&&!(_17 instanceof Date);},isItemLoaded:function(_18){return _18&&!_18._loadObject;},loadItem:function(_19){var _1a;if(_19.item._loadObject){_19.item._loadObject(function(_1b){_1a=_1b;delete _1a._loadObject;var _1c=_1b instanceof Error?_19.onError:_19.onItem;if(_1c){_1c.call(_19.scope,_1b);}});}else{if(_19.onItem){_19.onItem.call(_19.scope,_19.item);}}return _1a;},_currentId:0,_processResults:function(_1d,_1e){if(_1d&&typeof _1d=="object"){var id=_1d.__id;if(!id){if(this.idAttribute){id=_1d[this.idAttribute];}else{id=this._currentId++;}if(id!==undefined){var _20=this._index[id];if(_20){for(var j in _20){delete _20[j];}_1d=_4.mixin(_20,_1d);}_1d.__id=id;this._index[id]=_1d;}}for(var i in _1d){_1d[i]=this._processResults(_1d[i],_1e).items;}}var _23=_1d.length;return {totalCount:_1e.request.count==_23?(_1e.request.start||0)+_23*this.estimateCountFactor:_23,items:_1d};},close:function(_24){return _24&&_24.abort&&_24.abort();},fetch:function(_25){_25=_25||{};if("syncMode" in _25?_25.syncMode:this.syncMode){_6.rpc._sync=true;}var _26=this;var _27=_25.scope||_26;var _28=this.cachingFetch?this.cachingFetch(_25):this._doQuery(_25);_28.request=_25;_28.addCallback(function(_29){if(_25.clientFetch){_29=_26.clientSideFetch({query:_25.clientFetch,sort:_25.sort,start:_25.start,count:_25.count},_29);}var _2a=_26._processResults(_29,_28);_29=_25.results=_2a.items;if(_25.onBegin){_25.onBegin.call(_27,_2a.totalCount,_25);}if(_25.onItem){for(var i=0;i<_29.length;i++){_25.onItem.call(_27,_29[i],_25);}}if(_25.onComplete){_25.onComplete.call(_27,_25.onItem?null:_29,_25);}return _29;});_28.addErrback(_25.onError&&_4.hitch(_27,_25.onError));_25.abort=function(){_28.ioArgs.xhr.abort();};_25.store=this;return _25;},_doQuery:function(_2c){var _2d=typeof _2c.queryStr=="string"?_2c.queryStr:_2c.query;return this.service(_2d);},getFeatures:function(){return {"dojo.data.api.Read":true,"dojo.data.api.Identity":true,"dojo.data.api.Schema":this.schema};},getLabel:function(_2e){return this.getValue(_2e,this.labelAttribute);},getLabelAttributes:function(_2f){return [this.labelAttribute];},getIdentity:function(_30){return _30.__id;},getIdentityAttributes:function(_31){return [this.idAttribute];},fetchItemByIdentity:function(_32){var _33=this._index[(_32._prefix||"")+_32.identity];if(_33&&_32.onItem){_32.onItem.call(_32.scope,_33);}else{return this.fetch({query:_32.identity,onComplete:_32.onItem,onError:_32.onError,scope:_32.scope}).results;}return _33;}});}}};});