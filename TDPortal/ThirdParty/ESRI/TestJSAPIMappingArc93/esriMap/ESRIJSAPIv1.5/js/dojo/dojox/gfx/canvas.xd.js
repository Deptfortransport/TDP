/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.gfx.canvas"],["require","dojox.gfx._base"],["require","dojox.gfx.shape"],["require","dojox.gfx.path"],["require","dojox.gfx.arc"],["require","dojox.gfx.decompose"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.gfx.canvas"]){_4._hasResource["dojox.gfx.canvas"]=true;_4.provide("dojox.gfx.canvas");_4.require("dojox.gfx._base");_4.require("dojox.gfx.shape");_4.require("dojox.gfx.path");_4.require("dojox.gfx.arc");_4.require("dojox.gfx.decompose");_4.experimental("dojox.gfx.canvas");(function(){var g=_6.gfx,gs=g.shape,ga=g.arc,m=g.matrix,mp=m.multiplyPoint,pi=Math.PI,_d=2*pi,_e=pi/2;_4.extend(g.Shape,{_render:function(_f){_f.save();this._renderTransform(_f);this._renderShape(_f);this._renderFill(_f,true);this._renderStroke(_f,true);_f.restore();},_renderTransform:function(ctx){if("canvasTransform" in this){var t=this.canvasTransform;ctx.translate(t.dx,t.dy);ctx.rotate(t.angle2);ctx.scale(t.sx,t.sy);ctx.rotate(t.angle1);}},_renderShape:function(ctx){},_renderFill:function(ctx,_14){if("canvasFill" in this){if("canvasFillImage" in this){this.canvasFill=ctx.createPattern(this.canvasFillImage,"repeat");delete this.canvasFillImage;}ctx.fillStyle=this.canvasFill;if(_14){ctx.fill();}}else{ctx.fillStyle="rgba(0,0,0,0.0)";}},_renderStroke:function(ctx,_16){var s=this.strokeStyle;if(s){ctx.strokeStyle=s.color.toString();ctx.lineWidth=s.width;ctx.lineCap=s.cap;if(typeof s.join=="number"){ctx.lineJoin="miter";ctx.miterLimit=s.join;}else{ctx.lineJoin=s.join;}if(_16){ctx.stroke();}}else{if(!_16){ctx.strokeStyle="rgba(0,0,0,0.0)";}}},getEventSource:function(){return null;},connect:function(){},disconnect:function(){}});var _18=function(_19,_1a,_1b){var old=_19.prototype[_1a];_19.prototype[_1a]=_1b?function(){this.surface.makeDirty();old.apply(this,arguments);_1b.call(this);return this;}:function(){this.surface.makeDirty();return old.apply(this,arguments);};};_18(g.Shape,"setTransform",function(){if(this.matrix){this.canvasTransform=g.decompose(this.matrix);}else{delete this.canvasTransform;}});_18(g.Shape,"setFill",function(){var fs=this.fillStyle,f;if(fs){if(typeof (fs)=="object"&&"type" in fs){var ctx=this.surface.rawNode.getContext("2d");switch(fs.type){case "linear":case "radial":f=fs.type=="linear"?ctx.createLinearGradient(fs.x1,fs.y1,fs.x2,fs.y2):ctx.createRadialGradient(fs.cx,fs.cy,0,fs.cx,fs.cy,fs.r);_4.forEach(fs.colors,function(_20){f.addColorStop(_20.offset,g.normalizeColor(_20.color).toString());});break;case "pattern":var img=new Image(fs.width,fs.height);this.surface.downloadImage(img,fs.src);this.canvasFillImage=img;}}else{f=fs.toString();}this.canvasFill=f;}else{delete this.canvasFill;}});_18(g.Shape,"setStroke");_18(g.Shape,"setShape");_4.declare("dojox.gfx.Group",g.Shape,{constructor:function(){gs.Container._init.call(this);},_render:function(ctx){ctx.save();this._renderTransform(ctx);this._renderFill(ctx);this._renderStroke(ctx);for(var i=0;i<this.children.length;++i){this.children[i]._render(ctx);}ctx.restore();}});_4.declare("dojox.gfx.Rect",gs.Rect,{_renderShape:function(ctx){var s=this.shape,r=Math.min(s.r,s.height/2,s.width/2),xl=s.x,xr=xl+s.width,yt=s.y,yb=yt+s.height,xl2=xl+r,xr2=xr-r,yt2=yt+r,yb2=yb-r;ctx.beginPath();ctx.moveTo(xl2,yt);if(r){ctx.arc(xr2,yt2,r,-_e,0,false);ctx.arc(xr2,yb2,r,0,_e,false);ctx.arc(xl2,yb2,r,_e,pi,false);ctx.arc(xl2,yt2,r,pi,_e,false);}else{ctx.lineTo(xr2,yt);ctx.lineTo(xr,yb2);ctx.lineTo(xl2,yb);ctx.lineTo(xl,yt2);}ctx.closePath();}});var _2f=[];(function(){var u=ga.curvePI4;_2f.push(u.s,u.c1,u.c2,u.e);for(var a=45;a<360;a+=45){var r=m.rotateg(a);_2f.push(mp(r,u.c1),mp(r,u.c2),mp(r,u.e));}})();_4.declare("dojox.gfx.Ellipse",gs.Ellipse,{setShape:function(){g.Ellipse.superclass.setShape.apply(this,arguments);var s=this.shape,t,c1,c2,r=[],M=m.normalize([m.translate(s.cx,s.cy),m.scale(s.rx,s.ry)]);t=mp(M,_2f[0]);r.push([t.x,t.y]);for(var i=1;i<_2f.length;i+=3){c1=mp(M,_2f[i]);c2=mp(M,_2f[i+1]);t=mp(M,_2f[i+2]);r.push([c1.x,c1.y,c2.x,c2.y,t.x,t.y]);}this.canvasEllipse=r;return this;},_renderShape:function(ctx){var r=this.canvasEllipse;ctx.beginPath();ctx.moveTo.apply(ctx,r[0]);for(var i=1;i<r.length;++i){ctx.bezierCurveTo.apply(ctx,r[i]);}ctx.closePath();}});_4.declare("dojox.gfx.Circle",gs.Circle,{_renderShape:function(ctx){var s=this.shape;ctx.beginPath();ctx.arc(s.cx,s.cy,s.r,0,_d,1);}});_4.declare("dojox.gfx.Line",gs.Line,{_renderShape:function(ctx){var s=this.shape;ctx.beginPath();ctx.moveTo(s.x1,s.y1);ctx.lineTo(s.x2,s.y2);}});_4.declare("dojox.gfx.Polyline",gs.Polyline,{setShape:function(){g.Polyline.superclass.setShape.apply(this,arguments);var p=this.shape.points,f=p[0],r=[],c,i;if(p.length){if(typeof f=="number"){r.push(f,p[1]);i=2;}else{r.push(f.x,f.y);i=1;}for(;i<p.length;++i){c=p[i];if(typeof c=="number"){r.push(c,p[++i]);}else{r.push(c.x,c.y);}}}this.canvasPolyline=r;return this;},_renderShape:function(ctx){var p=this.canvasPolyline;if(p.length){ctx.beginPath();ctx.moveTo(p[0],p[1]);for(var i=2;i<p.length;i+=2){ctx.lineTo(p[i],p[i+1]);}}}});_4.declare("dojox.gfx.Image",gs.Image,{setShape:function(){g.Image.superclass.setShape.apply(this,arguments);var img=new Image();this.surface.downloadImage(img,this.shape.src);this.canvasImage=img;return this;},_renderShape:function(ctx){var s=this.shape;ctx.drawImage(this.canvasImage,s.x,s.y,s.width,s.height);}});_4.declare("dojox.gfx.Text",gs.Text,{_renderShape:function(ctx){var s=this.shape;}});_18(g.Text,"setFont");var _4e={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};_4.declare("dojox.gfx.Path",g.path.Path,{constructor:function(){this.lastControl={};},setShape:function(){this.canvasPath=[];return g.Path.superclass.setShape.apply(this,arguments);},_updateWithSegment:function(_4f){var _50=_4.clone(this.last);this[_4e[_4f.action]](this.canvasPath,_4f.action,_4f.args);this.last=_50;g.Path.superclass._updateWithSegment.apply(this,arguments);},_renderShape:function(ctx){var r=this.canvasPath;ctx.beginPath();for(var i=0;i<r.length;i+=2){ctx[r[i]].apply(ctx,r[i+1]);}},_moveToA:function(_54,_55,_56){_54.push("moveTo",[_56[0],_56[1]]);for(var i=2;i<_56.length;i+=2){_54.push("lineTo",[_56[i],_56[i+1]]);}this.last.x=_56[_56.length-2];this.last.y=_56[_56.length-1];this.lastControl={};},_moveToR:function(_58,_59,_5a){if("x" in this.last){_58.push("moveTo",[this.last.x+=_5a[0],this.last.y+=_5a[1]]);}else{_58.push("moveTo",[this.last.x=_5a[0],this.last.y=_5a[1]]);}for(var i=2;i<_5a.length;i+=2){_58.push("lineTo",[this.last.x+=_5a[i],this.last.y+=_5a[i+1]]);}this.lastControl={};},_lineToA:function(_5c,_5d,_5e){for(var i=0;i<_5e.length;i+=2){_5c.push("lineTo",[_5e[i],_5e[i+1]]);}this.last.x=_5e[_5e.length-2];this.last.y=_5e[_5e.length-1];this.lastControl={};},_lineToR:function(_60,_61,_62){for(var i=0;i<_62.length;i+=2){_60.push("lineTo",[this.last.x+=_62[i],this.last.y+=_62[i+1]]);}this.lastControl={};},_hLineToA:function(_64,_65,_66){for(var i=0;i<_66.length;++i){_64.push("lineTo",[_66[i],this.last.y]);}this.last.x=_66[_66.length-1];this.lastControl={};},_hLineToR:function(_68,_69,_6a){for(var i=0;i<_6a.length;++i){_68.push("lineTo",[this.last.x+=_6a[i],this.last.y]);}this.lastControl={};},_vLineToA:function(_6c,_6d,_6e){for(var i=0;i<_6e.length;++i){_6c.push("lineTo",[this.last.x,_6e[i]]);}this.last.y=_6e[_6e.length-1];this.lastControl={};},_vLineToR:function(_70,_71,_72){for(var i=0;i<_72.length;++i){_70.push("lineTo",[this.last.x,this.last.y+=_72[i]]);}this.lastControl={};},_curveToA:function(_74,_75,_76){for(var i=0;i<_76.length;i+=6){_74.push("bezierCurveTo",_76.slice(i,i+6));}this.last.x=_76[_76.length-2];this.last.y=_76[_76.length-1];this.lastControl.x=_76[_76.length-4];this.lastControl.y=_76[_76.length-3];this.lastControl.type="C";},_curveToR:function(_78,_79,_7a){for(var i=0;i<_7a.length;i+=6){_78.push("bezierCurveTo",[this.last.x+_7a[i],this.last.y+_7a[i+1],this.lastControl.x=this.last.x+_7a[i+2],this.lastControl.y=this.last.y+_7a[i+3],this.last.x+_7a[i+4],this.last.y+_7a[i+5]]);this.last.x+=_7a[i+4];this.last.y+=_7a[i+5];}this.lastControl.type="C";},_smoothCurveToA:function(_7c,_7d,_7e){for(var i=0;i<_7e.length;i+=4){var _80=this.lastControl.type=="C";_7c.push("bezierCurveTo",[_80?2*this.last.x-this.lastControl.x:this.last.x,_80?2*this.last.y-this.lastControl.y:this.last.y,_7e[i],_7e[i+1],_7e[i+2],_7e[i+3]]);this.lastControl.x=_7e[i];this.lastControl.y=_7e[i+1];this.lastControl.type="C";}this.last.x=_7e[_7e.length-2];this.last.y=_7e[_7e.length-1];},_smoothCurveToR:function(_81,_82,_83){for(var i=0;i<_83.length;i+=4){var _85=this.lastControl.type=="C";_81.push("bezierCurveTo",[_85?2*this.last.x-this.lastControl.x:this.last.x,_85?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+_83[i],this.last.y+_83[i+1],this.last.x+_83[i+2],this.last.y+_83[i+3]]);this.lastControl.x=this.last.x+_83[i];this.lastControl.y=this.last.y+_83[i+1];this.lastControl.type="C";this.last.x+=_83[i+2];this.last.y+=_83[i+3];}},_qCurveToA:function(_86,_87,_88){for(var i=0;i<_88.length;i+=4){_86.push("quadraticCurveTo",_88.slice(i,i+4));}this.last.x=_88[_88.length-2];this.last.y=_88[_88.length-1];this.lastControl.x=_88[_88.length-4];this.lastControl.y=_88[_88.length-3];this.lastControl.type="Q";},_qCurveToR:function(_8a,_8b,_8c){for(var i=0;i<_8c.length;i+=4){_8a.push("quadraticCurveTo",[this.lastControl.x=this.last.x+_8c[i],this.lastControl.y=this.last.y+_8c[i+1],this.last.x+_8c[i+2],this.last.y+_8c[i+3]]);this.last.x+=_8c[i+2];this.last.y+=_8c[i+3];}this.lastControl.type="Q";},_qSmoothCurveToA:function(_8e,_8f,_90){for(var i=0;i<_90.length;i+=2){var _92=this.lastControl.type=="Q";_8e.push("quadraticCurveTo",[this.lastControl.x=_92?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=_92?2*this.last.y-this.lastControl.y:this.last.y,_90[i],_90[i+1]]);this.lastControl.type="Q";}this.last.x=_90[_90.length-2];this.last.y=_90[_90.length-1];},_qSmoothCurveToR:function(_93,_94,_95){for(var i=0;i<_95.length;i+=2){var _97=this.lastControl.type=="Q";_93.push("quadraticCurveTo",[this.lastControl.x=_97?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=_97?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+_95[i],this.last.y+_95[i+1]]);this.lastControl.type="Q";this.last.x+=_95[i];this.last.y+=_95[i+1];}},_arcTo:function(_98,_99,_9a){var _9b=_99=="a";for(var i=0;i<_9a.length;i+=7){var x1=_9a[i+5],y1=_9a[i+6];if(_9b){x1+=this.last.x;y1+=this.last.y;}var _9f=ga.arcAsBezier(this.last,_9a[i],_9a[i+1],_9a[i+2],_9a[i+3]?1:0,_9a[i+4]?1:0,x1,y1);_4.forEach(_9f,function(p){_98.push("bezierCurveTo",p);});this.last.x=x1;this.last.y=y1;}this.lastControl={};},_closePath:function(_a1,_a2,_a3){_a1.push("closePath",[]);this.lastControl={};}});_4.forEach(["moveTo","lineTo","hLineTo","vLineTo","curveTo","smoothCurveTo","qCurveTo","qSmoothCurveTo","arcTo","closePath"],function(_a4){_18(g.Path,_a4);});_4.declare("dojox.gfx.TextPath",g.path.TextPath,{_renderShape:function(ctx){var s=this.shape;}});_4.declare("dojox.gfx.Surface",gs.Surface,{constructor:function(){gs.Container._init.call(this);this.pendingImageCount=0;this.makeDirty();},setDimensions:function(_a7,_a8){this.width=g.normalizedLength(_a7);this.height=g.normalizedLength(_a8);if(!this.rawNode){return this;}this.rawNode.width=_a7;this.rawNode.height=_a8;this.makeDirty();return this;},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null;},_render:function(){if(this.pendingImageCount){return;}var ctx=this.rawNode.getContext("2d");ctx.save();ctx.clearRect(0,0,this.rawNode.width,this.rawNode.height);for(var i=0;i<this.children.length;++i){this.children[i]._render(ctx);}ctx.restore();if("pendingRender" in this){clearTimeout(this.pendingRender);delete this.pendingRender;}},makeDirty:function(){if(!this.pendingImagesCount&&!("pendingRender" in this)){this.pendingRender=setTimeout(_4.hitch(this,this._render),0);}},downloadImage:function(img,url){var _ad=_4.hitch(this,this.onImageLoad);if(!this.pendingImageCount++&&"pendingRender" in this){clearTimeout(this.pendingRender);delete this.pendingRender;}img.onload=_ad;img.onerror=_ad;img.onabort=_ad;img.src=url;},onImageLoad:function(){if(!--this.pendingImageCount){this._render();}},getEventSource:function(){return null;},connect:function(){},disconnect:function(){}});g.createSurface=function(_ae,_af,_b0){if(!_af){_af="100%";}if(!_b0){_b0="100%";}var s=new g.Surface(),p=_4.byId(_ae),c=p.ownerDocument.createElement("canvas");c.width=_af;c.height=_b0;p.appendChild(c);s.rawNode=c;s._parent=p;s.surface=s;return s;};var C=gs.Container,_b5={add:function(_b6){this.surface.makeDirty();return C.add.apply(this,arguments);},remove:function(_b7,_b8){this.surface.makeDirty();return C.remove.apply(this,arguments);},clear:function(){this.surface.makeDirty();return C.clear.apply(this,arguments);},_moveChildToFront:function(_b9){this.surface.makeDirty();return C._moveChildToFront.apply(this,arguments);},_moveChildToBack:function(_ba){this.surface.makeDirty();return C._moveChildToBack.apply(this,arguments);}};_4.mixin(gs.Creator,{createObject:function(_bb,_bc){var _bd=new _bb();_bd.surface=this.surface;_bd.setShape(_bc);this.add(_bd);return _bd;}});_4.extend(g.Group,_b5);_4.extend(g.Group,gs.Creator);_4.extend(g.Surface,_b5);_4.extend(g.Surface,gs.Creator);})();}}};});