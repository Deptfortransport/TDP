/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.charting.plot2d.Stacked"],["require","dojox.charting.plot2d.common"],["require","dojox.charting.plot2d.Default"],["require","dojox.lang.functional"],["require","dojox.lang.functional.sequence"],["require","dojox.lang.functional.reversed"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.charting.plot2d.Stacked"]){_4._hasResource["dojox.charting.plot2d.Stacked"]=true;_4.provide("dojox.charting.plot2d.Stacked");_4.require("dojox.charting.plot2d.common");_4.require("dojox.charting.plot2d.Default");_4.require("dojox.lang.functional");_4.require("dojox.lang.functional.sequence");_4.require("dojox.lang.functional.reversed");(function(){var df=_6.lang.functional,dc=_6.charting.plot2d.common,_9=df.lambda("item.purgeGroup()");_4.declare("dojox.charting.plot2d.Stacked",_6.charting.plot2d.Default,{calculateAxes:function(_a){var _b=dc.collectStackedStats(this.series);this._maxRunLength=_b.hmax;this._calc(_a,_b);return this;},render:function(_c,_d){if(this._maxRunLength<=0){return this;}var _e=df.repeat(this._maxRunLength,"-> 0",0);for(var i=0;i<this.series.length;++i){var run=this.series[i];for(var j=0;j<run.data.length;++j){var v=run.data[j];if(isNaN(v)){v=0;}_e[j]+=v;}}this.dirty=this.isDirty();if(this.dirty){_4.forEach(this.series,_9);this.cleanGroup();var s=this.group;df.forEachRev(this.series,function(_14){_14.cleanGroup(s);});}var t=this.chart.theme,_16,_17,_18,_19,_1a=this.events(),ht=this._hScaler.scaler.getTransformerFromModel(this._hScaler),vt=this._vScaler.scaler.getTransformerFromModel(this._vScaler);this.resetEvents();for(var i=this.series.length-1;i>=0;--i){var run=this.series[i];if(!this.dirty&&!run.dirty){continue;}run.cleanGroup();var s=run.group,_1d=_4.map(_e,function(v,i){return {x:ht(i+1)+_d.l,y:_c.height-_d.b-vt(v)};},this);if(!run.fill||!run.stroke){_18=new _4.Color(t.next("color"));}var _20=this.opt.tension?dc.curve(_1d,this.opt.tension):"";if(this.opt.areas){var _21=_4.clone(_1d);var _22=run.fill?run.fill:dc.augmentFill(t.series.fill,_18);if(this.opt.tension){var p=dc.curve(_21,this.opt.tension);p+=" L"+_1d[_1d.length-1].x+","+(_c.height-_d.b)+" L"+_1d[0].x+","+(_c.height-_d.b)+" L"+_1d[0].x+","+_1d[0].y;run.dyn.fill=s.createPath(p).setFill(_22).getFill();}else{_21.push({x:_1d[_1d.length-1].x,y:_c.height-_d.b});_21.push({x:_1d[0].x,y:_c.height-_d.b});_21.push(_1d[0]);run.dyn.fill=s.createPolyline(_21).setFill(_22).getFill();}}if(this.opt.lines||this.opt.markers){_16=run.stroke?dc.makeStroke(run.stroke):dc.augmentStroke(t.series.stroke,_18);if(run.outline||t.series.outline){_17=dc.makeStroke(run.outline?run.outline:t.series.outline);_17.width=2*_17.width+_16.width;}}if(this.opt.markers){_19=run.dyn.marker=run.marker?run.marker:t.next("marker");}var _24,_25,_26;if(this.opt.shadows&&_16){var sh=this.opt.shadows,_28=new _4.Color([0,0,0,0.3]),_29=_4.map(_1d,function(c){return {x:c.x+sh.dx,y:c.y+sh.dy};}),_2b=_4.clone(_17?_17:_16);_2b.color=_28;_2b.width+=sh.dw?sh.dw:0;if(this.opt.lines){if(this.opt.tension){run.dyn.shadow=s.createPath(dc.curve(_29,this.opt.tension)).setStroke(_2b).getStroke();}else{run.dyn.shadow=s.createPolyline(_29).setStroke(_2b).getStroke();}}if(this.opt.markers){_26=_4.map(_29,function(c){return s.createPath("M"+c.x+" "+c.y+" "+_19).setStroke(_2b).setFill(_28);},this);}}if(this.opt.lines){if(_17){if(this.opt.tension){run.dyn.outline=s.createPath(_20).setStroke(_17).getStroke();}else{run.dyn.outline=s.createPolyline(_1d).setStroke(_17).getStroke();}}if(this.opt.tension){run.dyn.stroke=s.createPath(_20).setStroke(_16).getStroke();}else{run.dyn.stroke=s.createPolyline(_1d).setStroke(_16).getStroke();}}if(this.opt.markers){_24=new Array(_1d.length);_25=new Array(_1d.length);_4.forEach(_1d,function(c,i){var _2f="M"+c.x+" "+c.y+" "+_19;if(_17){_25[i]=s.createPath(_2f).setStroke(_17);}_24[i]=s.createPath(_2f).setStroke(_16).setFill(_16.color);},this);if(_1a){_4.forEach(_24,function(s,i){var o={element:"marker",index:i,run:run,plot:this,hAxis:this.hAxis||null,vAxis:this.vAxis||null,shape:s,outline:_25[i]||null,shadow:_26&&_26[i]||null,cx:_1d[i].x,cy:_1d[i].y,x:i+1,y:run.data[i]};this._connectEvents(s,o);},this);}}run.dirty=false;for(var j=0;j<run.data.length;++j){var v=run.data[j];if(isNaN(v)){v=0;}_e[j]-=v;}}this.dirty=false;return this;}});})();}}};});