/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.xmpp.RosterService"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.xmpp.RosterService"]){_4._hasResource["dojox.xmpp.RosterService"]=true;_4.provide("dojox.xmpp.RosterService");_6.xmpp.roster={ADDED:101,CHANGED:102,REMOVED:103};_4.declare("dojox.xmpp.RosterService",null,{constructor:function(_7){this.session=_7;},addRosterItem:function(_8,_9,_a){if(!_8){throw new Error("Roster::addRosterItem() - User ID is null");}var _b=this.session.getNextIqId();var _c={id:_b,from:this.session.jid+"/"+this.session.resource,type:"set"};var _d=new _6.string.Builder(_6.xmpp.util.createElement("iq",_c,false));_d.append(_6.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},false));_8=_6.xmpp.util.encodeJid(_8);if(_8.indexOf("@")==-1){_8=_8+"@"+this.session.domain;}_d.append(_6.xmpp.util.createElement("item",{jid:_8,name:_6.xmpp.util.xmlEncode(_9)},false));if(_a){for(var i=0;i<_a.length;i++){_d.append("<group>");_d.append(_a[i]);_d.append("</group>");}}_d.append("</item></query></iq>");var _f=this.session.dispatchPacket(_d.toString(),"iq",_c.id);_f.addCallback(this,"verifyRoster");return _f;},updateRosterItem:function(jid,_11,_12){if(jid.indexOf("@")==-1){jid+=jid+"@"+this.session.domain;}var req={id:this.session.getNextIqId(),from:this.session.jid+"/"+this.session.resource,type:"set"};var _14=new _6.string.Builder(_6.xmpp.util.createElement("iq",req,false));_14.append(_6.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},false));var i=this.session.getRosterIndex(jid);if(i==-1){return;}var _16={jid:jid};if(_11){_16.name=_11;}else{if(this.session.roster[i].name){_16.name=this.session.roster[i].name;}}if(_16.name){_16.name=_6.xmpp.util.xmlEncode(_16.name);}_14.append(_6.xmpp.util.createElement("item",_16,false));var _17=_12?_12:this.session.roster[i].groups;if(_17){for(var x=0;x<_17.length;x++){_14.append("<group>");_14.append(_17[x]);_14.append("</group>");}}_14.append("</item></query></iq>");var def=this.session.dispatchPacket(_14.toString(),"iq",req.id);def.addCallback(this,"verifyRoster");return def;},verifyRoster:function(res){if(res.getAttribute("type")=="result"){}else{var err=this.session.processXmppError(res);this.onAddRosterItemFailed(err);}return res;},addRosterItemToGroup:function(jid,_1d){if(!jid){throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");}if(!_1d){throw new Error("Roster::addRosterItemToGroup() group is null or undefined");}var _1e=this.session.getRosterIndex(jid);if(_1e==-1){return;}var _1f=this.session.roster[_1e];var _20=[];var _21=false;for(var i=0;((_1f<_1f.groups.length)&&(!_21));i++){if(_1f.groups[i]!=_1d){continue;}_21=true;}if(!_21){return this.updateRosterItem(jid,_1f.name,_1f.groups.concat(_1d),_1e);}return _6.xmpp.xmpp.INVALID_ID;},removeRosterGroup:function(_23){var _24=this.session.roster;for(var i=0;i<_24.length;i++){var _26=_24[i];if(_26.groups.length>0){for(var j=0;j<_26.groups.length;j++){if(_26.groups[j]==_23){_26.groups.splice(j,1);this.updateRosterItem(_26.jid,_26.name,_26.groups);}}}}},renameRosterGroup:function(_28,_29){var _2a=this.session.roster;for(var i=0;i<_2a.length;i++){var _2c=_2a[i];if(_2c.groups.length>0){for(var j=0;j<_2c.groups.length;j++){if(_2c.groups[j]==_28){_2c.groups[j]=_29;this.updateRosterItem(_2c.jid,_2c.name,_2c.groups);}}}}},removeRosterItemFromGroup:function(jid,_2f){if(!jid){throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");}if(!_2f){throw new Error("Roster::addRosterItemToGroup() group is null or undefined");}var _30=this.session.getRosterIndex(jid);if(_30==-1){return;}var _31=this.session.roster[_30];var _32=false;for(var i=0;((i<_31.groups.length)&&(!_32));i++){if(_31.groups[i]!=_2f){continue;}_32=true;_30=i;}if(_32==true){_31.groups.splice(_30,1);return this.updateRosterItem(jid,_31.name,_31.groups);}return _6.xmpp.xmpp.INVALID_ID;},rosterItemRenameGroup:function(jid,_35,_36){if(!jid){throw new Error("Roster::rosterItemRenameGroup() JID is null or undefined");}if(!_36){throw new Error("Roster::rosterItemRenameGroup() group is null or undefined");}var _37=this.session.getRosterIndex(jid);if(_37==-1){return;}var _38=this.session.roster[_37];var _39=false;for(var i=0;((i<_38.groups.length)&&(!_39));i++){if(_38.groups[i]==_35){_38.groups[i]=_36;_39=true;}}if(_39==true){return this.updateRosterItem(jid,_38.name,_38.groups);}return _6.xmpp.xmpp.INVALID_ID;},renameRosterItem:function(jid,_3c){if(!jid){throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");}if(!_3c){throw new Error("Roster::addRosterItemToGroup() New Name is null or undefined");}var _3d=this.session.getRosterIndex(jid);if(_3d==-1){return;}return this.updateRosterItem(jid,_3c,this.session.roster.groups,_3d);},removeRosterItem:function(jid){if(!jid){throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");}var req={id:this.session.getNextIqId(),from:this.session.jid+"/"+this.session.resource,type:"set"};var _40=new _6.string.Builder(_6.xmpp.util.createElement("iq",req,false));_40.append(_6.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},false));if(jid.indexOf("@")==-1){jid+=jid+"@"+this.session.domain;}_40.append(_6.xmpp.util.createElement("item",{jid:jid,subscription:"remove"},true));_40.append("</query></iq>");var def=this.session.dispatchPacket(_40.toString(),"iq",req.id);def.addCallback(this,"verifyRoster");return def;},getAvatar:function(jid){},publishAvatar:function(_43,_44){},onVerifyRoster:function(id){},onVerifyRosterFailed:function(err){}});}}};});