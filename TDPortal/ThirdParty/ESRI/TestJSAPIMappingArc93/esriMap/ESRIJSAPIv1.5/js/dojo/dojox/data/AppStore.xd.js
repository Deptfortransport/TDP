/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.AppStore"],["require","dojox.atom.io.Connection"],["require","dojo.data.util.simpleFetch"],["require","dojo.data.util.filter"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.AppStore"]){_4._hasResource["dojox.data.AppStore"]=true;_4.provide("dojox.data.AppStore");_4.require("dojox.atom.io.Connection");_4.require("dojo.data.util.simpleFetch");_4.require("dojo.data.util.filter");_4.experimental("dojox.data.AppStore");_4.declare("dojox.data.AppStore",null,{url:"",urlPreventCache:false,xmethod:false,_atomIO:null,_feed:null,_requests:null,_processing:null,_updates:null,_adds:null,_deletes:null,constructor:function(_7){if(_7&&_7.url){this.url=_7.url;}if(_7&&_7.urlPreventCache){this.urlPreventCache=_7.urlPreventCache;}if(!this.url){throw new Error("A URL is required to instantiate an APP Store object");}},_setFeed:function(_8,_9){this._feed=_8;var i;for(i=0;i<this._feed.entries.length;i++){this._feed.entries[i].store=this;}if(this._requests){for(i=0;i<this._requests.length;i++){var _b=this._requests[i];if(_b.request&&_b.fh&&_b.eh){this._finishFetchItems(_b.request,_b.fh,_b.eh);}else{if(_b.clear){this._feed=null;}else{if(_b.add){this._feed.addEntry(_b.add);}else{if(_b.remove){this._feed.removeEntry(_b.remove);}}}}}}this._requests=null;},_getAllItems:function(){var _c=[];for(var i=0;i<this._feed.entries.length;i++){_c.push(this._feed.entries[i]);}return _c;},_assertIsItem:function(_e){if(!this.isItem(_e)){throw new Error("This error message is provided when a function is called in the following form: "+"getAttribute(argument, attributeName).  The argument variable represents the member "+"or owner of the object. The error is created when an item that does not belong "+"to this store is specified as an argument.");}},_assertIsAttribute:function(_f){if(typeof _f!=="string"){throw new Error("The attribute argument must be a string. The error is created "+"when a different type of variable is specified such as an array or object.");}for(var key in _6.atom.io.model._actions){if(key==_f){return true;}}return false;},_addUpdate:function(_11){if(!this._updates){this._updates=[_11];}else{this._updates.push(_11);}},getValue:function(_12,_13,_14){var _15=this.getValues(_12,_13);return (_15.length>0)?_15[0]:_14;},getValues:function(_16,_17){this._assertIsItem(_16);var _18=this._assertIsAttribute(_17);if(_18){if((_17==="author"||_17==="contributor"||_17==="link")&&_16[_17+"s"]){return _16[_17+"s"];}if(_17==="category"&&_16.categories){return _16.categories;}if(_16[_17]){_16=_16[_17];if(_16.declaredClass=="dojox.atom.io.model.Content"){return [_16.value];}return [_16];}}return [];},getAttributes:function(_19){this._assertIsItem(_19);var _1a=[];for(var key in _6.atom.io.model._actions){if(this.hasAttribute(_19,key)){_1a.push(key);}}return _1a;},hasAttribute:function(_1c,_1d){return this.getValues(_1c,_1d).length>0;},containsValue:function(_1e,_1f,_20){var _21=undefined;if(typeof _20==="string"){_21=_4.data.util.filter.patternToRegExp(_20,false);}return this._containsValue(_1e,_1f,_20,_21);},_containsValue:function(_22,_23,_24,_25,_26){var _27=this.getValues(_22,_23);for(var i=0;i<_27.length;++i){var _29=_27[i];if(typeof _29==="string"&&_25){if(_26){_29=_29.replace(new RegExp(/^\s+/),"");_29=_29.replace(new RegExp(/\s+$/),"");}_29=_29.replace(/\r|\n|\r\n/g,"");return (_29.match(_25)!==null);}else{if(_24===_29){return true;}}}return false;},isItem:function(_2a){return _2a&&_2a.store&&_2a.store===this;},isItemLoaded:function(_2b){return this.isItem(_2b);},loadItem:function(_2c){this._assertIsItem(_2c.item);},_fetchItems:function(_2d,_2e,_2f){if(this._feed){this._finishFetchItems(_2d,_2e,_2f);}else{var _30=false;if(!this._requests){this._requests=[];_30=true;}this._requests.push({request:_2d,fh:_2e,eh:_2f});if(_30){this._atomIO=new _6.atom.io.Connection(false,this.urlPreventCache);this._atomIO.getFeed(this.url,this._setFeed,null,this);}}},_finishFetchItems:function(_31,_32,_33){var _34=null;var _35=this._getAllItems();if(_31.query){var _36=_31.queryOptions?_31.queryOptions.ignoreCase:false;_34=[];var _37={};var key;var _39;for(key in _31.query){_39=_31.query[key]+"";if(typeof _39==="string"){_37[key]=_4.data.util.filter.patternToRegExp(_39,_36);}}for(var i=0;i<_35.length;++i){var _3b=true;var _3c=_35[i];for(key in _31.query){_39=_31.query[key]+"";if(!this._containsValue(_3c,key,_39,_37[key],_31.trim)){_3b=false;}}if(_3b){_34.push(_3c);}}}else{if(_35.length>0){_34=_35.slice(0,_35.length);}}try{_32(_34,_31);}catch(e){_33(e,_31);}},getFeatures:function(){return {"dojo.data.api.Read":true,"dojo.data.api.Write":true,"dojo.data.api.Identity":true};},close:function(_3d){this._feed=null;},getLabel:function(_3e){if(this.isItem(_3e)){return this.getValue(_3e,"title","No Title");}return undefined;},getLabelAttributes:function(_3f){return ["title"];},getIdentity:function(_40){this._assertIsItem(_40);return this.getValue(_40,"id");},getIdentityAttributes:function(_41){return ["id"];},fetchItemByIdentity:function(_42){this._fetchItems({query:{id:_42.identity},onItem:_42.onItem,scope:_42.scope},function(_43,_44){var _45=_44.scope;if(!_45){_45=_4.global;}if(_43.length<1){_44.onItem.call(_45,null);}else{_44.onItem.call(_45,_43[0]);}},_42.onError);},newItem:function(_46){var _47=new _6.atom.io.model.Entry();var _48=null;var _49=null;var i;for(var key in _46){if(this._assertIsAttribute(key)){_48=_46[key];switch(key){case "link":for(i in _48){_49=_48[i];_47.addLink(_49.href,_49.rel,_49.hrefLang,_49.title,_49.type);}break;case "author":for(i in _48){_49=_48[i];_47.addAuthor(_49.name,_49.email,_49.uri);}break;case "contributor":for(i in _48){_49=_48[i];_47.addContributor(_49.name,_49.email,_49.uri);}break;case "category":for(i in _48){_49=_48[i];_47.addCategory(_49.scheme,_49.term,_49.label);}break;case "icon":case "id":case "logo":case "xmlBase":case "rights":_47[key]=_48;break;case "updated":case "published":case "issued":case "modified":_47[key]=_6.atom.io.model.util.createDate(_48);break;case "content":case "summary":case "title":case "subtitle":_47[key]=new _6.atom.io.model.Content(key);_47[key].value=_48;break;default:_47[key]=_48;break;}}}_47.store=this;_47.isDirty=true;if(!this._adds){this._adds=[_47];}else{this._adds.push(_47);}if(this._feed){this._feed.addEntry(_47);}else{if(this._requests){this._requests.push({add:_47});}else{this._requests=[{add:_47}];this._atomIO=new _6.atom.io.Connection(false,this.urlPreventCache);this._atomIO.getFeed(this.url,_4.hitch(this,this._setFeed));}}return true;},deleteItem:function(_4c){this._assertIsItem(_4c);if(!this._deletes){this._deletes=[_4c];}else{this._deletes.push(_4c);}if(this._feed){this._feed.removeEntry(_4c);}else{if(this._requests){this._requests.push({remove:_4c});}else{this._requests=[{remove:_4c}];this._atomIO=new _6.atom.io.Connection(false,this.urlPreventCache);this._atomIO.getFeed(this.url,_4.hitch(this,this._setFeed));}}_4c=null;return true;},setValue:function(_4d,_4e,_4f){this._assertIsItem(_4d);var _50={item:_4d};if(this._assertIsAttribute(_4e)){switch(_4e){case "link":_50.links=_4d.links;this._addUpdate(_50);_4d.links=null;_4d.addLink(_4f.href,_4f.rel,_4f.hrefLang,_4f.title,_4f.type);_4d.isDirty=true;return true;case "author":_50.authors=_4d.authors;this._addUpdate(_50);_4d.authors=null;_4d.addAuthor(_4f.name,_4f.email,_4f.uri);_4d.isDirty=true;return true;case "contributor":_50.contributors=_4d.contributors;this._addUpdate(_50);_4d.contributors=null;_4d.addContributor(_4f.name,_4f.email,_4f.uri);_4d.isDirty=true;return true;case "category":_50.categories=_4d.categories;this._addUpdate(_50);_4d.categories=null;_4d.addCategory(_4f.scheme,_4f.term,_4f.label);_4d.isDirty=true;return true;case "icon":case "id":case "logo":case "xmlBase":case "rights":_50[_4e]=_4d[_4e];this._addUpdate(_50);_4d[_4e]=_4f;_4d.isDirty=true;return true;case "updated":case "published":case "issued":case "modified":_50[_4e]=_4d[_4e];this._addUpdate(_50);_4d[_4e]=_6.atom.io.model.util.createDate(_4f);_4d.isDirty=true;return true;case "content":case "summary":case "title":case "subtitle":_50[_4e]=_4d[_4e];this._addUpdate(_50);_4d[_4e]=new _6.atom.io.model.Content(_4e);_4d[_4e].value=_4f;_4d.isDirty=true;return true;default:_50[_4e]=_4d[_4e];this._addUpdate(_50);_4d[_4e]=_4f;_4d.isDirty=true;return true;}}return false;},setValues:function(_51,_52,_53){if(_53.length===0){return this.unsetAttribute(_51,_52);}this._assertIsItem(_51);var _54={item:_51};var _55;var i;if(this._assertIsAttribute(_52)){switch(_52){case "link":_54.links=_51.links;_51.links=null;for(i in _53){_55=_53[i];_51.addLink(_55.href,_55.rel,_55.hrefLang,_55.title,_55.type);}_51.isDirty=true;return true;case "author":_54.authors=_51.authors;_51.authors=null;for(i in _53){_55=_53[i];_51.addAuthor(_55.name,_55.email,_55.uri);}_51.isDirty=true;return true;case "contributor":_54.contributors=_51.contributors;_51.contributors=null;for(i in _53){_55=_53[i];_51.addContributor(_55.name,_55.email,_55.uri);}_51.isDirty=true;return true;case "categories":_54.categories=_51.categories;_51.categories=null;for(i in _53){_55=_53[i];_51.addCategory(_55.scheme,_55.term,_55.label);}_51.isDirty=true;return true;case "icon":case "id":case "logo":case "xmlBase":case "rights":_54[_52]=_51[_52];_51[_52]=_53[0];_51.isDirty=true;return true;case "updated":case "published":case "issued":case "modified":_54[_52]=_51[_52];_51[_52]=_6.atom.io.model.util.createDate(_53[0]);_51.isDirty=true;return true;case "content":case "summary":case "title":case "subtitle":_54[_52]=_51[_52];_51[_52]=new _6.atom.io.model.Content(_52);_51[_52].values[0]=_53[0];_51.isDirty=true;return true;default:_54[_52]=_51[_52];_51[_52]=_53[0];_51.isDirty=true;return true;}}this._addUpdate(_54);return false;},unsetAttribute:function(_57,_58){this._assertIsItem(_57);if(this._assertIsAttribute(_58)){if(_57[_58]!==null){var _59={item:_57};switch(_58){case "author":case "contributor":case "link":_59[_58+"s"]=_57[_58+"s"];break;case "category":_59.categories=_57.categories;break;default:_59[_58]=_57[_58];break;}_57.isDirty=true;_57[_58]=null;this._addUpdate(_59);return true;}}return false;},save:function(_5a){var i;for(i in this._adds){this._atomIO.addEntry(this._adds[i],null,function(){},_5a.onError,false,_5a.scope);}this._adds=null;for(i in this._updates){this._atomIO.updateEntry(this._updates[i].item,function(){},_5a.onError,false,this.xmethod,_5a.scope);}this._updates=null;for(i in this._deletes){this._atomIO.removeEntry(this._deletes[i],function(){},_5a.onError,this.xmethod,_5a.scope);}this._deletes=null;this._atomIO.getFeed(this.url,_4.hitch(this,this._setFeed));if(_5a.onComplete){var _5c=_5a.scope||_4.global;_5a.onComplete.call(_5c);}},revert:function(){var i;for(i in this._adds){this._feed.removeEntry(this._adds[i]);}this._adds=null;var _5e,_5f,key;for(i in this._updates){_5e=this._updates[i];_5f=_5e.item;for(key in _5e){if(key!=="item"){_5f[key]=_5e[key];}}}this._updates=null;for(i in this._deletes){this._feed.addEntry(this._deletes[i]);}this._deletes=null;return true;},isDirty:function(_61){if(_61){this._assertIsItem(_61);return _61.isDirty?true:false;}return (this._adds!==null||this._updates!==null);}});_4.extend(_6.data.AppStore,_4.data.util.simpleFetch);}}};});