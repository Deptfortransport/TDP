/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.off.files"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.off.files"]){_4._hasResource["dojox.off.files"]=true;_4.provide("dojox.off.files");_6.off.files={versionURL:"version.js",listOfURLs:[],refreshing:false,_cancelID:null,_error:false,_errorMessages:[],_currentFileIndex:0,_store:null,_doSlurp:false,slurp:function(){this._doSlurp=true;},cache:function(_7){if(_4.isString(_7)){var _8=this._trimAnchor(_7+"");if(!this.isAvailable(_8)){this.listOfURLs.push(_8);}}else{if(_7 instanceof _4._Url){var _8=this._trimAnchor(_7.uri);if(!this.isAvailable(_8)){this.listOfURLs.push(_8);}}else{_4.forEach(_7,function(_9){_9=this._trimAnchor(_9);if(!this.isAvailable(_9)){this.listOfURLs.push(_9);}},this);}}},printURLs:function(){console.debug("The following URLs are cached for offline use:");_4.forEach(this.listOfURLs,function(i){console.debug(i);});},remove:function(_b){for(var i=0;i<this.listOfURLs.length;i++){if(this.listOfURLs[i]==_b){this.listOfURLs=this.listOfURLs.splice(i,1);break;}}},isAvailable:function(_d){for(var i=0;i<this.listOfURLs.length;i++){if(this.listOfURLs[i]==_d){return true;}}return false;},refresh:function(_f){try{if(_4.config.isDebug){this.printURLs();}this.refreshing=true;if(this.versionURL){this._getVersionInfo(function(_10,_11,_12){if(_4.config.isDebug||!_11||_12||!_10||_10!=_11){console.warn("Refreshing offline file list");this._doRefresh(_f,_11);}else{console.warn("No need to refresh offline file list");_f(false,[]);}});}else{console.warn("Refreshing offline file list");this._doRefresh(_f);}}catch(e){this.refreshing=false;_6.off.coreOpFailed=true;_6.off.enabled=false;_6.off.onFrameworkEvent("coreOperationFailed");}},abortRefresh:function(){if(!this.refreshing){return;}this._store.abortCapture(this._cancelID);this.refreshing=false;},_slurp:function(){if(!this._doSlurp){return;}var _13=_4.hitch(this,function(url){if(this._sameLocation(url)){this.cache(url);}});_13(window.location.href);_4.query("script").forEach(function(i){try{_13(i.getAttribute("src"));}catch(exp){}});_4.query("link").forEach(function(i){try{if(!i.getAttribute("rel")||i.getAttribute("rel").toLowerCase()!="stylesheet"){return;}_13(i.getAttribute("href"));}catch(exp){}});_4.query("img").forEach(function(i){try{_13(i.getAttribute("src"));}catch(exp){}});_4.query("a").forEach(function(i){try{_13(i.getAttribute("href"));}catch(exp){}});_4.forEach(document.styleSheets,function(_19){try{if(_19.cssRules){_4.forEach(_19.cssRules,function(_1a){var _1b=_1a.cssText;if(_1b){var _1c=_1b.match(/url\(\s*([^\) ]*)\s*\)/i);if(!_1c){return;}for(var i=1;i<_1c.length;i++){_13(_1c[i]);}}});}else{if(_19.cssText){var _1e;var _1f=_19.cssText.toString();var _20=_1f.split(/\f|\r|\n/);for(var i=0;i<_20.length;i++){_1e=_20[i].match(/url\(\s*([^\) ]*)\s*\)/i);if(_1e&&_1e.length){_13(_1e[1]);}}}}}catch(exp){}});},_sameLocation:function(url){if(!url){return false;}if(url.length&&url.charAt(0)=="#"){return false;}url=new _4._Url(url);if(!url.scheme&&!url.port&&!url.host){return true;}if(!url.scheme&&url.host&&url.port&&window.location.hostname==url.host&&window.location.port==url.port){return true;}if(!url.scheme&&url.host&&!url.port&&window.location.hostname==url.host&&window.location.port==80){return true;}return window.location.protocol==(url.scheme+":")&&window.location.hostname==url.host&&(window.location.port==url.port||!window.location.port&&!url.port);},_trimAnchor:function(url){return url.replace(/\#.*$/,"");},_doRefresh:function(_24,_25){var _26;try{_26=google.gears.factory.create("beta.localserver","1.0");}catch(exp){_4.setObject("google.gears.denied",true);_6.off.onFrameworkEvent("coreOperationFailed");throw "Google Gears must be allowed to run";}var _27="dot_store_"+window.location.href.replace(/[^0-9A-Za-z_]/g,"_");if(_27.length>=64){_27=_27.substring(0,63);}_26.removeStore(_27);_26.openStore(_27);var _28=_26.createStore(_27);this._store=_28;var _29=this;this._currentFileIndex=0;this._cancelID=_28.capture(this.listOfURLs,function(url,_2b,_2c){if(!_2b&&_29.refreshing){_29._cancelID=null;_29.refreshing=false;var _2d=[];_2d.push("Unable to capture: "+url);_24(true,_2d);return;}else{if(_2b){_29._currentFileIndex++;}}if(_2b&&_29._currentFileIndex>=_29.listOfURLs.length){_29._cancelID=null;_29.refreshing=false;if(_25){_6.storage.put("oldVersion",_25,null,_6.off.STORAGE_NAMESPACE);}_6.storage.put("justDebugged",_4.config.isDebug,null,_6.off.STORAGE_NAMESPACE);_24(false,[]);}});},_getVersionInfo:function(_2e){var _2f=_6.storage.get("justDebugged",_6.off.STORAGE_NAMESPACE);var _30=_6.storage.get("oldVersion",_6.off.STORAGE_NAMESPACE);var _31=null;_2e=_4.hitch(this,_2e);_4.xhrGet({url:this.versionURL+"?browserbust="+new Date().getTime(),timeout:5*1000,handleAs:"javascript",error:function(err){_6.storage.remove("oldVersion",_6.off.STORAGE_NAMESPACE);_6.storage.remove("justDebugged",_6.off.STORAGE_NAMESPACE);_2e(_30,_31,_2f);},load:function(_33){if(_33){_31=_33;}_2e(_30,_31,_2f);}});}};}}};});