/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid._Scroller"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid._Scroller"]){_4._hasResource["dojox.grid._Scroller"]=true;_4.provide("dojox.grid._Scroller");(function(){var _7=function(_8){var i=0,n,p=_8.parentNode;while((n=p.childNodes[i++])){if(n==_8){return i-1;}}return -1;};var _c=function(_d){if(!_d){return;}var _e=function(_f){return _f.domNode&&_4.isDescendant(_f.domNode,_d,true);};var ws=_5.registry.filter(_e);for(var i=0,w;(w=ws[i]);i++){w.destroy();}delete ws;};var _13=function(_14){var _15=_4.byId(_14);return (_15&&_15.tagName?_15.tagName.toLowerCase():"");};var _16=function(_17,_18){var _19=[];var i=0,n;while((n=_17.childNodes[i++])){if(_13(n)==_18){_19.push(n);}}return _19;};var _1c=function(_1d){return _16(_1d,"div");};_4.declare("dojox.grid._Scroller",null,{constructor:function(_1e){this.setContentNodes(_1e);this.pageHeights=[];this.pageNodes=[];this.stack=[];},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(_1f,_20,_21){switch(arguments.length){case 3:this.rowsPerPage=_21;case 2:this.keepRows=_20;case 1:this.rowCount=_1f;}this.defaultPageHeight=this.defaultRowHeight*this.rowsPerPage;this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);this.setKeepInfo(this.keepRows);this.invalidate();if(this.scrollboxNode){this.scrollboxNode.scrollTop=0;this.scroll(0);this.scrollboxNode.onscroll=_4.hitch(this,"onscroll");}},_getPageCount:function(_22,_23){return _22?(Math.ceil(_22/_23)||1):0;},destroy:function(){this.invalidateNodes();delete this.contentNodes;delete this.contentNode;delete this.scrollboxNode;},setKeepInfo:function(_24){this.keepRows=_24;this.keepPages=!this.keepRows?this.keepRows:Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2);},setContentNodes:function(_25){this.contentNodes=_25;this.colCount=(this.contentNodes?this.contentNodes.length:0);this.pageNodes=[];for(var i=0;i<this.colCount;i++){this.pageNodes[i]=[];}},getDefaultNodes:function(){return this.pageNodes[0]||[];},invalidate:function(){this.invalidateNodes();this.pageHeights=[];this.height=(this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0);this.resize();},updateRowCount:function(_27){this.invalidateNodes();this.rowCount=_27;var _28=this.pageCount;if(_28===0){this.height=1;}this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);if(this.pageCount<_28){for(var i=_28-1;i>=this.pageCount;i--){this.height-=this.getPageHeight(i);delete this.pageHeights[i];}}else{if(this.pageCount>_28){this.height+=this.defaultPageHeight*(this.pageCount-_28-1)+this.calcLastPageHeight();}}this.resize();},pageExists:function(_2a){return Boolean(this.getDefaultPageNode(_2a));},measurePage:function(_2b){var n=this.getDefaultPageNode(_2b);return (n&&n.innerHTML)?n.offsetHeight:0;},positionPage:function(_2d,_2e){for(var i=0;i<this.colCount;i++){this.pageNodes[i][_2d].style.top=_2e+"px";}},repositionPages:function(_30){var _31=this.getDefaultNodes();var _32=0;for(var i=0;i<this.stack.length;i++){_32=Math.max(this.stack[i],_32);}var n=_31[_30];var y=(n?this.getPageNodePosition(n)+this.getPageHeight(_30):0);for(var p=_30+1;p<=_32;p++){n=_31[p];if(n){if(this.getPageNodePosition(n)==y){return;}this.positionPage(p,y);}y+=this.getPageHeight(p);}},installPage:function(_37){for(var i=0;i<this.colCount;i++){this.contentNodes[i].appendChild(this.pageNodes[i][_37]);}},preparePage:function(_39,_3a){var p=(_3a?this.popPage():null);for(var i=0;i<this.colCount;i++){var _3d=this.pageNodes[i];var _3e=(p===null?this.createPageNode():this.invalidatePageNode(p,_3d));_3e.pageIndex=_39;_3e.id=(this._pageIdPrefix||"")+"page-"+_39;_3d[_39]=_3e;}},renderPage:function(_3f){var _40=[];for(var i=0;i<this.colCount;i++){_40[i]=this.pageNodes[i][_3f];}for(var i=0,j=_3f*this.rowsPerPage;(i<this.rowsPerPage)&&(j<this.rowCount);i++,j++){this.renderRow(j,_40);}},removePage:function(_43){for(var i=0,j=_43*this.rowsPerPage;i<this.rowsPerPage;i++,j++){this.removeRow(j);}},destroyPage:function(_46){for(var i=0;i<this.colCount;i++){var n=this.invalidatePageNode(_46,this.pageNodes[i]);if(n){_4.destroy(n);}}},pacify:function(_49){},pacifying:false,pacifyTicks:200,setPacifying:function(_4a){if(this.pacifying!=_4a){this.pacifying=_4a;this.pacify(this.pacifying);}},startPacify:function(){this.startPacifyTicks=new Date().getTime();},doPacify:function(){var _4b=(new Date().getTime()-this.startPacifyTicks)>this.pacifyTicks;this.setPacifying(true);this.startPacify();return _4b;},endPacify:function(){this.setPacifying(false);},resize:function(){if(this.scrollboxNode){this.windowHeight=this.scrollboxNode.clientHeight;}for(var i=0;i<this.colCount;i++){_6.grid.util.setStyleHeightPx(this.contentNodes[i],Math.max(1,this.height));}this.needPage(this.page,this.pageTop);var _4d=(this.page<this.pageCount-1)?this.rowsPerPage:((this.rowCount%this.rowsPerPage)||this.rowsPerPage);var _4e=this.getPageHeight(this.page);this.averageRowHeight=(_4e>0&&_4d>0)?(_4e/_4d):0;},calcLastPageHeight:function(){if(!this.pageCount){return 0;}var _4f=this.pageCount-1;var _50=((this.rowCount%this.rowsPerPage)||(this.rowsPerPage))*this.defaultRowHeight;this.pageHeights[_4f]=_50;return _50;},updateContentHeight:function(_51){this.height+=_51;this.resize();},updatePageHeight:function(_52){if(this.pageExists(_52)){var oh=this.getPageHeight(_52);var h=(this.measurePage(_52))||(oh);this.pageHeights[_52]=h;if((h)&&(oh!=h)){this.updateContentHeight(h-oh);this.repositionPages(_52);}}},rowHeightChanged:function(_55){this.updatePageHeight(Math.floor(_55/this.rowsPerPage));},invalidateNodes:function(){while(this.stack.length){this.destroyPage(this.popPage());}},createPageNode:function(){var p=document.createElement("div");_4.attr(p,"role","presentation");p.style.position="absolute";p.style[_4._isBodyLtr()?"left":"right"]="0";return p;},getPageHeight:function(_57){var ph=this.pageHeights[_57];return (ph!==undefined?ph:this.defaultPageHeight);},pushPage:function(_59){return this.stack.push(_59);},popPage:function(){return this.stack.shift();},findPage:function(_5a){var i=0,h=0;for(var ph=0;i<this.pageCount;i++,h+=ph){ph=this.getPageHeight(i);if(h+ph>=_5a){break;}}this.page=i;this.pageTop=h;},buildPage:function(_5e,_5f,_60){this.preparePage(_5e,_5f);this.positionPage(_5e,_60);this.installPage(_5e);this.renderPage(_5e);this.pushPage(_5e);},needPage:function(_61,_62){var h=this.getPageHeight(_61),oh=h;if(!this.pageExists(_61)){this.buildPage(_61,this.keepPages&&(this.stack.length>=this.keepPages),_62);h=this.measurePage(_61)||h;this.pageHeights[_61]=h;if(h&&(oh!=h)){this.updateContentHeight(h-oh);}}else{this.positionPage(_61,_62);}return h;},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop);},scroll:function(_65){this.grid.scrollTop=_65;if(this.colCount){this.startPacify();this.findPage(_65);var h=this.height;var b=this.getScrollBottom(_65);for(var p=this.page,y=this.pageTop;(p<this.pageCount)&&((b<0)||(y<b));p++){y+=this.needPage(p,y);}this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,_65);this.lastVisibleRow=this.getLastVisibleRow(p-1,y,b);if(h!=this.height){this.repositionPages(p-1);}this.endPacify();}},getScrollBottom:function(_6a){return (this.windowHeight>=0?_6a+this.windowHeight:-1);},processNodeEvent:function(e,_6c){var t=e.target;while(t&&(t!=_6c)&&t.parentNode&&(t.parentNode.parentNode!=_6c)){t=t.parentNode;}if(!t||!t.parentNode||(t.parentNode.parentNode!=_6c)){return false;}var _6e=t.parentNode;e.topRowIndex=_6e.pageIndex*this.rowsPerPage;e.rowIndex=e.topRowIndex+_7(t);e.rowTarget=t;return true;},processEvent:function(e){return this.processNodeEvent(e,this.contentNode);},renderRow:function(_70,_71){},removeRow:function(_72){},getDefaultPageNode:function(_73){return this.getDefaultNodes()[_73];},positionPageNode:function(_74,_75){},getPageNodePosition:function(_76){return _76.offsetTop;},invalidatePageNode:function(_77,_78){var p=_78[_77];if(p){delete _78[_77];this.removePage(_77,p);_c(p);p.innerHTML="";}return p;},getPageRow:function(_7a){return _7a*this.rowsPerPage;},getLastPageRow:function(_7b){return Math.min(this.rowCount,this.getPageRow(_7b+1))-1;},getFirstVisibleRow:function(_7c,_7d,_7e){if(!this.pageExists(_7c)){return 0;}var row=this.getPageRow(_7c);var _80=this.getDefaultNodes();var _81=_1c(_80[_7c]);for(var i=0,l=_81.length;i<l&&_7d<_7e;i++,row++){_7d+=_81[i].offsetHeight;}return (row?row-1:row);},getLastVisibleRow:function(_84,_85,_86){if(!this.pageExists(_84)){return 0;}var _87=this.getDefaultNodes();var row=this.getLastPageRow(_84);var _89=_1c(_87[_84]);for(var i=_89.length-1;i>=0&&_85>_86;i--,row--){_85-=_89[i].offsetHeight;}return row+1;},findTopRow:function(_8b){var _8c=this.getDefaultNodes();var _8d=_1c(_8c[this.page]);for(var i=0,l=_8d.length,t=this.pageTop,h;i<l;i++){h=_8d[i].offsetHeight;t+=h;if(t>=_8b){this.offset=h-(t-_8b);return i+this.page*this.rowsPerPage;}}return -1;},findScrollTop:function(_92){var _93=Math.floor(_92/this.rowsPerPage);var t=0;for(var i=0;i<_93;i++){t+=this.getPageHeight(i);}this.pageTop=t;this.needPage(_93,this.pageTop);var _96=this.getDefaultNodes();var _97=_1c(_96[_93]);var r=_92-this.rowsPerPage*_93;for(var i=0,l=_97.length;i<l&&i<r;i++){t+=_97[i].offsetHeight;}return t;},dummy:0});})();}}};});