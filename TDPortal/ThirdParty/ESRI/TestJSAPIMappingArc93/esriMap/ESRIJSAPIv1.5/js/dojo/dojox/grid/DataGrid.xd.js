/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid.DataGrid"],["require","dojox.grid._Grid"],["require","dojox.grid.DataSelection"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid.DataGrid"]){_4._hasResource["dojox.grid.DataGrid"]=true;_4.provide("dojox.grid.DataGrid");_4.require("dojox.grid._Grid");_4.require("dojox.grid.DataSelection");_4.declare("dojox.grid.DataGrid",_6.grid._Grid,{store:null,query:null,queryOptions:null,fetchText:"...",items:null,_store_connects:null,_by_idty:null,_by_idx:null,_cache:null,_pages:null,_pending_requests:null,_bop:-1,_eop:-1,_requests:0,rowCount:0,_isLoaded:false,_isLoading:false,postCreate:function(){this._pages=[];this._store_connects=[];this._by_idty={};this._by_idx=[];this._cache=[];this._pending_requests={};this._setStore(this.store);this.inherited(arguments);},createSelection:function(){this.selection=new _6.grid.DataSelection(this);},get:function(_7,_8){return (!_8?this.defaultValue:(!this.field?this.value:this.grid.store.getValue(_8,this.field)));},_onSet:function(_9,_a,_b,_c){var _d=this.getItemIndex(_9);if(_d>-1){this.updateRow(_d);}},_addItem:function(_e,_f,_10){var _11=this._hasIdentity?this.store.getIdentity(_e):_4.toJson(this.query)+":idx:"+_f+":sort:"+_4.toJson(this.getSortProps());var o={idty:_11,item:_e};this._by_idty[_11]=this._by_idx[_f]=o;if(!_10){this.updateRow(_f);}},_onNew:function(_13,_14){var _15=this.attr("rowCount");this._addingItem=true;this.updateRowCount(_15+1);this._addingItem=false;this._addItem(_13,_15);this.showMessage();},_onDelete:function(_16){var idx=this._getItemIndex(_16,true);if(idx>=0){var o=this._by_idx[idx];this._by_idx.splice(idx,1);delete this._by_idty[o.idty];this.updateRowCount(this.attr("rowCount")-1);if(this.attr("rowCount")===0){this.showMessage(this.noDataMessage);}}},_onRevert:function(){this._refresh();},setStore:function(_19,_1a,_1b){this._setQuery(_1a,_1b);this._setStore(_19);this._refresh(true);},setQuery:function(_1c,_1d){this._setQuery(_1c,_1d);this._refresh(true);},setItems:function(_1e){this.items=_1e;this._setStore(this.store);this._refresh(true);},_setQuery:function(_1f,_20){this.query=_1f;this.queryOptions=_20||this.queryOptions;},_setStore:function(_21){if(this.store&&this._store_connects){_4.forEach(this._store_connects,function(arr){_4.forEach(arr,_4.disconnect);});}this.store=_21;if(this.store){var f=this.store.getFeatures();var h=[];this._canEdit=!!f["dojo.data.api.Write"]&&!!f["dojo.data.api.Identity"];this._hasIdentity=!!f["dojo.data.api.Identity"];if(!!f["dojo.data.api.Notification"]&&!this.items){h.push(this.connect(this.store,"onSet","_onSet"));h.push(this.connect(this.store,"onNew","_onNew"));h.push(this.connect(this.store,"onDelete","_onDelete"));}if(this._canEdit){h.push(this.connect(this.store,"revert","_onRevert"));}this._store_connects=h;}},_onFetchBegin:function(_25,req){if(this.rowCount!=_25){if(req.isRender){this.scroller.init(_25,this.keepRows,this.rowsPerPage);this.rowCount=_25;this._setAutoHeightAttr(this.autoHeight,true);this.prerender();}else{this.updateRowCount(_25);}}},_onFetchComplete:function(_27,req){if(_27&&_27.length>0){_4.forEach(_27,function(_29,idx){this._addItem(_29,req.start+idx,true);},this);this.updateRows(req.start,_27.length);if(req.isRender){this.setScrollTop(0);this.postrender();}else{if(this._lastScrollTop){this.setScrollTop(this._lastScrollTop);}}}delete this._lastScrollTop;if(!this._isLoaded){this._isLoading=false;this._isLoaded=true;if(!_27||!_27.length){this.showMessage(this.noDataMessage);this.focus.initFocusView();}else{this.showMessage();}}this._pending_requests[req.start]=false;},_onFetchError:function(err,req){console.log(err);delete this._lastScrollTop;if(!this._isLoaded){this._isLoading=false;this._isLoaded=true;this.showMessage(this.errorMessage);}this.onFetchError(err,req);},onFetchError:function(err,req){},_fetch:function(_2f,_30){var _2f=_2f||0;if(this.store&&!this._pending_requests[_2f]){if(!this._isLoaded&&!this._isLoading){this._isLoading=true;this.showMessage(this.loadingMessage);}this._pending_requests[_2f]=true;try{if(this.items){var _31=this.items;var _32=this.store;this.rowsPerPage=_31.length;var req={start:_2f,count:this.rowsPerPage,isRender:_30};this._onFetchBegin(_31.length,req);var _34=0;_4.forEach(_31,function(i){if(!_32.isItemLoaded(i)){_34++;}});if(_34===0){this._onFetchComplete(_31,req);}else{var _36=function(_37){_34--;if(_34===0){this._onFetchComplete(_31,req);}};_4.forEach(_31,function(i){if(!_32.isItemLoaded(i)){_32.loadItem({item:i,onItem:_36,scope:this});}},this);}}else{this.store.fetch({start:_2f,count:this.rowsPerPage,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,isRender:_30,onBegin:_4.hitch(this,"_onFetchBegin"),onComplete:_4.hitch(this,"_onFetchComplete"),onError:_4.hitch(this,"_onFetchError")});}}catch(e){this._onFetchError(e);}}},_clearData:function(){this.updateRowCount(0);this._by_idty={};this._by_idx=[];this._pages=[];this._bop=this._eop=-1;this._isLoaded=false;this._isLoading=false;},getItem:function(idx){var _3a=this._by_idx[idx];if(!_3a||(_3a&&!_3a.item)){this._preparePage(idx);return null;}return _3a.item;},getItemIndex:function(_3b){return this._getItemIndex(_3b,false);},_getItemIndex:function(_3c,_3d){if(!_3d&&!this.store.isItem(_3c)){return -1;}var _3e=this._hasIdentity?this.store.getIdentity(_3c):null;for(var i=0,l=this._by_idx.length;i<l;i++){var d=this._by_idx[i];if(d&&((_3e&&d.idty==_3e)||(d.item===_3c))){return i;}}return -1;},filter:function(_42,_43){this.query=_42;if(_43){this._clearData();}this._fetch();},_getItemAttr:function(idx,_45){var _46=this.getItem(idx);return (!_46?this.fetchText:this.store.getValue(_46,_45));},_render:function(){if(this.domNode.parentNode){this.scroller.init(this.attr("rowCount"),this.keepRows,this.rowsPerPage);this.prerender();this._fetch(0,true);}},_requestsPending:function(_47){return this._pending_requests[_47];},_rowToPage:function(_48){return (this.rowsPerPage?Math.floor(_48/this.rowsPerPage):_48);},_pageToRow:function(_49){return (this.rowsPerPage?this.rowsPerPage*_49:_49);},_preparePage:function(_4a){if((_4a<this._bop||_4a>=this._eop)&&!this._addingItem){var _4b=this._rowToPage(_4a);this._needPage(_4b);this._bop=_4b*this.rowsPerPage;this._eop=this._bop+(this.rowsPerPage||this.attr("rowCount"));}},_needPage:function(_4c){if(!this._pages[_4c]){this._pages[_4c]=true;this._requestPage(_4c);}},_requestPage:function(_4d){var row=this._pageToRow(_4d);var _4f=Math.min(this.rowsPerPage,this.attr("rowCount")-row);if(_4f>0){this._requests++;if(!this._requestsPending(row)){setTimeout(_4.hitch(this,"_fetch",row,false),1);}}},getCellName:function(_50){return _50.field;},_refresh:function(_51){this._clearData();this._fetch(0,_51);},sort:function(){this._lastScrollTop=this.scrollTop;this._refresh();},canSort:function(){return (!this._isLoading);},getSortProps:function(){var c=this.getCell(this.getSortIndex());if(!c){return null;}else{var _53=c["sortDesc"];var si=!(this.sortInfo>0);if(typeof _53=="undefined"){_53=si;}else{_53=si?!_53:_53;}return [{attribute:c.field,descending:_53}];}},styleRowState:function(_55){if(this.store&&this.store.getState){var _56=this.store.getState(_55.index),c="";for(var i=0,ss=["inflight","error","inserting"],s;s=ss[i];i++){if(_56[s]){c=" dojoxGridRow-"+s;break;}}_55.customClasses+=c;}},onStyleRow:function(_5b){this.styleRowState(_5b);this.inherited(arguments);},canEdit:function(_5c,_5d){return this._canEdit;},_copyAttr:function(idx,_5f){var row={};var _61={};var src=this.getItem(idx);return this.store.getValue(src,_5f);},doStartEdit:function(_63,_64){if(!this._cache[_64]){this._cache[_64]=this._copyAttr(_64,_63.field);}this.onStartEdit(_63,_64);},doApplyCellEdit:function(_65,_66,_67){this.store.fetchItemByIdentity({identity:this._by_idx[_66].idty,onItem:_4.hitch(this,function(_68){var _69=this.store.getValue(_68,_67);if(typeof _69=="number"){_65=isNaN(_65)?_65:parseFloat(_65);}else{if(typeof _69=="boolean"){_65=_65=="true"?true:_65=="false"?false:_65;}else{if(_69 instanceof Date){var _6a=new Date(_65);_65=isNaN(_6a.getTime())?_65:_6a;}}}this.store.setValue(_68,_67,_65);this.onApplyCellEdit(_65,_66,_67);})});},doCancelEdit:function(_6b){var _6c=this._cache[_6b];if(_6c){this.updateRow(_6b);delete this._cache[_6b];}this.onCancelEdit.apply(this,arguments);},doApplyEdit:function(_6d,_6e){var _6f=this._cache[_6d];this.onApplyEdit(_6d);},removeSelectedRows:function(){if(this._canEdit){this.edit.apply();var _70=this.selection.getSelected();if(_70.length){_4.forEach(_70,this.store.deleteItem,this.store);this.selection.clear();}}}});_6.grid.DataGrid.markupFactory=function(_71,_72,_73,_74){return _6.grid._Grid.markupFactory(_71,_72,_73,function(_75,_76){var _77=_4.trim(_4.attr(_75,"field")||"");if(_77){_76.field=_77;}_76.field=_76.field||_76.name;if(_74){_74(_75,_76);}});};}}};});