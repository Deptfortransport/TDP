/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.json.ref"],["require","dojo.date.stamp"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.json.ref"]){_4._hasResource["dojox.json.ref"]=true;_4.provide("dojox.json.ref");_4.require("dojo.date.stamp");_6.json.ref={resolveJson:function(_7,_8){_8=_8||{};var _9=_8.idAttribute||"id";var _a=_8.idPrefix||"";var _b=_8.assignAbsoluteIds;var _c=_8.index||{};var _d=_8.timeStamps;var _e,_f=[];var _10=/^(.*\/)?(\w+:\/\/)|[^\/\.]+\/\.\.\/|^.*\/(\/)/;var _11=this._addProp;var F=function(){};function _13(it,_15,_16,_17,_18){var _19,val,id=_9 in it?it[_9]:_16;if(id!==undefined){id=(_a+id).replace(_10,"$2$3");}var _1c=_18||it;if(id!==undefined){if(_b){it.__id=id;}if(_8.schemas&&(!(it instanceof Array))&&(val=id.match(/^(.+\/)[^\.\[]*$/))){_17=_8.schemas[val[1]];}if(_c[id]&&((it instanceof Array)==(_c[id] instanceof Array))){_1c=_c[id];delete _1c.$ref;_19=true;}else{var _1d=_17&&_17.prototype;if(_1d){F.prototype=_1d;_1c=new F();}}_c[id]=_1c;if(_d){_d[id]=_8.time;}}var _1e=_17&&_17.properties;var _1f=it.length;for(var i in it){if(i==_1f){break;}if(it.hasOwnProperty(i)){val=it[i];var _21=_1e&&_1e[i];if(_21&&_21.format=="date-time"&&typeof val=="string"){val=_4.date.stamp.fromISOString(val);}else{if((typeof val=="object")&&val&&!(val instanceof Date)){_e=val.$ref;if(_e){delete it[i];var _22=_e.replace(/(#)([^\.\[])/,"$1.$2").match(/(^([^\[]*\/)?[^#\.\[]*)#?([\.\[].*)?/);if((_e=(_22[1]=="$"||_22[1]=="this"||_22[1]=="")?_7:_c[(_a+_22[1]).replace(_10,"$2$3")])){if(_22[3]){_22[3].replace(/(\[([^\]]+)\])|(\.?([^\.\[]+))/g,function(t,a,b,c,d){_e=_e&&_e[b?b.replace(/[\"\'\\]/,""):d];});}}if(_e){val=_e;}else{if(!_15){var _28;if(!_28){_f.push(_1c);}_28=true;}else{val=_13(val,false,val.$ref,_21);val._loadObject=_8.loader;}}}else{if(!_15){val=_13(val,_f==it,id&&_11(id,i),_21,_1c!=it&&typeof _1c[i]=="object"&&_1c[i]);}}}}it[i]=val;if(_1c!=it&&!_1c.__isDirty){var old=_1c[i];_1c[i]=val;if(_19&&val!==old&&!_1c._loadObject&&!(val instanceof Date&&old instanceof Date&&val.getTime()==old.getTime())&&!(typeof val=="function"&&typeof old=="function"&&val.toString()==old.toString())&&_c.onUpdate){_c.onUpdate(_1c,i,old,val);}}}}if(_19){for(i in _1c){if(!_1c.__isDirty&&_1c.hasOwnProperty(i)&&!it.hasOwnProperty(i)&&i!="__id"&&i!="__clientId"&&!(_1c instanceof Array&&isNaN(i))){if(_c.onUpdate&&i!="_loadObject"&&i!="_idAttr"){_c.onUpdate(_1c,i,_1c[i],undefined);}delete _1c[i];while(_1c instanceof Array&&_1c.length&&_1c[_1c.length-1]===undefined){_1c.length--;}}}}else{if(_c.onLoad){_c.onLoad(_1c);}}return _1c;};if(_7&&typeof _7=="object"){_7=_13(_7,false,_8.defaultId);_13(_f,false);}return _7;},fromJson:function(str,_2b){function ref(_2d){return {$ref:_2d};};try{var _2e=eval("("+str+")");}catch(e){throw new SyntaxError("Invalid JSON string: "+e.message+" parsing: "+str);}if(_2e){return this.resolveJson(_2e,_2b);}return _2e;},toJson:function(it,_30,_31,_32){var _33=this._useRefs;var _34=this._addProp;_31=_31||"";var _35={};var _36={};function _37(it,_39,_3a){if(typeof it=="object"&&it){var _3b;if(it instanceof Date){return "\""+_4.date.stamp.toISOString(it,{zulu:true})+"\"";}var id=it.__id;if(id){if(_39!="#"&&((_33&&!id.match(/#/))||_35[id])){var ref=id;if(id.charAt(0)!="#"){if(it.__clientId==id){ref="cid:"+id;}else{if(id.substring(0,_31.length)==_31){ref=id.substring(_31.length);}else{ref=id;}}}return _37({$ref:ref},"#");}_39=id;}else{it.__id=_39;_36[_39]=it;}_35[_39]=it;_3a=_3a||"";var _3e=_30?_3a+_4.toJsonIndentStr:"";var _3f=_30?"\n":"";var sep=_30?" ":"";if(it instanceof Array){var res=_4.map(it,function(obj,i){var val=_37(obj,_34(_39,i),_3e);if(typeof val!="string"){val="undefined";}return _3f+_3e+val;});return "["+res.join(","+sep)+_3f+_3a+"]";}var _45=[];for(var i in it){if(it.hasOwnProperty(i)){var _47;if(typeof i=="number"){_47="\""+i+"\"";}else{if(typeof i=="string"&&(i.charAt(0)!="_"||i.charAt(1)!="_")){_47=_4._escapeString(i);}else{continue;}}var val=_37(it[i],_34(_39,i),_3e);if(typeof val!="string"){continue;}_45.push(_3f+_3e+_47+":"+sep+val);}}return "{"+_45.join(","+sep)+_3f+_3a+"}";}else{if(typeof it=="function"&&_6.json.ref.serializeFunctions){return it.toString();}}return _4.toJson(it);};var _49=_37(it,"#","");if(!_32){for(var i in _36){delete _36[i].__id;}}return _49;},_addProp:function(id,_4c){return id+(id.match(/#/)?id.length==1?"":".":"#")+_4c;},_useRefs:false,serializeFunctions:false};}}};});