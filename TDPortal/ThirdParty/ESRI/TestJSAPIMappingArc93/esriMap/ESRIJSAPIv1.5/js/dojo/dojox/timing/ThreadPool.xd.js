/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.timing.ThreadPool"],["require","dojox.timing"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.timing.ThreadPool"]){_4._hasResource["dojox.timing.ThreadPool"]=true;_4.provide("dojox.timing.ThreadPool");_4.require("dojox.timing");_4.experimental("dojox.timing.ThreadPool");(function(){var t=_6.timing;t.threadStates={UNSTARTED:"unstarted",STOPPED:"stopped",PENDING:"pending",RUNNING:"running",SUSPENDED:"suspended",WAITING:"waiting",COMPLETE:"complete",ERROR:"error"};t.threadPriorities={LOWEST:1,BELOWNORMAL:2,NORMAL:3,ABOVENORMAL:4,HIGHEST:5};t.Thread=function(fn,_9){var _a=this;this.state=t.threadStates.UNSTARTED;this.priority=_9||t.threadPriorities.NORMAL;this.lastError=null;this.func=fn;this.invoke=function(){_a.state=t.threadStates.RUNNING;try{fn(this);_a.state=t.threadStates.COMPLETE;}catch(e){_a.lastError=e;_a.state=t.threadStates.ERROR;}};};t.ThreadPool=new (function(_b,_c){var _d=this;var _e=_b;var _f=_e;var _10=_c;var _11=Math.floor((_10/2)/_e);var _12=[];var _13=new Array(_e+1);var _14=new _6.timing.Timer();var _15=function(){var _16=_13[0]={};for(var i=0;i<_13.length;i++){window.clearTimeout(_13[i]);var _18=_12.shift();if(typeof (_18)=="undefined"){break;}_16["thread-"+i]=_18;_13[i]=window.setTimeout(_18.invoke,(_11*i));}_f=_e-(i-1);};this.getMaxThreads=function(){return _e;};this.getAvailableThreads=function(){return _f;};this.getTickInterval=function(){return _10;};this.queueUserWorkItem=function(fn){var _1a=fn;if(_1a instanceof Function){_1a=new t.Thread(_1a);}var idx=_12.length;for(var i=0;i<_12.length;i++){if(_12[i].priority<_1a.priority){idx=i;break;}}if(idx<_12.length){_12.splice(idx,0,_1a);}else{_12.push(_1a);}return true;};this.removeQueuedUserWorkItem=function(_1d){if(_1d instanceof Function){var idx=-1;for(var i=0;i<_12.length;i++){if(_12[i].func==_1d){idx=i;break;}}if(idx>-1){_12.splice(idx,1);return true;}return false;}var idx=-1;for(var i=0;i<_12.length;i++){if(_12[i]==_1d){idx=i;break;}}if(idx>-1){_12.splice(idx,1);return true;}return false;};this.start=function(){_14.start();};this.stop=function(){_14.stop();};this.abort=function(){this.stop();for(var i=1;i<_13.length;i++){if(_13[i]){window.clearTimeout(_13[i]);}}for(var _21 in _13[0]){this.queueUserWorkItem(_21);}_13[0]={};};this.reset=function(){this.abort();_12=[];};this.sleep=function(_22){_14.stop();window.setTimeout(_14.start,_22);};_14.onTick=_d.invoke;})(16,5000);})();}}};});