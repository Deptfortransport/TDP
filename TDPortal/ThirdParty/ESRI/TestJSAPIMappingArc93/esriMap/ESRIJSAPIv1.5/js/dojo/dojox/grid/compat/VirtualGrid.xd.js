/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid.compat.VirtualGrid"],["require","dojox.grid.compat._grid.lib"],["require","dojox.grid.compat._grid.scroller"],["require","dojox.grid.compat._grid.view"],["require","dojox.grid.compat._grid.views"],["require","dojox.grid.compat._grid.layout"],["require","dojox.grid.compat._grid.rows"],["require","dojox.grid.compat._grid.focus"],["require","dojox.grid.compat._grid.selection"],["require","dojox.grid.compat._grid.edit"],["require","dojox.grid.compat._grid.rowbar"],["require","dojox.grid.compat._grid.publicEvents"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid.compat.VirtualGrid"]){_4._hasResource["dojox.grid.compat.VirtualGrid"]=true;_4.provide("dojox.grid.compat.VirtualGrid");_4.require("dojox.grid.compat._grid.lib");_4.require("dojox.grid.compat._grid.scroller");_4.require("dojox.grid.compat._grid.view");_4.require("dojox.grid.compat._grid.views");_4.require("dojox.grid.compat._grid.layout");_4.require("dojox.grid.compat._grid.rows");_4.require("dojox.grid.compat._grid.focus");_4.require("dojox.grid.compat._grid.selection");_4.require("dojox.grid.compat._grid.edit");_4.require("dojox.grid.compat._grid.rowbar");_4.require("dojox.grid.compat._grid.publicEvents");_4.declare("dojox.VirtualGrid",[_5._Widget,_5._Templated],{templateString:"<div class=\"dojoxGrid\" hidefocus=\"hidefocus\" role=\"wairole:grid\">\r\n\t<div class=\"dojoxGrid-master-header\" dojoAttachPoint=\"viewsHeaderNode\"></div>\r\n\t<div class=\"dojoxGrid-master-view\" dojoAttachPoint=\"viewsNode\"></div>\r\n\t<span dojoAttachPoint=\"lastFocusNode\" tabindex=\"0\"></span>\r\n</div>\r\n",classTag:"dojoxGrid",get:function(_7){},rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:false,autoHeight:false,autoRender:true,defaultHeight:"15em",structure:"",elasticView:-1,singleClickEdit:false,_click:null,sortInfo:0,themeable:true,buildRendering:function(){this.inherited(arguments);if(this.get==_6.VirtualGrid.prototype.get){this.get=null;}if(!this.domNode.getAttribute("tabIndex")){this.domNode.tabIndex="0";}this.createScroller();this.createLayout();this.createViews();this.createManagers();_6.grid.initTextSizePoll();this.connect(_6.grid,"textSizeChanged","textSizeChanged");_6.grid.funnelEvents(this.domNode,this,"doKeyEvent",_6.grid.keyEvents);this.connect(this,"onShow","renderOnIdle");},postCreate:function(){this.styleChanged=this._styleChanged;this.setStructure(this.structure);this._click=[];},destroy:function(){this.domNode.onReveal=null;this.domNode.onSizeChange=null;this.edit.destroy();this.views.destroyViews();this.inherited(arguments);},styleChanged:function(){this.setStyledClass(this.domNode,"");},_styleChanged:function(){this.styleChanged();this.update();},textSizeChanged:function(){setTimeout(_4.hitch(this,"_textSizeChanged"),1);},_textSizeChanged:function(){if(this.domNode){this.views.forEach(function(v){v.content.update();});this.render();}},sizeChange:function(){_6.grid.jobs.job(this.id+"SizeChange",50,_4.hitch(this,"update"));},renderOnIdle:function(){setTimeout(_4.hitch(this,"render"),1);},createManagers:function(){this.rows=new _6.grid.rows(this);this.focus=new _6.grid.focus(this);this.selection=new _6.grid.selection(this);this.edit=new _6.grid.edit(this);},createScroller:function(){this.scroller=new _6.grid.scroller.columns();this.scroller._pageIdPrefix=this.id+"-";this.scroller.renderRow=_4.hitch(this,"renderRow");this.scroller.removeRow=_4.hitch(this,"rowRemoved");},createLayout:function(){this.layout=new _6.grid.layout(this);},createViews:function(){this.views=new _6.grid.views(this);this.views.createView=_4.hitch(this,"createView");},createView:function(_9){if(_4.isAIR){var _a=window;var _b=_9.split(".");for(var i=0;i<_b.length;i++){if(typeof _a[_b[i]]=="undefined"){var _d=_b[0];for(var j=1;j<=i;j++){_d+="."+_b[j];}throw new Error(_d+" is undefined");}_a=_a[_b[i]];}var c=_a;}else{var c=eval(_9);}var _10=new c({grid:this});this.viewsNode.appendChild(_10.domNode);this.viewsHeaderNode.appendChild(_10.headerNode);this.views.addView(_10);return _10;},buildViews:function(){for(var i=0,vs;(vs=this.layout.structure[i]);i++){this.createView(vs.type||_6._scopeName+".GridView").setStructure(vs);}this.scroller.setContentNodes(this.views.getContentNodes());},setStructure:function(_13){this.views.destroyViews();this.structure=_13;if((this.structure)&&(_4.isString(this.structure))){this.structure=_6.grid.getProp(this.structure);}if(!this.structure){this.structure=window["layout"];}if(!this.structure){return;}this.layout.setStructure(this.structure);this._structureChanged();},_structureChanged:function(){this.buildViews();if(this.autoRender){this.render();}},hasLayout:function(){return this.layout.cells.length;},resize:function(_14){this._sizeBox=_14;this._resize();this.sizeChange();},_getPadBorder:function(){this._padBorder=this._padBorder||_4._getPadBorderExtents(this.domNode);return this._padBorder;},_resize:function(){if(!this.domNode.parentNode||this.domNode.parentNode.nodeType!=1||!this.hasLayout()){return;}var _15=this._getPadBorder();if(this.autoHeight){this.domNode.style.height="auto";this.viewsNode.style.height="";}else{if(this.flex>0){}else{if(this.domNode.clientHeight<=_15.h){if(this.domNode.parentNode==document.body){this.domNode.style.height=this.defaultHeight;}else{this.fitTo="parent";}}}}if(this._sizeBox){_4.contentBox(this.domNode,this._sizeBox);}else{if(this.fitTo=="parent"){var h=_4._getContentBox(this.domNode.parentNode).h;_4.marginBox(this.domNode,{h:Math.max(0,h)});}}var h=_4._getContentBox(this.domNode).h;if(h==0&&!this.autoHeight){this.viewsHeaderNode.style.display="none";}else{this.viewsHeaderNode.style.display="block";}this.adaptWidth();this.adaptHeight();this.scroller.defaultRowHeight=this.rows.getDefaultHeightPx()+1;this.postresize();},adaptWidth:function(){var w=this.autoWidth?0:this.domNode.clientWidth||(this.domNode.offsetWidth-this._getPadBorder().w);var vw=this.views.arrange(1,w);this.views.onEach("adaptWidth");if(this.autoWidth){this.domNode.style.width=vw+"px";}},adaptHeight:function(){var vns=this.viewsHeaderNode.style,t=vns.display=="none"?0:this.views.measureHeader();vns.height=t+"px";this.views.normalizeHeaderNodeHeight();var h=(this.autoHeight?-1:Math.max(this.domNode.clientHeight-t,0)||0);this.views.onEach("setSize",[0,h]);this.views.onEach("adaptHeight");this.scroller.windowHeight=h;},render:function(){if(!this.domNode){return;}if(!this.hasLayout()){this.scroller.init(0,this.keepRows,this.rowsPerPage);return;}this.update=this.defaultUpdate;this.scroller.init(this.rowCount,this.keepRows,this.rowsPerPage);this.prerender();this.setScrollTop(0);this.postrender();},prerender:function(){this.keepRows=this.autoHeight?0:this.constructor.prototype.keepRows;this.scroller.setKeepInfo(this.keepRows);this.views.render();this._resize();},postrender:function(){this.postresize();this.focus.initFocusView();_4.setSelectable(this.domNode,false);},postresize:function(){if(this.autoHeight){this.viewsNode.style.height=this.views.measureContent()+"px";}},renderRow:function(_1c,_1d){this.views.renderRow(_1c,_1d);},rowRemoved:function(_1e){this.views.rowRemoved(_1e);},invalidated:null,updating:false,beginUpdate:function(){if(this.invalidated==null){this.invalidated={rows:[],count:1,all:false,rowCount:undefined};}else{this.invalidated.count++;}this.updating=true;},endUpdate:function(){var i=this.invalidated;if(--i.count===0){this.updating=false;if(i.rows.length>0){for(var r in i.rows){this.updateRow(Number(r));}this.invalidated.rows=[];}if(i.rowCount!=undefined){this.updateRowCount(i.rowCount);i.rowCount=undefined;}if(i.all){this.update();i.all=false;}}},defaultUpdate:function(){if(!this.domNode){return;}if(this.updating){this.invalidated.all=true;return;}this.prerender();this.scroller.invalidateNodes();this.setScrollTop(this.scrollTop);this.postrender();},update:function(){this.render();},updateRow:function(_21){_21=Number(_21);if(this.updating){this.invalidated.rows[_21]=true;}else{this.views.updateRow(_21,this.rows.getHeight(_21));this.scroller.rowHeightChanged(_21);}},updateRowCount:function(_22){if(this.updating){this.invalidated.rowCount=_22;}else{this.rowCount=_22;if(this.layout.cells.length){this.scroller.updateRowCount(_22);this.setScrollTop(this.scrollTop);}this._resize();}},updateRowStyles:function(_23){this.views.updateRowStyles(_23);},rowHeightChanged:function(_24){this.views.renormalizeRow(_24);this.scroller.rowHeightChanged(_24);},fastScroll:true,delayScroll:false,scrollRedrawThreshold:(_4.isIE?100:50),scrollTo:function(_25){if(!this.fastScroll){this.setScrollTop(_25);return;}var _26=Math.abs(this.lastScrollTop-_25);this.lastScrollTop=_25;if(_26>this.scrollRedrawThreshold||this.delayScroll){this.delayScroll=true;this.scrollTop=_25;this.views.setScrollTop(_25);_6.grid.jobs.job("dojoxGrid-scroll",200,_4.hitch(this,"finishScrollJob"));}else{this.setScrollTop(_25);}},finishScrollJob:function(){this.delayScroll=false;this.setScrollTop(this.scrollTop);},setScrollTop:function(_27){this.scrollTop=this.views.setScrollTop(_27);this.scroller.scroll(this.scrollTop);},scrollToRow:function(_28){this.setScrollTop(this.scroller.findScrollTop(_28)+1);},styleRowNode:function(_29,_2a){if(_2a){this.rows.styleRowNode(_29,_2a);}},getCell:function(_2b){return this.layout.cells[_2b];},setCellWidth:function(_2c,_2d){this.getCell(_2c).unitWidth=_2d;},getCellName:function(_2e){return "Cell "+_2e.index;},canSort:function(_2f){},sort:function(){},getSortAsc:function(_30){_30=_30==undefined?this.sortInfo:_30;return Boolean(_30>0);},getSortIndex:function(_31){_31=_31==undefined?this.sortInfo:_31;return Math.abs(_31)-1;},setSortIndex:function(_32,_33){var si=_32+1;if(_33!=undefined){si*=(_33?1:-1);}else{if(this.getSortIndex()==_32){si=-this.sortInfo;}}this.setSortInfo(si);},setSortInfo:function(_35){if(this.canSort(_35)){this.sortInfo=_35;this.sort();this.update();}},doKeyEvent:function(e){e.dispatch="do"+e.type;this.onKeyEvent(e);},_dispatch:function(m,e){if(m in this){return this[m](e);}},dispatchKeyEvent:function(e){this._dispatch(e.dispatch,e);},dispatchContentEvent:function(e){this.edit.dispatchEvent(e)||e.sourceView.dispatchContentEvent(e)||this._dispatch(e.dispatch,e);},dispatchHeaderEvent:function(e){e.sourceView.dispatchHeaderEvent(e)||this._dispatch("doheader"+e.type,e);},dokeydown:function(e){this.onKeyDown(e);},doclick:function(e){if(e.cellNode){this.onCellClick(e);}else{this.onRowClick(e);}},dodblclick:function(e){if(e.cellNode){this.onCellDblClick(e);}else{this.onRowDblClick(e);}},docontextmenu:function(e){if(e.cellNode){this.onCellContextMenu(e);}else{this.onRowContextMenu(e);}},doheaderclick:function(e){if(e.cellNode){this.onHeaderCellClick(e);}else{this.onHeaderClick(e);}},doheaderdblclick:function(e){if(e.cellNode){this.onHeaderCellDblClick(e);}else{this.onHeaderDblClick(e);}},doheadercontextmenu:function(e){if(e.cellNode){this.onHeaderCellContextMenu(e);}else{this.onHeaderContextMenu(e);}},doStartEdit:function(_43,_44){this.onStartEdit(_43,_44);},doApplyCellEdit:function(_45,_46,_47){this.onApplyCellEdit(_45,_46,_47);},doCancelEdit:function(_48){this.onCancelEdit(_48);},doApplyEdit:function(_49){this.onApplyEdit(_49);},addRow:function(){this.updateRowCount(this.rowCount+1);},removeSelectedRows:function(){this.updateRowCount(Math.max(0,this.rowCount-this.selection.getSelected().length));this.selection.clear();}});_4.mixin(_6.VirtualGrid.prototype,_6.grid.publicEvents);}}};});