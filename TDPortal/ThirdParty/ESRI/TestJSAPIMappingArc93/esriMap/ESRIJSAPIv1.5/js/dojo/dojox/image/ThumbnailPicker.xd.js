/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.image.ThumbnailPicker"],["require","dojox.fx.scroll"],["require","dojo.fx.easing"],["require","dojo.fx"],["require","dijit._Widget"],["require","dijit._Templated"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.image.ThumbnailPicker"]){_4._hasResource["dojox.image.ThumbnailPicker"]=true;_4.provide("dojox.image.ThumbnailPicker");_4.experimental("dojox.image.ThumbnailPicker");_4.require("dojox.fx.scroll");_4.require("dojo.fx.easing");_4.require("dojo.fx");_4.require("dijit._Widget");_4.require("dijit._Templated");_4.declare("dojox.image.ThumbnailPicker",[_5._Widget,_5._Templated],{imageStore:null,request:null,size:500,thumbHeight:75,thumbWidth:100,useLoadNotifier:false,useHyperlink:false,hyperlinkTarget:"new",isClickable:true,isScrollable:true,isHorizontal:true,autoLoad:true,linkAttr:"link",imageThumbAttr:"imageUrlThumb",imageLargeAttr:"imageUrl",pageSize:20,titleAttr:"title",templateString:"<div dojoAttachPoint=\"outerNode\" class=\"thumbOuter\">\r\n\t<div dojoAttachPoint=\"navPrev\" class=\"thumbNav thumbClickable\">\r\n\t  <img src=\"\" dojoAttachPoint=\"navPrevImg\"/>    \r\n\t</div>\r\n\t<div dojoAttachPoint=\"thumbScroller\" class=\"thumbScroller\">\r\n\t  <div dojoAttachPoint=\"thumbsNode\" class=\"thumbWrapper\"></div>\r\n\t</div>\r\n\t<div dojoAttachPoint=\"navNext\" class=\"thumbNav thumbClickable\">\r\n\t  <img src=\"\" dojoAttachPoint=\"navNextImg\"/>  \r\n\t</div>\r\n</div>\r\n",_thumbs:[],_thumbIndex:0,_maxPhotos:0,_loadedImages:{},postCreate:function(){this.widgetid=this.id;this.inherited(arguments);this.pageSize=Number(this.pageSize);this._scrollerSize=this.size-(51*2);var _7=this._sizeProperty=this.isHorizontal?"width":"height";_4.style(this.outerNode,"textAlign","center");_4.style(this.outerNode,_7,this.size+"px");_4.style(this.thumbScroller,_7,this._scrollerSize+"px");if(this.useHyperlink){_4.subscribe(this.getClickTopicName(),this,function(_8){var _9=_8.index;var _a=this.imageStore.getValue(_8.data,this.linkAttr);if(!_a){return;}if(this.hyperlinkTarget=="new"){window.open(_a);}else{window.location=_a;}});}if(this.isClickable){_4.addClass(this.thumbsNode,"thumbClickable");}this._totalSize=0;this.init();},init:function(){if(this.isInitialized){return false;}var _b=this.isHorizontal?"Horiz":"Vert";_4.addClass(this.navPrev,"prev"+_b);_4.addClass(this.navNext,"next"+_b);_4.addClass(this.thumbsNode,"thumb"+_b);_4.addClass(this.outerNode,"thumb"+_b);this.navNextImg.setAttribute("src",this._blankGif);this.navPrevImg.setAttribute("src",this._blankGif);this.connect(this.navPrev,"onclick","_prev");this.connect(this.navNext,"onclick","_next");this.isInitialized=true;if(this.isHorizontal){this._offsetAttr="offsetLeft";this._sizeAttr="offsetWidth";this._scrollAttr="scrollLeft";}else{this._offsetAttr="offsetTop";this._sizeAttr="offsetHeight";this._scrollAttr="scrollTop";}this._updateNavControls();if(this.imageStore&&this.request){this._loadNextPage();}return true;},getClickTopicName:function(){return (this.widgetId||this.id)+"/select";},getShowTopicName:function(){return (this.widgetId||this.id)+"/show";},setDataStore:function(_c,_d,_e){this.reset();this.request={query:{},start:_d.start||0,count:_d.count||10,onBegin:_4.hitch(this,function(_f){this._maxPhotos=_f;})};if(_d.query){_4.mixin(this.request.query,_d.query);}if(_e){_4.forEach(["imageThumbAttr","imageLargeAttr","linkAttr","titleAttr"],function(_10){if(_e[_10]){this[_10]=_e[_10];}},this);}this.request.start=0;this.request.count=this.pageSize;this.imageStore=_c;if(!this.init()){this._loadNextPage();}},reset:function(){this._loadedImages={};_4.forEach(this._thumbs,function(img){if(img){if(img.parentNode){img.parentNode.removeChild(img);}}});this._thumbs=[];this.isInitialized=false;this._noImages=true;},isVisible:function(_12){var img=this._thumbs[_12];if(!img){return false;}var pos=this.isHorizontal?"offsetLeft":"offsetTop";var _15=this.isHorizontal?"offsetWidth":"offsetHeight";var _16=this.isHorizontal?"scrollLeft":"scrollTop";var _17=img[pos]-this.thumbsNode[pos];return (_17>=this.thumbScroller[_16]&&_17+img[_15]<=this.thumbScroller[_16]+this._scrollerSize);},_next:function(){var pos=this.isHorizontal?"offsetLeft":"offsetTop";var _19=this.isHorizontal?"offsetWidth":"offsetHeight";var _1a=this.thumbsNode[pos];var _1b=this._thumbs[this._thumbIndex];var _1c=_1b[pos]-_1a;var _1d=-1,img;for(var i=this._thumbIndex+1;i<this._thumbs.length;i++){img=this._thumbs[i];if(img[pos]-_1a+img[_19]-_1c>this._scrollerSize){this._showThumbs(i);return;}}},_prev:function(){if(this.thumbScroller[this.isHorizontal?"scrollLeft":"scrollTop"]==0){return;}var pos=this.isHorizontal?"offsetLeft":"offsetTop";var _21=this.isHorizontal?"offsetWidth":"offsetHeight";var _22=this._thumbs[this._thumbIndex];var _23=_22[pos]-this.thumbsNode[pos];var _24=-1,img;for(var i=this._thumbIndex-1;i>-1;i--){img=this._thumbs[i];if(_23-img[pos]>this._scrollerSize){this._showThumbs(i+1);return;}}this._showThumbs(0);},_checkLoad:function(img,_28){_4.publish(this.getShowTopicName(),[{index:_28}]);this._updateNavControls();this._loadingImages={};this._thumbIndex=_28;if(this.thumbsNode.offsetWidth-img.offsetLeft<(this._scrollerSize*2)){this._loadNextPage();}},_showThumbs:function(_29){_29=Math.min(Math.max(_29,0),this._maxPhotos);if(_29>=this._maxPhotos){return;}var img=this._thumbs[_29];if(!img){return;}var _2b=img.offsetLeft-this.thumbsNode.offsetLeft;var top=img.offsetTop-this.thumbsNode.offsetTop;var _2d=this.isHorizontal?_2b:top;if((_2d>=this.thumbScroller[this._scrollAttr])&&(_2d+img[this._sizeAttr]<=this.thumbScroller[this._scrollAttr]+this._scrollerSize)){return;}if(this.isScrollable){var _2e=this.isHorizontal?{x:_2b,y:0}:{x:0,y:top};_6.fx.smoothScroll({target:_2e,win:this.thumbScroller,duration:300,easing:_4.fx.easing.easeOut,onEnd:_4.hitch(this,"_checkLoad",img,_29)}).play(10);}else{if(this.isHorizontal){this.thumbScroller.scrollLeft=_2b;}else{this.thumbScroller.scrollTop=top;}this._checkLoad(img,_29);}},markImageLoaded:function(_2f){var _30=_4.byId("loadingDiv_"+this.widgetid+"_"+_2f);if(_30){this._setThumbClass(_30,"thumbLoaded");}this._loadedImages[_2f]=true;},_setThumbClass:function(_31,_32){if(!this.autoLoad){return;}_4.addClass(_31,_32);},_loadNextPage:function(){if(this._loadInProgress){return;}this._loadInProgress=true;var _33=this.request.start+(this._noImages?0:this.pageSize);var pos=_33;while(pos<this._thumbs.length&&this._thumbs[pos]){pos++;}var _35=function(_36,_37){if(_36&&_36.length){var _38=0;var _39=_4.hitch(this,function(){if(_38>=_36.length){this._loadInProgress=false;return;}var _3a=_38++;this._loadImage(_36[_3a],pos+_3a,_39);});_39();this._updateNavControls();}else{this._loadInProgress=false;}};var _3b=function(){this._loadInProgress=false;console.debug("Error getting items");};this.request.onComplete=_4.hitch(this,_35);this.request.onError=_4.hitch(this,_3b);this.request.start=_33;this._noImages=false;this.imageStore.fetch(this.request);},_loadImage:function(_3c,_3d,_3e){var url=this.imageStore.getValue(_3c,this.imageThumbAttr);var img=document.createElement("img");var _41=document.createElement("div");_41.setAttribute("id","img_"+this.widgetid+"_"+_3d);_41.appendChild(img);img._index=_3d;img._data=_3c;this._thumbs[_3d]=_41;var _42;if(this.useLoadNotifier){_42=document.createElement("div");_42.setAttribute("id","loadingDiv_"+this.widgetid+"_"+_3d);this._setThumbClass(_42,this._loadedImages[_3d]?"thumbLoaded":"thumbNotifier");_41.appendChild(_42);}var _43=_4.marginBox(this.thumbsNode);var _44;var _45;if(this.isHorizontal){_44=this.thumbWidth;_45="w";}else{_44=this.thumbHeight;_45="h";}_43=_43[_45];var sl=this.thumbScroller.scrollLeft,st=this.thumbScroller.scrollTop;_4.style(this.thumbsNode,this._sizeProperty,(_43+_44+20)+"px");this.thumbScroller.scrollLeft=sl;this.thumbScroller.scrollTop=st;this.thumbsNode.appendChild(_41);_4.connect(img,"onload",this,function(){var _48=_4.marginBox(img)[_45];this._totalSize+=(Number(_48)+4);_4.style(this.thumbsNode,this._sizeProperty,this._totalSize+"px");if(this.useLoadNotifier){_4.style(_42,"width",(img.width-4)+"px");}_4.style(_41,"width",img.width+"px");_3e();return false;});_4.connect(img,"onclick",this,function(evt){_4.publish(this.getClickTopicName(),[{index:evt.target._index,data:evt.target._data,url:img.getAttribute("src"),largeUrl:this.imageStore.getValue(_3c,this.imageLargeAttr),title:this.imageStore.getValue(_3c,this.titleAttr),link:this.imageStore.getValue(_3c,this.linkAttr)}]);return false;});_4.addClass(img,"imageGalleryThumb");img.setAttribute("src",url);var _4a=this.imageStore.getValue(_3c,this.titleAttr);if(_4a){img.setAttribute("title",_4a);}this._updateNavControls();},_updateNavControls:function(){var _4b=[];var _4c=function(_4d,add){var fn=add?"addClass":"removeClass";_4[fn](_4d,"enabled");_4[fn](_4d,"thumbClickable");};var pos=this.isHorizontal?"scrollLeft":"scrollTop";var _51=this.isHorizontal?"offsetWidth":"offsetHeight";_4c(this.navPrev,(this.thumbScroller[pos]>0));var _52=this._thumbs[this._thumbs.length-1];var _53=(this.thumbScroller[pos]+this._scrollerSize<this.thumbsNode[_51]);_4c(this.navNext,_53);}});}}};});