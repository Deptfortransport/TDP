/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.storage.AirFileStorageProvider"],["require","dojox.storage.manager"],["require","dojox.storage.Provider"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.storage.AirFileStorageProvider"]){_4._hasResource["dojox.storage.AirFileStorageProvider"]=true;_4.provide("dojox.storage.AirFileStorageProvider");_4.require("dojox.storage.manager");_4.require("dojox.storage.Provider");if(_4.isAIR){(function(){if(!_7){var _7={};}_7.File=window.runtime.flash.filesystem.File;_7.FileStream=window.runtime.flash.filesystem.FileStream;_7.FileMode=window.runtime.flash.filesystem.FileMode;_4.declare("dojox.storage.AirFileStorageProvider",[_6.storage.Provider],{initialized:false,_storagePath:"__DOJO_STORAGE/",initialize:function(){this.initialized=false;try{var _8=_7.File.applicationStorageDirectory.resolvePath(this._storagePath);if(!_8.exists){_8.createDirectory();}this.initialized=true;}catch(e){console.debug("dojox.storage.AirFileStorageProvider.initialize:",e);}_6.storage.manager.loaded();},isAvailable:function(){return true;},put:function(_9,_a,_b,_c){if(this.isValidKey(_9)==false){throw new Error("Invalid key given: "+_9);}_c=_c||this.DEFAULT_NAMESPACE;if(this.isValidKey(_c)==false){throw new Error("Invalid namespace given: "+_c);}try{this.remove(_9,_c);var _d=_7.File.applicationStorageDirectory.resolvePath(this._storagePath+_c);if(!_d.exists){_d.createDirectory();}var _e=_d.resolvePath(_9);var _f=new _7.FileStream();_f.open(_e,_7.FileMode.WRITE);_f.writeObject(_a);_f.close();}catch(e){console.debug("dojox.storage.AirFileStorageProvider.put:",e);_b(this.FAILED,_9,e.toString(),_c);return;}if(_b){_b(this.SUCCESS,_9,null,_c);}},get:function(key,_11){if(this.isValidKey(key)==false){throw new Error("Invalid key given: "+key);}_11=_11||this.DEFAULT_NAMESPACE;var _12=null;var _13=_7.File.applicationStorageDirectory.resolvePath(this._storagePath+_11+"/"+key);if(_13.exists&&!_13.isDirectory){var _14=new _7.FileStream();_14.open(_13,_7.FileMode.READ);_12=_14.readObject();_14.close();}return _12;},getNamespaces:function(){var _15=[this.DEFAULT_NAMESPACE];var dir=_7.File.applicationStorageDirectory.resolvePath(this._storagePath);var _17=dir.getDirectoryListing(),i;for(i=0;i<_17.length;i++){if(_17[i].isDirectory&&_17[i].name!=this.DEFAULT_NAMESPACE){_15.push(_17[i].name);}}return _15;},getKeys:function(_19){_19=_19||this.DEFAULT_NAMESPACE;if(this.isValidKey(_19)==false){throw new Error("Invalid namespace given: "+_19);}var _1a=[];var dir=_7.File.applicationStorageDirectory.resolvePath(this._storagePath+_19);if(dir.exists&&dir.isDirectory){var _1c=dir.getDirectoryListing(),i;for(i=0;i<_1c.length;i++){_1a.push(_1c[i].name);}}return _1a;},clear:function(_1e){if(this.isValidKey(_1e)==false){throw new Error("Invalid namespace given: "+_1e);}var dir=_7.File.applicationStorageDirectory.resolvePath(this._storagePath+_1e);if(dir.exists&&dir.isDirectory){dir.deleteDirectory(true);}},remove:function(key,_21){_21=_21||this.DEFAULT_NAMESPACE;var _22=_7.File.applicationStorageDirectory.resolvePath(this._storagePath+_21+"/"+key);if(_22.exists&&!_22.isDirectory){_22.deleteFile();}},putMultiple:function(_23,_24,_25,_26){if(this.isValidKeyArray(_23)===false||!_24 instanceof Array||_23.length!=_24.length){throw new Error("Invalid arguments: keys = ["+_23+"], values = ["+_24+"]");}if(_26==null||typeof _26=="undefined"){_26=this.DEFAULT_NAMESPACE;}if(this.isValidKey(_26)==false){throw new Error("Invalid namespace given: "+_26);}this._statusHandler=_25;try{for(var i=0;i<_23.length;i++){this.put(_23[i],_24[i],null,_26);}}catch(e){console.debug("dojox.storage.AirFileStorageProvider.putMultiple:",e);if(_25){_25(this.FAILED,_23,e.toString(),_26);}return;}if(_25){_25(this.SUCCESS,_23,null,_26);}},getMultiple:function(_28,_29){if(this.isValidKeyArray(_28)===false){throw new Error("Invalid key array given: "+_28);}if(_29==null||typeof _29=="undefined"){_29=this.DEFAULT_NAMESPACE;}if(this.isValidKey(_29)==false){throw new Error("Invalid namespace given: "+_29);}var _2a=[];for(var i=0;i<_28.length;i++){_2a[i]=this.get(_28[i],_29);}return _2a;},removeMultiple:function(_2c,_2d){_2d=_2d||this.DEFAULT_NAMESPACE;for(var i=0;i<_2c.length;i++){this.remove(_2c[i],_2d);}},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}});_6.storage.manager.register("dojox.storage.AirFileStorageProvider",new _6.storage.AirFileStorageProvider());_6.storage.manager.initialize();})();}}}};});