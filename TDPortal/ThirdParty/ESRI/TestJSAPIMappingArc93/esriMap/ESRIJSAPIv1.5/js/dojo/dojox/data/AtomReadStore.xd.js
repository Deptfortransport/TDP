/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.AtomReadStore"],["require","dojo.data.util.simpleFetch"],["require","dojo.data.util.filter"],["require","dojo.date.stamp"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.AtomReadStore"]){_4._hasResource["dojox.data.AtomReadStore"]=true;_4.provide("dojox.data.AtomReadStore");_4.require("dojo.data.util.simpleFetch");_4.require("dojo.data.util.filter");_4.require("dojo.date.stamp");_4.experimental("dojox.data.AtomReadStore");_4.declare("dojox.data.AtomReadStore",null,{constructor:function(_7){if(_7){this.url=_7.url;this.rewriteUrl=_7.rewriteUrl;this.label=_7.label||this.label;this.sendQuery=(_7.sendQuery||_7.sendquery||this.sendQuery);this.unescapeHTML=_7.unescapeHTML;}if(!this.url){throw new Error("AtomReadStore: a URL must be specified when creating the data store");}},url:"",label:"title",sendQuery:false,unescapeHTML:false,getValue:function(_8,_9,_a){this._assertIsItem(_8);this._assertIsAttribute(_9);this._initItem(_8);_9=_9.toLowerCase();if(!_8._attribs[_9]&&!_8._parsed){this._parseItem(_8);_8._parsed=true;}var _b=_8._attribs[_9];if(!_b&&_9=="summary"){var _c=this.getValue(_8,"content");var _d=new RegExp("/(<([^>]+)>)/g","i");var _e=_c.text.replace(_d,"");_b={text:_e.substring(0,Math.min(400,_e.length)),type:"text"};_8._attribs[_9]=_b;}if(_b&&this.unescapeHTML){if((_9=="content"||_9=="summary"||_9=="subtitle")&&!_8["_"+_9+"Escaped"]){_b.text=this._unescapeHTML(_b.text);_8["_"+_9+"Escaped"]=true;}}return _b?_4.isArray(_b)?_b[0]:_b:_a;},getValues:function(_f,_10){this._assertIsItem(_f);this._assertIsAttribute(_10);this._initItem(_f);_10=_10.toLowerCase();if(!_f._attribs[_10]){this._parseItem(_f);}var _11=_f._attribs[_10];return _11?((_11.length!==undefined&&typeof (_11)!=="string")?_11:[_11]):undefined;},getAttributes:function(_12){this._assertIsItem(_12);if(!_12._attribs){this._initItem(_12);this._parseItem(_12);}var _13=[];for(var x in _12._attribs){_13.push(x);}return _13;},hasAttribute:function(_15,_16){return (this.getValue(_15,_16)!==undefined);},containsValue:function(_17,_18,_19){var _1a=this.getValues(_17,_18);for(var i=0;i<_1a.length;i++){if((typeof _19==="string")){if(_1a[i].toString&&_1a[i].toString()===_19){return true;}}else{if(_1a[i]===_19){return true;}}}return false;},isItem:function(_1c){if(_1c&&_1c.element&&_1c.store&&_1c.store===this){return true;}return false;},isItemLoaded:function(_1d){return this.isItem(_1d);},loadItem:function(_1e){},getFeatures:function(){var _1f={"dojo.data.api.Read":true};return _1f;},getLabel:function(_20){if((this.label!=="")&&this.isItem(_20)){var _21=this.getValue(_20,this.label);if(_21&&_21.text){return _21.text;}else{if(_21){return _21.toString();}else{return undefined;}}}return undefined;},getLabelAttributes:function(_22){if(this.label!==""){return [this.label];}return null;},getFeedValue:function(_23,_24){var _25=this.getFeedValues(_23,_24);if(_4.isArray(_25)){return _25[0];}return _25;},getFeedValues:function(_26,_27){if(!this.doc){return _27;}if(!this._feedMetaData){this._feedMetaData={element:this.doc.getElementsByTagName("feed")[0],store:this,_attribs:{}};this._parseItem(this._feedMetaData);}return this._feedMetaData._attribs[_26]||_27;},_initItem:function(_28){if(!_28._attribs){_28._attribs={};}},_fetchItems:function(_29,_2a,_2b){var url=this._getFetchUrl(_29);if(!url){_2b(new Error("No URL specified."));return;}var _2d=(!this.sendQuery?_29:null);var _2e=this;var _2f=function(_30){_2e.doc=_30;var _31=_2e._getItems(_30,_2d);var _32=_29.query;if(_32){if(_32.id){_31=_4.filter(_31,function(_33){return (_2e.getValue(_33,"id")==_32.id);});}else{if(_32.category){_31=_4.filter(_31,function(_34){var _35=_2e.getValues(_34,"category");if(!_35){return false;}return _4.some(_35,"return item.term=='"+_32.category+"'");});}}}if(_31&&_31.length>0){_2a(_31,_29);}else{_2a([],_29);}};if(this.doc){_2f(this.doc);}else{var _36={url:url,handleAs:"xml"};var _37=_4.xhrGet(_36);_37.addCallback(_2f);_37.addErrback(function(_38){_2b(_38,_29);});}},_getFetchUrl:function(_39){if(!this.sendQuery){return this.url;}var _3a=_39.query;if(!_3a){return this.url;}if(_4.isString(_3a)){return this.url+_3a;}var _3b="";for(var _3c in _3a){var _3d=_3a[_3c];if(_3d){if(_3b){_3b+="&";}_3b+=(_3c+"="+_3d);}}if(!_3b){return this.url;}var _3e=this.url;if(_3e.indexOf("?")<0){_3e+="?";}else{_3e+="&";}return _3e+_3b;},_getItems:function(_3f,_40){if(this._items){return this._items;}var _41=[];var _42=[];if(_3f.childNodes.length<1){this._items=_41;console.log("dojox.data.AtomReadStore: Received an invalid Atom document. Check the content type header");return _41;}var _43=_4.filter(_3f.childNodes,"return item.tagName && item.tagName.toLowerCase() == 'feed'");var _44=_40.query;if(!_43||_43.length!=1){console.log("dojox.data.AtomReadStore: Received an invalid Atom document, number of feed tags = "+(_43?_43.length:0));return _41;}_42=_4.filter(_43[0].childNodes,"return item.tagName && item.tagName.toLowerCase() == 'entry'");if(_40.onBegin){_40.onBegin(_42.length,this.sendQuery?_40:{});}for(var i=0;i<_42.length;i++){var _46=_42[i];if(_46.nodeType!=1){continue;}_41.push(this._getItem(_46));}this._items=_41;return _41;},close:function(_47){},_getItem:function(_48){return {element:_48,store:this};},_parseItem:function(_49){var _4a=_49._attribs;var _4b=this;var _4c,_4d;function _4e(_4f){var txt=_4f.textContent||_4f.innerHTML||_4f.innerXML;if(!txt&&_4f.childNodes[0]){var _51=_4f.childNodes[0];if(_51&&(_51.nodeType==3||_51.nodeType==4)){txt=_4f.childNodes[0].nodeValue;}}return txt;};function _52(_53){return {text:_4e(_53),type:_53.getAttribute("type")};};_4.forEach(_49.element.childNodes,function(_54){var _55=_54.tagName?_54.tagName.toLowerCase():"";switch(_55){case "title":_4a[_55]={text:_4e(_54),type:_54.getAttribute("type")};break;case "subtitle":case "summary":case "content":_4a[_55]=_52(_54);break;case "author":var _56,_57;_4.forEach(_54.childNodes,function(_58){if(!_58.tagName){return;}switch(_58.tagName.toLowerCase()){case "name":_56=_58;break;case "uri":_57=_58;break;}});var _59={};if(_56&&_56.length==1){_59.name=_4e(_56[0]);}if(_57&&_57.length==1){_59.uri=_4e(_57[0]);}_4a[_55]=_59;break;case "id":_4a[_55]=_4e(_54);break;case "updated":_4a[_55]=_4.date.stamp.fromISOString(_4e(_54));break;case "published":_4a[_55]=_4.date.stamp.fromISOString(_4e(_54));break;case "category":if(!_4a[_55]){_4a[_55]=[];}_4a[_55].push({scheme:_54.getAttribute("scheme"),term:_54.getAttribute("term")});break;case "link":if(!_4a[_55]){_4a[_55]=[];}var _5a={rel:_54.getAttribute("rel"),href:_54.getAttribute("href"),type:_54.getAttribute("type")};_4a[_55].push(_5a);if(_5a.rel=="alternate"){_4a["alternate"]=_5a;}break;default:break;}});},_unescapeHTML:function(_5b){_5b=_5b.replace(/&#8217;/m,"'").replace(/&#8243;/m,"\"").replace(/&#60;/m,">").replace(/&#62;/m,"<").replace(/&#38;/m,"&");return _5b;},_assertIsItem:function(_5c){if(!this.isItem(_5c)){throw new Error("dojox.data.AtomReadStore: Invalid item argument.");}},_assertIsAttribute:function(_5d){if(typeof _5d!=="string"){throw new Error("dojox.data.AtomReadStore: Invalid attribute argument.");}}});_4.extend(_6.data.AtomReadStore,_4.data.util.simpleFetch);}}};});