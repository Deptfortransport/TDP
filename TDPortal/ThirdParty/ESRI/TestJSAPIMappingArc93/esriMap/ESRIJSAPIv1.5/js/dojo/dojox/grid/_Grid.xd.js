/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid._Grid"],["require","dijit.dijit"],["require","dijit.Menu"],["require","dojox.html.metrics"],["require","dojox.grid.util"],["require","dojox.grid._Scroller"],["require","dojox.grid._Layout"],["require","dojox.grid._View"],["require","dojox.grid._ViewManager"],["require","dojox.grid._RowManager"],["require","dojox.grid._FocusManager"],["require","dojox.grid._EditManager"],["require","dojox.grid.Selection"],["require","dojox.grid._RowSelector"],["require","dojox.grid._Events"],["requireLocalization","dijit","loading",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ru,sk,sl,sv,th,tr,zh,zh-tw"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid._Grid"]){_4._hasResource["dojox.grid._Grid"]=true;_4.provide("dojox.grid._Grid");_4.require("dijit.dijit");_4.require("dijit.Menu");_4.require("dojox.html.metrics");_4.require("dojox.grid.util");_4.require("dojox.grid._Scroller");_4.require("dojox.grid._Layout");_4.require("dojox.grid._View");_4.require("dojox.grid._ViewManager");_4.require("dojox.grid._RowManager");_4.require("dojox.grid._FocusManager");_4.require("dojox.grid._EditManager");_4.require("dojox.grid.Selection");_4.require("dojox.grid._RowSelector");_4.require("dojox.grid._Events");(function(){var _7={cancel:function(_8){if(_8){clearTimeout(_8);}},jobs:[],job:function(_9,_a,_b){_7.cancelJob(_9);var _c=function(){delete _7.jobs[_9];_b();};_7.jobs[_9]=setTimeout(_c,_a);},cancelJob:function(_d){_7.cancel(_7.jobs[_d]);}};_4.declare("dojox.grid._Grid",[_5._Widget,_5._Templated,_6.grid._Events],{templateString:"<div class=\"dojoxGrid\" hidefocus=\"hidefocus\" wairole=\"grid\" dojoAttachEvent=\"onmouseout:_mouseOut\">\r\n\t<div class=\"dojoxGridMasterHeader\" dojoAttachPoint=\"viewsHeaderNode\" tabindex=\"-1\" wairole=\"presentation\"></div>\r\n\t<div class=\"dojoxGridMasterView\" dojoAttachPoint=\"viewsNode\" wairole=\"presentation\"></div>\r\n\t<div class=\"dojoxGridMasterMessages\" style=\"display: none;\" dojoAttachPoint=\"messagesNode\"></div>\r\n\t<span dojoAttachPoint=\"lastFocusNode\" tabindex=\"0\"></span>\r\n</div>\r\n",classTag:"dojoxGrid",get:function(_e){},rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:false,autoHeight:"",autoRender:true,defaultHeight:"15em",height:"",structure:null,elasticView:-1,singleClickEdit:false,selectionMode:"extended",rowSelector:"",columnReordering:false,headerMenu:null,placeholderLabel:"GridColumns",selectable:false,_click:null,loadingMessage:"<span class='dojoxGridLoading'>${loadingState}</span>",errorMessage:"<span class='dojoxGridError'>${errorState}</span>",noDataMessage:"",sortInfo:0,themeable:true,_placeholders:null,buildRendering:function(){this.inherited(arguments);if(this.get==_6.grid._Grid.prototype.get){this.get=null;}if(!this.domNode.getAttribute("tabIndex")){this.domNode.tabIndex="0";}this.createScroller();this.createLayout();this.createViews();this.createManagers();this.createSelection();this.connect(this.selection,"onSelected","onSelected");this.connect(this.selection,"onDeselected","onDeselected");this.connect(this.selection,"onChanged","onSelectionChanged");_6.html.metrics.initOnFontResize();this.connect(_6.html.metrics,"onFontResize","textSizeChanged");_6.grid.util.funnelEvents(this.domNode,this,"doKeyEvent",_6.grid.util.keyEvents);this.connect(this,"onShow","renderOnIdle");},postMixInProperties:function(){this.inherited(arguments);var _f=_4.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=_4.string.substitute(this.loadingMessage,_f);this.errorMessage=_4.string.substitute(this.errorMessage,_f);if(this.srcNodeRef&&this.srcNodeRef.style.height){this.height=this.srcNodeRef.style.height;}this._setAutoHeightAttr(this.autoHeight,true);},postCreate:function(){this.styleChanged=this._styleChanged;this._placeholders=[];this._setHeaderMenuAttr(this.headerMenu);this._setStructureAttr(this.structure);this._click=[];},destroy:function(){this.domNode.onReveal=null;this.domNode.onSizeChange=null;delete this._click;this.edit.destroy();delete this.edit;this.views.destroyViews();if(this.scroller){this.scroller.destroy();delete this.scroller;}if(this.focus){this.focus.destroy();delete this.focus;}if(this.headerMenu&&this._placeholders.length){_4.forEach(this._placeholders,function(p){p.unReplace(true);});this.headerMenu.unBindDomNode(this.viewsHeaderNode);}this.inherited(arguments);},_setAutoHeightAttr:function(ah,_12){if(typeof ah=="string"){if(!ah||ah=="false"){ah=false;}else{if(ah=="true"){ah=true;}else{ah=window.parseInt(ah,10);}}}if(typeof ah=="number"){if(isNaN(ah)){ah=false;}if(ah<0){ah=true;}else{if(ah===0){ah=false;}}}this.autoHeight=ah;if(typeof ah=="boolean"){this._autoHeight=ah;}else{if(typeof ah=="number"){this._autoHeight=(ah>=this.attr("rowCount"));}else{this._autoHeight=false;}}if(this._started&&!_12){this.render();}},_getRowCountAttr:function(){return this.updating&&this.invalidated&&this.invalidated.rowCount!=undefined?this.invalidated.rowCount:this.rowCount;},styleChanged:function(){this.setStyledClass(this.domNode,"");},_styleChanged:function(){this.styleChanged();this.update();},textSizeChanged:function(){setTimeout(_4.hitch(this,"_textSizeChanged"),1);},_textSizeChanged:function(){if(this.domNode){this.views.forEach(function(v){v.content.update();});this.render();}},sizeChange:function(){_7.job(this.id+"SizeChange",50,_4.hitch(this,"update"));},renderOnIdle:function(){setTimeout(_4.hitch(this,"render"),1);},createManagers:function(){this.rows=new _6.grid._RowManager(this);this.focus=new _6.grid._FocusManager(this);this.edit=new _6.grid._EditManager(this);},createSelection:function(){this.selection=new _6.grid.Selection(this);},createScroller:function(){this.scroller=new _6.grid._Scroller();this.scroller.grid=this;this.scroller._pageIdPrefix=this.id+"-";this.scroller.renderRow=_4.hitch(this,"renderRow");this.scroller.removeRow=_4.hitch(this,"rowRemoved");},createLayout:function(){this.layout=new _6.grid._Layout(this);this.connect(this.layout,"moveColumn","onMoveColumn");},onMoveColumn:function(){this.render();this._resize();},createViews:function(){this.views=new _6.grid._ViewManager(this);this.views.createView=_4.hitch(this,"createView");},createView:function(_14,idx){var c=_4.getObject(_14);var _17=new c({grid:this,index:idx});this.viewsNode.appendChild(_17.domNode);this.viewsHeaderNode.appendChild(_17.headerNode);this.views.addView(_17);return _17;},buildViews:function(){for(var i=0,vs;(vs=this.layout.structure[i]);i++){this.createView(vs.type||_6._scopeName+".grid._View",i).setStructure(vs);}this.scroller.setContentNodes(this.views.getContentNodes());},_setStructureAttr:function(_1a){var s=_1a;if(s&&_4.isString(s)){_4.deprecated("dojox.grid._Grid.attr('structure', 'objVar')","use dojox.grid._Grid.attr('structure', objVar) instead","2.0");s=_4.getObject(s);}this.structure=s;if(!s){if(this.layout.structure){s=this.layout.structure;}else{return;}}this.views.destroyViews();if(s!==this.layout.structure){this.layout.setStructure(s);}this._structureChanged();},setStructure:function(_1c){_4.deprecated("dojox.grid._Grid.setStructure(obj)","use dojox.grid._Grid.attr('structure', obj) instead.","2.0");this._setStructureAttr(_1c);},getColumnTogglingItems:function(){return _4.map(this.layout.cells,function(_1d){if(!_1d.menuItems){_1d.menuItems=[];}var _1e=this;var _1f=new _5.CheckedMenuItem({label:_1d.name,checked:!_1d.hidden,_gridCell:_1d,onChange:function(_20){if(_1e.layout.setColumnVisibility(this._gridCell.index,_20)){var _21=this._gridCell.menuItems;if(_21.length>1){_4.forEach(_21,function(_22){if(_22!==this){_22.setAttribute("checked",_20);}},this);}var _20=_4.filter(_1e.layout.cells,function(c){if(c.menuItems.length>1){_4.forEach(c.menuItems,"item.attr('disabled', false);");}else{c.menuItems[0].attr("disabled",false);}return !c.hidden;});if(_20.length==1){_4.forEach(_20[0].menuItems,"item.attr('disabled', true);");}}},destroy:function(){var _24=_4.indexOf(this._gridCell.menuItems,this);this._gridCell.menuItems.splice(_24,1);delete this._gridCell;_5.CheckedMenuItem.prototype.destroy.apply(this,arguments);}});_1d.menuItems.push(_1f);return _1f;},this);},_setHeaderMenuAttr:function(_25){if(this._placeholders&&this._placeholders.length){_4.forEach(this._placeholders,function(p){p.unReplace(true);});this._placeholders=[];}if(this.headerMenu){this.headerMenu.unBindDomNode(this.viewsHeaderNode);}this.headerMenu=_25;if(!_25){return;}this.headerMenu.bindDomNode(this.viewsHeaderNode);if(this.headerMenu.getPlaceholders){this._placeholders=this.headerMenu.getPlaceholders(this.placeholderLabel);}},setHeaderMenu:function(_27){_4.deprecated("dojox.grid._Grid.setHeaderMenu(obj)","use dojox.grid._Grid.attr('headerMenu', obj) instead.","2.0");this._setHeaderMenuAttr(_27);},setupHeaderMenu:function(){if(this._placeholders&&this._placeholders.length){_4.forEach(this._placeholders,function(p){if(p._replaced){p.unReplace(true);}p.replace(this.getColumnTogglingItems());},this);}},_fetch:function(_29){this.setScrollTop(0);},getItem:function(_2a){return null;},showMessage:function(_2b){if(_2b){this.messagesNode.innerHTML=_2b;this.messagesNode.style.display="";}else{this.messagesNode.innerHTML="";this.messagesNode.style.display="none";}},_structureChanged:function(){this.buildViews();if(this.autoRender&&this._started){this.render();}},hasLayout:function(){return this.layout.cells.length;},resize:function(_2c,_2d){this._resize(_2c,_2d);this.sizeChange();},_getPadBorder:function(){this._padBorder=this._padBorder||_4._getPadBorderExtents(this.domNode);return this._padBorder;},_getHeaderHeight:function(){var vns=this.viewsHeaderNode.style,t=vns.display=="none"?0:this.views.measureHeader();vns.height=t+"px";this.views.normalizeHeaderNodeHeight();return t;},_resize:function(_30,_31){var pn=this.domNode.parentNode;if(!pn||pn.nodeType!=1||!this.hasLayout()||pn.style.visibility=="hidden"||pn.style.display=="none"){return;}var _33=this._getPadBorder();var hh=0;if(this._autoHeight){this.domNode.style.height="auto";this.viewsNode.style.height="";}else{if(typeof this.autoHeight=="number"){var h=hh=this._getHeaderHeight();h+=(this.scroller.averageRowHeight*this.autoHeight);this.domNode.style.height=h+"px";}else{if(this.flex>0){}else{if(this.domNode.clientHeight<=_33.h){if(pn==document.body){this.domNode.style.height=this.defaultHeight;}else{if(this.height){this.domNode.style.height=this.height;}else{this.fitTo="parent";}}}}}}if(_31){_30=_31;}if(_30){_4.marginBox(this.domNode,_30);this.height=this.domNode.style.height;delete this.fitTo;}else{if(this.fitTo=="parent"){var h=_4._getContentBox(pn).h;_4.marginBox(this.domNode,{h:Math.max(0,h)});}}var h=_4._getContentBox(this.domNode).h;if(h==0&&!this._autoHeight){this.viewsHeaderNode.style.display="none";}else{this.viewsHeaderNode.style.display="block";hh=this._getHeaderHeight();}this.adaptWidth();this.adaptHeight(hh);this.postresize();},adaptWidth:function(){var w=this.autoWidth?0:this.domNode.clientWidth||(this.domNode.offsetWidth-this._getPadBorder().w),vw=this.views.arrange(1,w);this.views.onEach("adaptWidth");if(this.autoWidth){this.domNode.style.width=vw+"px";}},adaptHeight:function(_38){var t=_38||this._getHeaderHeight();var h=(this._autoHeight?-1:Math.max(this.domNode.clientHeight-t,0)||0);this.views.onEach("setSize",[0,h]);this.views.onEach("adaptHeight");if(!this._autoHeight){var _3b=0,_3c=0;var _3d=_4.filter(this.views.views,function(v){var has=v.hasHScrollbar();if(has){_3b++;}else{_3c++;}return (!has);});if(_3b>0&&_3c>0){_4.forEach(_3d,function(v){v.adaptHeight(true);});}}if(this.autoHeight===true||h!=-1||(typeof this.autoHeight=="number"&&this.autoHeight>=this.attr("rowCount"))){this.scroller.windowHeight=h;}else{this.scroller.windowHeight=Math.max(this.domNode.clientHeight-t,0);}},startup:function(){if(this._started){return;}this.inherited(arguments);if(this.autoRender){this.render();}},render:function(){if(!this.domNode){return;}if(!this._started){return;}if(!this.hasLayout()){this.scroller.init(0,this.keepRows,this.rowsPerPage);return;}this.update=this.defaultUpdate;this._render();},_render:function(){this.scroller.init(this.attr("rowCount"),this.keepRows,this.rowsPerPage);this.prerender();this.setScrollTop(0);this.postrender();},prerender:function(){this.keepRows=this._autoHeight?0:this.keepRows;this.scroller.setKeepInfo(this.keepRows);this.views.render();this._resize();},postrender:function(){this.postresize();this.focus.initFocusView();_4.setSelectable(this.domNode,this.selectable);},postresize:function(){if(this._autoHeight){var _41=Math.max(this.views.measureContent())+"px";this.viewsNode.style.height=_41;}},renderRow:function(_42,_43){this.views.renderRow(_42,_43);},rowRemoved:function(_44){this.views.rowRemoved(_44);},invalidated:null,updating:false,beginUpdate:function(){this.invalidated=[];this.updating=true;},endUpdate:function(){this.updating=false;var i=this.invalidated,r;if(i.all){this.update();}else{if(i.rowCount!=undefined){this.updateRowCount(i.rowCount);}else{for(r in i){this.updateRow(Number(r));}}}this.invalidated=null;},defaultUpdate:function(){if(!this.domNode){return;}if(this.updating){this.invalidated.all=true;return;}var _47=this.scrollTop;this.prerender();this.scroller.invalidateNodes();this.setScrollTop(_47);this.postrender();},update:function(){this.render();},updateRow:function(_48){_48=Number(_48);if(this.updating){this.invalidated[_48]=true;}else{this.views.updateRow(_48);this.scroller.rowHeightChanged(_48);}},updateRows:function(_49,_4a){_49=Number(_49);_4a=Number(_4a);if(this.updating){for(var i=0;i<_4a;i++){this.invalidated[i+_49]=true;}}else{for(var i=0;i<_4a;i++){this.views.updateRow(i+_49);}this.scroller.rowHeightChanged(_49);}},updateRowCount:function(_4c){if(this.updating){this.invalidated.rowCount=_4c;}else{this.rowCount=_4c;this._setAutoHeightAttr(this.autoHeight,true);if(this.layout.cells.length){this.scroller.updateRowCount(_4c);}this._resize();if(this.layout.cells.length){this.setScrollTop(this.scrollTop);}}},updateRowStyles:function(_4d){this.views.updateRowStyles(_4d);},rowHeightChanged:function(_4e){this.views.renormalizeRow(_4e);this.scroller.rowHeightChanged(_4e);},fastScroll:true,delayScroll:false,scrollRedrawThreshold:(_4.isIE?100:50),scrollTo:function(_4f){if(!this.fastScroll){this.setScrollTop(_4f);return;}var _50=Math.abs(this.lastScrollTop-_4f);this.lastScrollTop=_4f;if(_50>this.scrollRedrawThreshold||this.delayScroll){this.delayScroll=true;this.scrollTop=_4f;this.views.setScrollTop(_4f);_7.job("dojoxGridScroll",200,_4.hitch(this,"finishScrollJob"));}else{this.setScrollTop(_4f);}},finishScrollJob:function(){this.delayScroll=false;this.setScrollTop(this.scrollTop);},setScrollTop:function(_51){this.scroller.scroll(this.views.setScrollTop(_51));},scrollToRow:function(_52){this.setScrollTop(this.scroller.findScrollTop(_52)+1);},styleRowNode:function(_53,_54){if(_54){this.rows.styleRowNode(_53,_54);}},_mouseOut:function(e){this.rows.setOverRow(-2);},getCell:function(_56){return this.layout.cells[_56];},setCellWidth:function(_57,_58){this.getCell(_57).unitWidth=_58;},getCellName:function(_59){return "Cell "+_59.index;},canSort:function(_5a){},sort:function(){},getSortAsc:function(_5b){_5b=_5b==undefined?this.sortInfo:_5b;return Boolean(_5b>0);},getSortIndex:function(_5c){_5c=_5c==undefined?this.sortInfo:_5c;return Math.abs(_5c)-1;},setSortIndex:function(_5d,_5e){var si=_5d+1;if(_5e!=undefined){si*=(_5e?1:-1);}else{if(this.getSortIndex()==_5d){si=-this.sortInfo;}}this.setSortInfo(si);},setSortInfo:function(_60){if(this.canSort(_60)){this.sortInfo=_60;this.sort();this.update();}},doKeyEvent:function(e){e.dispatch="do"+e.type;this.onKeyEvent(e);},_dispatch:function(m,e){if(m in this){return this[m](e);}},dispatchKeyEvent:function(e){this._dispatch(e.dispatch,e);},dispatchContentEvent:function(e){this.edit.dispatchEvent(e)||e.sourceView.dispatchContentEvent(e)||this._dispatch(e.dispatch,e);},dispatchHeaderEvent:function(e){e.sourceView.dispatchHeaderEvent(e)||this._dispatch("doheader"+e.type,e);},dokeydown:function(e){this.onKeyDown(e);},doclick:function(e){if(e.cellNode){this.onCellClick(e);}else{this.onRowClick(e);}},dodblclick:function(e){if(e.cellNode){this.onCellDblClick(e);}else{this.onRowDblClick(e);}},docontextmenu:function(e){if(e.cellNode){this.onCellContextMenu(e);}else{this.onRowContextMenu(e);}},doheaderclick:function(e){if(e.cellNode){this.onHeaderCellClick(e);}else{this.onHeaderClick(e);}},doheaderdblclick:function(e){if(e.cellNode){this.onHeaderCellDblClick(e);}else{this.onHeaderDblClick(e);}},doheadercontextmenu:function(e){if(e.cellNode){this.onHeaderCellContextMenu(e);}else{this.onHeaderContextMenu(e);}},doStartEdit:function(_6e,_6f){this.onStartEdit(_6e,_6f);},doApplyCellEdit:function(_70,_71,_72){this.onApplyCellEdit(_70,_71,_72);},doCancelEdit:function(_73){this.onCancelEdit(_73);},doApplyEdit:function(_74){this.onApplyEdit(_74);},addRow:function(){this.updateRowCount(this.attr("rowCount")+1);},removeSelectedRows:function(){this.updateRowCount(Math.max(0,this.attr("rowCount")-this.selection.getSelected().length));this.selection.clear();}});_6.grid._Grid.markupFactory=function(_75,_76,_77,_78){var d=_4;var _7a=function(n){var w=d.attr(n,"width")||"auto";if((w!="auto")&&(w.slice(-2)!="em")&&(w.slice(-1)!="%")){w=parseInt(w)+"px";}return w;};if(!_75.structure&&_76.nodeName.toLowerCase()=="table"){_75.structure=d.query("> colgroup",_76).map(function(cg){var sv=d.attr(cg,"span");var v={noscroll:(d.attr(cg,"noscroll")=="true")?true:false,__span:(!!sv?parseInt(sv):1),cells:[]};if(d.hasAttr(cg,"width")){v.width=_7a(cg);}return v;});if(!_75.structure.length){_75.structure.push({__span:Infinity,cells:[]});}d.query("thead > tr",_76).forEach(function(tr,_81){var _82=0;var _83=0;var _84;var _85=null;d.query("> th",tr).map(function(th){if(!_85){_84=0;_85=_75.structure[0];}else{if(_82>=(_84+_85.__span)){_83++;_84+=_85.__span;var _87=_85;_85=_75.structure[_83];}}var _88={name:d.trim(d.attr(th,"name")||th.innerHTML),colSpan:parseInt(d.attr(th,"colspan")||1,10),type:d.trim(d.attr(th,"cellType")||"")};_82+=_88.colSpan;var _89=d.attr(th,"rowspan");if(_89){_88.rowSpan=_89;}if(d.hasAttr(th,"width")){_88.width=_7a(th);}if(d.hasAttr(th,"relWidth")){_88.relWidth=window.parseInt(_4.attr(th,"relWidth"),10);}if(d.hasAttr(th,"hidden")){_88.hidden=d.attr(th,"hidden")=="true";}if(_78){_78(th,_88);}_88.type=_88.type?_4.getObject(_88.type):_6.grid.cells.Cell;if(_88.type&&_88.type.markupFactory){_88.type.markupFactory(th,_88);}if(!_85.cells[_81]){_85.cells[_81]=[];}_85.cells[_81].push(_88);});});}return new _77(_75,_76);};})();}}};});