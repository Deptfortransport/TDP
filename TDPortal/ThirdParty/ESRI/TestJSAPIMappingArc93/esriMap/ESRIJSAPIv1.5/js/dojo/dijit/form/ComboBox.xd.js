/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit.form.ComboBox"],["require","dijit.form.ValidationTextBox"],["require","dojo.data.util.simpleFetch"],["require","dojo.data.util.filter"],["require","dojo.regexp"],["requireLocalization","dijit.form","ComboBox",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ru,sk,sl,sv,th,tr,zh,zh-tw"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit.form.ComboBox"]){_4._hasResource["dijit.form.ComboBox"]=true;_4.provide("dijit.form.ComboBox");_4.require("dijit.form.ValidationTextBox");_4.require("dojo.data.util.simpleFetch");_4.require("dojo.data.util.filter");_4.require("dojo.regexp");_4.declare("dijit.form.ComboBoxMixin",null,{item:null,pageSize:Infinity,store:null,fetchProperties:{},query:{},autoComplete:true,highlightMatch:"first",searchDelay:100,searchAttr:"name",labelAttr:"",labelType:"text",queryExpr:"${0}*",ignoreCase:true,hasDownArrow:true,templateString:"<div class=\"dijit dijitReset dijitInlineTable dijitLeft\"\r\n\tid=\"widget_${id}\"\r\n\tdojoAttachEvent=\"onmouseenter:_onMouse,onmouseleave:_onMouse,onmousedown:_onMouse\" dojoAttachPoint=\"comboNode\" waiRole=\"combobox\" tabIndex=\"-1\"\r\n\t><div style=\"overflow:hidden;\"\r\n\t\t><div class='dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton'\r\n\t\t\tdojoAttachPoint=\"downArrowNode\" waiRole=\"presentation\"\r\n\t\t\tdojoAttachEvent=\"onmousedown:_onArrowMouseDown,onmouseup:_onMouse,onmouseenter:_onMouse,onmouseleave:_onMouse\"\r\n\t\t\t><div class=\"dijitArrowButtonInner\">&thinsp;</div\r\n\t\t\t><div class=\"dijitArrowButtonChar\">&#9660;</div\r\n\t\t></div\r\n\t\t><div class=\"dijitReset dijitValidationIcon\"><br></div\r\n\t\t><div class=\"dijitReset dijitValidationIconText\">&Chi;</div\r\n\t\t><div class=\"dijitReset dijitInputField\"\r\n\t\t\t><input ${nameAttrSetting} type=\"text\" autocomplete=\"off\" class='dijitReset'\r\n\t\t\tdojoAttachEvent=\"onkeypress:_onKeyPress,compositionend\"\r\n\t\t\tdojoAttachPoint=\"textbox,focusNode\" waiRole=\"textbox\" waiState=\"haspopup-true,autocomplete-list\"\r\n\t\t/></div\r\n\t></div\r\n></div>\r\n",baseClass:"dijitComboBox",_getCaretPos:function(_7){var _8=0;if(typeof (_7.selectionStart)=="number"){_8=_7.selectionStart;}else{if(_4.isIE){var tr=_4.doc.selection.createRange().duplicate();var _a=_7.createTextRange();tr.move("character",0);_a.move("character",0);try{_a.setEndPoint("EndToEnd",tr);_8=String(_a.text).replace(/\r/g,"").length;}catch(e){}}}return _8;},_setCaretPos:function(_b,_c){_c=parseInt(_c);_5.selectInputText(_b,_c,_c);},_setDisabledAttr:function(_d){this.inherited(arguments);_5.setWaiState(this.comboNode,"disabled",_d);},_onKeyPress:function(_e){var _f=_e.charOrCode;if(_e.altKey||(_e.ctrlKey&&(_f!="x"&&_f!="v"))||_e.key==_4.keys.SHIFT){return;}var _10=false;var pw=this._popupWidget;var dk=_4.keys;var _13=null;if(this._isShowingNow){pw.handleKey(_f);_13=pw.getHighlightedOption();}switch(_f){case dk.PAGE_DOWN:case dk.DOWN_ARROW:if(!this._isShowingNow||this._prev_key_esc){this._arrowPressed();_10=true;}else{if(_13){this._announceOption(_13);}}_4.stopEvent(_e);this._prev_key_backspace=false;this._prev_key_esc=false;break;case dk.PAGE_UP:case dk.UP_ARROW:if(this._isShowingNow){this._announceOption(_13);}_4.stopEvent(_e);this._prev_key_backspace=false;this._prev_key_esc=false;break;case dk.ENTER:if(_13){if(_13==pw.nextButton){this._nextSearch(1);_4.stopEvent(_e);break;}else{if(_13==pw.previousButton){this._nextSearch(-1);_4.stopEvent(_e);break;}}}else{this._setDisplayedValueAttr(this.attr("displayedValue"),true);}_e.preventDefault();case dk.TAB:var _14=this.attr("displayedValue");if(pw&&(_14==pw._messages["previousMessage"]||_14==pw._messages["nextMessage"])){break;}if(this._isShowingNow){this._prev_key_backspace=false;this._prev_key_esc=false;if(_13){pw.attr("value",{target:_13});}this._lastQuery=null;this._hideResultList();}break;case " ":this._prev_key_backspace=false;this._prev_key_esc=false;if(_13){_4.stopEvent(_e);this._selectOption();this._hideResultList();}else{_10=true;}break;case dk.ESCAPE:this._prev_key_backspace=false;this._prev_key_esc=true;if(this._isShowingNow){_4.stopEvent(_e);this._hideResultList();}break;case dk.DELETE:case dk.BACKSPACE:this._prev_key_esc=false;this._prev_key_backspace=true;_10=true;break;case dk.RIGHT_ARROW:case dk.LEFT_ARROW:this._prev_key_backspace=false;this._prev_key_esc=false;break;default:this._prev_key_backspace=false;this._prev_key_esc=false;_10=typeof _f=="string";}if(this.searchTimer){clearTimeout(this.searchTimer);}if(_10){setTimeout(_4.hitch(this,"_startSearchFromInput"),1);}},_autoCompleteText:function(_15){var fn=this.focusNode;_5.selectInputText(fn,fn.value.length);var _17=this.ignoreCase?"toLowerCase":"substr";if(_15[_17](0).indexOf(this.focusNode.value[_17](0))==0){var _18=this._getCaretPos(fn);if((_18+1)>fn.value.length){fn.value=_15;_5.selectInputText(fn,_18);}}else{fn.value=_15;_5.selectInputText(fn);}},_openResultList:function(_19,_1a){if(this.disabled||this.readOnly||(_1a.query[this.searchAttr]!=this._lastQuery)){return;}this._popupWidget.clearResultList();if(!_19.length){this._hideResultList();return;}this.item=null;var _1b=new String(this.store.getValue(_19[0],this.searchAttr));if(_1b&&this.autoComplete&&!this._prev_key_backspace&&(_1a.query[this.searchAttr]!="*")){this.item=_19[0];this._autoCompleteText(_1b);}_1a._maxOptions=this._maxOptions;this._popupWidget.createOptions(_19,_1a,_4.hitch(this,"_getMenuLabelFromItem"));this._showResultList();if(_1a.direction){if(1==_1a.direction){this._popupWidget.highlightFirstOption();}else{if(-1==_1a.direction){this._popupWidget.highlightLastOption();}}this._announceOption(this._popupWidget.getHighlightedOption());}},_showResultList:function(){this._hideResultList();var _1c=this._popupWidget.getItems(),_1d=Math.min(_1c.length,this.maxListLength);this._arrowPressed();this.displayMessage("");_4.style(this._popupWidget.domNode,{width:"",height:""});var _1e=this.open();var _1f=_4.marginBox(this._popupWidget.domNode);this._popupWidget.domNode.style.overflow=((_1e.h==_1f.h)&&(_1e.w==_1f.w))?"hidden":"auto";var _20=_1e.w;if(_1e.h<this._popupWidget.domNode.scrollHeight){_20+=16;}_4.marginBox(this._popupWidget.domNode,{h:_1e.h,w:Math.max(_20,this.domNode.offsetWidth)});_5.setWaiState(this.comboNode,"expanded","true");},_hideResultList:function(){if(this._isShowingNow){_5.popup.close(this._popupWidget);this._arrowIdle();this._isShowingNow=false;_5.setWaiState(this.comboNode,"expanded","false");_5.removeWaiState(this.focusNode,"activedescendant");}},_setBlurValue:function(){var _21=this.attr("displayedValue");var pw=this._popupWidget;if(pw&&(_21==pw._messages["previousMessage"]||_21==pw._messages["nextMessage"])){this._setValueAttr(this._lastValueReported,true);}else{this.attr("displayedValue",_21);}},_onBlur:function(){this._hideResultList();this._arrowIdle();this.inherited(arguments);},_announceOption:function(_23){if(_23==null){return;}var _24;if(_23==this._popupWidget.nextButton||_23==this._popupWidget.previousButton){_24=_23.innerHTML;}else{_24=this.store.getValue(_23.item,this.searchAttr);}this.focusNode.value=this.focusNode.value.substring(0,this._getCaretPos(this.focusNode));_5.setWaiState(this.focusNode,"activedescendant",_4.attr(_23,"id"));this._autoCompleteText(_24);},_selectOption:function(evt){var tgt=null;if(!evt){evt={target:this._popupWidget.getHighlightedOption()};}if(!evt.target){this.attr("displayedValue",this.attr("displayedValue"));return;}else{tgt=evt.target;}if(!evt.noHide){this._hideResultList();this._setCaretPos(this.focusNode,this.store.getValue(tgt.item,this.searchAttr).length);}this._doSelect(tgt);},_doSelect:function(tgt){this.item=tgt.item;this.attr("value",this.store.getValue(tgt.item,this.searchAttr));},_onArrowMouseDown:function(evt){if(this.disabled||this.readOnly){return;}_4.stopEvent(evt);this.focus();if(this._isShowingNow){this._hideResultList();}else{this._startSearch("");}},_startSearchFromInput:function(){this._startSearch(this.focusNode.value.replace(/([\\\*\?])/g,"\\$1"));},_getQueryString:function(_29){return _4.string.substitute(this.queryExpr,[_29]);},_startSearch:function(key){if(!this._popupWidget){var _2b=this.id+"_popup";this._popupWidget=new _5.form._ComboBoxMenu({onChange:_4.hitch(this,this._selectOption),id:_2b});_5.removeWaiState(this.focusNode,"activedescendant");_5.setWaiState(this.textbox,"owns",_2b);}this.item=null;var _2c=_4.clone(this.query);this._lastInput=key;this._lastQuery=_2c[this.searchAttr]=this._getQueryString(key);this.searchTimer=setTimeout(_4.hitch(this,function(_2d,_2e){var _2f={queryOptions:{ignoreCase:this.ignoreCase,deep:true},query:_2d,onBegin:_4.hitch(this,"_setMaxOptions"),onComplete:_4.hitch(this,"_openResultList"),onError:function(_30){console.error("dijit.form.ComboBox: "+_30);_4.hitch(_2e,"_hideResultList")();},start:0,count:this.pageSize};_4.mixin(_2f,_2e.fetchProperties);var _31=_2e.store.fetch(_2f);var _32=function(_33,_34){_33.start+=_33.count*_34;_33.direction=_34;this.store.fetch(_33);};this._nextSearch=this._popupWidget.onPage=_4.hitch(this,_32,_31);},_2c,this),this.searchDelay);},_setMaxOptions:function(_35,_36){this._maxOptions=_35;},_getValueField:function(){return this.searchAttr;},_arrowPressed:function(){if(!this.disabled&&!this.readOnly&&this.hasDownArrow){_4.addClass(this.downArrowNode,"dijitArrowButtonActive");}},_arrowIdle:function(){if(!this.disabled&&!this.readOnly&&this.hasDownArrow){_4.removeClass(this.downArrowNode,"dojoArrowButtonPushed");}},compositionend:function(evt){this._onKeyPress({charCode:-1});},constructor:function(){this.query={};this.fetchProperties={};},postMixInProperties:function(){if(!this.hasDownArrow){this.baseClass="dijitTextBox";}if(!this.store){var _38=this.srcNodeRef;this.store=new _5.form._ComboBoxDataStore(_38);if(!this.value||((typeof _38.selectedIndex=="number")&&_38.selectedIndex.toString()===this.value)){var _39=this.store.fetchSelectedItem();if(_39){this.value=this.store.getValue(_39,this._getValueField());}}}this.inherited(arguments);},postCreate:function(){var _3a=_4.query("label[for=\""+this.id+"\"]");if(_3a.length){_3a[0].id=(this.id+"_label");var cn=this.comboNode;_5.setWaiState(cn,"labelledby",_3a[0].id);}this.inherited(arguments);},uninitialize:function(){if(this._popupWidget){this._hideResultList();this._popupWidget.destroy();}},_getMenuLabelFromItem:function(_3c){var _3d=this.store.getValue(_3c,this.labelAttr||this.searchAttr);var _3e=this.labelType;if(this.highlightMatch!="none"&&this.labelType=="text"&&this._lastInput){_3d=this.doHighlight(_3d,this._escapeHtml(this._lastInput));_3e="html";}return {html:_3e=="html",label:_3d};},doHighlight:function(_3f,_40){var _41="i"+(this.highlightMatch=="all"?"g":"");var _42=this._escapeHtml(_3f);_40=_4.regexp.escapeString(_40);var ret=_42.replace(new RegExp("(^|\\s)("+_40+")",_41),"$1<span class=\"dijitComboBoxHighlightMatch\">$2</span>");return ret;},_escapeHtml:function(str){str=String(str).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");return str;},open:function(){this._isShowingNow=true;return _5.popup.open({popup:this._popupWidget,around:this.domNode,parent:this});},reset:function(){this.item=null;this.inherited(arguments);}});_4.declare("dijit.form._ComboBoxMenu",[_5._Widget,_5._Templated],{templateString:"<ul class='dijitReset dijitMenu' dojoAttachEvent='onmousedown:_onMouseDown,onmouseup:_onMouseUp,onmouseover:_onMouseOver,onmouseout:_onMouseOut' tabIndex='-1' style='overflow: \"auto\"; overflow-x: \"hidden\";'>"+"<li class='dijitMenuItem dijitMenuPreviousButton' dojoAttachPoint='previousButton' waiRole='option'></li>"+"<li class='dijitMenuItem dijitMenuNextButton' dojoAttachPoint='nextButton' waiRole='option'></li>"+"</ul>",_messages:null,postMixInProperties:function(){this._messages=_4.i18n.getLocalization("dijit.form","ComboBox",this.lang);this.inherited(arguments);},_setValueAttr:function(_45){this.value=_45;this.onChange(_45);},onChange:function(_46){},onPage:function(_47){},postCreate:function(){this.previousButton.innerHTML=this._messages["previousMessage"];this.nextButton.innerHTML=this._messages["nextMessage"];this.inherited(arguments);},onClose:function(){this._blurOptionNode();},_createOption:function(_48,_49){var _4a=_49(_48);var _4b=_4.doc.createElement("li");_5.setWaiRole(_4b,"option");if(_4a.html){_4b.innerHTML=_4a.label;}else{_4b.appendChild(_4.doc.createTextNode(_4a.label));}if(_4b.innerHTML==""){_4b.innerHTML="&nbsp;";}_4b.item=_48;return _4b;},createOptions:function(_4c,_4d,_4e){this.previousButton.style.display=(_4d.start==0)?"none":"";_4.attr(this.previousButton,"id",this.id+"_prev");_4.forEach(_4c,function(_4f,i){var _51=this._createOption(_4f,_4e);_51.className="dijitReset dijitMenuItem";_4.attr(_51,"id",this.id+i);this.domNode.insertBefore(_51,this.nextButton);},this);var _52=false;if(_4d._maxOptions&&_4d._maxOptions!=-1){if((_4d.start+_4d.count)<_4d._maxOptions){_52=true;}else{if((_4d.start+_4d.count)>(_4d._maxOptions-1)){if(_4d.count==_4c.length){_52=true;}}}}else{if(_4d.count==_4c.length){_52=true;}}this.nextButton.style.display=_52?"":"none";_4.attr(this.nextButton,"id",this.id+"_next");},clearResultList:function(){while(this.domNode.childNodes.length>2){this.domNode.removeChild(this.domNode.childNodes[this.domNode.childNodes.length-2]);}},getItems:function(){return this.domNode.childNodes;},getListLength:function(){return this.domNode.childNodes.length-2;},_onMouseDown:function(evt){_4.stopEvent(evt);},_onMouseUp:function(evt){if(evt.target===this.domNode){return;}else{if(evt.target==this.previousButton){this.onPage(-1);}else{if(evt.target==this.nextButton){this.onPage(1);}else{var tgt=evt.target;while(!tgt.item){tgt=tgt.parentNode;}this._setValueAttr({target:tgt},true);}}}},_onMouseOver:function(evt){if(evt.target===this.domNode){return;}var tgt=evt.target;if(!(tgt==this.previousButton||tgt==this.nextButton)){while(!tgt.item){tgt=tgt.parentNode;}}this._focusOptionNode(tgt);},_onMouseOut:function(evt){if(evt.target===this.domNode){return;}this._blurOptionNode();},_focusOptionNode:function(_59){if(this._highlighted_option!=_59){this._blurOptionNode();this._highlighted_option=_59;_4.addClass(this._highlighted_option,"dijitMenuItemSelected");}},_blurOptionNode:function(){if(this._highlighted_option){_4.removeClass(this._highlighted_option,"dijitMenuItemSelected");this._highlighted_option=null;}},_highlightNextOption:function(){var fc=this.domNode.firstChild;if(!this.getHighlightedOption()){this._focusOptionNode(fc.style.display=="none"?fc.nextSibling:fc);}else{var ns=this._highlighted_option.nextSibling;if(ns&&ns.style.display!="none"){this._focusOptionNode(ns);}}_5.scrollIntoView(this._highlighted_option);},highlightFirstOption:function(){this._focusOptionNode(this.domNode.firstChild.nextSibling);_5.scrollIntoView(this._highlighted_option);},highlightLastOption:function(){this._focusOptionNode(this.domNode.lastChild.previousSibling);_5.scrollIntoView(this._highlighted_option);},_highlightPrevOption:function(){var lc=this.domNode.lastChild;if(!this.getHighlightedOption()){this._focusOptionNode(lc.style.display=="none"?lc.previousSibling:lc);}else{var ps=this._highlighted_option.previousSibling;if(ps&&ps.style.display!="none"){this._focusOptionNode(ps);}}_5.scrollIntoView(this._highlighted_option);},_page:function(up){var _5f=0;var _60=this.domNode.scrollTop;var _61=_4.style(this.domNode,"height");if(!this.getHighlightedOption()){this._highlightNextOption();}while(_5f<_61){if(up){if(!this.getHighlightedOption().previousSibling||this._highlighted_option.previousSibling.style.display=="none"){break;}this._highlightPrevOption();}else{if(!this.getHighlightedOption().nextSibling||this._highlighted_option.nextSibling.style.display=="none"){break;}this._highlightNextOption();}var _62=this.domNode.scrollTop;_5f+=(_62-_60)*(up?-1:1);_60=_62;}},pageUp:function(){this._page(true);},pageDown:function(){this._page(false);},getHighlightedOption:function(){var ho=this._highlighted_option;return (ho&&ho.parentNode)?ho:null;},handleKey:function(key){switch(key){case _4.keys.DOWN_ARROW:this._highlightNextOption();break;case _4.keys.PAGE_DOWN:this.pageDown();break;case _4.keys.UP_ARROW:this._highlightPrevOption();break;case _4.keys.PAGE_UP:this.pageUp();break;}}});_4.declare("dijit.form.ComboBox",[_5.form.ValidationTextBox,_5.form.ComboBoxMixin],{_setValueAttr:function(_65,_66){if(!_65){_65="";}_5.form.ValidationTextBox.prototype._setValueAttr.call(this,_65,_66);}});_4.declare("dijit.form._ComboBoxDataStore",null,{constructor:function(_67){this.root=_67;_4.query("> option",_67).forEach(function(_68){_68.innerHTML=_4.trim(_68.innerHTML);});},getValue:function(_69,_6a,_6b){return (_6a=="value")?_69.value:(_69.innerText||_69.textContent||"");},isItemLoaded:function(_6c){return true;},getFeatures:function(){return {"dojo.data.api.Read":true,"dojo.data.api.Identity":true};},_fetchItems:function(_6d,_6e,_6f){if(!_6d.query){_6d.query={};}if(!_6d.query.name){_6d.query.name="";}if(!_6d.queryOptions){_6d.queryOptions={};}var _70=_4.data.util.filter.patternToRegExp(_6d.query.name,_6d.queryOptions.ignoreCase),_71=_4.query("> option",this.root).filter(function(_72){return (_72.innerText||_72.textContent||"").match(_70);});if(_6d.sort){_71.sort(_4.data.util.sorter.createSortFunction(_6d.sort,this));}_6e(_71,_6d);},close:function(_73){return;},getLabel:function(_74){return _74.innerHTML;},getIdentity:function(_75){return _4.attr(_75,"value");},fetchItemByIdentity:function(_76){var _77=_4.query("option[value='"+_76.identity+"']",this.root)[0];_76.onItem(_77);},fetchSelectedItem:function(){var _78=this.root,si=_78.selectedIndex;return _4.query("> option:nth-child("+(si!=-1?si+1:1)+")",_78)[0];}});_4.extend(_5.form._ComboBoxDataStore,_4.data.util.simpleFetch);}}};});