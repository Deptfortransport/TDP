/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.image.SlideShow"],["require","dojo.string"],["require","dojo.fx"],["require","dijit._Widget"],["require","dijit._Templated"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.image.SlideShow"]){_4._hasResource["dojox.image.SlideShow"]=true;_4.provide("dojox.image.SlideShow");_4.require("dojo.string");_4.require("dojo.fx");_4.require("dijit._Widget");_4.require("dijit._Templated");_4.declare("dojox.image.SlideShow",[_5._Widget,_5._Templated],{imageHeight:375,imageWidth:500,title:"",titleTemplate:"${title} <span class=\"slideShowCounterText\">(${current} of ${total})</span>",noLink:false,loop:true,hasNav:true,images:[],pageSize:20,autoLoad:true,autoStart:false,fixedHeight:false,imageStore:null,linkAttr:"link",imageLargeAttr:"imageUrl",titleAttr:"title",slideshowInterval:3,templateString:"<div dojoAttachPoint=\"outerNode\" class=\"slideShowWrapper\">\r\n\t<div style=\"position:relative;\" dojoAttachPoint=\"innerWrapper\">\r\n\t\t<div class=\"slideShowNav\" dojoAttachEvent=\"onclick: _handleClick\">\r\n\t\t\t<div class=\"dijitInline slideShowTitle\" dojoAttachPoint=\"titleNode\">${title}</div>\r\n\t\t</div>\r\n\t\t<div dojoAttachPoint=\"navNode\" class=\"slideShowCtrl\" dojoAttachEvent=\"onclick: _handleClick\">\r\n\t\t\t<span dojoAttachPoint=\"navPrev\" class=\"slideShowCtrlPrev\"></span>\r\n\t\t\t<span dojoAttachPoint=\"navPlay\" class=\"slideShowCtrlPlay\"></span>\r\n\t\t\t<span dojoAttachPoint=\"navNext\" class=\"slideShowCtrlNext\"></span>\r\n\t\t</div>\r\n\t\t<div dojoAttachPoint=\"largeNode\" class=\"slideShowImageWrapper\"></div>\t\t\r\n\t\t<div dojoAttachPoint=\"hiddenNode\" class=\"slideShowHidden\"></div>\r\n\t</div>\r\n</div>\r\n",_imageCounter:0,_tmpImage:null,_request:null,postCreate:function(){this.inherited(arguments);var _7=document.createElement("img");_7.setAttribute("width",this.imageWidth);_7.setAttribute("height",this.imageHeight);if(this.hasNav){_4.connect(this.outerNode,"onmouseover",this,function(_8){try{this._showNav();}catch(e){}});_4.connect(this.outerNode,"onmouseout",this,function(_9){try{this._hideNav(_9);}catch(e){}});}this.outerNode.style.width=this.imageWidth+"px";_7.setAttribute("src",this._blankGif);var _a=this;this.largeNode.appendChild(_7);this._tmpImage=this._currentImage=_7;this._fitSize(true);this._loadImage(0,_4.hitch(this,"showImage",0));this._calcNavDimensions();},setDataStore:function(_b,_c,_d){this.reset();var _e=this;this._request={query:{},start:_c.start||0,count:_c.count||this.pageSize,onBegin:function(_f,_10){_e.maxPhotos=_f;}};if(_c.query){_4.mixin(this._request.query,_c.query);}if(_d){_4.forEach(["imageLargeAttr","linkAttr","titleAttr"],function(_11){if(_d[_11]){this[_11]=_d[_11];}},this);}var _12=function(_13){_e.maxPhotos=_13.length;_e.showImage(0);_e._request.onComplete=null;if(_e.autoStart){_e.toggleSlideShow();}};this.imageStore=_b;this._request.onComplete=_12;this._request.start=0;this.imageStore.fetch(this._request);},reset:function(){while(this.largeNode.firstChild){this.largeNode.removeChild(this.largeNode.firstChild);}this.largeNode.appendChild(this._tmpImage);while(this.hiddenNode.firstChild){this.hiddenNode.removeChild(this.hiddenNode.firstChild);}_4.forEach(this.images,function(img){if(img&&img.parentNode){img.parentNode.removeChild(img);}});this.images=[];this.isInitialized=false;this._imageCounter=0;},isImageLoaded:function(_15){return this.images&&this.images.length>_15&&this.images[_15];},moveImageLoadingPointer:function(_16){this._imageCounter=_16;},destroy:function(){if(this._slideId){this._stop();}this.inherited(arguments);},showNextImage:function(_17,_18){if(_17&&this._timerCancelled){return false;}if(this.imageIndex+1>=this.maxPhotos){if(_17&&(this.loop||_18)){this.imageIndex=-1;}else{if(this._slideId){this._stop();}return false;}}this.showImage(this.imageIndex+1,_4.hitch(this,function(){if(_17){this._startTimer();}}));return true;},toggleSlideShow:function(){if(this._slideId){this._stop();}else{_4.toggleClass(this.domNode,"slideShowPaused");this._timerCancelled=false;if(this.images[this.imageIndex]&&this.images[this.imageIndex]._img.complete){var _19=this.showNextImage(true,true);if(!_19){this._stop();}}else{var idx=this.imageIndex;var _1b=_4.subscribe(this.getShowTopicName(),_4.hitch(this,function(_1c){setTimeout(_4.hitch(this,function(){if(_1c.index==idx){var _1d=this.showNextImage(true,true);if(!_1d){this._stop();}_4.unsubscribe(_1b);}}),this.slideshowInterval*1000);}));_4.publish(this.getShowTopicName(),[{index:idx,title:"",url:""}]);}}},getShowTopicName:function(){return (this.widgetId||this.id)+"/imageShow";},getLoadTopicName:function(){return (this.widgetId?this.widgetId:this.id)+"/imageLoad";},showImage:function(_1e,_1f){if(!_1f&&this._slideId){this.toggleSlideShow();}var _20=this;var _21=this.largeNode.getElementsByTagName("div");this.imageIndex=_1e;var _22=function(){if(_20.images[_1e]){while(_20.largeNode.firstChild){_20.largeNode.removeChild(_20.largeNode.firstChild);}_4.style(_20.images[_1e],"opacity",0);_20.largeNode.appendChild(_20.images[_1e]);_20._currentImage=_20.images[_1e]._img;_20._fitSize();var _23=function(a,b,c){var img=_20.images[_1e].firstChild;if(img.tagName.toLowerCase()!="img"){img=img.firstChild;}var _28=img.getAttribute("title")||"";if(_20._navShowing){_20._showNav(true);}_4.publish(_20.getShowTopicName(),[{index:_1e,title:_28,url:img.getAttribute("src")}]);if(_1f){_1f(a,b,c);}_20._setTitle(_28);};_4.fadeIn({node:_20.images[_1e],duration:300,onEnd:_23}).play();}else{_20._loadImage(_1e,function(){_4.publish(_20.getLoadTopicName(),[_1e]);_20.showImage(_1e,_1f);});}};if(_21&&_21.length>0){_4.fadeOut({node:_21[0],duration:300,onEnd:function(){_20.hiddenNode.appendChild(_21[0]);_22();}}).play();}else{_22();}},_fitSize:function(_29){if(!this.fixedHeight||_29){var _2a=(this._currentImage.height+(this.hasNav?20:0));_4.style(this.innerWrapper,"height",_2a+"px");return;}_4.style(this.largeNode,"paddingTop",this._getTopPadding()+"px");},_getTopPadding:function(){if(!this.fixedHeight){return 0;}return (this.imageHeight-this._currentImage.height)/2;},_loadNextImage:function(){if(!this.autoLoad){return;}while(this.images.length>=this._imageCounter&&this.images[this._imageCounter]){this._imageCounter++;}this._loadImage(this._imageCounter);},_loadImage:function(_2b,_2c){if(this.images[_2b]||!this._request){return;}var _2d=_2b-(_2b%this.pageSize);this._request.start=_2d;this._request.onComplete=function(_2e){var _2f=_2b-_2d;if(_2e&&_2e.length>_2f){_30(_2e[_2f]);}else{}};var _31=this;var _30=function(_32){var url=_31.imageStore.getValue(_32,_31.imageLargeAttr);var img=new Image();var div=document.createElement("div");div._img=img;var _36=_31.imageStore.getValue(_32,_31.linkAttr);if(!_36||_31.noLink){div.appendChild(img);}else{var a=document.createElement("a");a.setAttribute("href",_36);a.setAttribute("target","_blank");div.appendChild(a);a.appendChild(img);}div.setAttribute("id",_31.id+"_imageDiv"+_2b);_4.connect(img,"onload",function(){_31._fitImage(img);div.setAttribute("width",_31.imageWidth);div.setAttribute("height",_31.imageHeight);_4.publish(_31.getLoadTopicName(),[_2b]);setTimeout(_31._loadNextImage,1);if(_2c){_2c();}});_31.hiddenNode.appendChild(div);var _38=document.createElement("div");_4.addClass(_38,"slideShowTitle");div.appendChild(_38);_31.images[_2b]=div;img.setAttribute("src",url);var _39=_31.imageStore.getValue(_32,_31.titleAttr);if(_39){img.setAttribute("title",_39);}};this.imageStore.fetch(this._request);},_stop:function(){if(this._slideId){clearTimeout(this._slideId);}this._slideId=null;this._timerCancelled=true;_4.removeClass(this.domNode,"slideShowPaused");},_prev:function(){if(this.imageIndex<1){return;}this.showImage(this.imageIndex-1);},_next:function(){this.showNextImage();},_startTimer:function(){var id=this.id;this._slideId=setTimeout(function(){_5.byId(id).showNextImage(true);},this.slideshowInterval*1000);},_calcNavDimensions:function(){_4.style(this.navNode,"position","absolute");_4.style(this.navNode,"top","-10000px");_4._setOpacity(this.navNode,99);this.navPlay._size=_4.marginBox(this.navPlay);this.navPrev._size=_4.marginBox(this.navPrev);this.navNext._size=_4.marginBox(this.navNext);_4._setOpacity(this.navNode,0);_4.style(this.navNode,"position","");_4.style(this.navNode,"top","");},_setTitle:function(_3b){this.titleNode.innerHTML=_4.string.substitute(this.titleTemplate,{title:_3b,current:1+this.imageIndex,total:this.maxPhotos||""});},_fitImage:function(img){var _3d=img.width;var _3e=img.height;if(_3d>this.imageWidth){_3e=Math.floor(_3e*(this.imageWidth/_3d));img.height=_3e;img.width=_3d=this.imageWidth;}if(_3e>this.imageHeight){_3d=Math.floor(_3d*(this.imageHeight/_3e));img.height=this.imageHeight;img.width=_3d;}},_handleClick:function(e){switch(e.target){case this.navNext:this._next();break;case this.navPrev:this._prev();break;case this.navPlay:this.toggleSlideShow();break;}},_showNav:function(_40){if(this._navShowing&&!_40){return;}_4.style(this.navNode,"marginTop","0px");_4.style(this.navPlay,"marginLeft","0px");var _41=_4.marginBox(this.outerNode);var _42=this._currentImage.height-this.navPlay._size.h-10+this._getTopPadding();if(_42>this._currentImage.height){_42+=10;}_4[this.imageIndex<1?"addClass":"removeClass"](this.navPrev,"slideShowCtrlHide");_4[this.imageIndex+1>=this.maxPhotos?"addClass":"removeClass"](this.navNext,"slideShowCtrlHide");var _43=this;if(this._navAnim){this._navAnim.stop();}if(this._navShowing){return;}this._navAnim=_4.fadeIn({node:this.navNode,duration:300,onEnd:function(){_43._navAnim=null;}});this._navAnim.play();this._navShowing=true;},_hideNav:function(e){if(!e||!this._overElement(this.outerNode,e)){var _45=this;if(this._navAnim){this._navAnim.stop();}this._navAnim=_4.fadeOut({node:this.navNode,duration:300,onEnd:function(){_45._navAnim=null;}});this._navAnim.play();this._navShowing=false;}},_overElement:function(_46,e){if(typeof (_4)=="undefined"){return false;}_46=_4.byId(_46);var m={x:e.pageX,y:e.pageY};var bb=_4._getBorderBox(_46);var _4a=_4.coords(_46,true);var _4b=_4a.x;return (m.x>=_4b&&m.x<=(_4b+bb.w)&&m.y>=_4a.y&&m.y<=(top+bb.h));}});}}};});