/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.gfx3d.lighting"],["require","dojox.gfx._base"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.gfx3d.lighting"]){_4._hasResource["dojox.gfx3d.lighting"]=true;_4.provide("dojox.gfx3d.lighting");_4.require("dojox.gfx._base");(function(){var _7=_6.gfx3d.lighting;_4.mixin(_6.gfx3d.lighting,{black:function(){return {r:0,g:0,b:0,a:1};},white:function(){return {r:1,g:1,b:1,a:1};},toStdColor:function(c){c=_6.gfx.normalizeColor(c);return {r:c.r/255,g:c.g/255,b:c.b/255,a:c.a};},fromStdColor:function(c){return new _4.Color([Math.round(255*c.r),Math.round(255*c.g),Math.round(255*c.b),c.a]);},scaleColor:function(s,c){return {r:s*c.r,g:s*c.g,b:s*c.b,a:s*c.a};},addColor:function(a,b){return {r:a.r+b.r,g:a.g+b.g,b:a.b+b.b,a:a.a+b.a};},multiplyColor:function(a,b){return {r:a.r*b.r,g:a.g*b.g,b:a.b*b.b,a:a.a*b.a};},saturateColor:function(c){return {r:c.r<0?0:c.r>1?1:c.r,g:c.g<0?0:c.g>1?1:c.g,b:c.b<0?0:c.b>1?1:c.b,a:c.a<0?0:c.a>1?1:c.a};},mixColor:function(c1,c2,s){return _7.addColor(_7.scaleColor(s,c1),_7.scaleColor(1-s,c2));},diff2Color:function(c1,c2){var r=c1.r-c2.r;var g=c1.g-c2.g;var b=c1.b-c2.b;var a=c1.a-c2.a;return r*r+g*g+b*b+a*a;},length2Color:function(c){return c.r*c.r+c.g*c.g+c.b*c.b+c.a*c.a;},dot:function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z;},scale:function(s,v){return {x:s*v.x,y:s*v.y,z:s*v.z};},add:function(a,b){return {x:a.x+b.x,y:a.y+b.y,z:a.z+b.z};},saturate:function(v){return Math.min(Math.max(v,0),1);},length:function(v){return Math.sqrt(_6.gfx3d.lighting.dot(v,v));},normalize:function(v){return _7.scale(1/_7.length(v),v);},faceforward:function(n,i){var p=_6.gfx3d.lighting;var s=p.dot(i,n)<0?1:-1;return p.scale(s,n);},reflect:function(i,n){var p=_6.gfx3d.lighting;return p.add(i,p.scale(-2*p.dot(i,n),n));},diffuse:function(_2b,_2c){var c=_7.black();for(var i=0;i<_2c.length;++i){var l=_2c[i],d=_7.dot(_7.normalize(l.direction),_2b);c=_7.addColor(c,_7.scaleColor(d,l.color));}return _7.saturateColor(c);},specular:function(_31,v,_33,_34){var c=_7.black();for(var i=0;i<_34.length;++i){var l=_34[i],h=_7.normalize(_7.add(_7.normalize(l.direction),v)),s=Math.pow(Math.max(0,_7.dot(_31,h)),1/_33);c=_7.addColor(c,_7.scaleColor(s,l.color));}return _7.saturateColor(c);},phong:function(_3a,v,_3c,_3d){_3a=_7.normalize(_3a);var c=_7.black();for(var i=0;i<_3d.length;++i){var l=_3d[i],r=_7.reflect(_7.scale(-1,_7.normalize(v)),_3a),s=Math.pow(Math.max(0,_7.dot(r,_7.normalize(l.direction))),_3c);c=_7.addColor(c,_7.scaleColor(s,l.color));}return _7.saturateColor(c);}});_4.declare("dojox.gfx3d.lighting.Model",null,{constructor:function(_43,_44,_45,_46){this.incident=_7.normalize(_43);this.lights=[];for(var i=0;i<_44.length;++i){var l=_44[i];this.lights.push({direction:_7.normalize(l.direction),color:_7.toStdColor(l.color)});}this.ambient=_7.toStdColor(_45.color?_45.color:"white");this.ambient=_7.scaleColor(_45.intensity,this.ambient);this.ambient=_7.scaleColor(this.ambient.a,this.ambient);this.ambient.a=1;this.specular=_7.toStdColor(_46?_46:"white");this.specular=_7.scaleColor(this.specular.a,this.specular);this.specular.a=1;this.npr_cool={r:0,g:0,b:0.4,a:1};this.npr_warm={r:0.4,g:0.4,b:0.2,a:1};this.npr_alpha=0.2;this.npr_beta=0.6;this.npr_scale=0.6;},constant:function(_49,_4a,_4b){_4b=_7.toStdColor(_4b);var _4c=_4b.a,_4d=_7.scaleColor(_4c,_4b);_4d.a=_4c;return _7.fromStdColor(_7.saturateColor(_4d));},matte:function(_4e,_4f,_50){if(typeof _4f=="string"){_4f=_7.finish[_4f];}_50=_7.toStdColor(_50);_4e=_7.faceforward(_7.normalize(_4e),this.incident);var _51=_7.scaleColor(_4f.Ka,this.ambient),_52=_7.saturate(-4*_7.dot(_4e,this.incident)),_53=_7.scaleColor(_52*_4f.Kd,_7.diffuse(_4e,this.lights)),_54=_7.scaleColor(_50.a,_7.multiplyColor(_50,_7.addColor(_51,_53)));_54.a=_50.a;return _7.fromStdColor(_7.saturateColor(_54));},metal:function(_55,_56,_57){if(typeof _56=="string"){_56=_7.finish[_56];}_57=_7.toStdColor(_57);_55=_7.faceforward(_7.normalize(_55),this.incident);var v=_7.scale(-1,this.incident),_59,_5a,_5b=_7.scaleColor(_56.Ka,this.ambient),_5c=_7.saturate(-4*_7.dot(_55,this.incident));if("phong" in _56){_59=_7.scaleColor(_5c*_56.Ks*_56.phong,_7.phong(_55,v,_56.phong_size,this.lights));}else{_59=_7.scaleColor(_5c*_56.Ks,_7.specular(_55,v,_56.roughness,this.lights));}_5a=_7.scaleColor(_57.a,_7.addColor(_7.multiplyColor(_57,_5b),_7.multiplyColor(this.specular,_59)));_5a.a=_57.a;return _7.fromStdColor(_7.saturateColor(_5a));},plastic:function(_5d,_5e,_5f){if(typeof _5e=="string"){_5e=_7.finish[_5e];}_5f=_7.toStdColor(_5f);_5d=_7.faceforward(_7.normalize(_5d),this.incident);var v=_7.scale(-1,this.incident),_61,_62,_63=_7.scaleColor(_5e.Ka,this.ambient),_64=_7.saturate(-4*_7.dot(_5d,this.incident)),_65=_7.scaleColor(_64*_5e.Kd,_7.diffuse(_5d,this.lights));if("phong" in _5e){_61=_7.scaleColor(_64*_5e.Ks*_5e.phong,_7.phong(_5d,v,_5e.phong_size,this.lights));}else{_61=_7.scaleColor(_64*_5e.Ks,_7.specular(_5d,v,_5e.roughness,this.lights));}_62=_7.scaleColor(_5f.a,_7.addColor(_7.multiplyColor(_5f,_7.addColor(_63,_65)),_7.multiplyColor(this.specular,_61)));_62.a=_5f.a;return _7.fromStdColor(_7.saturateColor(_62));},npr:function(_66,_67,_68){if(typeof _67=="string"){_67=_7.finish[_67];}_68=_7.toStdColor(_68);_66=_7.faceforward(_7.normalize(_66),this.incident);var _69=_7.scaleColor(_67.Ka,this.ambient),_6a=_7.saturate(-4*_7.dot(_66,this.incident)),_6b=_7.scaleColor(_6a*_67.Kd,_7.diffuse(_66,this.lights)),_6c=_7.scaleColor(_68.a,_7.multiplyColor(_68,_7.addColor(_69,_6b))),_6d=_7.addColor(this.npr_cool,_7.scaleColor(this.npr_alpha,_6c)),_6e=_7.addColor(this.npr_warm,_7.scaleColor(this.npr_beta,_6c)),d=(1+_7.dot(this.incident,_66))/2,_6c=_7.scaleColor(this.npr_scale,_7.addColor(_6c,_7.mixColor(_6d,_6e,d)));_6c.a=_68.a;return _7.fromStdColor(_7.saturateColor(_6c));}});})();_6.gfx3d.lighting.finish={defaults:{Ka:0.1,Kd:0.6,Ks:0,roughness:0.05},dull:{Ka:0.1,Kd:0.6,Ks:0.5,roughness:0.15},shiny:{Ka:0.1,Kd:0.6,Ks:1,roughness:0.001},glossy:{Ka:0.1,Kd:0.6,Ks:1,roughness:0.0001},phong_dull:{Ka:0.1,Kd:0.6,Ks:0.5,phong:0.5,phong_size:1},phong_shiny:{Ka:0.1,Kd:0.6,Ks:1,phong:1,phong_size:200},phong_glossy:{Ka:0.1,Kd:0.6,Ks:1,phong:1,phong_size:300},luminous:{Ka:1,Kd:0,Ks:0,roughness:0.05},metalA:{Ka:0.35,Kd:0.3,Ks:0.8,roughness:1/20},metalB:{Ka:0.3,Kd:0.4,Ks:0.7,roughness:1/60},metalC:{Ka:0.25,Kd:0.5,Ks:0.8,roughness:1/80},metalD:{Ka:0.15,Kd:0.6,Ks:0.8,roughness:1/100},metalE:{Ka:0.1,Kd:0.7,Ks:0.8,roughness:1/120}};}}};});