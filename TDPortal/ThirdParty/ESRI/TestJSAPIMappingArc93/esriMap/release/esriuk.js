/**
*   This is a compiled version of ESRI (UK) Custom JavaScript library
*   For use with the ESRI JavaScript API
*   @copyright: ESRI (UK) 2009
*   @author: Sam Larsen, ESRI (UK), slarsen@esriuk.com
*   @date: September 2009
*/
if(!dojo._hasResource["ESRIUK.Util"]){dojo._hasResource["ESRIUK.Util"]=true;if(typeof ESRIUK=="undefined"){ESRIUK={};}ESRIUK.Util=ESRIUK.Util||{};dojo._loadedModules["ESRIUK.Util"]=ESRIUK.Util;dojo.declare("ESRIUK.Util",null,(function(){var _1=function(_2){var s=typeof _2;if(s==="object"){if(_2){if(typeof _2.length==="number"&&!(_2.propertyIsEnumerable("length"))&&typeof _2.splice==="function"){s="array";}}else{s="null";}}return s;};var _4=function(o){var i,v;if(_1(o)==="object"){for(i in o){v=o[i];if(v!==undefined&&_1(v)!=="function"){return false;}}}return true;};String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");};String.prototype.quote=function(){var c,i,l=this.length,o="\"";for(i=0;i<l;i+=1){c=this.charAt(i);if(c>=" "){if(c==="\\"||c==="\""){o+="\\";}o+=c;}else{switch(c){case "\b":o+="\\b";break;case "\f":o+="\\f";break;case "\n":o+="\\n";break;case "\r":o+="\\r";break;case "\t":o+="\\t";break;default:c=c.charCodeAt();o+="\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16);}}}return o+"\"";};String.prototype.supplant=function(o){return this.replace(/{([^{}]*)}/g,function(a,b){var r=o[b];return typeof r==="string"||typeof r==="number"?r:a;});};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};String.prototype.camelCase=function(){var s=trim(this);return (/\S[A-Z]/.test(s))?s.replace(/(.)([A-Z])/g,function(t,a,b){return a+" "+b.toLowerCase();}):s.replace(/( )([a-z])/g,function(t,a,b){return b.toUpperCase();});};return {_logLevel:0,degrees:"<span class='degrees'>&deg;</span>",isValid:false,jsonESRITemplate:{result:{geometryType:"",displayFieldName:"",fieldAliases:null,spatialReference:null,features:[]}},constructor:function(){this.isValid=true;if(this.isNothing(window.console)){this.setupDummyConsole();}this._getURLParams();if(this._logLevel<1){var fcn=function(){return false;};this.logMessage=this.logDebug=this.logInfo=this.logWarning=this.logError=fcn;}else{this.log=this.logMessage;this.debug=this.logDebug;this.info=this.logInfo;this.warn=this.logWarning;this.error=this.logError;}},isNothing:function(){if(arguments.length<1){return true;}var _18=function(obj){return obj===undefined||obj===null;};for(var i=0;i<arguments.length;i++){if(!_18(arguments[0])){return false;}}return true;},isBoolean:function(){if(arguments.length<1){return false;}var _1b=function(obj){return _1(obj)==="boolean";};for(var i=0;i<arguments.length;i++){if(!_1b(arguments[0])){return false;}}return true;},isObject:function(){if(arguments.length<1){return false;}var _1e=function(obj){return _1(obj)==="object";};for(var i=0;i<arguments.length;i++){if(!_1e(arguments[0])){return false;}}return true;},isString:function(){if(arguments.length<1){return false;}var _21=function(obj){return _1(obj)==="string";};for(var i=0;i<arguments.length;i++){if(!_21(arguments[0])){return false;}}return true;},isArray:function(){if(arguments.length<1){return false;}var _24=function(obj){return _1(obj)==="array";};for(var i=0;i<arguments.length;i++){if(!_24(arguments[0])){return false;}}return true;},isNumber:function(){if(arguments.length<1){return false;}var _27=this;var _28=function(obj){if(!_27.isNothing(obj)){if(typeof obj==="string"){if(isNaN(obj)){return false;}else{return true;}}else{if(typeof obj==="number"){return true;}else{return false;}}}else{return false;}};for(var i=0;i<arguments.length;i++){if(!_28(arguments[i])){return false;}}return true;},isStringPopulated:function(obj){return this.isString(obj)&&obj.length>0;},isArrayPopulated:function(obj){return this.isArray(obj)&&obj.length>0;},parseBool:function(obj){if(this.isBoolean(obj)){return obj;}else{if(this.isString(obj)){return (obj.toLowerCase()==="true");}else{return false;}}},parseNumber:function(obj){if(this.isNumber(obj)){return obj*1;}else{this.warn(this.declaredClass,arguments.callee.nom," Could not parse number ",obj);}},isValidXY:function(obj){if(this.isObject(obj)&&this.isNumber(obj.x,obj.y)){return true;}return false;},isValidWH:function(obj){if(this.isObject(obj)&&this.isNumber(obj.w,obj.h)){return true;}return false;},isValidExt:function(obj){if(this.isObject(obj)&&this.isNumber(obj.xmin,obj.ymin,obj.xmax,obj.ymax)){return true;}return false;},validateXY:function(obj){if(this.isString(obj.x)){obj.x=parseFloat(obj.x);}if(this.isString(obj.y)){obj.y=parseFloat(obj.y);}return obj;},validateExt:function(ext){if(typeof ext.xmin==="string"){ext.xmin=parseFloat(ext.xmin);}if(typeof ext.ymin==="string"){ext.ymin=parseFloat(ext.ymin);}if(typeof ext.xmax==="string"){ext.xmax=parseFloat(ext.xmax);}if(typeof ext.ymax==="string"){ext.ymax=parseFloat(ext.ymax);}return ext;},getElmGutterVertical:function(elm){var _35=0;_35+=dojo.style(elm,"paddingLeft");_35+=dojo.style(elm,"paddingRight");return _35;},getElmGutterHorizontal:function(elm){var _37=0;_37+=dojo.style(elm,"paddingTop");_37+=dojo.style(elm,"paddingBottom");return _37;},getST_GeometryExtent:function(ext){var x=ext.toJson();return x.xmin+" "+x.ymin+", "+x.xmin+" "+x.ymax+", "+x.xmax+" "+x.ymax+", "+x.xmax+" "+x.ymin+","+x.xmin+" "+x.ymin;},getESRIJsonExtent:function(ext){var _3b=ext.toJson();_3b.spatialReference="";return _3b;},getValidJSONResponse:function(_3c){var _3d=this.jsonESRITemplate.result;try{var _3e=_3c.result||undefined;if(typeof _3e==="string"){_3e=dojo.fromJson(_3c.result);}else{if(typeof _3e==="object"&&typeof _3e.features==="object"&&typeof _3e.features.length==="number"){_3d=_3e;if(typeof _3e.displayFieldName!=="string"){_3d.displayFieldName="";}if(typeof _3e.geometryType!=="string"){_3d.geometryType="";}if(typeof _3e.fieldAliases!=="object"){_3d.fieldAliases=null;}if(typeof _3e.spatialReference!=="object"){_3d.spatialReference=null;}}else{}}}catch(err){}return _3d;},getValidGraphic:function(obj){var _40=null;var x=obj.x||null;var y=obj.y||null;var _43=obj.paths||null;var _44=obj.rings||null;var _45=obj.spatialReference;if(x&&y){_40=new esri.geometry.Point([x,y],new esri.SpatialReference(_45));}else{if(_43){_40=new esri.geometry.Polyline(obj);}else{if(_44){_40=new esri.geometry.Polygon(obj);}}}return _40;},getPtExtent:function(pt){return new esri.geometry.Extent(pt.x,pt.y,pt.x,pt.y,pt.spatialReference);},formatConnect:function(_47,_48){return {handle:_47,name:_48};},arguments2Array:function(obj){return Array.prototype.slice.call(obj);},setupDummyConsole:function(){window.console={log:function(){return false;},debug:function(){return false;},warn:function(){return false;},info:function(){return false;},error:function(){return false;}};},logMessage:function(){if(this._logLevel>4){}},logDebug:function(){if(this._logLevel>3){}},logInfo:function(){if(this._logLevel>2){}},logWarning:function(){if(this._logLevel>1){}},logError:function(){if(this._logLevel>0){}},log:function(){return false;},debug:function(){return false;},info:function(){return false;},warn:function(){return false;},error:function(){return false;},_getURLParams:function(){try{if(this.isStringPopulated(window.location.search)){var _4a=dojo.queryToObject(window.location.search.slice(1));if(this.isNumber(_4a.debug)){this._setDebugLevel(parseInt(_4a.debug));}}}catch(err){this.log(this.declaredClass,arguments.callee.nom,err,window.location);}},_setDebugLevel:function(obj){if(obj>-1&&obj<6){this._logLevel=obj*1;}}};})());ESRIUK._util=null;ESRIUK.util=function(){if(ESRIUK._util===null){ESRIUK._util=new ESRIUK.Util();}return ESRIUK._util;};}if(!dojo._hasResource["dijit._Contained"]){dojo._hasResource["dijit._Contained"]=true;if(typeof dijit=="undefined"){dijit={};}dijit._Contained=dijit._Contained||{};dojo._loadedModules["dijit._Contained"]=dijit._Contained;dojo.declare("dijit._Contained",null,{getParent:function(){for(var p=this.domNode.parentNode;p;p=p.parentNode){var id=p.getAttribute&&p.getAttribute("widgetId");if(id){var _4e=dijit.byId(id);return _4e.isContainer?_4e:null;}}return null;},_getSibling:function(_4f){var _50=this.domNode;do{_50=_50[_4f+"Sibling"];}while(_50&&_50.nodeType!=1);if(!_50){return null;}var id=_50.getAttribute("widgetId");return dijit.byId(id);},getPreviousSibling:function(){return this._getSibling("previous");},getNextSibling:function(){return this._getSibling("next");},getIndexInParent:function(){var p=this.getParent();if(!p||!p.getIndexOfChild){return -1;}return p.getIndexOfChild(this);}});}if(!dojo._hasResource["dijit.form.TextBox"]){dojo._hasResource["dijit.form.TextBox"]=true;dijit.form=dijit.form||{};dijit.form.TextBox=dijit.form.TextBox||{};dojo._loadedModules["dijit.form.TextBox"]=dijit.form.TextBox;dojo.declare("dijit.form.TextBox",dijit.form._FormValueWidget,{trim:false,uppercase:false,lowercase:false,propercase:false,maxLength:"",templateString:"<input class=\"dijit dijitReset dijitLeft\" dojoAttachPoint='textbox,focusNode'\r\n\tdojoAttachEvent='onmouseenter:_onMouse,onmouseleave:_onMouse'\r\n\tautocomplete=\"off\" type=\"${type}\" ${nameAttrSetting}\r\n\t/>\r\n",baseClass:"dijitTextBox",attributeMap:dojo.delegate(dijit.form._FormValueWidget.prototype.attributeMap,{maxLength:"focusNode"}),_getValueAttr:function(){return this.parse(this.attr("displayedValue"),this.constraints);},_setValueAttr:function(_53,_54,_55){var _56;if(_53!==undefined){_56=this.filter(_53);if(typeof _55!="string"){if(_56!==null&&((typeof _56!="number")||!isNaN(_56))){_55=this.filter(this.format(_56,this.constraints));}else{_55="";}}}if(_55!=null&&_55!=undefined&&((typeof _55)!="number"||!isNaN(_55))&&this.textbox.value!=_55){this.textbox.value=_55;}this.inherited(arguments,[_56,_54]);},displayedValue:"",getDisplayedValue:function(){dojo.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use attr('displayedValue') instead.","","2.0");return this.attr("displayedValue");},_getDisplayedValueAttr:function(){return this.filter(this.textbox.value);},setDisplayedValue:function(_57){dojo.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use attr('displayedValue', ...) instead.","","2.0");this.attr("displayedValue",_57);},_setDisplayedValueAttr:function(_58){if(_58===null||_58===undefined){_58="";}else{if(typeof _58!="string"){_58=String(_58);}}this.textbox.value=_58;this._setValueAttr(this.attr("value"),undefined,_58);},format:function(_59,_5a){return ((_59==null||_59==undefined)?"":(_59.toString?_59.toString():_59));},parse:function(_5b,_5c){return _5b;},_refreshState:function(){},_onInput:function(e){if(e&&e.type&&/key/i.test(e.type)&&e.keyCode){switch(e.keyCode){case dojo.keys.SHIFT:case dojo.keys.ALT:case dojo.keys.CTRL:case dojo.keys.TAB:return;}}if(this.intermediateChanges){var _5e=this;setTimeout(function(){_5e._handleOnChange(_5e.attr("value"),false);},0);}this._refreshState();},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);if(dojo.isMoz||dojo.isOpera){this.connect(this.textbox,"oninput",this._onInput);}else{this.connect(this.textbox,"onkeydown",this._onInput);this.connect(this.textbox,"onkeyup",this._onInput);this.connect(this.textbox,"onpaste",this._onInput);this.connect(this.textbox,"oncut",this._onInput);}this._layoutHack();},_blankValue:"",filter:function(val){if(val===null){return this._blankValue;}if(typeof val!="string"){return val;}if(this.trim){val=dojo.trim(val);}if(this.uppercase){val=val.toUpperCase();}if(this.lowercase){val=val.toLowerCase();}if(this.propercase){val=val.replace(/[^\s]+/g,function(_60){return _60.substring(0,1).toUpperCase()+_60.substring(1);});}return val;},_setBlurValue:function(){this._setValueAttr(this.attr("value"),true);},_onBlur:function(e){if(this.disabled){return;}this._setBlurValue();this.inherited(arguments);},_onFocus:function(e){if(this.disabled){return;}this._refreshState();this.inherited(arguments);},reset:function(){this.textbox.value="";this.inherited(arguments);}});dijit.selectInputText=function(_63,_64,_65){var _66=dojo.global;var _67=dojo.doc;_63=dojo.byId(_63);if(isNaN(_64)){_64=0;}if(isNaN(_65)){_65=_63.value?_63.value.length:0;}_63.focus();if(_67["selection"]&&dojo.body()["createTextRange"]){if(_63.createTextRange){var _68=_63.createTextRange();with(_68){collapse(true);moveStart("character",_64);moveEnd("character",_65);select();}}}else{if(_66["getSelection"]){var _69=_66.getSelection();if(_63.setSelectionRange){_63.setSelectionRange(_64,_65);}}}};}if(!dojo._hasResource["dojo.io.script"]){dojo._hasResource["dojo.io.script"]=true;if(typeof dojo=="undefined"){dojo={};}dojo.io=dojo.io||{};dojo.io.script=dojo.io.script||{};dojo._loadedModules["dojo.io.script"]=dojo.io.script;dojo.io.script={get:function(_6a){var dfd=this._makeScriptDeferred(_6a);var _6c=dfd.ioArgs;dojo._ioAddQueryToUrl(_6c);if(this._canAttach(_6c)){this.attach(_6c.id,_6c.url,_6a.frameDoc);}dojo._ioWatch(dfd,this._validCheck,this._ioCheck,this._resHandle);return dfd;},attach:function(id,url,_6f){var doc=(_6f||dojo.doc);var _71=doc.createElement("script");_71.type="text/javascript";_71.src=url;_71.id=id;_71.charset="utf-8";doc.getElementsByTagName("head")[0].appendChild(_71);},remove:function(id,_73){dojo.destroy(dojo.byId(id,_73));if(this["jsonp_"+id]){delete this["jsonp_"+id];}},_makeScriptDeferred:function(_74){var dfd=dojo._ioSetArgs(_74,this._deferredCancel,this._deferredOk,this._deferredError);var _76=dfd.ioArgs;_76.id=dojo._scopeName+"IoScript"+(this._counter++);_76.canDelete=false;if(_74.callbackParamName){_76.query=_76.query||"";if(_76.query.length>0){_76.query+="&";}_76.query+=_74.callbackParamName+"="+(_74.frameDoc?"parent.":"")+dojo._scopeName+".io.script.jsonp_"+_76.id+"._jsonpCallback";_76.frameDoc=_74.frameDoc;_76.canDelete=true;dfd._jsonpCallback=this._jsonpCallback;this["jsonp_"+_76.id]=dfd;}return dfd;},_deferredCancel:function(dfd){dfd.canceled=true;if(dfd.ioArgs.canDelete){dojo.io.script._addDeadScript(dfd.ioArgs);}},_deferredOk:function(dfd){if(dfd.ioArgs.canDelete){dojo.io.script._addDeadScript(dfd.ioArgs);}if(dfd.ioArgs.json){return dfd.ioArgs.json;}else{return dfd.ioArgs;}},_deferredError:function(_79,dfd){if(dfd.ioArgs.canDelete){if(_79.dojoType=="timeout"){dojo.io.script.remove(dfd.ioArgs.id,dfd.ioArgs.frameDoc);}else{dojo.io.script._addDeadScript(dfd.ioArgs);}}return _79;},_deadScripts:[],_counter:1,_addDeadScript:function(_7b){dojo.io.script._deadScripts.push({id:_7b.id,frameDoc:_7b.frameDoc});_7b.frameDoc=null;},_validCheck:function(dfd){var _7d=dojo.io.script;var _7e=_7d._deadScripts;if(_7e&&_7e.length>0){for(var i=0;i<_7e.length;i++){_7d.remove(_7e[i].id,_7e[i].frameDoc);_7e[i].frameDoc=null;}dojo.io.script._deadScripts=[];}return true;},_ioCheck:function(dfd){if(dfd.ioArgs.json){return true;}var _81=dfd.ioArgs.args.checkString;if(_81&&eval("typeof("+_81+") != 'undefined'")){return true;}return false;},_resHandle:function(dfd){if(dojo.io.script._ioCheck(dfd)){dfd.callback(dfd);}else{dfd.errback(new Error("inconceivable dojo.io.script._resHandle error"));}},_canAttach:function(_83){return true;},_jsonpCallback:function(_84){this.ioArgs.json=_84;}};}if(!dojo._hasResource["ESRIUK.Dijits.Loading"]){dojo._hasResource["ESRIUK.Dijits.Loading"]=true;(function(){ESRIUK.Dijits=ESRIUK.Dijits||{};ESRIUK.Dijits.Loading=ESRIUK.Dijits.Loading||{};dojo._loadedModules["ESRIUK.Dijits.Loading"]=ESRIUK.Dijits.Loading;var _85=ESRIUK.util();dojo.declare("ESRIUK.Dijits.Loading",[dijit._Widget,dijit._Templated],{counter:0,templateString:"<div class='mapOverlay semiTransparent loadingIcon mapPanel noDisplay'><img src='${imagePath}ajax-loader.gif' /><span>&nbsp;&nbsp;Loading&nbsp;...&nbsp;</span></div>",imagePath:dojo.moduleUrl("ESRIUK.Dijits","images/Loading/"),loadingMaxTime:30000,loadingTimer:null,toggle:function(on){var _87=this;on=_85.isBoolean(on)?on:false;if(_85.isNumber(this.loadingTimer)){clearTimeout(this.loadingTimer);}if(on){this.counter++;if(this.counter==1){this.domNode.style.display="block";}}else{this.counter--;if(this.counter<1){this.domNode.style.display="none";}if(this.counter<0){this.counter=0;}}if(this.counter>0){this.loadingTimer=setTimeout(function(){_87.switchOff();},this.loadingMaxTime);}},switchOff:function(){this.counter=0;this.domNode.style.display="none";}});})();}if(!dojo._hasResource["ESRIUK.Dijits.Query"]){dojo._hasResource["ESRIUK.Dijits.Query"]=true;ESRIUK.Dijits.Query=ESRIUK.Dijits.Query||{};dojo._loadedModules["ESRIUK.Dijits.Query"]=ESRIUK.Dijits.Query;dojo.declare("ESRIUK.Dijits.Query",esri.layers.Layer,(function(){var _88=ESRIUK.util(),_89=ESRIUK.config();sConfig=null,jsonHandler=null;return {loaded:false,_extentQueries:0,_loading:function(){return false;},setLoading:function(fcn){this._loading=fcn;},constructor:function(_8b,_8c){sConfig=_8b;this._loading=_8c;this._loading(true);this._checkConfig();this._loadJSONHandler();},onLoad:function(){this.inherited(arguments);this._loading(false);},_cleanUp:function(){this.loaded=false;this._extentQueries=0;},_checkConfig:function(){if(!_88.isObject(sConfig.errorStrings)){sConfig.errorStrings={};}},_load:function(){this._loaded=true;jsonHandler=new TransportDirectQueryWebService();},_loadJSONHandler:function(){var _8d=this,_8e=arguments.callee.nom;var _8f={url:sConfig.url,checkString:sConfig.checkString,timeout:20000,load:function(_90,_91){if(_8d._loaded){}else{try{_8d._load();}catch(err){_89.events.queryError({message:_8d.declaredClass+"."+_8e+" - Failed to load Query Service JavaScript: error processing response ",innerException:err,request:_91},_90);}}},error:function(_92,_93){_89.events.queryError({message:_8d.declaredClass+"."+_8e+" - Failed to load Query Service JavaScript: script not loaded",innerException:_93,request:_93},_92);}};dojo.io.script.get(_8f);},queryPoint:function(_94,_95){this._loading(true);var _96=this,_97=arguments.callee.nom,_98=" jsonHandler.queryPoint ";jsonHandler.queryPoint(_94.x,_94.y,function(obj){try{var _9a=false;if(_88.isObject(obj)){if(_88.isObject(obj.result)){var _9b=obj.result;if(_88.isArray(_9b.results)){_9a=true;_96._queryResults=_9b.results;_95(_9b.results);}}}if(!_9a){_89.events.queryError({message:_96.declaredClass+"."+_97+" - Failed to query point: error processing response ",innerException:{code:_9b.errorStatusCode,message:_9b.errorMessage}},obj);}}catch(err){_89.events.queryError({message:_96.declaredClass+"."+_97+" - Failed to query point: error processing response.  Response message:"+_9b.errorMessage,code:_9b.errorStatusCode,innerException:err},obj);}finally{_96._loading(false);}});},getInitFeatures:function(_9c,map,_9e,_9f,_a0,_a1){var _a2=this,_a3=arguments.callee.nom;try{if(_88.isObject(_a1)){this.getExtentFeatures(_9c,map,_9e,_9f,function(obj){try{_a0.call(_a1,obj);_a2.loaded=true;_a2.onLoad(_a2);}catch(err){_89.events.queryError({message:_a2.declaredClass+"."+_a3+" failure parsing response",innerException:err},obj);}},null);}else{this.getExtentFeatures(_9c,map,_9e,_9f,function(obj){try{_a0(obj);_a2.loaded=true;_a2.onLoad(_a2);}catch(err){_89.events.queryError({message:_a2.declaredClass+"."+_a3+" failure parsing response",innerException:err},obj);}},_a1);}}catch(err){_89.events.queryError({message:this.declaredClass+"."+arguments.callee.nom+" Error querying extent features",data:arguments,innerException:err},null);}},getExtentFeatures:function(_a6,map,_a8,_a9,_aa,_ab){this._loading(true);var _ac=this,lod=esri.version<1.5?map._LOD:map.__LOD,_ae=false,_af=arguments.callee.nom,_b0=" jsonHandler.getExtentFeatures ";this._extentQueries++;_a9=_88.isNothing(_a9)?_89.filter.standard:_a9;jsonHandler.queryExtent(_a6.xmin,_a6.ymin,_a6.xmax,_a6.ymax,lod.resolution,_a8.pointX,_a8.stops,_a8.carparkLayerVisible,_a9,function(obj){try{var _b2=0;if(_88.isObject(obj)&&_88.isObject(obj.result)&&_ac._extentQueries<2){var _b3=obj.result;if(_88.isArray(_b3.results)){_ae=true;_b2=_b3.results.length;if(_88.isObject(_ab)){_aa.call(_ab,_b3.results);}else{_aa(_b3.results);}if(_b3.errorStatusCode===650){_b2=-1;}}}_89.events.mapGraphicsCount(_b2);if(!_ae){_89.events.queryError({message:_ac.declaredClass+"."+_af+" Failed to parse response ",data:[_a6,map,_a8,_a9],innerException:{code:_b3.errorStatusCode,message:_b3.errorMessage}},obj);}}catch(err){_89.events.queryError({message:_ac.declaredClass+"."+_af+" Failed to parse response",data:[_a6,map,_a8,_a9],innerException:err},obj);}finally{_ac._extentQueries--;_ac._loading(false);_ac._loading(false);}});},findJunctionPoint:function(_b4,_b5){var _b6=this,_b7=arguments.callee.nom,_b8=" jsonHandler.findJunctionPoint ",_b9;try{_b9=jsonHandler.findJunctionPoint(_b4,_b5);if(_88.isObject(_b9)&&_88.isValidXY(_b9)&&_b9.errorStatusCode==200){return _88.validateXY(_b9);}else{throw _b9;}}catch(err){_89.events.error({message:_b6.declaredClass+"."+_b7+" failed",innerException:err},_b9);throw err;}},findITNNodePoint:function(_ba){var _bb=this,_bc=arguments.callee.nom,_bd=" jsonHandler.findITNNodePoint ",_be;try{_be=jsonHandler.findITNNodePoint(_ba);if(_88.isObject(_be)&&_88.isValidXY(_be)&&_be.errorStatusCode==200){return _88.validateXY(_be);}else{throw _be;}}catch(err){_89.events.error({message:_bb.declaredClass+"."+_bc+" failed",innerException:err},_be);throw err;}},getTravelNewsInfo:function(id,_c0,_c1){this._loading(true);var _c2=this,_c3=this.declaredClass,_c4=" jsonHandler.getRoadEnvelope ";jsonHandler.getTravelNews(id,function(obj){try{var _c6=false,_c7=_89.statics;if(_88.isObject(obj)&&_88.isObject(obj.result)){if(_88.isArrayPopulated(obj.result.results)){var _c8=obj.result.results[0],_c9="",_ca=null,_cb=null,_cc=null,div=dojo.create("div");elements=[],arr=sConfig.roadIncidentQueryFields;caps=function(s){var _cf=s.slice(0,1),_d0=s.slice(1,s.length);return _cf.toUpperCase()+_d0;};if(_88.isStringPopulated(_c8.type)&&_c8.type==="TravelNews"&&_88.isArrayPopulated(_c8.values)){_cb=_c8.values;_ca=_cb.length;var _d1=dojo.create("tbody",null,dojo.create("table",{cellpadding:0,cellspacing:0},div));for(var i=0;i<_ca-2;i++){_cc=arr[i];elm=dojo.create("tr",null,_d1);dojo.create("td",{innerHTML:_cc+":","class":_c7.cssTravelNewsField},elm);dojo.create("td",{innerHTML:_cb[i].replace("&apos;","&#039;"),"class":_c7.cssTravelNewsBody},elm);}var e=_c7.travelNewsEnum,_d4=_cb[dojo.indexOf(arr,sConfig.roadIncidentTypeField)],_d5=_88.parseBool(_cb[dojo.indexOf(arr,sConfig.roadIncidentPlannedField)]);_c9=_88.parseBool(_d5)?_d4==="Road"?e.pRoad:e.pRail:_d4==="Road"?e.upRoad:e.upRail;if(_88.isObject(_c1)){_c0.call(_c1,_c9,[div]);}else{_c0(_c9,[div]);}_c6=true;}}}if(!_c6){_89.events.queryError({message:_c2.declaredClass+"."+_c3+" Failed to parse Travel News response",innerException:{code:obj.result.errorStatusCode,message:obj.result.errorMessage}},obj);}}catch(err){_89.events.queryError({message:_c2.declaredClass+"."+_c3+" Failed to parse Travel News response",innerException:err},obj);}finally{_c2._loading(false);}});},getPointXInfo:function(id,_d7,_d8){this._loading(true);var _d9=this,_da=this.declaredClass;jsonHandler.getPointX(id,function(obj){try{var _dc=false,_dd=" jsonHandler.getPointXInfo ";if(_88.isObject(obj)&&_88.isObject(obj.result)){if(_88.isArrayPopulated(obj.result.results)){var _de=obj.result.results[0],_df=[],_e0=null;if(_88.isStringPopulated(_de.type)&&_88.isArrayPopulated(_de.values)){var _e1=_de.values;_e0=_e1[0];for(var i=1;i<_e1.length;i++){if(_e1[i]!==""){_df.push(dojo.create("span",{innerHTML:_e1[i].replace("&apos;","&#039;")}));}}_dc=true;if(_88.isObject(_d8)){_d7.call(_d8,_e0,_df);}else{_d7(_e0,_df);}}}}if(!_dc){_89.events.queryError({message:_d9.declaredClass+"."+_da+" Failed to parse PointX response",innerException:{code:obj.result.errorStatusCode,message:obj.result.errorMessage}},obj);}}catch(err){_89.events.queryError({message:_d9.declaredClass+"."+_da+" Failed to parse Point X response",innerException:err},obj);}finally{_d9._loading(false);}});},getRouteEnvelope:function(_e3,id,_e5){var _e6=this,_e7=arguments.callee.nom,_e8=" jsonHandler.getRouteEnvelope ",_e9;try{_e9=jsonHandler.getRouteEnvelope(_e3,id,_e5);if(_88.isObject(_e9)&&_88.isValidExt(_e9)&&_e9.errorStatusCode==200){return _88.validateExt(_e9);}else{throw _e9;}}catch(err){_89.events.error({message:_e6.declaredClass+"."+_e7+" failed",innerException:err},_e9);throw err;}}};})());}if(!dojo._hasResource["ESRIUK.Dijits.MapNavPanel"]){dojo._hasResource["ESRIUK.Dijits.MapNavPanel"]=true;ESRIUK.Dijits.MapNavPanel=ESRIUK.Dijits.MapNavPanel||{};dojo._loadedModules["ESRIUK.Dijits.MapNavPanel"]=ESRIUK.Dijits.MapNavPanel;dojo.declare("ESRIUK.Dijits.MapNavPanel",[dijit._Widget,dijit._Templated],(function(){var _ea=ESRIUK.util(),_eb=ESRIUK.config();return {_statics:{altSuffix:" navigation image",panNorth:"Pan North",panEast:"Pan East",panSouth:"Pan South",panWest:"Pan West",fullExtent:"Full Extent"},widgetsInTemplate:true,templateString:"<div class=\"navPanelContainer\">\r\n    <div class=\"navPanelHolder mapPanel\">\r\n        <div class=\"navPanelItem top centre\" dojoAttachEvent='onclick:_onPanNorth'>\r\n            <img title=\"${_statics.panNorth}\" alt=\"${_statics.panNorth}${_statics.altSuffix}\" src=\"${imagePath}panNorth${navImgType}\" class=\"transparentPNG\" />\r\n        </div>\r\n        <div class=\"navPanelItem middle left\" dojoAttachEvent='onclick:_onPanWest'>\r\n            <img title=\"${_statics.panWest}\" alt=\"${_statics.panWest}${_statics.altSuffix}\" src=\"${imagePath}panWest${navImgType}\" class=\"transparentPNG\" />\r\n        </div>\r\n        <div class=\"navPanelItem middle centrePlus\" dojoAttachEvent='onclick:_onPanFullExtent'>\r\n            <img title=\"${_statics.fullExtent}\" alt=\"${_statics.fullExtent}${_statics.altSuffix}\" src=\"${imagePath}panFullExtent${navImgType}\" class=\"transparentPNG\" />\r\n        </div>\r\n        <div class=\"navPanelItem middle right\" dojoAttachEvent='onclick:_onPanEast'>\r\n            <img title=\"${_statics.panEast}\" alt=\"${_statics.panEast}${_statics.altSuffix}\" src=\"${imagePath}panEast${navImgType}\" class=\"transparentPNG\" />\r\n        </div>\r\n        <div class=\"navPanelItem bottom centre\" dojoAttachEvent='onclick:_onPanSouth' >\r\n            <img title=\"${_statics.panSouth}\" alt=\"${_statics.panSouth}${_statics.altSuffix}\" src=\"${imagePath}panSouth${navImgType}\" class=\"transparentPNG\" />\r\n        </div>\r\n    </div>\r\n</div>\r\n",imagePath:dojo.moduleUrl("ESRIUK.Dijits","images/MapNavPanel/"),navImgType:".png",constructor:function(){try{var obj=_eb.statics.mapNavPanel;if(_ea.isObject(obj)){dojo.mixin(this._statics,obj);}}catch(err){}},bindEvents:function(_ed,_ee,_ef,_f0,_f1){this._onPanNorth=_ed;this._onPanSouth=_ee;this._onPanEast=_ef;this._onPanWest=_f0;this._onPanFullExtent=_f1;},_onPanNorth:function(){},_onPanWest:function(){},_onPanFullExtent:function(){},_onPanEast:function(){},_onPanSouth:function(){}};})());}if(!dojo._hasResource["ESRIUK.Dijits.MapToolBarPanel"]){dojo._hasResource["ESRIUK.Dijits.MapToolBarPanel"]=true;ESRIUK.Dijits.MapToolBarPanel=ESRIUK.Dijits.MapToolBarPanel||{};dojo._loadedModules["ESRIUK.Dijits.MapToolBarPanel"]=ESRIUK.Dijits.MapToolBarPanel;dojo.declare("ESRIUK.Dijits.MapToolBarPanel",[dijit._Widget,dijit._Templated],(function(){var _f2=ESRIUK.util(),_f3=ESRIUK.config();return {_statics:{altSuffix:" tool image",panMap:"Pan Map",userDefined:"Add A User Defined Location",selectNearby:"Select A Nearby Point"},isShowing:false,tools:[],widgetsInTemplate:true,templateString:"<div class=\"toolbarPanelContainer\" style=\"display:none\">\r\n    <div class=\"toolbarPanelHolder mapPanel\">\r\n        <span class=\"toolbarPanelItem selected default\" dojoAttachPoint=\"attachDefault\">\r\n            <img title=\"${_statics.panMap}\" alt=\"${_statics.panMap}${_statics.altSuffix}\" src=\"${imagePath}default-map-actions${navImgType}\" dojoAttachEvent='onclick:_onDefaultMapActions' class=\"transparentPNG\" />\r\n        </span>\r\n        <span class=\"toolbarPanelItem\" dojoAttachPoint=\"attachUserDefined\">\r\n            <img title=\"${_statics.userDefined}\" alt=\"${_statics.userDefined}${_statics.altSuffix}\" src=\"${imagePath}user-defined-location${navImgType}\" dojoAttachEvent='onclick:_onUserDefinedLocation' class=\"transparentPNG\" />\r\n        </span>                \r\n        <span class=\"toolbarPanelItem\" dojoAttachPoint=\"attachSelectNearby\">\r\n            <img title=\"${_statics.selectNearby}\" alt=\"${_statics.selectNearby}${_statics.altSuffix}\" src=\"${imagePath}select-nearby-point${navImgType}\" dojoAttachEvent='onclick:_onSelectNearbyPoint' class=\"transparentPNG\" />\r\n        </span>        \r\n    </div>\r\n</div>\r\n",imagePath:dojo.moduleUrl("ESRIUK.Dijits","images/MapToolBarPanel/"),navImgType:".png",constructor:function(){try{var obj=_f3.statics.mapToolbarPanel;if(_f2.isObject(obj)){dojo.mixin(this._statics,obj);}}catch(err){}},init:function(_f5){_f5=_f2.isArrayPopulated(_f5)?_f5:[];var _f6=false,_f7=false;this.tools=_f5;for(var i=0;i<_f5.length;i++){if(_f5[i]==="selectNearby"){_f7=true;this.isShowing=true;}else{if(_f5[i]==="userDefined"){_f6=true;this.isShowing=true;}}}dojo.style(this.domNode,{display:this.isShowing?"block":"none"});if(!_f6){dojo.style(this.attachUserDefined,{display:"none"});}if(!_f7){dojo.style(this.attachSelectNearby,{display:"none"});}},bindEvents:function(_f9,_fa,_fb){this._onDefaultMapActions=_f9;this._onUserDefinedLocation=_fa;this._onSelectNearbyPoint=_fb;},_onDefaultMapActions:function(){},_onUserDefinedLocation:function(){},_onSelectNearbyPoint:function(){},getCurrentActiveTool:function(){var _fc=_f3.statics.cssSelectedToolClass;var arr=dojo.query("."+_f3.statics.cssToolItemClass,this.domNode);for(var i=0;i<arr.length;i++){if(dojo.hasClass(arr[i],_fc)){return arr[i];}}},getDefaultTool:function(){return dojo.query("."+_f3.statics.cssDefaultToolClass,this.domNode)[0];},toggleActiveTool:function(_ff){if(_f2.isStringPopulated(_ff)){var _100=_f3.toolBar.typeEnum;if(_ff===_100.defaultTool){_ff=this.attachDefault;}else{if(_ff===_100.userDefinedLocation){_ff=this.attachUserDefined;}else{if(_ff===_100.selectNearbyPoint){_ff=this.attachSelectNearby;}else{_ff=dojo.byId(_ff);}}}}else{if(!_f2.isObject(_ff)){return false;}}this._resetAllTools();dojo.addClass(_ff,_f3.statics.cssSelectedToolClass);},_resetAllTools:function(){var _101=_f3.statics.cssSelectedToolClass;var arr=dojo.query("."+_f3.statics.cssToolItemClass,this.domNode);for(var i=0;i<arr.length;i++){dojo.removeClass(arr[i],_101);}}};})());}if(!dojo._hasResource["ESRIUK.Dijits.IMSServerStateLayer"]){dojo._hasResource["ESRIUK.Dijits.IMSServerStateLayer"]=true;ESRIUK.Dijits.IMSServerStateLayer=ESRIUK.Dijits.IMSServerStateLayer||{};dojo._loadedModules["ESRIUK.Dijits.IMSServerStateLayer"]=ESRIUK.Dijits.IMSServerStateLayer;dojo.declare("ESRIUK.Dijits.IMSServerStateLayer",esri.layers.DynamicMapServiceLayer,(function(){var util=ESRIUK.util(),_105=ESRIUK.config(),_106=null;return {_requestId:0,_loaded:false,_initRoutes:false,_lastScale:null,_layers:{},_externalConfig:null,_loading:function(){return false;},setLoading:function(fcn){this._loading=fcn;},ovUrl:"",urlTest:null,constructor:function(_108,_109,_10a){this._loading=_10a;this._loading(true);this._cleanUp(_108,_109);this._checkConfig();this._loadJSONHandler();},onLoad:function(){this.inherited(arguments);this._loading(false);},_cleanUp:function(_10b,_10c){this._requestId=0;this._loaded=false;this._lastScale=null;this._layers={};this.ovUrl="";this._externalConfig={travelNews:null,sumbols:[],routes:[]};if(util.isObject(_10c.travelNews)){_10b.travelNews=_10c.travelNews;}if(util.isArrayPopulated(_10c.symbols)){_10b.symbols=_10c.symbols;}if(util.isArrayPopulated(_10c.routes)){_10b.routes=_10c.routes;}this._externalConfig=_10b;},_checkConfig:function(){if(!util.isObject(this._externalConfig.errorStrings)){this._externalConfig.errorStrings={no_imageUrl:" Result does not contain valid imageUrl. ",no_errorStatusCode:" Result does not contain valid errorStatusCode. ",no_result:" No valid result was returned. ",no_response:" No valid response was returned. ",invalid_status:" Invalid status code returned. ",invalid_url:" Invalid image url returned. "};}this.urlTest=this._externalConfig.imgUrlPattern||/^http:\/\/.+(\.png|\.jpg|\.gif)$/;},_load:function(){var m=esri.config.defaults.map;this._loaded=true;this._loadInitMap(m.width,m.height);},_loadJSONHandler:function(){var that=this,_10f=arguments.callee.nom;var _110={url:this._externalConfig.url,checkString:this._externalConfig.checkString,timeout:50000,load:function(_111,_112){if(that._loaded){}else{try{that._load();}catch(err){_105.events.queryError({message:that.declaredClass+"."+_10f+" - Failed to load Map Service JavaScript: error processing response ",innerException:err,request:_112},_111);}}},error:function(_113,_114){var str=that.declaredClass+"."+_10f+" script not loaded ";_105.events.queryError({message:that.declaredClass+"."+_10f+" - Failed to load Map Service JavaScript: script not loaded",innerException:_114,request:_114},_113);}};dojo.io.script.get(_110);},_loadInitMap:function(_116,_117){var that=this,_119=arguments.callee.nom,_11a=" jsonHandler.initMap ",_11b=function(obj){try{if(!util.isNothing(obj)){if(!util.isNothing(obj.result)){var _11d=obj.result;if(util.isBoolean(_11d.isValid)&&_11d.isValid===true){that.initialExtent=that.fullExtent=new esri.geometry.Extent({xmin:_11d.xmin,ymin:_11d.ymin,xmax:_11d.xmax,ymax:_11d.ymax,spatialReference:new esri.SpatialReference({wkid:_105.map.wkid})});that.spatialReference=new esri.SpatialReference({wkid:_105.map.wkid});that._readMapLayers(_11d);if(that._initRoutes){dojo.publish("esriukMap/newInitExtent",[that.initialExtent]);}that.loaded=true;that.onLoad(that);}}}if(!that.loaded){var str=that.declaredClass+"."+_119+" "+_11a+"not successful";_105.events.mapError({message:that.declaredClass+"."+_119+" "+_11a+" Failed parsing response ",innerException:null},obj);}}catch(err){_105.events.mapError({message:that.declaredClass+"."+_119+" "+_11a+" Failed parsing response ",innerException:err},obj);}};try{_106=new TransportDirectMapWebService();var _11f=this._externalConfig,_120=util.isArrayPopulated(_11f.symbols),_121=util.isArrayPopulated(_11f.routes);this._initRoutes=_121;if(util.isObject(_11f.travelNews)){if(_120){if(_121){_106.initMap_Sym_TN_R(_116,_117,_11f.travelNews,_11f.symbols,_11f.routes,_11b);}else{_106.initMap_Symbols_TravelNews(_116,_117,_11f.travelNews,_11f.symbols,_11b);}}else{if(_121){_106.initMap_TN_R(_116,_117,_11f.travelNews,_11f.routes,_11b);}else{_106.initMapAndTravelNews(_116,_117,_11f.travelNews,_11b);}}}else{if(_120){if(_121){_106.initMap_Sym_R(_116,_117,_11f.symbols,_11f.routes,_11b);}else{_106.initMapAndSymbols(_116,_117,_11f.symbols,_11b);}}else{if(_121){_106.initMap_Routes(_116,_117,_11f.routes,_11b);}else{_106.initMap(_116,_117,_11b);}}}}catch(err){_105.events.mapError({message:this.declaredClass+"."+_119+" Failed calling initial map request ",innerException:err},null);}},getImageUrl:function(_122,_123,_124,_125){var that=this,map=this._map,lod=esri.version<1.5?map._LOD:map.__LOD,_129=lod.scale,_12a=_105.events,_12b=this._lastScale==_129?false:true,_12c=arguments.callee.nom,_12d=" jsonHandler.getImage ";this._loading(true);this._loading(true);this._requestId++;if(_12b){this._lastScale=_129;}_106.getImage(_122.xmin,_122.ymin,_122.xmax,_122.ymax,_12b,function(obj){try{if(util.isNumber(obj.id)){if(obj.id!==that._requestId){return;}}var _12f=that._jsonResponseHandler(obj,_125);if(!_12f.valid){_105.events.mapError({message:that.declaredClass+"."+_12c+" "+_12d+" Failed parsing response ",innerException:null},obj);}else{_12a.onMapExtentChange(map.extent,_12b,_129,that.ovUrl);}}catch(err){_105.events.mapError({message:that.declaredClass+"."+_12c+" "+_12d+" Failed parsing response ",innerException:err},obj);}finally{that._loading(false);}});},addStartEndPt:function(pt){var that=this,_132=arguments.callee.nom,_133=" jsonHandler.addPoint ";var _134=function(_135){that._replaceImageUrl(_135);};this._loading(true);this._requestId++;_106.addPoint(pt,function(obj){var _137=that._jsonResponseHandler(obj,_134);if(!_137.valid){_105.events.mapError({message:that.declaredClass+"."+_132+" "+_133+" Failed parsing response ",innerException:null},obj);}that._loading(false);});},clearPoints:function(type){var that=this,_13a=arguments.callee.nom,_13b=" jsonHandler.clearPoints ";type=util.isStringPopulated(type)?type:"";this._loading(true);this._requestId++;var _13c=function(_13d){that._replaceImageUrl(_13d);};_106.clearPoints(type,function(obj){try{var _13f=that._jsonResponseHandler(obj,_13c);if(!_13f.valid){_105.events.mapError({message:that.declaredClass+"."+_13a+" "+_13b+" Failed parsing response ",innerException:null},obj);}}catch(err){throw err;}finally{that._loading(false);}});},setLayerState:function(_140){var that=this,_142=arguments.callee.nom,_143=" jsonHandler.setLayerStates ";if(util.isObject(_140)){dojo.mixin(this._layers,_140);}else{return;}this._loading(true);this._requestId++;var _144=function(_145){that._replaceImageUrl(_145);};_106.setLayerStates(_140.pointX,_140.stops,_140.carparkLayerVisible,function(obj){try{var _147=that._jsonResponseHandler(obj,_144);if(!_147.valid){_105.events.mapError({message:that.declaredClass+"."+_142+" "+_143+" Failed parsing response ",innerException:null},obj);}}catch(err){throw err;}finally{that._loading(false);}});},setTravelNewsLayers:function(_148){var that=this,_14a=arguments.callee.nom,_14b=" jsonHandler.setTravelNewsLayers ";this._loading(true);this._requestId++;var _14c=function(_14d){that._replaceImageUrl(_14d);};_106.setTravelNewsLayers(_148,function(obj){var _14f=that._jsonResponseHandler(obj,_14c);if(!_14f.valid){_105.events.mapError({message:that.declaredClass+"."+_14a+" "+_14b+" Failed parsing response ",innerException:null},obj);}that._loading(false);});},getPrintImage:function(_150,_151,dpi){this._loading(true);this._requestId++;var obj=null,url=null,_155=null,_156=" jsonHandler.getPrintImage ";try{obj=_106.getPrintImage(_150,_151,dpi);_155=this._jsonResponseHandler({result:{errorStatusCode:200,imageUrl:obj.imageUrl,ovUrl:obj.ovUrl}},function(){return false;});if(_155.valid){url=obj.imageUrl;}else{_105.events.mapError({message:that.declaredClass+"."+scope+" "+_156+" Failed parsing response ",innerException:null},obj);}}catch(err){throw err;}finally{this._loading(false);}return url;},addRoute:function(_157,id,type,_15a){this._loading(true);this._requestId++;var that=this,_15c=arguments.callee.nom,_15d=" jsonHandler.addRoute ",_15e=_106.addRoute(_157,id,type,_15a);this._loading(false);if(util.isObject(_15e)&&util.isValidExt(_15e)&&_15e.errorStatusCode==200){return util.validateExt(_15e);}else{throw dojo.mixin(_15e,{message:_15e.errorMessage});}},clearRoutes:function(type){this._loading(true);this._requestId++;var that=this,_161={valid:false},_162=arguments.callee.nom,_163=" jsonHandler.clearRoutes ",obj=_106.clearRoutes(util.isStringPopulated(type)?type:""),_165=function(_166){that._replaceImageUrl(_166);};this._loading(false);if(util.isObject(obj)&&obj.errorStatusCode==200){_161=that._jsonResponseHandler({result:obj},_165);}if(!_161.valid){throw dojo.mixin(_161,{message:_161.errorMessage});}},zoomToAllAddedRoutes:function(){this._loading(true);this._requestId++;var that=this,_168={valid:false},_169=arguments.callee.nom,_16a=" jsonHandler.zoomToAllAddedRoutes ";obj=_106.zoomToAllAddedRoutes();this._loading(false);if(util.isObject(obj)&&util.isValidExt(obj)&&obj.errorStatusCode==200){return util.validateExt(obj);}else{throw dojo.mixin(obj,{message:obj.errorMessage});}},getNumberOfCycleImages:function(_16b){this._loading(true);this._requestId++;var that=this,_16d=arguments.callee.nom,_16e=" jsonHandler.getNumberOfCycleImages ",_16f=_106.getNumberOfCycleImages(_16b);this._loading(false);if(util.isObject(_16f)&&_16f.errorStatusCode==200&&util.isNumber(_16f.number)){return util.parseNumber(_16f.number);}else{throw dojo.mixin(_16f,{message:_16f.errorMessage});}},getCyclePrintDetails:function(_170){this._loading(true);this._requestId++;var that=this,_172=arguments.callee.nom,_173=" jsonHandler.getCyclePrintInfo ",_174=_106.getCyclePrintInfo(_170);this._loading(false);if(util.isObject(_174)&&_174.errorStatusCode==200&&util.isArrayPopulated(_174.cyclePrintInfo)){return _174.cyclePrintInfo;}else{throw dojo.mixin(_174,{message:_174.errorMessage});}},toggleLayer:function(_175,on){var _177=this._externalConfig.layers,_178=this._layers;if(_175===_177.carparks){_178.carparkLayerVisible=on;}else{if(_175.indexOf(_177.pointX)>-1){var name=_175.split(_177.pointX)[1],arr=_178.pointX;for(var i=0;i<arr.length;i++){if(arr[i].name===name){arr[i].visible=on;break;}}_178.pointX=arr;}else{if(_175.indexOf(_177.stops)>-1){var name=_175.split(_177.stops)[1],arr=_178.stops;for(var i=0;i<arr.length;i++){if(arr[i].name===name){arr[i].visible=on;break;}}_178.stops=arr;}}}this.setLayerState(_178);},_replaceImageUrl:function(url){if(util.isStringPopulated(url)&&this.urlTest.test(url)){this._img.src=url;}else{}},_jsonResponseHandler:function(obj,_17e){var _17f=false,_180="",_181=this._externalConfig.errorStrings;try{if(!util.isNothing(obj)){var _182=obj.result;if(!util.isNothing(_182)){if(util.isNumber(_182.errorStatusCode)&&_182.errorStatusCode==200){if(util.isStringPopulated(_182.imageUrl)&&this.urlTest.test(_182.imageUrl)){_17f=true;if(util.isStringPopulated(_182.ovUrl)&&this.urlTest.test(_182.ovUrl)){this.ovUrl=_182.ovUrl;}_17e(_182.imageUrl);}else{_180+=_181.no_imageUrl;}}else{if(util.isNumber(_182.errorStatusCode)){_180+="{str}, Status code:{code}, Error message:{msg} ".supplant({str:_181.invalid_status,code:_182.errorStatusCode,msg:_182.errorMessage});}else{_180+=_181.no_errorStatusCode;}}}else{_180+=_181.no_result;}}else{_180+=_181.no_response;}}catch(err){_180+=" Error determining response status. "+(util.isStringPopulated(err.message)?err.message:"");_105.events.mapError({message:this.declaredClass+"."+arguments.callee.nom+" Failed parsing response ",innerException:err},obj);}return {valid:_17f,message:_180};},_readMapLayers:function(_183){try{var ptX=[],_185=[],_186=_183.pointXVisible[0],_187=_183.pointXVisible[1];for(var i=0;i<_186.length;i++){ptX.push({name:_186[i],visible:_187[i]});}_186=_183.stopsVisible[0];_187=_183.stopsVisible[1];for(var i=0;i<_186.length;i++){_185.push({name:_186[i],visible:_187[i]});}dojo.mixin(this._layers,{carparkLayerVisible:_183.carparkLayerVisible,pointX:ptX,stops:_185});}catch(err){}}};})());}if(!dojo._hasResource["ESRIUK.Dijits.MapBase"]){dojo._hasResource["ESRIUK.Dijits.MapBase"]=true;ESRIUK.Dijits.MapBase=ESRIUK.Dijits.MapBase||{};dojo._loadedModules["ESRIUK.Dijits.MapBase"]=ESRIUK.Dijits.MapBase;dojo.declare("ESRIUK.Dijits.MapBase",[dijit._Widget,dijit._Contained],(function(){var util=ESRIUK.util(),_18a=ESRIUK.config(),_18b={graphics:"graphics",drawing:"drawing",extentQuery:"extentQuery",perm:"permanent"};return {loaded:false,_map:null,_navBar:null,_filter:null,_connects:[],_graphics:[],_initGraphics:[],_userGraphics:[],_serverGraphics:[],_toolBar:null,_resizeSet:false,_graphicsLayer:null,_drawToolBar:null,_geomService:null,_queryTimer:null,_sliderHandle:null,_resizeTimer:null,_scrollTimer:null,_queryService:null,_queryResults:null,_loadingHandler:null,_baseMapServiceId:null,_ie6ResizeTrigger:true,_graphcisMapServiceId:null,_disable:{extentChange:true},_externalConfig:{},imagesPath:dojo.moduleUrl("ESRIUK","images/"),setMap:function(map){if(typeof map=="object"){if(typeof map.declaredClass=="string"){if(map.declaredClass=="esri.Map"){this._map=map;}}}},setGeomService:function(_18d){if(util.isNothing(this._geomService)){if(typeof _18d==="object"){if(typeof _18d.declaredClass==="string"){if(_18d.declaredClass===""){}}}}},setDrawingToolBar:function(_18e){if(util.isObject(_18e)){this._drawToolBar=_18e;}},setGraphicsMapService:function(_18f){if(util.isStringPopulated(_18f)){this._graphcisMapServiceId=_18f;}},setBaseMapService:function(_190){if(util.isStringPopulated(_190)){this._baseMapServiceId=_190;}},setQueryService:function(_191){if(util.isObject(_191)&&_191.declaredClass==="ESRIUK.Dijits.Query"){this._queryService=_191;}},getInputText:function(){return this._externalConfig.text;},getMap:function(){return this._map;},getDrawingToolBar:function(){return this._drawToolBar;},getQueryService:function(){if(util.isNothing(this._queryService)){try{this._queryService=new ESRIUK.Dijits.Query();}catch(err){this._queryService=null;}}return this._queryService;},getGeomService:function(){if(util.isNothing(this._geomService)){try{this._geomService=this.getServiceSetting(_18a.webServiceTypeEnum.geom);}catch(err){this._geomService=null;}}return this._geomService;},getBaseMapSetting:function(){var _192=_18a.mapServices;var _193=_192.length;for(var i=0;i<_193;i++){if(_192[i].baseMap){return _192[i];}}return null;},getBaseMapService:function(){var _195=null;if(!util.isNothing(this._graphcisMapServiceId)){_195=this.getMap().getLayer(this._baseMapServiceId);if(_195===null){}}return _195;},getGraphicsMapService:function(){var _196=null;if(!util.isNothing(this._graphcisMapServiceId)){_196=this.getMap().getLayer(this._graphcisMapServiceId);if(_196===null){}}return _196;},getOtherMapSettings:function(){var _197=[];var _198=_18a.mapServices;var _199=_198.length;for(var i=0;i<_199;i++){if(!_198[i].baseMap){_197.push(_198[i]);}}return _197;},getServiceSetting:function(_19b){var _19c=_18a.webServices;var _19d=_19c.length;for(var i=0;i<_19d;i++){if(_19c[i].type===_19b){return _19c[i];}}return null;},getOverviewUrl:function(){var _19f=this.getBaseMapService();return util.isStringPopulated(_19f.ovUrl)?_19f.ovUrl:"";},_getAddPointPrefixText:function(){return util.isStringPopulated(this._externalConfig.text)?this._externalConfig.text:_18a.statics.planAJourneyText.addPointPrefix;},removeConnectTypes:function(type){var arr=this._connects,_1a2=arr.length;for(var i=0;i<_1a2;i++){if(arr[i].name===type){dojo.disconnect(arr[i].handle);arr.splice(i,1);_1a2--;i--;}}},toggleEvt:function(_1a4,on){on=(typeof on==="boolean"?on:true);var dis=this._disable;if(_1a4===_18b.extentQuery){dis.extentChange=on;}},checkMapSpatialRef:function(map){if(util.isObject(map.spatialReference)){if(util.isNothing(map.spatialReference.wkid)){if(map.spatialReference.wkt.indexOf("British_National_Grid")>-1){map.spatialReference.wkid=27700;}}}},constructor:function(){this._externalConfig={};},postCreate:function(){this.inherited(arguments);if(util.isNumber(dojo.isIE)&&dojo.isIE<7){esri.config.defaults.map.zoomDuration=1;esri.config.defaults.map.panDuration=1;}esri.config.defaults.map.slider=_18a.map.slider;},init:function(_1a8){try{this._applyPreLoadConfig(_1a8);this._addBaseMap();this._addOtherMaps();this._addGeomService();this._addOtherServices();}catch(err){_18a.events.miscError({message:this.declaredClass+"."+arguments.callee.nom+" - "+err.message,error:err});}},_applyPreLoadConfig:function(_1a9){this._externalConfig={};this._filter=null;if(typeof _1a9==="object"){if(util.isNumber(_1a9.width)){dojo.style(this.domNode,{width:_1a9.width+"px"});esri.config.defaults.map.width=_1a9.width;}if(util.isNumber(_1a9.height)){dojo.style(this.domNode,{height:_1a9.height+"px"});esri.config.defaults.map.height=_1a9.height;}}dojo.mixin(this._externalConfig,_1a9);dojo.subscribe("esriukMap/newInitExtent",this,"_onNewLoadExtent");},_getLoadConfig:function(){var _1aa=null,pt=null,_1ac=null,_1ad=this._externalConfig;if(util.isValidXY(_1ad.location)){var xy=util.validateXY(_1ad.location);pt=new esri.geometry.Point(xy.x,xy.y,new esri.SpatialReference({wkid:_18a.map.wkid}));if(util.isNumber(_1ad.scale)){_1aa=this._generateExtentFromPt(pt,_1ad.scale,false);}else{if(util.isNumber(_1ad.level)){_1aa=this._generateExtentFromPt(pt,_1ad.level,true);}else{_1aa=this._generateExtentFromPt(pt,5,true);}}}else{if(util.isValidExt(_1ad.extent)){var ex=_1ad.extent;_1aa=new esri.geometry.Extent(ex.xmin,ex.ymin,ex.xmax,ex.ymax,new esri.SpatialReference({wkid:_18a.map.wkid}));}}return _1aa;},_addBaseMap:function(){var map=null,_1b1={displayGraphicsOnPan:false},_1b2=null,_1b3=this.getBaseMapSetting(),_1b4=_18a.mapServiceTypeEnum,_1b5=this._externalConfig,_1b6=this._getLoadConfig(),_1b7={};if(_1b3!==null){if(util.isArrayPopulated(_18a.map.lods)){dojo.mixin(_1b1,{lods:_18a.map.lods});}if(util.isObject(_1b6)){dojo.mixin(_1b1,{extent:_1b6});this._externalConfig.extent=_1b6;}if(util.isObject(_1b5.travelNews)){this._filter=_1b5.travelNews;dojo.mixin(_1b7,{travelNews:this._filter});}if(util.isArrayPopulated(_1b5.symbols)){dojo.mixin(_1b7,{symbols:_1b5.symbols});}if(util.isArrayPopulated(_1b5.routes)){dojo.mixin(_1b7,{routes:_1b5.routes});}map=new esri.Map(this.domNode.id,_1b1);dojo.connect(map,"onLoad",function(){this.disableDoubleClickZoom();dojo.connect(this,"onDblClick",function(evt){this.centerAt(evt.mapPoint);dojo.stopEvent(evt);return false;});});switch(_1b3.type){case _1b4.dynamic:_1b2=new esri.layers.ArcGISDynamicMapServiceLayer(_1b3.url);break;case _1b4.tiled:_1b2=new esri.layers.ArcGISTiledMapServiceLayer(_1b3.url);break;case _1b4.imsserver:_1b2=new ESRIUK.Dijits.IMSServerStateLayer(_1b3,_1b7,this._loadingHandler);break;default:break;}this._connects.push(util.formatConnect(dojo.connect(map,"onLoad",this,this._setHandlers),"init"));this.setMap(map);map.addLayer(_1b2);if(!util.isNothing(_1b3.addGraphics)){this.setGraphicsMapService(util.isNothing(_1b2.id)?0:_1b2.id);}this.setBaseMapService(_1b2.id);}else{}},_addOtherMaps:function(){var _1b9=null,map=this.getMap(),_1bb=this.getOtherMapSettings(),_1bc=_1bb.length;for(var i=0;i<_1bc;i++){if(_1bb[i].type=="dynamic"){_1b9=new esri.layers.ArcGISDynamicMapServiceLayer(_1bb[i].url);}else{if(_1bb[i].type=="tiled"){_1b9=new esri.layers.ArcGISTiledMapServiceLayer(_1bb[i].url);}else{continue;}}map.addLayer(_1b9);}},_addGeomService:function(){var _1be=this.getServiceSetting(_18a.webServiceTypeEnum.geom);if(!util.isNothing(this._geomService)&&!util.isNothing(_1be)){var _1bf=new esri.tasks.GeometryService(_1be.url);this.setGeomService(_1bf);}},_addOtherServices:function(){var _1c0=this.getServiceSetting(_18a.webServiceTypeEnum.query);if(util.isObject(_1c0)){this.setQueryService(new ESRIUK.Dijits.Query(_1c0,this._loadingHandler));}},_setHandlers:function(){var map=this.getMap();try{this._graphicsLayer=map.addLayer(new esri.layers.GraphicsLayer({displayOnPan:dojo.isIE?false:true,id:"esriukCustomGraphicsLayer"}));if(_18a.map.useResizeHandler){this._connects.push(util.formatConnect(dojo.connect(window,"onresize",this,this.onMapResize),_18b.perm));}this._connects.push(util.formatConnect(dojo.connect(map.graphics,"onClick",this,this.onGraphicClick),_18b.graphics),util.formatConnect(dojo.connect(this._graphicsLayer,"onClick",this,this.onGraphicClick),_18b.graphics),util.formatConnect(dojo.connect(window,"onscroll",this,this.onScroll),_18b.perm),util.formatConnect(dojo.connect(map,"onExtentChange",this,this.onMapExtentChange),_18b.extentQuery));this._applyPostLoadChanges();this._runPostLoad();this._onLoad();}catch(err){_18a.events.miscError({message:this.declaredClass+"."+arguments.callee.nom+" - "+err.message,error:err});}},_applyPostLoadChanges:function(){var map=this.getMap(),_1c3=_18a.map,_1c4=map._slider,node=_1c4.domNode,arr=dojo.query("div.dijitRuleMarkV",node),_1c7=arr.length,item,elm,_1ca,str,div,lods=_1c3.lods,_1ce=_1c4.sliderHandle,lod=esri.version<1.5?map._LOD:map.__LOD,par=arr[0].parentNode,pad=_1c3.sliderBoxPadding,_1d2=_1c3.sliderBoxStart-1;try{dojo.place(node,this.getParent().attachMapSliderContent);this._sliderHandle=_1ce;_1c4.scrollOnFocus=false;if(util.isObject(_1ce)){_1ce.title="Scale = 1:"+dojo.number.format(lod.scale,"#,##0.###");_1ce.alt=_1ce.title;}str="-"+pad+"px";div=dojo.create("div",{"class":"sliderBottomBox",style:{left:str,right:str,top:str}},par,"first");for(var i=0,j=lods.length-1;i<_1c7;i++,j--){item=arr[i];if(i==_1d2){var _1d5=dojo.coords(item);dojo.style(div,{height:(_1d5.t+(pad*2))+"px"});}str=dojo.number.format(lods[j].scale,"#,##0.###");item._val=lods[j].level;item.title="Scale 1:"+str;item.alt=item.title;dojo.connect(item,"onclick",function(){map.setLevel(this._val);});}dojo.attr((dojo.isFF?_1c4.incrementButton.parentNode:_1c4.incrementButton),{alt:"Zoom In",title:"Zoom In"});dojo.attr((dojo.isFF?_1c4.decrementButton.parentNode:_1c4.decrementButton),{alt:"Zoom In",title:"Zoom Out"});}catch(err){_18a.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed to set slider tooltips",obj:err});}if(util.isNumber(dojo.isIE)){var _1d6=parseInt(dojo.style(this.getParent().attachMapSliderContent,"height"),10);if(isNaN(_1d6)||_1d6<2){_1d6=parseInt(_1c3.slider.height,10);}dojo.style(this.getParent().attachMapSliderContent,{height:(_1d6+_1c3.sliderIEOverlap)+"px"});}dojo.addClass(map.infoWindow.domNode,_18a.statics.cssInfoWindowClassName);map.reposition();},_runPostLoad:function(){var arr,_1d8,elm,item,_1db,_1dc,_1dd,geom,map=this.getMap(),type=_18a.graphics.typeEnum.serverGraphic,geo=esri.geometry,_1e2=map.graphics,_1e3=this.getParent(),ref=map.spatialReference,pt=_18a.graphics.point,_1e6=this.getQueryService();if(util.isArrayPopulated(this._externalConfig.symbols)){arr=this._externalConfig.symbols;_1db=arr.length;for(var i=0;i<_1db;i++){item=arr[i];if(util.parseBool(item.infoWindowRequired)){if(util.isStringPopulated(item.content)){elm=dojo.byId(item.content);_1dc=util.isNothing(elm)?item.content:elm.innerHTML;}else{_1dc="";}_1d8={text:item.label,type:type,content:_1dc};geom=new geo.Point(util.parseNumber(item.x),util.parseNumber(item.y),ref);_1dd=_1e2.add(new esri.Graphic(geom,pt,_1d8));this._serverGraphics.push(_1dd);if(util.parseBool(item.main)){this.drawCallout({screenPoint:esri.geometry.toScreenGeometry(map.extent,map.width,map.height,geom)},map,_1dd,geom);}}}}if(_1e6!==null){_1e6.getInitFeatures(map.extent,map,this.getBaseMapService()._layers,this._filter,this._plotMapFeatures,this);}else{_18a.events.miscEror({message:this.declaredClass+"."+arguments.callee.nom+" - Failed to load Query Service"});}},_onNewLoadExtent:function(ext){this._externalConfig.extent=ext;},_onLoad:function(){try{var map=this.getMap(),ext=this._externalConfig.extent,mExt=map.extent,_1ec=this.getBaseMapService(),_1ed=this.getQueryService();if(_1ec.loaded&&_1ed.loaded){this.loaded=true;if(typeof ext!=="undefined"&&(mExt.getHeight()<ext.getHeight()||mExt.getWidth()<ext.getWidth())){map.setExtent(ext,true);setTimeout(function(){dojo.publish(_18a.events.mapLoad);},1000);}else{dojo.publish(_18a.events.mapLoad);}}else{if(_1ec.loaded&&(!_1ed.loaded)){dojo.connect(_1ed,"onLoad",this,this._onLoad);}else{if((!_1ec.loaded)&&_1ed.loaded){dojo.connect(_1ec,"onLoad",this,this._onLoad);}else{dojo.connect(_1ed,"onLoad",this,this._onLoad);dojo.connect(_1ec,"onLoad",this,this._onLoad);}}}}catch(err){_18a.events.error({message:"error firing final onMapInitialiseComplete method",obj:err});}},bindNavControls:function(_1ee){var map=this.getMap(),that=this;if(!util.isNothing(_1ee)&&!util.isNothing(map)){var nav=this._navBar=new esri.toolbars.Navigation(map),_1f2;if(util.isValidExt(this._externalConfig.extent)){_1f2=function(){map.setExtent(that._externalConfig.extent,true);};}else{_1f2=function(){nav.zoomToFullExtent();};}_1ee.bindEvents(function(){map.panUp();},function(){map.panDown();},function(){map.panRight();},function(){map.panLeft();},_1f2);}else{this._navBar=null;}},bindToolbar:function(_1f3){if(!util.isNothing(_1f3)){this._toolBar=_1f3;if(_1f3.isShowing){var that=this,_1f5=_18a.toolBar.typeEnum;_1f3.bindEvents(function(evt){that._setMapNavigationState(evt,_1f5.defaultTool);},function(evt){that._setMapNavigationState(evt,_1f5.userDefinedLocation);},function(evt){that._setMapNavigationState(evt,_1f5.selectNearbyPoint);});}}else{this._toolBar=null;}},bindLoading:function(_1f9){this._loadingHandler=function(obj){_1f9.toggle(obj);};},setActiveTool:function(type){if(util.isStringPopulated(type)){var _1fc=_18a.toolBar.typeEnum;if(type===_1fc.defaultTool){this._setMapNavigationState(_1fc.defaultTool);}else{if(type===_1fc.userDefinedLocation){this._setMapNavigationState(_1fc.userDefinedLocation);}else{if(type===_1fc.selectNearbyPoint){this._setMapNavigationState(_1fc.selectNearbyPoint);}else{}}}}else{}},_setMapNavigationState:function(evt,type){if(util.isStringPopulated(evt)&&util.isNothing(type)){type=evt;evt={target:{parentNode:type}};}if(util.isStringPopulated(type)){var map=this.getMap(),that=this,_201=this.getDrawingToolBar(),_202=_18a.toolBar.typeEnum;if(!util.isObject(_201)){_201=new esri.toolbars.Draw(map);this.setDrawingToolBar(_201);}this._toolBar.toggleActiveTool(evt.target.parentNode);this.removeConnectTypes(_18b.drawing);switch(type){case _202.defaultTool:_201.deactivate();map.enableMapNavigation();break;case _202.userDefinedLocation:map.disableMapNavigation();that._connects.push(util.formatConnect(dojo.connect(_201,"onDrawEnd",function(geom){that._toolAddUserDefinedPoint(geom);}),_18b.drawing));_201.activate(esri.toolbars.Draw.POINT);break;case _202.selectNearbyPoint:map.disableMapNavigation();that._connects.push(util.formatConnect(dojo.connect(_201,"onDrawEnd",function(geom){that._toolSelectNearbyPoints(geom);}),_18b.drawing));_201.activate(esri.toolbars.Draw.POINT);break;default:break;}}else{}},_toolAddUserDefinedPoint:function(geom){if(util.isStringPopulated(geom.type)&&geom.type==="point"){var that=this,_207=null,_208=false,_209=arguments.callee.nom,_20a=_18a.statics,map=this.getMap(),arr=that._userGraphics,win=map.infoWindow,_20e=esri.geometry.toScreenGeometry(map.extent,map.width,map.height,geom),_20f=map.graphics.add(new esri.Graphic(geom,_18a.graphics.pointMisc));arr.push(_20f);if(win.isShowing){win.hide();}var _210=dojo.create("div");var _211=function(){if(!_208){var map=that.getMap(),_213=map.graphics,_214=arr.length;try{_213.remove(_20f);arr.pop();}catch(err){}if(win.isShowing){win.hide();}that._setMapNavigationState({target:that._toolBar.getDefaultTool().getElementsByTagName("img")[0]},"default");}};var _215=function(){var text=_207.attr("value");_20f.setAttributes({text:text});_208=true;win.setTitle(text);win.resize(_20a.dims.addPointSize.x,_20a.dims.addPointSize.y+30);win.setContent(that._getGraphicOptionLinks(_20f,[],true));that._setMapNavigationState({target:that._toolBar.getDefaultTool().getElementsByTagName("img")[0]},"default");};_207=new dijit.form.TextBox({value:_20a.planAJourneyText.addPointDefaultText,style:"width: 100px;",maxLength:20},dojo.create("div",null,_210));var _217=dojo.connect(_207,"_onFocus",function(){this.attr("value","");dojo.disconnect(_217);});var _218=new dijit.form.Button({onClick:_215,label:_20a.misc.ok},dojo.create("div",null,_210));var _219=new dijit.form.Button({onClick:_211,label:_20a.misc.cancel},dojo.create("div",null,_210));this._connects.push(util.formatConnect(dojo.connect(win,"onHide",_211),_18b.drawing));win.setContent(_210);win.setTitle(_20a.planAJourneyText.addPointTitle);win.resize(_20a.dims.addPointSize.x,_20a.dims.addPointSize.y);win.show(_20e,map.getInfoWindowAnchor(_20e));this._resizeInfoWindow(win);_218.focus();}else{}},_toolSelectNearbyPoints:function(geom){if(util.isStringPopulated(geom.type)&&geom.type==="point"){this.getQueryService().queryPoint(geom,_18a.events.selectNearbyPointResult);}},_getGraphicOptionLinks:function(_21b,_21c,_21d){var that=this,i=0,geom=util.isObject(_21b)?_21b.geometry:null,_221=_18a.statics,_222=dojo.create("div"),_223=_221.planAJourneyText,_224=function(){return false;},_225=this._getAddPointPrefixText(),arr=util.isArrayPopulated(this._externalConfig.mode)?this._externalConfig.mode:["start","end"];_21d=util.isBoolean(_21d)?_21d:false;_21c=_21c||[];dojo.addClass(_222,_221.cssInfoWindowContentClassName);for(i=0;i<_21c.length;i++){if(util.isString(_21c[i].tagName)){if(i>0){dojo.create("br",null,_222);}_222.appendChild(_21c[i]);}}if(util.isNothing(geom)){return _222;}_224=function(type){_18a.events[type](geom.x,geom.y,util.isStringPopulated(_21b.attributes.text)?_21b.attributes.text:_221.pointInfoNoTitle);var map=that.getMap();map.infoWindow.hide();if(_21d){map.graphics.remove(_21b);}};if(_21c.length>0){dojo.create("br",null,_222);}for(i=0;i<arr.length;i++){if(i>0){dojo.create("br",null,_222);}if(arr[i]==="start"){dojo.connect(dojo.create("a",{innerHTML:_225+_223.addPointSuffixStart},_222),"onclick",function(){_224("useAsStartPoint");});}else{if(arr[i]==="via"){dojo.connect(dojo.create("a",{innerHTML:_225+_223.addPointSuffixVia},_222),"onclick",function(){_224("useAsViaPoint");});}else{if(arr[i]==="end"){dojo.connect(dojo.create("a",{innerHTML:_225+_223.addPointSuffixEnd},_222),"onclick",function(){_224("useAsEndPoint");});}}}}if(_222.firstChild!==null){return _222;}else{return null;}},onGraphicClick:function(_229){if(util.isObject(_229.graphic)){var _22a=_229.graphic;if(!util.isNothing(_22a.attributes)){this.drawCallout(_229,this.getMap(),_22a,_22a.geometry);}}},onGraphicMouseOver:function(_22b){if(util.isObject(_22b.graphic)){var _22c=_22b.graphic;if(!util.isNothing(_22c.attributes)){this.drawCallout(_22b,this.getMap(),_22c,_22c.geometry);}}},onMapExtentChange:function(_22d,_22e,_22f,lod){var t=this._queryTimer,time=_18a.query.wait,that=this;if(util.isNumber(t)){clearTimeout(t);this._loadingHandler(false);}this._queryTimer=setTimeout(function(){that._onMapExtentChange(_22d,_22e,_22f,lod);},time);if(util.isObject(this._sliderHandle)){this._sliderHandle.title="Scale = 1:"+dojo.number.format(lod.scale,"#,##0.###");this._sliderHandle.alt=this._sliderHandle.title;}},_onMapExtentChange:function(_234,_235,_236,lod){var map=this.getMap(),t=this._queryTimer;if(util.isNumber(t)){clearTimeout(t);this._queryTimer=null;}this._removeMapFeatures();if(lod.level>_18a.query.maxLOD&&this._disable.extentChange){this.getQueryService().getExtentFeatures(_234,map,this.getBaseMapService()._layers,this._filter,this._plotMapFeatures,this);}else{if(_236){this.toggleEvt(_18b.extentQuery,true);}}},onMapPanStart:function(_23a,_23b){this._removeMapFeatures();},onMapPan:function(){return;},onMapPanEnd:function(_23c,_23d){},onMapResize:function(){if(dojo.coords(this.domNode).w>2&&dojo.coords(this.domNode).h>2){clearTimeout(this._resizeTimer);var that=this;var _23f=arguments.callee.nom;if(dojo.isIE<7&&this._ie6ResizeTrigger){this._ie6ResizeTrigger=false;return;}this._resizeTimer=setTimeout(function(){var map=that.getMap();if(that._externalConfig.wholePage){try{var _241=that.getParent()._wholePageResize();dojo.style(that.domNode,{height:_241.height+"px",width:_241.width+"px"});}catch(err){}}if(that._resizeSet){that._resizeSet=false;}dojo.style(that.domNode.parentNode,{width:"auto"});dojo.style(that.domNode,{width:"auto"});var _242=dojo.coords(that.domNode);map.width=parseInt(_242.w,10);map.height=parseInt(_242.h,10);if(dojo.isIE<7){var _243=dojo.coords(that.domNode.parentNode.parentNode);var _244=util.getElmGutterHorizontal(that.domNode.parentNode.parentNode)+util.getElmGutterHorizontal(that.domNode.parentNode);dojo.style(that.domNode,{width:_243.w-_244});map.width=_243.w-_244;}that._onMapResize();},300);}},onScroll:function(){clearTimeout(this._scrollTimer);var that=this;this._scrollTimer=setTimeout(function(){that._onScroll();},300);},_onMapResize:function(){var that=this,_247=arguments.callee.nom,map=this.getMap();map.reposition();map.resize();setTimeout(function(){try{for(var i=0;i<map.layerIds.length;i++){map.getLayer(map.layerIds[i]).refresh();}}catch(err){}},300);},_onScroll:function(){this.getMap().reposition();},_getClosestScale:function(_24a,dims){var _24c,_24d,next,_24f,_250,i;lods=_18a.map.lods,dpi=96,counter=0,factor=1.2,inchPerMetre=39.3700787402,smaller=true;while(smaller&&counter<20){counter++;next=null;_24d=null;_24f=_24a.getWidth()/dims.w,_250=Math.round(_24f*dpi*inchPerMetre);for(i=0;i<lods.length;i++){_24c=lods[i].scale;if(_250<_24c){_24d=_24c;}else{if(_250>_24c){next=_24c;break;}else{if(_250===_24c){return _24a;}}}}if(!util.isNothing(_24d,next)){var _252=_24d-_250,_253=_250-next;if(_252>=_253){_24a=_24a.expand(factor);}else{smaller=false;return _24a;}}else{smaller=false;}}},_getClosestLOD:function(_254){var lods=_18a.map.lods,lod=null;for(var i=0;i<lods.length;i++){if(_254==lods[i].scale){return lods[i].level;}else{if(_254>lods[i].scale){lod=i>0?lods[i-1]:lods[0];return lod.level;}}}lod=lods[lods.length-1];return lod.level;},_getLODInfo:function(_258,type){var i=null,lod=null,arr=_18a.map.lods;_258=util.parseNumber(_258);if(util.isArrayPopulated(arr)){if(type!=="level"){_258=this._getClosestLOD(_258);}for(i=0;i<arr.length;i++){lod=arr[i];if(_258===lod.level){return lod;}}}else{}return lod;},_generateExtentFromPt:function(pt,_25e,_25f){try{_25f=util.parseBool(_25f);var _260=esri.config.defaults.map,_261=this._getLODInfo(_25e,_25f?"level":null).resolution,x=(_260.width/2)*_261,y=(_260.height/2)*_261;return new esri.geometry.Extent(pt.x-x,pt.y-y,pt.x+x,pt.y+y,new esri.SpatialReference({wkid:_18a.map.wkid}));}catch(err){return null;}},_plotMapFeatures:function(arr){var item=null,pt=null,_267=arr.length,map=this.getMap(),geo=esri.geometry,_26a=this._graphicsLayer,_26b=this._graphics,ref=map.spatialReference,_26d=_18a.graphics.point;for(var i=0;i<_267;++i){item=arr[i];if(item.points.length==1){pt=item.points[0];_26b.push(_26a.add(new esri.Graphic(new geo.Point(pt.x,pt.y,ref),_26d,{type:item.type,values:item.values})));}}},_removeMapFeatures:function(){var arr=this._graphics,_270=this._graphicsLayer,_271=arr.length;for(var i=0;i<_271;++i){_270.remove(arr[i]);}this._graphics=[];},_removeUserGraphics:function(){var arr=this._userGraphics,_274=this.getMap().graphics,_275=arr.length;for(var i=0;i<_275;++i){_274.remove(arr[i]);}this._userGraphics=[];},_removeServerGraphics:function(){var arr=this._serverGraphics,_278=this.getMap().graphics,_279=arr.length;for(var i=0;i<_279;++i){_278.remove(arr[i]);}this._serverGraphics=[];},setExtent:function(_27b){this.getMap().setExtent(_27b);},resize:function(x,y){if(util.isNumber(x)&&util.isNumber(y)){var map=this.getMap();this._resizeSet=true;dojo.style(this.domNode,{height:y+"px",width:x+"px"});map.width=parseInt(x,10);map.height=parseInt(y,10);this._onMapResize();}else{}},zoomToFullExtent:function(){this._navBar.zoomToFullExtent();},zoomToPreviousExtent:function(){this._navBar.zoomToPrevExtent();},zoomToXY:function(x,y){var map=this.getMap();var pt=new esri.geometry.Point(util.parseNumber(x),util.parseNumber(y),map.spatialReference);map.centerAt(pt);},zoomToLevel:function(_283){this.getMap().setLevel(_283);},zoomToScale:function(_284){var lod=this._getClosestLOD(_284);this.getMap().setLevel(lod);},centerAndZoom:function(x,y,_288,text){var map=this.getMap(),that=this,_28c=null,_28d=function(_28e,_28f,_290,_291){dojo.disconnect(_28c);this.addIconAndInfoWindow(x,y,text,false);};text=util.isNothing(text)?null:text;if(util.isStringPopulated(text)){_28c=dojo.connect(map,"onExtentChange",that,_28d);}map.centerAndZoom(new esri.geometry.Point(util.parseNumber(x),util.parseNumber(y),map.spatialReference),_288);},centerAndScale:function(x,y,_294,text){var lod=this._getClosestLOD(_294);text=util.isStringPopulated(text)?text:null;this.centerAndZoom(x,y,lod,text);},zoomToExtent:function(ext,_298){_298=util.isBoolean(_298)?_298:false;this.getMap().setExtent(ext,_298);},addStartEndPt:function(pt){var _29a=this.getGraphicsMapService(),map=this._map;if(!util.isNothing(_29a)){_29a.addStartEndPt(pt);try{if(util.parseBool(pt.infoWindowRequired)&&util.isStringPopulated(pt.content)){attributes={text:pt.label,type:_18a.graphics.typeEnum.serverGraphic,content:pt.content};var geom=new esri.geometry.Point(util.parseNumber(pt.x),util.parseNumber(pt.y),map.spatialReference),_29d=map.graphics.add(new esri.Graphic(geom,_18a.graphics.point,attributes));this._serverGraphics.push(_29d);if(pt.main){this.drawCallout({screenPoint:esri.geometry.toScreenGeometry(map.extent,map.width,map.height,geom)},map,_29d,geom);}}}catch(err){throw {source:this.declaredClass+arguments.callee.nom,message:" Could not add invisible client graphic on top of server symbol. "+err.message};}}else{throw {source:this.declaredClass+arguments.callee.nom,message:" No 'addable graphics' map service available.\n Check there is a map service with 'addGraphics:true' defined in config. "};}},addIconAndInfoWindow:function(x,y,text,_2a1){var map=this.getMap(),geom=new esri.geometry.Point(x,y,map.spatialReference),_2a4=map.graphics.add(new esri.Graphic(geom,_18a.graphics.pointMisc,{text:text}));this.drawCallout({screenPoint:esri.geometry.toScreenGeometry(map.extent,map.width,map.height,geom)},map,_2a4,geom);if(!util.parseBool(_2a1)){this.setActiveTool(_18a.toolBar.typeEnum.defaultTool);}},clearPoints:function(type){var _2a6=this.getGraphicsMapService();if(!util.isNothing(_2a6)){if(((!util.isStringPopulated(type))||type==="graphics")&&type!=="server"){this._removeUserGraphics();}_2a6.clearPoints(type);this._removeServerGraphics();}else{throw {source:this.declaredClass+arguments.callee.nom,message:" No 'addable graphics' map service available.\n Check there is a map service with 'addGraphics:true' defined in config. "};}},getLayerList:function(){return this.copyLayerList(this.getBaseMapService()._layers);},copyLayerList:function(_2a7){var i=0,obj={carparkLayerVisible:false,stops:[],pointX:[]},_2aa=_2a7.stops,_2ab=_2a7.pointX,_2ac=_2a7.carparkLayerVisible;obj.carparkLayerVisible=_2ac;for(i=0;i<_2aa.length;++i){obj.stops.push(dojo.mixin({},_2aa[i]));}for(i=0;i<_2ab.length;++i){obj.pointX.push(dojo.mixin({},_2ab[i]));}return obj;},getMapProperties:function(){var map=this.getMap(),lod=esri.version<1.5?map._LOD:map.__LOD,_2af=map.extent,obj=this._externalConfig,_2b1=new esri.geometry.Point(_2af.xmin+((_2af.xmax-_2af.xmin)/2),_2af.ymin+((_2af.ymax-_2af.ymin)/2),map.spatialReference).toJson();var _2b2={};for(var name in obj){if(obj.hasOwnProperty(name)){if(name==="location"){if(obj[name].x!==null){dojo.mixin(_2b2,{location:obj[name]});}}else{if(name!=="set"&&name!=="wholePage"){if(obj[name]!==null){dojo.mixin(_2b2,dojo.fromJson("{\""+name+"\":"+dojo.toJson(obj[name])+"}"));}}}}}return {scale:lod.scale,level:lod.level,centrePoint:_2b1,layers:this.getLayerList(),inputs:_2b2};},toggleLayer:function(_2b4,on){var _2b6=this.getBaseMapService();_2b6.toggleLayer(_2b4,on);},setLayerState:function(_2b7){var map=this.getMap(),_2b9=this.getBaseMapService(),obj=this.copyLayerList(_2b7);this._removeMapFeatures();_2b9.setLayerState(obj);this.getQueryService().getExtentFeatures(map.extent,map,obj,this._filter,this._plotMapFeatures,this);},setTravelNews:function(_2bb){var map=this.getMap(),_2bd=this.getBaseMapService();this._filter=this.validateTravelFilter(_2bb);this._removeMapFeatures();_2bd.setTravelNewsLayers(this._filter);this.getQueryService().getExtentFeatures(map.extent,map,_2bd._layers,this._filter,this._plotMapFeatures,this);},findJunctionPoint:function(_2be,_2bf,_2c0,_2c1){var map=this.getMap(),obj=this.getQueryService().findJunctionPoint(_2be,_2bf),pt=new esri.geometry.Point(obj.x,obj.y,map.spatialReference);if(_2c1){if(util.isNumber(_2c0)){map.centerAndZoom(pt,util.parseNumber(_2c0)-1);}else{map.centerAt(pt);}}return pt.toJson();},findITNNodePoint:function(TOID,_2c6,_2c7){var map=this.getMap(),obj=this.getQueryService().findITNNodePoint(TOID),pt=new esri.geometry.Point(obj.x,obj.y,map.spatialReference);if(_2c7){if(util.isNumber(_2c6)){map.centerAndZoom(pt,util.parseNumber(_2c6)-1);}else{map.centerAt(pt);}}return pt.toJson();},addRoute:function(_2cb,_2cc,type,_2ce){var map=this.getMap(),_2d0=this.getBaseMapService(),obj=_2d0.addRoute(_2cb,_2cc,type,_2ce),ext=new esri.geometry.Extent({xmin:obj.xmin,ymin:obj.ymin,xmax:obj.xmax,ymax:obj.ymax,spatialReference:map.spatialReference});if(_2ce==="all"||_2ce==="this"){map.setExtent(ext,true);}else{_2d0.refresh();this._loadingHandler(false);}return ext.toJson();},clearRoutes:function(type){this.getBaseMapService().clearRoutes(type);},zoomToRoute:function(_2d4,_2d5,type){var map=this.getMap(),obj=this.getQueryService().getRouteEnvelope(_2d4,_2d5,type),ext=new esri.geometry.Extent({xmin:obj.xmin,ymin:obj.ymin,xmax:obj.xmax,ymax:obj.ymax,spatialReference:map.spatialReference});map.setExtent(ext,true);return ext.toJson();},zoomToAllAddedRoues:function(){var map=this.getMap(),obj=this.getBaseMapService().zoomToAllAddedRoutes(),ext=new esri.geometry.Extent({xmin:obj.xmin,ymin:obj.ymin,xmax:obj.xmax,ymax:obj.ymax,spatialReference:map.spatialReference});map.setExtent(ext,true);return ext.toJson();},getPrintImage:function(_2dd,_2de,dpi){return this.getBaseMapService().getPrintImage(_2dd,_2de,dpi);},getNumberOfCycleImages:function(_2e0){return this.getBaseMapService().getNumberOfCycleImages(_2e0);},getCyclePrintDetails:function(_2e1){return this.getBaseMapService().getCyclePrintDetails(_2e1);},validateTravelFilter:function(_2e2){var str=null,_2e4=false,obj={};if(util.isStringPopulated(_2e2.transportType)){str=_2e2.transportType;if(str==="all"){_2e4=true;dojo.mixin(obj,{roadIncidentsVisible:true,publicIncidentsVisible:true});}else{if(str==="road"){_2e4=true;dojo.mixin(obj,{roadIncidentsVisible:true,publicIncidentsVisible:false});}else{if(str==="public"){_2e4=true;dojo.mixin(obj,{roadIncidentsVisible:false,publicIncidentsVisible:true});}else{if(str==="none"){_2e4=true;dojo.mixin(obj,{roadIncidentsVisible:false,publicIncidentsVisible:false});}}}}}if(util.isStringPopulated(_2e2.incidentType)){str=_2e2.incidentType;if(str==="all"||str==="planned"||str==="unplanned"){_2e4=true;dojo.mixin(obj,{incidentType:_2e2.incidentType});}else{}}if(util.isStringPopulated(_2e2.severity)){str=_2e2.severity;if(str==="all"||str==="major"){_2e4=true;dojo.mixin(obj,{severity:_2e2.severity});}else{}}if(util.isStringPopulated(_2e2.timePeriod)){str=_2e2.timePeriod;if(str==="current"||str==="recent"){_2e4=true;dojo.mixin(obj,{timePeriod:_2e2.timePeriod});}else{if(str==="date"||str==="datetime"){if(util.isStringPopulated(_2e2.datetime)){str=_2e2.datetime;if(/^\d{1,2}\/\d{1,2}\/\d{2,4} \d{1,2}[\:\/]\d{1,2}$/.test(str)){_2e4=true;dojo.mixin(obj,{datetime:str.replace(/\:/g,"/"),timePeriod:_2e2.timePeriod});}else{_2e4=false;}}}else{}}}if(_2e4){return obj;}else{throw {message:this.declaredClass+"."+arguments.callee.nom+" failed to parse travel news ",obj:_2e2};}},drawCallout:function(_2e6,map,_2e8,geom){var id=null,link=null,_2ec=[],attr=_2e8.attributes,arr=attr.values,_2ef=_18a.statics,dims=_2ef.dims,win=map.infoWindow,_2f2=true,_2f3=_18a.graphics.typeEnum,type=util.isStringPopulated(attr.type)?attr.type:"Generic",text=util.isStringPopulated(attr.text)?attr.text:_2ef.pointInfoNoTitle;switch(type){case _2f3.carParks:var isPR=arr[0]==="Y",_2f7=arr[1],name=arr[2],ref=arr[3];_2f2=false;str=_2ef.misc;link=dojo.create("a",{innerHTML:str.infoPageCarParks});text="{a}, {b} {c}{d}".supplant({a:_2f7,b:name,c:(isPR?str.parkandride:""),d:str.carpark});dojo.connect(link,"onclick",function(){_18a.events.showCarParkInformation(ref);});_2ec=[link];win.resize(dims.calloutCarParks.x,dims.calloutCarParks.y);break;case _2f3.stops:var str=_2ef.misc;id=arr[0];text=arr[1];_2f2=false;link=dojo.create("a",{innerHTML:str.infoPageStops});dojo.connect(link,"onclick",function(){_18a.events.showStopsInformation(id);});_2ec=[link];win.resize(dims.calloutStops.x,dims.calloutStops.y);break;case _2f3.travelNews:case _2f3.pointX:var that=this,elm=null,_2fd=type===_2f3.travelNews,_2fe=arguments.callee.nom,_2ff=_2fd?"getTravelNewsInfo":"getPointXInfo";dims=_2fd?dims.calloutTravelNews:dims.calloutPointX;id=arr[0];win.setTitle(_2ef.misc.loading);win.setContent("<img src=\""+this.imagesPath+"ajax-loader.gif\" alt=\"Loading...\" />");win.resize(dims.x,dims.y);win.show(_2e6.screenPoint,map.getInfoWindowAnchor(_2e6.screenPoint));this.getQueryService()[_2ff](id,function(text,_301){_2e8.attributes.text=text;win.setTitle(text.replace("&apos;","&#039;"));var elm=that._getGraphicOptionLinks((_2fd?null:_2e8),_301);if(elm!==null){win.setContent(elm);that._resizeInfoWindow(win);}else{win.setContent("");dojo.style(win.containerNode,{height:"0px"});that._resizeInfoWindow(win,true);}});return;case _2f3.serverGraphic:text=util.isStringPopulated(attr.text)?attr.text:_18a.statics.misc.pt;_2ec=attr.content.length>0?[dojo.create("span",{innerHTML:attr.content})]:[];break;default:win.resize(dims.calloutGeneric.x,dims.calloutGeneric.y);break;}_2e8.attributes.text=text;win.setTitle(text.replace("&apos;","&#039;"));win.setContent(this._getGraphicOptionLinks(_2e8,_2ec,_2f2));win.show(_2e6.screenPoint,map.getInfoWindowAnchor(_2e6.screenPoint));this._resizeInfoWindow(win);},_resizeInfoWindow:function(win,_304){var dims=dojo.coords(win._titlebar);var _306=dojo.coords(util.parseBool(_304)?win.containerNode:win.containerNode.firstChild);if(util.isNumber(dojo.isIE)){dims.h+=_18a.statics.dims.ieBuffer;}win.resize(win.width,dims.h+dims.t+_306.h+_306.t);},fuzzyPan:function(pt,panx,pany){var map=this.getMap();var ex=map.extent;if(map.extent.contains(pt)){return;}else{this.toggleEvt(eventToggleEnum.ext,false);var ox=0;var oy=0;if(pt.x<ex.xmin){ox=pt.x-ex.xmin-(panx*ex.getWidth());}else{if(pt.x>ex.xmax){ox=pt.x-ex.xmax+(panx*ex.getWidth());}}if(pt.y<ex.ymin){oy=pt.y-ex.ymin-(pany*ex.getHeight());}else{if(pt.y>ex.ymax){oy=pt.y-ex.ymax+(pany*ex.getHeight());}}map.setExtent(ex.offset(ox,oy));}}};})());}if(!dojo._hasResource["ESRIUK.Dijits.Map"]){dojo._hasResource["ESRIUK.Dijits.Map"]=true;ESRIUK.Dijits.Map=ESRIUK.Dijits.Map||{};dojo._loadedModules["ESRIUK.Dijits.Map"]=ESRIUK.Dijits.Map;dojo.declare("ESRIUK.Dijits.Map",[dijit._Widget,dijit._Templated,dijit._Container],(function(){var util=ESRIUK.util(),_30f=null;return {loaded:false,_tmpConnect:null,_tmpWidth:null,_tmpHeight:null,settings:{},param_XMin:null,param_YMin:null,param_XMax:null,param_YMax:null,param_Scale:null,param_Level:null,param_Width:null,param_Height:null,param_LocationX:null,param_LocationY:null,param_Text:"",param_Mode:"",param_Tools:"",param_Symbols:"",param_Routes:"",param_TravelNews:"",param_WholePage:false,widgetsInTemplate:true,templateString:"<div class='esriuk-custom-mapbase'>\r\n  <div dojoAttachPoint='attachNavPanel' dojoType='ESRIUK.Dijits.MapNavPanel' class='mapOverlay semiTransparent' style=\"display:none\"></div>\r\n  <div dojoAttachPoint='attachToolBarPanel' dojoType='ESRIUK.Dijits.MapToolBarPanel' class='mapOverlay'></div>\r\n  <div class='sliderPanelContainer mapOverlay semiTransparent' style=\"display:none\"><div dojoAttachPoint='attachMapSliderContent' class='sliderPanelHolder mapPanel'></div></div>\r\n  <div dojoAttachPoint='attachLoading' dojoType='ESRIUK.Dijits.Loading'></div>\r\n  <div dojoAttachPoint='attachMap' dojoType='ESRIUK.Dijits.MapBase' class=\"esriuk-custom-map\"></div>\r\n</div>\r\n",imagesPath:dojo.moduleUrl("ESRIUK.Dijits","images/Map/"),constructor:function(){dojo.mixin(this,arguments[0]);this.settings={set:false,scale:null,level:null,location:{x:null,y:null},extent:{xmin:null,ymin:null,xmax:null,ymax:null},height:null,width:null,text:null,tools:[],travelNews:null,symbols:null,mode:null};ESRIUK._config=null;_30f=ESRIUK.config();dojo.subscribe(_30f.events.mapLoad,this,"onLoad");},postCreate:function(){this.inherited(arguments);this.attachLoading.toggle(true);this._readURLSettings();this._readInlineSettings();this._addRequiredCSSFiles();this._applyStyleParams(true);if(!util.isNothing(this.attachMap)){try{this.attachMap.bindLoading(this.attachLoading);this.attachMap.init(this.getMapParams());this.showPanels(this.getToolsInput());this.attachToolBarPanel.init(this.getToolsInput());}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" error initiating map widget ",innerException:err});}}else{}},startup:function(){this.inherited(arguments);var map=this.attachMap,nav=this.attachNavPanel,_312=this.attachToolBarPanel;try{map.bindNavControls(nav);map.bindToolbar(_312);this._addBugFixes();}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" error binding nav & toolbar controls ",innerException:err});}finally{this.attachLoading.toggle(false);}},onLoad:function(){this.loaded=true;_30f.events.onMapInitialiseComplete(this);},destroy:function(){this.inherited(arguments);},destroyRecursive:function(){this.inherited(arguments);},resize:function(x,y){if(util.isNumber(x,y)){try{this.setWidthInput(x);this.setHeightInput(y);this._applyStyleParams();this.attachMap.resize(x,y);}catch(err){}}else{if(util.isValidWH(x)){if(_30f.map.useResizeHandler){}else{try{this.attachMap.onScroll();}catch(err){}}}else{}}},zoomToXY:function(x,y){if(util.isNumber(x,y)){try{this.attachMap.zoomToXY(x,y);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},zoomToLevel:function(_317){if(util.isNumber(_317)){try{this.attachMap.zoomToLevel(_317);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},zoomToScale:function(_318){if(util.isNumber(_318)){try{this.attachMap.zoomToScale(_318);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},zoomToLevelAndPoint:function(x,y,_31b,text){if(util.isNumber(x,y,_31b)){try{this.attachMap.centerAndZoom(x,y,_31b,text);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},zoomToScaleAndPoint:function(x,y,_31f,text){if(util.isNumber(x,y,_31f)){try{this.attachMap.centerAndScale(x,y,_31f,text);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},zoomToExtent:function(xmin,ymin,xmax,ymax,fit){if(util.isNumber(xmin,ymin,xmax,ymax)){try{fit=util.isBoolean(fit)?fit:true;this.attachMap.zoomToExtent(new esri.geometry.Extent(util.parseNumber(xmin),util.parseNumber(ymin),util.parseNumber(xmax),util.parseNumber(ymax),this.attachMap.getMap().spatialReference),fit);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},setActiveTool:function(type){if(util.isStringPopulated(type)){try{this.attachMap.setActiveTool(type);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},addIconAndInfoWindow:function(x,y,text){if(util.isNumber(x,y)&&util.isStringPopulated(text)){try{this.attachMap.addIconAndInfoWindow(util.parseNumber(x),util.parseNumber(y),text);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},zoomToFullExtent:function(){try{this.attachMap.zoomToFullExtent();}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}},zoomPrevious:function(){try{this.attachMap.zoomToPreviousExtent();}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}},toggleLayer:function(_32a,on){return;if(util.isString(_32a)&&util.isBoolean(on)){try{this.attachMap.toggleLayer(_32a,util.parseBool(on));}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},setLayerState:function(_32c){if(util.isObject(_32c)){try{this.attachMap.setLayerState(_32c);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},addStartEndPt:function(pt){if(util.isValidXY(pt)){pt=util.validateXY(pt);try{this.attachMap.addStartEndPt(pt);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},clearPoints:function(type){try{this.attachMap.clearPoints(type);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}},getLayerList:function(){var _32f=null;try{_32f=this.attachMap.getLayerList();}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}return _32f;},getMapProperties:function(){var _330=null;try{_330=this.attachMap.getMapProperties();}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}return _330;},setTravelNews:function(_331){if(util.isObject(_331)){try{this.attachMap.setTravelNews(_331);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}},findJunctionPoint:function(_332,_333,_334,_335){var _336=null;_334=_334||null;_335=_335||false;if(util.isStringPopulated(_332)&&util.isStringPopulated(_333)){try{_336=this.attachMap.findJunctionPoint(_332,_333,_334,_335);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _336;},findITNNodePoint:function(TOID,_338,_339){var _33a=null;_338=_338||null;_339=_339||false;if(util.isStringPopulated(TOID)){try{_33a=this.attachMap.findITNNodePoint(TOID,_338,_339);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _33a;},getPrintImage:function(_33b,_33c,dpi){var _33e=null;if(util.isNumber(_33b,_33c,dpi)){try{_33e=this.attachMap.getPrintImage(util.parseNumber(_33b),util.parseNumber(_33c),util.parseNumber(dpi));}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _33e;},addRoute:function(_33f,_340,type,_342){var _343=null;_342=util.isStringPopulated(_342)?_342:"";if(util.isStringPopulated(_33f)&&util.isNumber(_340)&&util.isStringPopulated(type)){try{_343=this.attachMap.addRoute(_33f,util.parseNumber(_340),type,_342);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _343;},clearRoutes:function(type){var _345=false;type=util.isStringPopulated(type)?type:"";try{this.attachMap.clearRoutes(type);_345=true;}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}return _345;},zoomToRoute:function(_346,_347,type){var _349=null;if(util.isStringPopulated(_346)&&util.isNumber(_347)&&util.isStringPopulated(type)){try{_349=this.attachMap.zoomToRoute(_346,util.parseNumber(_347),type);}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _349;},zoomtoAllAddedRoutes:function(){var _34a=null;try{_34a=this.attachMap.zoomToAllAddedRoues();}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}return _34a;},getNumberOfCycleImages:function(_34b){var _34c=-1;if(util.isNumber(_34b)){try{_34c=this.attachMap.getNumberOfCycleImages(util.parseNumber(_34b));}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _34c;},getCyclePrintDetails:function(_34d){var _34e=null;if(util.isNumber(_34d)){try{_34e=this.attachMap.getCyclePrintDetails(util.parseNumber(_34d));}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}else{}return _34e;},setScaleInput:function(_34f){if(util.isNumber(_34f)){if(typeof _34f==="string"){_34f=util.parseNumber(_34f);}this.settings.scale=_34f;if(!this.settings.set){this.settings.set=true;}}},setLevelInput:function(_350){if(util.isNumber(_350)){if(typeof _350==="string"){_350=util.parseNumber(_350);}if(_350>0){_350--;}this.settings.level=_350;if(!this.settings.set){this.settings.set=true;}}},setLocationInput:function(_351){if(util.isObject(_351)){if(util.isNumber(_351.x,_351.y)){if(typeof _351.x==="string"){_351.x=util.parseNumber(_351.x);}if(typeof _351.y==="string"){_351.y=util.parseNumber(_351.y);}this.settings.location=_351;if(!this.settings.set){this.settings.set=true;}}}},setExtentInput:function(ext){if(util.isValidExt(ext)){if(util.isString(ext.xmin)){ext.xmin=util.parseNumber(ext.xmin);}if(util.isString(ext.ymin)){ext.ymin=util.parseNumber(ext.ymin);}if(util.isString(ext.xmax)){ext.xmax=util.parseNumber(ext.xmax);}if(util.isString(ext.ymax)){ext.ymax=util.parseNumber(ext.ymax);}this.settings.extent=ext;if(!this.settings.set){this.settings.set=true;}}},setTextInput:function(text){if(util.isStringPopulated(text)){this.settings.text=text;if(!this.settings.set){this.settings.set=true;}}},setToolsInput:function(text){if(util.isStringPopulated(text)){var arr=text.split(",");this.settings.tools=[];for(var i=0;i<arr.length;i++){if(util.isStringPopulated(arr[i])){this.settings.tools.push(arr[i]);}}if(!this.settings.set){this.settings.set=true;}}},setTravelNewsInput:function(text){if(util.isStringPopulated(text)){var arr=text.split(","),obj={};try{for(var i=0;i<arr.length;i++){var pair=arr[i].split(":");obj[pair[0]]=pair[1];}this.settings.travelNews=this.attachMap.validateTravelFilter(obj);if(!this.settings.set){this.settings.set=true;}}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}},setSymbolsInput:function(text){if(util.isStringPopulated(text)||util.isArrayPopulated(text)){try{if(typeof text==="string"){var obj=dojo.fromJson(text),arr=[];for(var i=0;i<obj.length;i++){if(util.isValidXY(obj[i])){arr.push(obj[i]);}}this.settings.symbols=arr;if(!this.settings.set){this.settings.set=true;}}else{this.settings.symbols=text;if(!this.settings.set){this.settings.set=true;}}}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}},setRouteInput:function(text){if(util.isStringPopulated(text)){var obj=dojo.fromJson(text),arr=[];try{for(var i=0;i<obj.length;i++){var o=obj[i],s=o.type;if(s==="PT"||s==="Road"||s==="Cycle"){arr.push(o);}}this.settings.routes=arr;if(!this.settings.set){this.settings.set=true;}}catch(err){_30f.events.error({message:this.declaredClass+"."+arguments.callee.nom+" failed ",innerException:err});}}},setModeInput:function(text){if(util.isStringPopulated(text)){var arr=text.split(",");this.settings.mode=[];for(var i=0;i<arr.length;i++){if(util.isStringPopulated(arr[i])){this.settings.mode.push(arr[i]);}}if(!this.settings.set){this.settings.set=true;}}},setHeightInput:function(_369){if(util.isNumber(_369)){if(typeof _369==="string"){_369=util.parseNumber(_369);}this.settings.height=_369;if(!this.settings.set){this.settings.set=true;}}},setWidthInput:function(_36a){if(util.isNumber(_36a)){if(typeof _36a==="string"){_36a=util.parseNumber(_36a);}this.settings.width=_36a;if(!this.settings.set){this.settings.set=true;}}},getScaleInput:function(){return this.settings.scale;},getLevelInput:function(){return this.settings.level;},getLocationInput:function(){return this.settings.location;},getExtentInput:function(){return this.settings.extent;},getTextInput:function(){return this.settings.text;},getToolsInput:function(){return this.settings.tools;},getHeightInput:function(){return this.settings.height;},getWidthInput:function(){return this.settings.width;},getTravelNewsInput:function(){return this.settings.travelNews;},getSymbolsInput:function(){return this.settings.symbols;},getRoutesInput:function(){return this.settings.routes;},getModeInput:function(){return this.settings.mode;},getMapParams:function(){var _36b={wholePage:this.param_WholePage},pt=this.getLocationInput(),ext=this.getExtentInput();if(this.settings.set){if(util.isValidXY(pt)){dojo.mixin(_36b,{location:pt});}else{if(util.isValidExt(ext)){dojo.mixin(_36b,{extent:ext});}}if(util.isNumber(this.getScaleInput())){dojo.mixin(_36b,{scale:this.getScaleInput()});}else{if(util.isNumber(this.getLevelInput())){dojo.mixin(_36b,{level:this.getLevelInput()});}}if(util.isStringPopulated(this.getTextInput())){dojo.mixin(_36b,{text:this.getTextInput()});}if(util.isNumber(this.getHeightInput())){dojo.mixin(_36b,{height:this.getHeightInput()});}if(util.isNumber(this.getWidthInput())){dojo.mixin(_36b,{width:this.getWidthInput()});}if(util.isObject(this.getTravelNewsInput())){dojo.mixin(_36b,{travelNews:this.getTravelNewsInput()});}if(util.isArrayPopulated(this.getSymbolsInput())){dojo.mixin(_36b,{symbols:this.getSymbolsInput()});}if(util.isArrayPopulated(this.getRoutesInput())){dojo.mixin(_36b,{routes:this.getRoutesInput()});}if(util.isArrayPopulated(this.getModeInput())){dojo.mixin(_36b,{mode:this.getModeInput()});}}return _36b;},_addRequiredCSSFiles:function(){if(util.isArrayPopulated(_30f.requiredCSSFiles)){var head=document.getElementsByTagName("head")[0],_36f=_30f.live?"":"?r="+Math.random()*1000;for(var i=0;i<_30f.requiredCSSFiles.length;i++){dojo.create("link",{type:"text/css",rel:"stylesheet",href:_30f.requiredCSSFiles[i]+_36f},head);}}},_applyStyleParams:function(_371){_371=util.isBoolean(_371)?_371:false;var _372=null;if(!this.param_WholePage){if(_371){var _373=_30f.map.defaultDimensions;if(util.isNothing(this.getHeightInput())){if(util.isNothing(_373)&&!util.isNumber(_373.height)){this.setHeight(esri.config.defaults.map.height);}else{this.setHeightInput(_373.height);}}if(util.isNothing(this.getWidthInput())){if(util.isNothing(_373)&&!util.isNumber(_373.width)){this.setWidthInput(esri.config.defaults.map.width);}else{this.setWidthInput(_373.width);}}}var _374=this.getHeightInput(),_375=this.getWidthInput();if(util.isNumber(_374)){_372={height:_374+"px"};}if(util.isNumber(_375)){if(util.isNothing(_372)){_372={width:_375+"px"};}else{_372.width=_375+"px";}}dojo.style(this.domNode,_372);}else{this._wholePageResize();}},_wholePageResize:function(){var _376=dojo.coords(this.domNode.parentNode);var _377=util.getElmGutterVertical(this.domNode.parentNode)+util.getElmGutterVertical(this.domNode);var _378=util.getElmGutterHorizontal(this.domNode.parentNode)+util.getElmGutterHorizontal(this.domNode);var h=(_376.h-_377-2);var w=(_376.w-_378-2);this.setHeightInput(h);this.setWidthInput(w);dojo.style(this.domNode,{height:h+"px",width:w+"px"});return {height:h,width:w};},_readURLSettings:function(){if(!this.settings.set){if(window.location.search){var _37b=dojo.queryToObject(window.location.search.slice(1));if(!util.isNothing(_37b.scale)){this.setScaleInput(_37b.scale);}if(!util.isNothing(_37b.level)){this.setLevelInput(_37b.level);}if(!util.isNothing(_37b.mapWidth)){this.setWidthInput(_37b.mapWidth);}if(!util.isNothing(_37b.mapHeight)){this.setHeightInput(_37b.mapHeight);}if(util.isNumber(_37b.x)&&util.isNumber(_37b.y)){this.setLocationInput({x:_37b.x,y:_37b.y});}}}},_readInlineSettings:function(){if(!this.settings.set){if(!util.isNothing(this.param_Scale)){this.setScaleInput(this.param_Scale);}if(!util.isNothing(this.param_Level)){this.setLevelInput(this.param_Level);}if(!util.isNothing(this.param_Height)){this.setHeightInput(this.param_Height);}if(!util.isNothing(this.param_Width)){this.setWidthInput(this.param_Width);}if(!util.isNothing(this.param_LocationX,this.param_LocationY)){this.setLocationInput({x:util.parseNumber(this.param_LocationX),y:util.parseNumber(this.param_LocationY)});}else{if(!util.isNothing(this.param_XMin,this.param_YMin,this.param_XMax,this.param_YMax)){this.setExtentInput({xmin:util.parseNumber(this.param_XMin),ymin:util.parseNumber(this.param_YMin),xmax:util.parseNumber(this.param_XMax),ymax:util.parseNumber(this.param_YMax)});}}if(util.isStringPopulated(this.param_Text)){this.setTextInput(this.param_Text);}if(util.isStringPopulated(this.param_Tools)){this.setToolsInput(this.param_Tools);}if(util.isStringPopulated(this.param_TravelNews)){this.setTravelNewsInput(this.param_TravelNews);}if(util.isStringPopulated(this.param_Symbols)||util.isArrayPopulated(this.param_Symbols)){this.setSymbolsInput(this.param_Symbols);}if(util.isStringPopulated(this.param_Routes)){this.setRouteInput(this.param_Routes);}if(util.isStringPopulated(this.param_Mode)){this.setModeInput(this.param_Mode);}this.param_WholePage=util.parseBool(this.param_WholePage);}},showPanels:function(arr){var _37d=arr.length,_37e=false,item;for(var i=0;i<_37d;i++){item=arr[i];if(item==="pan"){_37e=true;dojo.style(this.attachNavPanel.domNode,{display:"block"});}else{if(item==="zoom"){_37e=true;dojo.style(this.attachMapSliderContent.parentNode,{display:"block"});}}}if(!_37e){dojo.addClass(this.attachToolBarPanel.domNode,"toolbarPanelContainerFlush");}},_addBugFixes:function(){var map=this.attachMap.getMap();dojo.global.esri.Map.prototype.reposition=function(){var pos=dojo.coords(this.container,true),brdr=dojo._getBorderExtents(this.container);this.position.setX(pos.x+brdr.l);this.position.setY(pos.y+brdr.t);this.onReposition(this.position.x,this.position.y);};}};})());}